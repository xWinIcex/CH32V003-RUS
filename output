'''CH32V003 Reference Manual'''

<blockquote>V1.7
</blockquote>
<span id="overview"></span>
= Overview  =

<blockquote>Серия CH32V003 - это промышленные микроконтроллеры общего назначения, разработанные на основе 32-разрядного набора команд и архитектуры RISC-V. В них используется ядро QingKe V2A, набор команд RV32EC и поддерживается 2 уровня вложенности прерываний. Устройства этой серии оснащены широкими периферийными интерфейсами и функциональными модулями. Их внутренняя организационная структура соответствует сценариям встраиваемых приложений с низкой стоимостью и низким энергопотреблением.

Данное руководство содержит подробную информацию об использовании серии CH32V003 для разработки пользовательских приложений и применимо к продуктам данной серии с различным объемом памяти, функциональными ресурсами и пакетами; любые различия будут специально объяснены в соответствующих функциональных главах.
</blockquote>
Пожалуйста, ознакомьтесь с техническими характеристиками данного устройства в спецификации ''CH32V003DS0''. Для получения информации о ядре, пожалуйста, обратитесь к руководству ''QingKeV2_Processor_Manual''.

<span id="risc-v-обзор-версии-ядра"></span>
== RISC-V обзор версии ядра  ==

{| class="wikitable"
|-
! style="text-align: center;"|  
! style="text-align: center;"| Набор инструкций
! style="text-align: center;"| кол-во аппаратных стеков
! style="text-align: center;"| Уровни вложенности прерываний
! style="text-align: center;"| Быстрые каналы прерывания
! style="text-align: center;"| Линий потока (Flow Line)
! style="text-align: center;"| Модель таблицы векторов (Vector table model)
! style="text-align: center;"| Поддержка инструкций по подключению расширений
! style="text-align: center;"| Интерфейс отладки
|-
| style="text-align: center;"| QingKe V2A
| style="text-align: center;"| RV32EC
| style="text-align: center;"| 2
| style="text-align: center;"| 2
| style="text-align: center;"| 2
| style="text-align: center;"| 2
| style="text-align: center;"| Адреса или команды
| style="text-align: center;"| Поддерживаеся
| style="text-align: center;"| 1-wire
|}

Abbreviated description of the bit attribute in the register:

{| class="wikitable"
|-
! style="text-align: center;"| Аббревиатура
! style="text-align: center;"| Описание свойств
|-
| style="text-align: center;"| RF
| style="text-align: left;"| Свойство только для чтения, которое считывает фиксированное значение.
|-
| style="text-align: center;"| RO
| style="text-align: left;"| Атрибут, доступный только для чтения, изменяемый аппаратным обеспечением.
|-
| style="text-align: center;"| RZ
| style="text-align: left;"| Свойство только для чтения, автоматическое удаление бита 0 после операции чтения.
|-
| style="text-align: center;"| WO
| style="text-align: left;"| Атрибут только для записи (не читается, значение для чтения неопределенно)
|-
| style="text-align: center;"| WA
| style="text-align: left;"| Атрибут, доступный только для записи в безопасном режиме.
|-
| style="text-align: center;"| WZ
| style="text-align: left;"| Атрибут только для записи, автоматический сброс бита 0 после операции записи.
|-
| style="text-align: center;"| RW
| style="text-align: left;"| Читаемый и доступный для записи.
|-
| style="text-align: center;"| RWA
| style="text-align: left;"| Читаемый и доступный для записи в безопасном режиме.
|-
| style="text-align: center;"| RW1
| style="text-align: left;"| Читаемый, запись 1 допустима, запись 0 недопустима.
|-
| style="text-align: center;"| RW0
| style="text-align: left;"| Читаемый, запись 0 допустима, запись 1 недопустима.
|-
| style="text-align: center;"| RW1T
| style="text-align: left;"| Читаемый, запись 0 недопустима, запись 1 инвертирована.
|}

<span id="глава-1.-архитектура-памяти-и-шины"></span>
= <br />
Глава 1. Архитектура памяти и шины =

<span id="архитектура-шины"></span>
== 1.1 Архитектура шины ==

<blockquote>Серия CH32V003 разработана на основе набора команд RISC-V, и ее архитектура обеспечивает взаимодействие ядра, модуля арбитража, модуля DMA, хранилища SRAM и других компонентов через несколько шин. В конструкцию встроен универсальный контроллер DMA для снижения нагрузки на процессор и повышения эффективности доступа, а также механизмы защиты данных, механизмы автоматического переключения тактовых импульсов и другие меры для повышения стабильности системы. Структурная схема системы показана на рисунке 1.1.

Рисунок 1-1 Структурная схема системы CH32V003

[[File:media/image2.png|589x650px]]

Система оснащена: универсальным контроллером DMA для снижения нагрузки на процессор и повышения эффективности; управлением древовидной иерархией тактирования для снижения общего энергопотребления периферийных устройств, а также механизмами защиты данных, механизмами защиты сторожевыми таймерами и другими мерами для повышения стабильности системы.
</blockquote>
* Шина команд (I-Code) соединяет ядро с интерфейсом команд FLASH, и предварительная выборка выполняется по этой шине.
* Шина данных (D-Code) соединяет ядро с интерфейсом передачи данных FLASH для постоянной загрузки и отладки.
* Системная шина соединяет ядро с матрицей шин и используется для координации доступа к ядру, DMA, SRAM и периферийным устройствам.
* Шина DMA отвечает за DMA главного интерфейса HB, подключенного к матрице шины, доступ к которой осуществляется с помощью флэш-памяти, SRAM и периферийных устройств.
* Матрица шины отвечает за координацию доступа между системной шиной, шиной данных, шиной DMA, SRAM и мостом HB.

<span id="образ-памяти"></span>
== 1.2 Образ памяти ==

<blockquote>Семейство CH32V003 содержит программную память, память данных, основные регистры, периферийные регистры и многое другое, все они расположены в линейном пространстве объемом 4 ГБ.

Системное хранилище хранит данные в сокращенном формате, т.е. младшие байты хранятся по младшему адресу, а старшие байты хранятся по старшему адресу.

Рисунок 1-2 Образ хранилища

[[File:media/image3.png|611x763px]]
</blockquote>
<span id="распределение-памяти"></span>
=== 1.2.1 Распределение памяти  ===

<blockquote>Встроенная память SRAM емкостью 2 КБАЙТ, начальный адрес 0x20000000, поддерживает доступ к байтам, полусловам (2 байта) и полному слову (4 байта).

Встроенная программная флэш-память объемом 16 КБАЙТ (Code Flash) для хранения пользовательских приложений.

Встроенная системная память 1920B (bootloader) для хранения системного загрузчика (заводской загрузчик).

Встроенное пространство объемом 64 Б для хранения слов конфигурации поставщика, отлаженное на заводе-изготовителе и не изменяемое пользователями. Встроенное пространство объемом 64 Б для хранения пользовательских байт.
</blockquote>
<span id="глава-2-управление-питанием-pwr"></span>
= Глава 2 Управление питанием (PWR) =

<span id="обзор"></span>
== 2.1 Обзор  ==

<blockquote>Рабочее напряжение системы V<sub>DD</sub> колеблется от 2.7 to 5.5V, а встроенный регулятор напряжения обеспечивает рабочее питание, необходимое ядру.

Рисунок 2-1 Структурная схема структуры источника питания

[[File:media/image4.png|340x237px]]
</blockquote>
<span id="управление-питанием"></span>
== 2.2 Управление питанием  ==

<span id="сброс-при-включении-питания-и-сброс-при-выключении-питания"></span>
=== 2.2.1 Сброс при включении питания и Сброс при выключении питания ===

<blockquote>Система имеет внутреннюю схему сброса при включении питания и схему PDR сброса при выключении питания. Когда напряжение питания микросхемы V<sub>DD</sub> если напряжение падает ниже соответствующего порогового значения, система сбрасывается с помощью соответствующей схемы, и дополнительная внешняя схема сброса не требуется. Параметры порогового напряжения при включении приведены в соответствующем техническом описании V<sub>POR</sub> и пороговое напряжение отключения питания V<sub>PDR</sub>.

Рисунок 2-2 Принципиальная схема работы POR и PDR

[[File:media/image5.png|428x187px]]
</blockquote>
<span id="программируемый-датчик-напряжения"></span>
=== 2.2.2 Программируемый датчик напряжения ===

<blockquote>Программируемый монитор напряжения, '''PVD''', в основном используется для отслеживания изменения основного источника питания системы и сравнения его с пороговым напряжением, установленным '''PLS'''[2:0] в регистре управления питанием '''PWR_CTLR''', а при настройке регистра внешних прерываний ('''EXTI''') он может генерировать соответствующие прерывания для своевременного уведомления системы о выполнении операций предварительного отключения питания, таких как сохранение данных.

Конкретная конфигурация заключается в следующем.
</blockquote>
# Установите в поле '''PLS'''[2:0] регистра '''PWR_CTLR''' пороговое значение напряжения, которое будет контролироваться.
# Дополнительная обработка прерываний. функция '''PVD''' внутренне подключается к настройке запуска нарастающего/спадающего фронта в строке 8 модуля '''EXTI''', включает это прерывание (настраивает '''EXTI''') и генерирует прерывание '''PVD''', когда '''VDD''' падает ниже порогового значения '''PVD''' или поднимается выше порогового значения '''PVD'''.
# Установите бит '''PVDE''' в регистре '''PWR_CTLR''', чтобы включить функцию '''PVD'''.
# Считайте бит '''PVD0''' регистра состояния '''PWR_CSR''', чтобы получить текущее значение основного питания системы и соотношение пороговых значений настройки '''PLS'''[2:0], и выполните соответствующую мягкую обработку. Когда напряжение VDD превышает пороговое значение, установленное '''PLS'''[2:0], значение '''PVD0''' равно 0; когда напряжение VDD ниже порогового значения, установленного '''PLS'''[2:0], значение '''PVD0''' равно 1.

<blockquote>Figure 2-3 Schematic diagram of PVD operation

[[File:media/image6.png|372x158px]]
</blockquote>
<span id="режимы-с-низким-энергопотреблением"></span>
== 2.3 Режимы с низким энергопотреблением ==

<blockquote>После перезагрузки системы микроконтроллер переходит в нормальное рабочее состояние (режим запуска), в котором можно сэкономить энергопотребление системы, снизив основную частоту системы, отключив неиспользуемые периферийные часы или уменьшив рабочие периферийные часы. Если система не должна работать, вы можете перевести ее в режим пониженного энергопотребления и позволить системе выйти из этого состояния с помощью определенных событий.

В настоящее время микроконтроллеры предлагают 2 режима работы с низким энергопотреблением, разделенных с точки зрения различий в работе процессоров, периферийных устройств, регуляторов напряжения и т.д.
</blockquote>
* Спящий режим: Ядро перестает работать, а все периферийные устройства (включая основные частные периферийные устройства) продолжают работать.
* Режим ожидания: Остановите все часы, проснитесь и переведите часы в режим HSI.

<blockquote>Таблица 2-1 Список режимов низкого энергопотребления
</blockquote>
{| class="wikitable"
|-
! style="text-align: center;"| Режим
! style="text-align: center;"| Установки
! style="text-align: center;"| Источник события пробуждения
! style="text-align: center;"| Воздействие на тактирование
! style="text-align: center;"| Регул. напряжения
|-
| rowspan="2" style="text-align: center;"| Sleep
| style="text-align: center;"| '''WFI'''
| style="text-align: center;"| Любое прерывание
| rowspan="2" style="text-align: center;"| Часы ядра выключены, не влияет на другие системы тактирования
| rowspan="2" style="text-align: center;"| Вкл
|-
| style="text-align: center;"| '''WFE'''
| style="text-align: center;"| Событие Wake-Up
|-
| style="text-align: center;"| Standby
| style="text-align: center;"| Установить '''SLEEPDEEP''' в 1<br />
Установить '''PDDS''' в 1<br />
'''WFI''' or '''WFE'''
| style="text-align: center;"| AWU событие<br />
''Note: Любое событие может вывести систему из сна, но после этого вызова Reset нет.''
| style="text-align: center;"| HSE, HIS, PLL и тактирование переферии выключено
| style="text-align: center;"| Откл
|}

''Примечание: Бит '''SLEEPDEEP''' относится к приватным битам управления периферийными устройствами ядра, ссылка на регистр '''PFIC_SCTLR''' контроллера CH32V003.''

<span id="варианты-конфигурации-с-низким-энергопотреблением"></span>
=== 2.3.1 Варианты конфигурации с низким энергопотреблением ===

 WFI и WFE

<blockquote>WFI: Микроконтроллер включается источником прерывания с ответом контроллера прерывания, и функция обслуживания прерывания будет выполнена первой после пробуждения системы (за исключением сброса микроконтроллера).

WFE: Событие пробуждения запускает микроконтроллер для выхода из режима пониженного энергопотребления. К событиям пробуждения относятся:
</blockquote>
# Сконфигурируйте внешнюю или внутреннюю линию EXTI в режиме события, когда нет необходимости настраивать контроллер прерываний.
# Или настройте источник прерываний, эквивалентный пробуждению WFI, при котором система определяет приоритет выполнения функции обслуживания прерываний.
# Или настройте бит '''SLEEPONPEN''' так, чтобы он включал включение периферийных прерываний, но не включал прерывания в контроллере прерываний, и бит ожидания прерывания должен быть сброшен после пробуждения системы.

* '''SLEEPONEXIT'''

<blockquote>''Включен'': После выполнения команды WFI или WFE микроконтроллер гарантирует, что все ожидающие прерывания службы завершены, а затем переходит в режим пониженного энергопотребления.

''Отключен'': Микроконтроллер переходит в режим пониженного энергопотребления сразу после выполнения команды WFI или WFE.
</blockquote>
* '''SEVONPEND'''

<blockquote>''Включен'': Все прерывания или события пробуждения могут привести к снижению энергопотребления, введенного при выполнении WFE.

''Отключен'': Только прерывания или события пробуждения, включенные в контроллере прерываний, могут активировать режим низкого энергопотребления, введенный при выполнении WFE.
</blockquote>
<span id="режим-сна-sleep"></span>
=== 2.3.2 Режим сна (SLEEP)  ===

В этом режиме все контакты ввода-вывода находятся в рабочем состоянии, а все периферийные устройства работают нормально, поэтому попробуйте отключить бесполезные периферийные устройства перед переходом в спящий режим, чтобы снизить энергопотребление. В этом режиме пробуждение занимает меньше всего времени.

<blockquote>''Вход в режим'': Сконфигурируйте бит управления базовым регистром '''SLEEPDEEP'''=0, регистр управления питанием '''PDDS'''=0, выполните WFI или WFE, опционально '''SEVONPEND''' и '''SLEEPONEXIT'''.

''Выход из режима'': Произвольное прерывание или событие пробуждения.
</blockquote>
<span id="режим-ожидания-standby"></span>
=== 2.3.3 Режим ожидания (STANDBY)  ===

<blockquote>Режим ожидания представляет собой комбинацию периферийных механизмов управления тактовой частотой, основанных на режиме глубокого сна ядра (SLEEP DEEP), и позволяет регулятору напряжения работать с гораздо меньшим энергопотреблением. В этом режиме домен высокочастотных тактовых импульсов (HSE/HSI/PL) отключен, содержимое SRAM и регистра сохранено, а состояние pin-кода ввода-вывода сохранено. Система может продолжать работать после выхода из этого режима, и HSI называется системными часами по умолчанию.

Если выполняется программирование флэш-памяти, система не перейдет в режим ожидания до тех пор, пока не будет завершен доступ к памяти.

В режиме ожидания могут работать модули: независимый сторожевой таймер (IWDG), низкочастотные тактовые сигналы (LSI).

''Вход в режим'': Настройте управляющий бит основного регистра '''SLEEPDEEP'''=1, '''ODDS'''=1 в регистре управления питанием и выполните WFI или WFE, необязательно '''SEVONPEND''' и '''SLEEPONEXIT'''.

''Выход из режима'':
</blockquote>
# Любое прерывание/событие (заданное во внешнем регистре прерываний).
# Событие AWU, часы переключаются на тактирование от HSI после этого пробуждения, система не сбрасывается.

<span id="auto-пробуждение-awu"></span>
=== 2.3.4 Auto-пробуждение (AWU)  ===

<blockquote>Может быть реализован автоматический режим пробуждения без внешних прерываний. Можно запрограммировать базу времени на периодический выход из режима ожидания.

Дополнительный внутренний низкочастотный генератор тактовых импульсов LSI частотой 128 кГц используется в качестве основы для автоматического подсчета времени пробуждения.

При включении функции прерывания AWU вам необходимо установить триггер нарастания/спада фронтов 9-й линии, внутренне подключенной к модулю EXTI, и включить это прерывание (конфигурация EXTI).
</blockquote>
<span id="описание-регистров"></span>
== 2.4 Описание регистров  ==

Таблица 2-2 Список регистров, связанных с PWR

{| class="wikitable"
|-
! style="text-align: center;"| '''Наименование'''
! style="text-align: center;"| '''Адрес'''
! style="text-align: center;"| '''Описание'''
! style="text-align: center;"| '''Значение сброса'''
|-
| style="text-align: left;"| R32_PWR_CTLR
| style="text-align: center;"| 0x40007000
| style="text-align: left;"| Регистр управления питанием
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_PWR_CSR
| style="text-align: center;"| 0x40007004
| style="text-align: left;"| Регулятор питания/регистр состояния
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_PWR_AWUCSR
| style="text-align: center;"| 0x40007008
| style="text-align: left;"| Управление автоматическим пробуждением /регистрация состояния
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_PWR_AWUWR
| style="text-align: center;"| 0x4000700С
| style="text-align: left;"| Регистр значений для сравнения в окне автоматического пробуждения
| style="text-align: center;"| 0x0000003F
|-
| style="text-align: left;"| R32_PWR_AWUPSC
| style="text-align: center;"| 0x40007010
| style="text-align: left;"| Регистр коэффициента пересечения с автоматическим включением
| style="text-align: center;"| 0x00000000
|}

<span id="регистр-управления-питанием-pwr_ctlr"></span>
=== 2.4.1 Регистр управления питанием (PWR_CTLR)  ===

<blockquote>Смещение адреса: 0x00
</blockquote>
{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="8" style="text-align: center;"| Резерв
| colspan="3" style="text-align: center;"| PLS[0:2]
| style="text-align: center;"| PVDE
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| PDDS
| style="text-align: center;"| Резерв
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Знач. сброса
|-
| style="text-align: center;"| [31:8]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="9" style="text-align: center;"| [7:5]
| rowspan="9" style="text-align: center;"| PLS[2:0]
| rowspan="9" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Настройка порога контроля напряжения PVD. Подробные инструкции приведены в разделе &quot;Электрические характеристики&quot; спецификации
| rowspan="9" style="text-align: center;"| 0
|-
| style="text-align: left;"| 000:
| style="text-align: left;"| 2.85V восходящий фронт/2.7V нисходящий фронт
|-
| style="text-align: left;"| 001:
| style="text-align: left;"| 3.05V восходящий фронт/2.9V нисходящий фронт
|-
| style="text-align: left;"| 010:
| style="text-align: left;"| 3.3V восходящий фронт/3.15V нисходящий фронт
|-
| style="text-align: left;"| 011:
| style="text-align: left;"| 3.5V восходящий фронт/3.3V нисходящий фронт
|-
| style="text-align: left;"| 100:
| style="text-align: left;"| 3.7V восходящий фронт/3.5V нисходящий фронт
|-
| style="text-align: left;"| 101:
| style="text-align: left;"| 3.9V восходящий фронт/3.7V нисходящий фронт
|-
| style="text-align: left;"| 110:
| style="text-align: left;"| 4.1V восходящий фронт/3.9V нисходящий фронт
|-
| style="text-align: left;"| 111:
| style="text-align: left;"| 4.4V восходящий фронт/4.2V нисходящий фронт
|-
| rowspan="3" style="text-align: center;"| [4]
| rowspan="3" style="text-align: center;"| PVDE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: center;"| Бит флага включения функции контроля напряжения
| rowspan="3" style="text-align: center;"| 0

 

 

|-
| style="text-align: left;"| 1:
| style="text-align: left;"| Включить функцию контроля напряжения
|-
| style="text-align: left;"| 0:
| style="text-align: left;"| Отключить функцию контроля напряжения
|-
| style="text-align: center;"| [3:2]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [1]
| rowspan="3" style="text-align: center;"| PDDS
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: center;"| Бит флага включения функции контроля напряжения
| rowspan="3" style="text-align: center;"| 0

 

 

|-
| style="text-align: left;"| 1:
| style="text-align: left;"| Вход в режим ожидания
|-
| style="text-align: left;"| 0:
| style="text-align: left;"| Вход в режим сна
|-
| style="text-align: center;"| [0]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|}

<span id="power-controlstatus-register-pwr_csr"></span>
=== 2.4.2 Power Control/Status Register (PWR_CSR)  ===

<blockquote>Смещение адреса: 0x04
</blockquote>
{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="13" style="text-align: center;"| Резерв
| style="text-align: left;"| PVD0
| colspan="2" style="text-align: center;"| Резерв
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:3]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [2]
| rowspan="3" style="text-align: center;"| PVD0
| rowspan="3" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Бит флага состояния вывода PVD. Этот бит действителен, когда значение PVDE=1 в регистре PWR_CTLR
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: left;"| 1:
| style="text-align: left;"| Значения VDD и VDDA ниже порогового значения PVD, установленного PLS[2:0]
|-
| style="text-align: left;"| 0:
| style="text-align: left;"| Значения VDD и VDDA превышают пороговое значение PVD, установленное PLS[2:0]
|-
| style="text-align: center;"| [1:0]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|}

<span id="auto-wakeup-controlstatus-register-pwr_awucsr"></span>
=== 2.4.3 Auto-wakeup Control/Status Register (PWR_AWUCSR)  ===

<blockquote>Смещение адреса: 0x08
</blockquote>
{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="14" style="text-align: center;"| Резерв
| style="text-align: left;"| AWUEN
| style="text-align: left;"| Резерв
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:2]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [1]
| rowspan="3" style="text-align: center;"| AWUEN
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Включить автоматическое пробуждение
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: left;"| 1:
| style="text-align: left;"| Включение авто пробуждения
|-
| style="text-align: left;"| 0:
| style="text-align: left;"| недостоверный
|-
| style="text-align: center;"| [0]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|}

<span id="auto-wakeup-window-comparison-value-register-pwr_awuwr"></span>
=== 2.4.4 Auto-wakeup Window Comparison Value Register (PWR_AWUWR)  ===

<blockquote>Смещение адреса: 0x0C
</blockquote>
{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="10" style="text-align: center;"| Резерв
| colspan="6" style="text-align: center;"| AWUUWR[5:0]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:6]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| style="text-align: left;"| [5:0]
| style="text-align: left;"| AWUEN
| style="text-align: left;"| RW
| style="text-align: left;"| Значение окна AWU:<br />
Значение AWU окна равно входному значению<br />
AWU + 1;<br />
Значение окна AWARF используется для сравнения со<br />
значением счетчика вверх. Когда значение счетчика равно значению окна, генерируется сигнал пробуждения
| style="text-align: center;"| 0
|}

<span id="auto-wakeup-crossover-factor-register-pwr_-awupsc"></span>
=== 2.4.5 Auto-wakeup Crossover Factor Register (PWR_ AWUPSC)  ===

<blockquote>Смещение адреса: 0x10
</blockquote>
{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="12" style="text-align: center;"| Резерв
| colspan="4" style="text-align: center;"| AWUPSC[3:0]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:4]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="17" style="text-align: center;"| [3:0]
| rowspan="17" style="text-align: center;"| AWUPSC [3:0]
| rowspan="17" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| База счета времени
| rowspan="17" style="text-align: center;"| 0
|-
| style="text-align: left;"| 0000:
| style="text-align: left;"| Прескаллер выключен
|-
| style="text-align: left;"| 0001:
| style="text-align: left;"| Прескаллер выключен
|-
| style="text-align: left;"| 0010:
| style="text-align: left;"| Делитель 2
|-
| style="text-align: left;"| 0011:
| style="text-align: left;"| Делитель 4
|-
| style="text-align: left;"| 0100:
| style="text-align: left;"| Делитель 8
|-
| style="text-align: left;"| 0101:
| style="text-align: left;"| Делитель 16
|-
| style="text-align: left;"| 0110:
| style="text-align: left;"| Делитель 32
|-
| style="text-align: left;"| 0111:
| style="text-align: left;"| Делитель 64
|-
| style="text-align: left;"| 1000:
| style="text-align: left;"| Делитель 128
|-
| style="text-align: left;"| 1001:
| style="text-align: left;"| Делитель 256
|-
| style="text-align: left;"| 1010:
| style="text-align: left;"| Делитель 512
|-
| style="text-align: left;"| 1011:
| style="text-align: left;"| Делитель 1024
|-
| style="text-align: left;"| 1100:
| style="text-align: left;"| Делитель 2048
|-
| style="text-align: left;"| 1101:
| style="text-align: left;"| Делитель 4096
|-
| style="text-align: left;"| 1110:
| style="text-align: left;"| Делитель 10240
|-
| style="text-align: left;"| 1111:
| style="text-align: left;"| Делитель 61440
|}

<span id="глава-3-сброс-и-управление-тактовой-частотой-rcc"></span>
= Глава 3 Сброс и управление тактовой частотой (RCC) =

Контроллер предоставляет различные типов сбросов и настраиваемые древовидные структуры синхронизации, основанные на разделении областей электропитания и особенностях управления питанием периферийных устройств в приложениях. В этом разделе описывается область применения каждой системы тактирования.

<span id="основные-характеристики"></span>
== 3.1 Основные характеристики ==

* Несколько типов сброса
* Несколько источников тактовой частоты, управление тактовой частотой шины
* Встроенная система мониторинга и защиты внешнего источника частоты
* Независимое управление всеми периферийными часами: сброс, включение, выключение
* Поддержка вывода внутреннего тактирования

<span id="сброс"></span>
== 3.2 Сброс ==

<blockquote>Контроллер обеспечивает 2 вида сброса: сброс питания и сброс системы.
</blockquote>
<span id="сброс-питания"></span>
=== 3.2.1 Сброс питания ===

Когда происходит сброс питания, все регистры сбрасываются.

Сброс питания генерируется при возникновении следующего события:

* Сброс настроек включения/выключения питания ('''POR'''/'''PDR''')

<span id="сброс-системы"></span>
=== 3.2.2 Сброс системы ===

<blockquote>Когда происходит сброс системы, она сбрасывает флаг сброса в дополнение к регистру управления/состояния '''RCC_RSTSCKR''' и всем регистрам. Источник события сброса определяется путем просмотра бита флага сброса состояния в регистре '''RCC_RSTSCKR'''.

Сброс системы происходит при возникновении одного из следующих событий:
</blockquote>
* Низкий уровень сигнала на выводе '''NRST''' (внешний сброс)
* Окончен счет оконного сторожевого таймера ('''WWDG''' сброс) Окончен счет независимого сторожевого таймера ('''IWDG''' сброс)
* Программный сброс ('''SW''' сброс)
* Сброс от контроллера пониженного напряжения питания

<blockquote>Сброс оконного/независимого сторожевого таймера: генерируется триггером переполнения цикла подсчета периферийного таймера оконного/независимого сторожевого таймера, подробное описание которого приведено в соответствующем разделе.

Сброс программного обеспечения: Устройство CH32V003 выполняет сброс системы с помощью позиции 1 регистра '''RSTSYS''' конфигурации прерываний PFIC_'''CFGR''' в программируемом контроллере прерываний '''PFIC''' или позиции '''SYSRST''' 1 регистра конфигурации '''PFIC_SCTLR''' для сброса системного блока, подробности приведены в соответствующей главе.Low Power Management Сброс: Сброс режима ожидания будет активирован путем установки значения '''STANDBY_RST''' в положение 1 в выбранном пользователем байте. При этом будет выполнен сброс системы вместо перехода в режим ожидания после завершения процесса перехода в режим ожидания.
</blockquote>
Рисунок 3-1: Структура сброса системыНачало формы

System

Reset

Power Reset

Software Reset

WWDG Reset

IWDG Reset

Low-power Management Reset

R

PU

V

DD

/V

DDA

NRST

<span id="тактирование"></span>
== 3.3 Тактирование  ==

<span id="структура-системы-тактирования"></span>
=== 3.3.1 Структура системы тактирования ===

<blockquote>Таблица 3-2 CH32V003 диаграмма дерева тактирования

[[File:media/image7.png|633x884px]]
</blockquote>
<span id="high-speed-clock-hsihse"></span>
=== 3.3.2 High-speed Clock (HSI/HSE)  ===

<blockquote>HSI - это высокоскоростной тактовый сигнал, генерируемый внутренним RC-генератором системы с частотой 24 МГц. RC-генератор HSI может обеспечивать синхронизацию системы без каких-либо внешних устройств. Он имеет короткое время запуска. ЭТО включается и отключается установкой бита HSI в регистре '''RCC_CTLR''', а бит '''DIRTY''' указывает, является ли генератор RC HSI стабильным или нет. По умолчанию в системе для значений '''HSION''' и '''HSIRDY''' установлено значение 1 (рекомендуется не отключать их). Если установлен бит '''HSIRDYIE''' в регистре '''RCC_INTR''', будет сгенерировано соответствующее прерывание.
</blockquote>
* Заводская калибровка: Различия в производственном процессе приводят к разной частоте RC-колебаний для каждой микросхемы, поэтому калибровка HSI выполняется для каждой микросхемы перед отправкой. После сброса системы заводское значение калибровки загружается в HSICAL[7:0] регистра RCC_CTLR.
* Пользовательская настройка: В зависимости от различных напряжений или температур окружающей среды приложение может регулировать частоту HSI, используя биты '''HSITRIM'''[4:0] в регистре '''RCC_CTLR'''.

''Примечание: Если кварцевый генератор HSE выходит из строя, часы HSI используются в качестве резервного источника тактового сигнала (система защиты часов).''

<blockquote>HSE - это внешний высокоскоростной тактовый сигнал, включающий генерацию внешнего кристаллического/керамического резонатора или внешнюю высокоскоростную подачу тактового сигнала.
</blockquote>
* Внешний керамический резонатор/генератор (HSE Crystal): Внешний генератор с частотой 4 - 25 МГц обеспечивает более точный источник тактовых импульсов для системы. Дополнительную информацию можно найти в разделе &quot;Электрические характеристики&quot; спецификации. Кристалл HSE можно включать и выключать, установив бит '''HSEON''' в регистре '''RCC_CTLR'''. Бит '''HSERDY''' указывает, стабильны ли колебания кристалла HSE или нет, и аппаратное обеспечение подает тактовый сигнал в систему только после установки '''HSERDY''' в положение 1. Если установлен бит '''HSERDYIE''' регистра '''RCC_INTR''', то будет сгенерировано соответствующее прерывание.

<blockquote>Рисунок 3-3 Схема подключения высокоскоростного внешнего резонатора
</blockquote>
OSC_IN

OSC_OUT

C

L1

C

L2

4～25МГц

Нагрузочная емкость

<blockquote>''Примечание: Нагрузочный конденсатор должен располагаться как можно ближе к контакту генератора, а значение емкости должно быть выбрано в соответствии с параметрами кристалла.''
</blockquote>
* Внешний высокоскоростной источник тактовой частоты (HSE Bypass): В этом режиме источник тактовой частоты подается непосредственно с внешнего устройства на вывод '''OSC_IN''', при этом вывод '''OSC_OUT''' не подключен. Максимальная поддерживаемая частота составляет 25 МГц. Приложению необходимо установить бит '''HSEBYP''' для включения функции обхода HSE с битом '''HSEON''' равным 0, а затем снова установить бит '''HSEON'''.

<blockquote>Рисунок 3-3 Схема подключения высокоскоростного внешнего генератора
</blockquote>
OSC_IN

'''fHSE_ext'''

Внешний источник тактирования

OSC_OUT

(Не используется)

<span id="низкоскоростные-тактовые-импульсы-lsi"></span>
=== 3.3.3 Низкоскоростные тактовые импульсы (LSI) ===

<blockquote>LSI - это низкочастотный тактовый сигнал, генерируемый внутренним RC-генератором системы с частотой около 128 кГц. Он может поддерживаться в рабочем состоянии в режиме выключения и ожидания и обеспечивает синхронизацию для часов RTC, независимого сторожевого таймера и блока пробуждения. Более подробную информацию можно найти в разделе &quot;Электрические характеристики&quot; спецификации. LSI можно включать и отключать, устанавливая бит '''LSION''' в регистре '''RCC_RSTSCKR''', а затем определяя, стабильны ли RC-колебания LSI, запрашивая бит '''LSIRDY''', и аппаратное обеспечение подает тактовый сигнал только после позиции '''LSIRDY''' 1. Если установлен бит '''LSIRDYIE''' в регистре '''RCC_INTR''', то будет сгенерировано соответствующее прерывание.
</blockquote>
<span id="pll-тактирование"></span>
=== 3.3.4 PLL тактирование  ===

<blockquote>Настроив регистр '''RCC_CFGR0''' и расширенный регистр '''EXTEND_CTR''', внутренние часы PLL могут выбирать 2 источника синхронизации, эти настройки необходимо выполнить до включения PLL, после запуска PLL эти параметры изменить нельзя. Установите бит '''PLLON''' в регистре '''RCC_CTLR''' включенным и выключенным, бит '''PLLRDY''' - для указания стабильности синхронизации PLL, а аппаратное обеспечение - для подачи синхронизации в систему только после позиции 1 PLL. Если установлен бит '''PLLRDYIE''' регистра '''RCC_INTR''', то будет сгенерировано соответствующее прерывание.

PLL источник тактирования:
</blockquote>
* HSI тактирование
* HSE тактирование

<span id="тактирование-шиныпериферии"></span>
=== 3.3.5 Тактирование шины/периферии  ===

<span id="системное-тактирование-sysclk"></span>
==== 3.3.5.1 Системное тактирование (SYSCLK)  ====

<blockquote>Настройте источник системных тактовых импульсов, настроив регистр '''RCC_CFGR0''' биты '''SW'''[1:0], '''СЕК'''[1:0] указывает текущий источник системных тактовых импульсов.
</blockquote>
* HSI как источник тактов для системы
* HSE как источник тактов для системы
* PLL как источник тактов для системы

<blockquote>После перезагрузки контроллера в качестве системного источника тактовых импульсов выбираются часы HSI по умолчанию. Переключение между источниками тактовых импульсов должно происходить только тогда, когда целевой источник тактовых импульсов готов.
</blockquote>
<span id="hb-тактирование-шины-периферии-hclk"></span>
==== 3.3.5.2 HB тактирование шины периферии (HCLK)  ====

<blockquote>Тактовые частоты шины HB можно настроить, настроив биты '''PRE'''[3:0] регистра '''RCC_CFGR0'''. Тактовые частоты шины определяют опорную частоту доступа к периферийному интерфейсу, которая устанавливается под ними. Приложения могут настраивать различные значения, чтобы снизить энергопотребление при работе некоторых периферийных устройств. Различные разряды в регистрах '''RCC_APB1RSTR''' и '''RCC_APB2PRSTR''' могут возвращать различные периферийные модули в исходное состояние.

Каждый бит в регистрах '''RCC_AHBLPENR''', '''RCC_APB1PCENR''' и '''RCC_APB2PCENR''' может использоваться для индивидуального включения или выключения интерфейса синхронизации связи для различных периферийных модулей. При использовании периферийного устройства вам сначала необходимо включить его бит включения тактовой частоты, чтобы получить доступ к его регистрам.
</blockquote>
<span id="тактирование-независимого-сторожевого-таймера"></span>
==== 3.3.5.3 Тактирование независимого сторожевого таймера  ====

<blockquote>Если независимый сторожевой таймер был установлен с помощью аппаратной конфигурации или запущен с помощью программного обеспечения, генератор LSI будет включен принудительно и не может быть выключен. После стабилизации генератора LSI тактовый сигнал подается на IWDG.
</blockquote>
<span id="выход-тактирования-микроконтроллера-mco"></span>
==== 3.3.5.4 Выход тактирования микроконтроллера (MCO)  ====

<blockquote>Микроконтроллер позволяет выводить тактовые сигналы на контакты MCO. Следующие 4 тактовых сигнала могут быть выбраны в качестве выходных сигналов синхронизации MCO путем настройки режима мультиплексированного двухтактного вывода в соответствующих регистрах порта GPIO путем настройки битов '''MCO'''[2:0] регистра '''RCC_CFGR0'''.
</blockquote>
* Системный (SYSCLK) вывод тактов
* HSI вывод тактов
* HSE вывод тактов
* PLL вывод тактов

<span id="защита-системы-тактирования"></span>
=== 3.3.6 Защита системы тактирования  ===

<blockquote>Система clock safety system - это механизм оперативной защиты контроллера, который переключается на внутреннее тактирование HSI в случае сбоя внешнего тактирования HSE и генерирует прерывании, позволяющее прикладному программному обеспечению выполнить обработку этого события.

Система clock security system активируется установкой '''CSSON''' в положение 1 регистра '''RCC_CTLR'''. После этого мониторинг часов может быть включен после задержки запуска генератора HSE ('''HSERDY'''=1) и будет выключен после отключения часов HSE. Как только часы HSE выйдут из строя во время работы системы, генератор HSE будет выключен, событие сбоя часов будет отправлено на '''TIM1_BKIN''' вход таймера расширенного управления (TIM1), и будет сгенерировано защитное прерывание часов с позицией CSSF 1, и приложение перейдет в немаскируемое прерывание NMI. Установив бит '''CSSC''', можно снять флаг бита '''CSSF''' и отменить бит ожидания прерывания NMI.

Если в качестве системного тактирования используется текущее значение HSE или если текущее значение HSE используется в качестве входных тактов для PLL, а PLL используется в качестве системного тактирования, система безопасности тактирования автоматически переключит системную на генератор HSI и отключит генератор HSE и PLL в случае сбоя HSE.
</blockquote>
<span id="описание-регистров-1"></span>
== 3.4 Описание регистров  ==

Таблица 3-1 Список регистров, связанных с RCC

{| class="wikitable"
|-
! style="text-align: center;"| '''Наименование'''
! style="text-align: center;"| '''Адрес'''
! style="text-align: center;"| '''Описание'''
! style="text-align: center;"| '''Значение сброса'''
|-
| style="text-align: left;"| R32_RCC_CTLR
| style="text-align: center;"| 0x40021000
| style="text-align: left;"| Регистр управления тактированием
| style="text-align: center;"| 0x0000xx83
|-
| style="text-align: left;"| R32_RCC_CFGR0
| style="text-align: center;"| 0x40021004
| style="text-align: left;"| Регистр конфигурации тактирования 0
| style="text-align: center;"| 0x00000020
|-
| style="text-align: left;"| R32_RCC_INTR
| style="text-align: center;"| 0x40021008
| style="text-align: left;"| Регистр прерываний тактирования
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_RCC_APB2PRSTR
| style="text-align: center;"| 0x4002100C
| style="text-align: left;"| Регистр сброса периферийной шины PB2
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_RCC_APB1PRSTR
| style="text-align: center;"| 0x40021010
| style="text-align: left;"| Регистр сброса периферийной шины PB1
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_RCC_AHBPCENR
| style="text-align: center;"| 0x40021014
| style="text-align: left;"| Регистр включения тактирования периферийной шины HB
| style="text-align: center;"| 0x00000004
|-
| style="text-align: left;"| R32_RCC_APB2PCENR
| style="text-align: center;"| 0x40021018
| style="text-align: left;"| Регистр включения тактирования периферийной шины PB2
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_RCC_APB1PCENR
| style="text-align: center;"| 0x4002101C
| style="text-align: left;"| Регистр включения тактирования периферийной шины PB1
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_RCC_RSTSCKR
| style="text-align: center;"| 0x40021024
| style="text-align: left;"| Регистр статуса/управления
| style="text-align: center;"| 0x0C000000
|}

<span id="регистр-управления-тактированием-rcc_ctlr"></span>
=== 3.4.1 Регистр управления тактированием (RCC_CTLR)  ===

<blockquote>Смещение адреса: 0x00
</blockquote>
{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="6" style="text-align: center;"| Резерв
| style="text-align: center;"| PLL RDY
| style="text-align: center;"| PLL ON
| colspan="4" style="text-align: center;"| Резерв
| style="text-align: center;"| CSS ON
| style="text-align: center;"| HSEBYP
| style="text-align: center;"| HSERDY
| style="text-align: center;"| HSEON
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="8" style="text-align: center;"| HSICAL[7:0]
| colspan="5" style="text-align: center;"| HSITRIM[4:0]
| style="text-align: center;"| Рез.
| style="text-align: center;"| HSIRDY
| style="text-align: center;"| HSION
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Знач. сброса
|-
| style="text-align: center;"| [31:26]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [25]
| rowspan="3" style="text-align: center;"| PLLRDY
| rowspan="3" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Бит готовности к блокировке тактовой частоты PLL
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Частота PLL заблокирована
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Частота PLL не заблокирована
|-
| rowspan="3" style="text-align: center;"| [24]
| rowspan="3" style="text-align: center;"| PLLON
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Управляющий бит включения такттирования PLL
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включить такрирование PLL
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключить такрирование PLL
|-
| style="text-align: center;"| [23:20]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [19]
| rowspan="3" style="text-align: center;"| CSSON
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит включения зищиты системы тактирования
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включение защиты тактирования. Когда HSE готов (флаг HSERDY=1), аппаратное обеспечение активирует функцию мониторинга тактовой частоты HSE и устанавливает флаг CSSF и прерывание NMI при обнаружении аномалии в работе HSE; когда HSE не готов, аппаратное обеспечение отключает функцию мониторинга тактового сигнала HSE
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключение защиты тактирования
|-
| rowspan="4" style="text-align: center;"| [18]
| rowspan="4" style="text-align: center;"| HSEBYP
| rowspan="4" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит управления обходом внешнего высокоскоростного тактирования
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Байпас внешнего кварцевого генератора/резонатора
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Байпас отключен
|-
| colspan="2" style="text-align: left;"| Примечание: этот бит будет записан при HSEON=0
|-
| rowspan="4" style="text-align: center;"| [17]
| rowspan="4" style="text-align: center;"| HSERDY
| rowspan="4" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Бит готовности внешнего высокоскоростного тактового генератора (устанавливается аппаратно)
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Стабильное внешнее тактирование
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Внешнее тактирование не стабильно
|-
| colspan="2" style="text-align: left;"| Примечание: этот бит будет записан при HSEON=0 через 6 тактов
|-
| rowspan="4" style="text-align: center;"| [16]
| rowspan="4" style="text-align: center;"| HSEON
| rowspan="4" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит управления включением внешнего высокоскоростного кристаллического генератора
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включить такрирование HSE
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключить такрирование HSE
|-
| colspan="2" style="text-align: left;"| Примечание: Этот бит автоматически сбрасывается в 0 аппаратным обеспечением после входа в режим Standby
|-
| style="text-align: center;"| [15:8]
| style="text-align: center;"| HSICAL
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Значение калибровки внутреннего высокоскоростного тактового генератора, которое автоматически инициализируется при запуске системы
| style="text-align: center;"| xxh
|-
| style="text-align: center;"| [7:3]
| style="text-align: center;"| HSITRIM
| style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Внутреннее значение регулировки высокоскоростного тактового генератора. Пользователь может ввести корректирующее значение, которое будет наложено на значение HSICAL[7:0], чтобы настроить частоту внутреннего RC-генератора HSI с учетом изменений напряжения и температуры. По умолчанию установлено значение 16, что позволяет настроить HSI на 24 МГц ±1%. Изменение значения HSICAL регулируется примерно на 60 кГц за шаг
| style="text-align: center;"| 10000
|-
| style="text-align: center;"| [2]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="4" style="text-align: center;"| [1]
| rowspan="4" style="text-align: center;"| HSIRDY
| rowspan="4" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Бит готовности внутреннего тактового генератора (24MHz) (устанавливается аппаратно)
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Стабильное внутреннее тактирование
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Внутреннее тактирование не стабильно
|-
| colspan="2" style="text-align: left;"| Примечание: этот бит будет записан при HSEON=0 через 6 тактов
|-
| rowspan="4" style="text-align: center;"| [0]
| rowspan="4" style="text-align: center;"| HSION
| rowspan="4" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит управления включением внутреннего тактового генератора
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включить такрирование HSI
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключить такрирование HIS
|-
| colspan="2" style="text-align: left;"| Примечание: Этот бит автоматически сбрасывается в 0 аппаратным обеспечением после входа в режим Standby
|}

<span id="регистр-конфигурации-тактирования-0-rcc_cfgr0"></span>
=== 3.4.2 Регистр конфигурации тактирования 0 (RCC_CFGR0)  ===

<blockquote>Смещение адреса: 0x04
</blockquote>
{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="5" style="text-align: center;"| Резерв
| colspan="3" style="text-align: center;"| MCO[2:0]
| colspan="7" style="text-align: center;"| Резерв
| style="text-align: left;"| PLLSRC
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="5" style="text-align: center;"| ADCPRE[4:0]
| colspan="3" style="text-align: center;"| Резерв
| colspan="4" style="text-align: center;"| HPRE[3:0]
| colspan="2" style="text-align: center;"| SWS[1:0]
| colspan="2" style="text-align: center;"| SW[1:0]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Знач. сброса
|-
| style="text-align: center;"| [31:27]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="6" style="text-align: center;"| [26:24]
| rowspan="6" style="text-align: center;"| MCO[2:0]
| rowspan="6" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Управление тактированием выхода микроконтрроллера на пин MCO
| rowspan="6" style="text-align: center;"| 0
|-
| style="text-align: right;"| 0xx:
| style="text-align: left;"| Нет тактирования на выход
|-
| style="text-align: right;"| 100:
| style="text-align: left;"| Выход тактируется от системных часов (SYSCLK)
|-
| style="text-align: right;"| 101:
| style="text-align: left;"| Выход тактируется от HSI (24MHz)
|-
| style="text-align: right;"| 110:
| style="text-align: left;"| Выход тактируется от внешнего резонатора HSE
|-
| style="text-align: right;"| 111:
| style="text-align: left;"| Выход тактируется от PLL
|-
| style="text-align: center;"| [23:17]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [16]
| rowspan="3" style="text-align: center;"| PLLSRC
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Источник входного тактового сигнала для PLL (записывается только при выключенном PLL)
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| HSE подается на PLL без деления частоты
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| HSI подается на PLL без деления частоты
|-
| rowspan="22" style="text-align: center;"| [15:11]
| rowspan="22" style="text-align: center;"| ADCPRE [4:0]
| rowspan="22" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Управление предделителем источника тактовой частоты АЦП {13:11,15:14}
| rowspan="22" style="text-align: center;"| 0
|-
| style="text-align: left;"| 000xx:
| style="text-align: left;"| HBCLK деленное на 2 как тактирование для АЦП
|-
| style="text-align: left;"| 010xx:
| style="text-align: left;"| HBCLK деленное на 4 как тактирование для АЦП
|-
| style="text-align: left;"| 100xx:
| style="text-align: left;"| HBCLK деленное на 6 как тактирование для АЦП
|-
| style="text-align: left;"| 110xx:
| style="text-align: left;"| HBCLK деленное на 8 как тактирование для АЦП
|-
| style="text-align: left;"| 00100:
| style="text-align: left;"| HBCLK деленное на 4 как тактирование для АЦП
|-
| style="text-align: left;"| 00101:
| style="text-align: left;"| HBCLK деленное на 8 как тактирование для АЦП
|-
| style="text-align: left;"| 00110:
| style="text-align: left;"| HBCLK деленное на 16 как тактирование для АЦП
|-
| style="text-align: left;"| 00111:
| style="text-align: left;"| HBCLK деленное на 32 как тактирование для АЦП
|-
| style="text-align: left;"| 01100:
| style="text-align: left;"| HBCLK деленное на 8 как тактирование для АЦП
|-
| style="text-align: left;"| 01101:
| style="text-align: left;"| HBCLK деленное на 16 как тактирование для АЦП
|-
| style="text-align: left;"| 01110:
| style="text-align: left;"| HBCLK деленное на 32 как тактирование для АЦП
|-
| style="text-align: left;"| 01111:
| style="text-align: left;"| HBCLK деленное на 64 как тактирование для АЦП
|-
| style="text-align: left;"| 10100:
| style="text-align: left;"| HBCLK деленное на 12 как тактирование для АЦП
|-
| style="text-align: left;"| 10101:
| style="text-align: left;"| HBCLK деленное на 24 как тактирование для АЦП
|-
| style="text-align: left;"| 10110:
| style="text-align: left;"| HBCLK деленное на 48 как тактирование для АЦП
|-
| style="text-align: left;"| 10111:
| style="text-align: left;"| HBCLK деленное на 96 как тактирование для АЦП
|-
| style="text-align: left;"| 11100:
| style="text-align: left;"| HBCLK деленное на 16 как тактирование для АЦП
|-
| style="text-align: left;"| 11101:
| style="text-align: left;"| HBCLK деленное на 32 как тактирование для АЦП
|-
| style="text-align: left;"| 11110:
| style="text-align: left;"| HBCLK деленное на 64 как тактирование для АЦП
|-
| style="text-align: left;"| 11111:
| style="text-align: left;"| HBCLK деленное на 128 как тактирование для АЦП
|-
| colspan="2" style="text-align: left;"| Примечание: Тактовая частота АЦП не должна превышать максимальное значение 24 МГц
|-
| style="text-align: center;"| [10:8]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="18" style="text-align: center;"| [7:4]
| rowspan="18" style="text-align: center;"| HPRE[3:0]
| rowspan="18" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Управление предделителем источника тактовой частоты HB
| rowspan="18" style="text-align: center;"| 0010
|-
| style="text-align: left;"| 0000:
| style="text-align: left;"| Предделитель отключен
|-
| style="text-align: left;"| 0001:
| style="text-align: left;"| SYSCLK / 2
|-
| style="text-align: left;"| 0010:
| style="text-align: left;"| SYSCLK / 3
|-
| style="text-align: left;"| 0011:
| style="text-align: left;"| SYSCLK / 4
|-
| style="text-align: left;"| 0100:
| style="text-align: left;"| SYSCLK / 5
|-
| style="text-align: left;"| 0101:
| style="text-align: left;"| SYSCLK / 6
|-
| style="text-align: left;"| 0110:
| style="text-align: left;"| SYSCLK / 7
|-
| style="text-align: left;"| 0111:
| style="text-align: left;"| SYSCLK / 8
|-
| style="text-align: left;"| 1000:
| style="text-align: left;"| SYSCLK / 2
|-
| style="text-align: left;"| 1001:
| style="text-align: left;"| SYSCLK / 4
|-
| style="text-align: left;"| 1010:
| style="text-align: left;"| SYSCLK / 8
|-
| style="text-align: left;"| 1011:
| style="text-align: left;"| SYSCLK / 16
|-
| style="text-align: left;"| 1100:
| style="text-align: left;"| SYSCLK / 32
|-
| style="text-align: left;"| 1101:
| style="text-align: left;"| SYSCLK / 64
|-
| style="text-align: left;"| 1110:
| style="text-align: left;"| SYSCLK / 128
|-
| style="text-align: left;"| 1111:
| style="text-align: left;"| SYSCLK / 256
|-
| colspan="2" style="text-align: left;"| Примечание: Если коэффициент предделителя источника тактовой частоты HB больше 1, необходимо включить буфер предварительной выборки.
|-
| rowspan="5" style="text-align: center;"| [3:2]
| rowspan="5" style="text-align: center;"| SWS[1:0]
| rowspan="5" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Статус системных часов (SYSCLK) (устанавливается аппаратно)
| rowspan="5" style="text-align: center;"| 0
|-
| style="text-align: left;"| 00:
| style="text-align: left;"| Тактирование SYSCLK по тактированию из HSI
|-
| style="text-align: left;"| 01:
| style="text-align: left;"| Тактирование SYSCLK по тактированию из HSE
|-
| style="text-align: left;"| 10:
| style="text-align: left;"| Тактирование SYSCLK по тактированию из PLL
|-
| style="text-align: left;"| 11:
| style="text-align: left;"| Недоступно
|-
| rowspan="6" style="text-align: center;"| [1:0]
| rowspan="6" style="text-align: center;"| SW[1:0]
| rowspan="6" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Выбор источника тактирования для системных часов (SYSCLK)
| rowspan="6" style="text-align: center;"| 0
|-
| style="text-align: left;"| 00:
| style="text-align: left;"| Тактирование SYSCLK по тактированию из HSI
|-
| style="text-align: left;"| 01:
| style="text-align: left;"| Тактирование SYSCLK по тактированию из HSE
|-
| style="text-align: left;"| 10:
| style="text-align: left;"| Тактирование SYSCLK по тактированию из PLL
|-
| style="text-align: left;"| 11:
| style="text-align: left;"| Недоступно
|-
| colspan="2" style="text-align: left;"| Примечание: При включении функции защиты тактового сигнала (CSSON=1) в случае возврата из режимов Standby и Stop или при отказе внешнего генератора HSE, используемого в качестве системного тактового сигнала, внутренний генератор HSI принудительно выбирается аппаратно в качестве системного тактового сигнала
|}

<span id="регистр-прерываний-тактирования-rcc_intr"></span>
=== 3.4.3 Регистр прерываний тактирования (RCC_INTR)  ===

<blockquote>Смещение адреса: 0x08
</blockquote>
{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="8" style="text-align: center;"| Резерв
| style="text-align: center;"| CSSC
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| PLLRDYC
| style="text-align: center;"| HSERDYC
| style="text-align: center;"| HSIRDYC
| style="text-align: center;"| Ре

з.

| style="text-align: center;"| LSIRDYC
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="3" style="text-align: center;"| Резерв
| style="text-align: center;"| PLLEDYIE
| style="text-align: center;"| HSERDYIE
| style="text-align: center;"| HSIRDYIE
| style="text-align: center;"| Ре з.
| style="text-align: center;"| LSIRDYIE
| style="text-align: center;"| CSSF
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| PLLRDYF
| style="text-align: center;"| HSERDYF
| style="text-align: center;"| HSIRDYF
| style="text-align: center;"| Ре з.
| style="text-align: center;"| LSIRDYF
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Знач. сброса
|-
| style="text-align: center;"| [31:24]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [23]
| rowspan="3" style="text-align: center;"| CSSC
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| Сбросить флаг прерывания системы безопасности тактового генератора (CSSF)
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Сбросить флаг прерывания CSSF
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Не сбрасывать
|-
| style="text-align: center;"| [22:21]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [20]
| rowspan="3" style="text-align: center;"| PLLRDYC
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| Сбросить флаг готовности прерывания PLL
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Отчистить флаг прерывания PLLRDYF
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Не сбрасывать
|-
| rowspan="3" style="text-align: center;"| [19]
| rowspan="3" style="text-align: center;"| HSERDYC
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| Сбросить флаг готовности прерывания HSE
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Отчистить флаг прерывания HSERDYF
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Не сбрасывать
|-
| rowspan="3" style="text-align: center;"| [18]
| rowspan="3" style="text-align: center;"| HSIRDYC
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| Сбросить флаг готовности прерывания HSI
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Отчистить флаг прерывания HSIRDYF
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Не сбрасывать
|-
| style="text-align: center;"| [17]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [16]
| rowspan="3" style="text-align: center;"| LSIRDYC
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| Сбросить флаг готовности прерывания LSI
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Отчистить флаг прерывания LSIRDYF
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Не сбрасывать
|-
| style="text-align: center;"| [15:13]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [12]
| rowspan="3" style="text-align: center;"| PLLRDYIE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит разрешения прерывания по готовности PLL
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включить прерывание
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключить прерывание
|-
| rowspan="3" style="text-align: center;"| [11]
| rowspan="3" style="text-align: center;"| HSERDYIE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит разрешения прерывания по готовности HSE
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включить прерывание
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключить прерывание
|-
| rowspan="3" style="text-align: center;"| [10]
| rowspan="3" style="text-align: center;"| HSIRDYIE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит разрешения прерывания по готовности HSI
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включить прерывание
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключить прерывание
|-
| style="text-align: center;"| [9]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [8]
| rowspan="3" style="text-align: center;"| LSIRDYIE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит разрешения прерывания по готовности LSI
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включить прерывание
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключить прерывание
|-
| rowspan="3" style="text-align: center;"| [7]
| rowspan="3" style="text-align: center;"| CSSF
| rowspan="3" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Флаг прерывания по системе безопасности тактового генератора
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Отказ тактового сигнала HSE, который генерирует прерывание безопасности тактового сигнала CSSI
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет прерывания от системы безопасности тактового генератора. Устанавливается аппаратно, программная запись бита CSSC со значением 1 очищает его
|-
| style="text-align: center;"| [6:5]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="4" style="text-align: center;"| [4]
| rowspan="4" style="text-align: center;"| PLLRDYF
| rowspan="4" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Флаг блокировки прерывания готовности тактового сигнала PLL
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Блокировка тактового сигнала PLL, вызывающая прерывание
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет блокировки прерывания тактового сигнала PLL
|-
| colspan="2" style="text-align: left;"| Устанавливается аппаратно, программная запись бита PLLRDYC=1 очищает его
|-
| rowspan="4" style="text-align: center;"| [3]
| rowspan="4" style="text-align: center;"| HSERDYF
| rowspan="4" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Флаг блокировки прерывания готовности тактового сигнала HSE
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Блокировка тактового сигнала HSE, вызывающая прерывание
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет блокировки прерывания тактового сигнала HSE
|-
| colspan="2" style="text-align: left;"| Устанавливается аппаратно, программная запись бита HSERDYC=1 очищает его
|-
| rowspan="4" style="text-align: center;"| [2]
| rowspan="4" style="text-align: center;"| HSIRDYF
| rowspan="4" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Флаг блокировки прерывания готовности тактового сигнала HSI
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Блокировка тактового сигнала HSI, вызывающая прерывание
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет блокировки прерывания тактового сигнала HSI
|-
| colspan="2" style="text-align: left;"| Устанавливается аппаратно, программная запись бита HSIRDYC=1 очищает его
|-
| style="text-align: center;"| [1]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="4" style="text-align: center;"| [0]
| rowspan="4" style="text-align: center;"| LSIRDYF
| rowspan="4" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Флаг блокировки прерывания готовности тактового сигнала LSI
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Блокировка тактового сигнала LSI, вызывающая прерывание
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет блокировки прерывания тактового сигнала LSI
|-
| colspan="2" style="text-align: left;"| Устанавливается аппаратно, программная запись бита LSIRDYC=1 очищает его
|}

<span id="регистр-сброса-периферийной-шины-pb2-rcc_apb2prstr"></span>
=== 3.4.4 Регистр сброса периферийной шины PB2 (RCC_APB2PRSTR)  ===

<blockquote>Смещение адреса: 0x0С
</blockquote>
{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| style="text-align: center;"| Рез.
| style="text-align: center;"| USART

1RST

| style="text-align: center;"| Рез.
| style="text-align: center;"| SPI1

RST

| style="text-align: center;"| TIM1

RST

| style="text-align: center;"| Рез.
| style="text-align: center;"| ADC1

RST

| colspan="3" style="text-align: center;"| Резерв
| style="text-align: center;"| IOPD

RST

| style="text-align: center;"| IOPC

RST

| style="text-align: center;"| Рез.
| style="text-align: center;"| IOPA

RST

| style="text-align: center;"| Рез.
| style="text-align: center;"| AFIO

RST

|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Знач. сброса
|-
| style="text-align: center;"| [31:15]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [14]
| rowspan="3" style="text-align: center;"| USART1 RST
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Управление сбросом интерфейса USART1
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Сброс модуля
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Без изменений
|-
| style="text-align: center;"| [15]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [12]
| rowspan="3" style="text-align: center;"| SPI1RST
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Управление сбросом интерфейса SPI1
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Сброс модуля
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Без изменений
|-
| rowspan="3" style="text-align: center;"| [11]
| rowspan="3" style="text-align: center;"| TIM1RST
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Управление сбросом интерфейса TIM1
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Сброс модуля
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Без изменений
|-
| style="text-align: center;"| [10]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [9]
| rowspan="3" style="text-align: center;"| ADC1RST
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Управление сбросом интерфейса ADC1
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Сброс модуля
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Без изменений
|-
| style="text-align: center;"| [8:6]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [5]
| rowspan="3" style="text-align: center;"| IOPDRST
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Управление сбросом порта ввода-вывода D
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Сброс модуля
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Без изменений
|-
| rowspan="3" style="text-align: center;"| [4]
| rowspan="3" style="text-align: center;"| IOPCRST
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Управление сбросом порта ввода-вывода C
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Сброс модуля
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Без изменений
|-
| style="text-align: center;"| [3]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [2]
| rowspan="3" style="text-align: center;"| IOPARST
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Управление сбросом порта ввода-вывода A
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Сброс модуля
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Без изменений
|-
| style="text-align: center;"| [1]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [0]
| rowspan="3" style="text-align: center;"| AFIORST
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Управление сбросом интерфейса вспомогательных функций портов ввода-вывода
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Сброс модуля
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Без изменений
|}

<span id="регистр-сброса-периферийной-шины-pb1-rcc_apb1prstr"></span>
=== 3.4.5 Регистр сброса периферийной шины PB1 (RCC_APB1PRSTR)  ===

<blockquote>Смещение адреса: 0x10
</blockquote>
{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="3" style="text-align: center;"| Резерв
| style="text-align: left;"| PWRRST
| colspan="6" style="text-align: center;"| Резерв
| style="text-align: left;"|  
| colspan="5" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="4" style="text-align: center;"| Резерв
| style="text-align: center;"| WWDG

RST

| colspan="10" style="text-align: center;"| Резерв
| style="text-align: center;"| TIM2

RST

|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Знач. сброса
|-
| style="text-align: center;"| [31:29]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [28]
| rowspan="3" style="text-align: center;"| PWRRST
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Управление сбросом интерфейса управления питанием
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Сброс модуля
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Без изменений
|-
| style="text-align: center;"| [27:22]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [21]
| rowspan="3" style="text-align: center;"| I2C1RST
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Управление сбросом интерфейса шины I2C1
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Сброс модуля
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Без изменений
|-
| style="text-align: center;"| [20:12]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [11]
| rowspan="3" style="text-align: center;"| WWDGRST
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Управление сбросом интерфейса оконного сторожевого таймера
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Сброс модуля
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Без изменений
|-
| style="text-align: center;"| [10:1]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [0]
| rowspan="3" style="text-align: center;"| TIM2RST
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Управление сбросом интерфейса таймера TIM2
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Сброс модуля
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Без изменений
|}

<span id="регистр-включения-тактирования-периферийной-шины-hb-rcc_ahbpcenr"></span>
=== 3.4.6 Регистр включения тактирования периферийной шины HB (RCC_AHBPCENR)  ===

<blockquote>Смещение адреса: 0x14
</blockquote>
{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="13" style="text-align: center;"| Резерв
| style="text-align: center;"| SRAM

EN

| style="text-align: center;"| Рез.
| style="text-align: center;"| DMA1

EN

|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Знач. сброса
|-
| style="text-align: center;"| [31:3]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [2]
| rowspan="3" style="text-align: center;"| SRAMEN
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит включения тактового сигнала модуля интерфейса SRAM
| rowspan="3" style="text-align: center;"| 1
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Тактовый сигнал модуля интерфейса SRAM остается активным во время режима сна
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Тактовый сигнал модуля интерфейса SRAM отключается в режиме сна
|-
| style="text-align: center;"| [1]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [0]
| rowspan="3" style="text-align: center;"| DMA1EN
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит включения тактового сигнала модуля DMA1
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Тактовый сигнал модуля включен
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Тактовый сигнал модуля отключен
|}

<span id="регистр-включения-тактирования-периферийной-шины-pb2-rcc_apb2pcenr"></span>
=== 3.4.7 Регистр включения тактирования периферийной шины PB2 (RCC_APB2PCENR)  ===

<blockquote>Смещение адреса: 0x18
</blockquote>
{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! colspan="2" style="text-align: center;"| 21
! colspan="2" style="text-align: center;"| 20
! colspan="2" style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="19" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| colspan="2" style="text-align: center;"| 5
| colspan="2" style="text-align: center;"| 4
| colspan="2" style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| style="text-align: center;"| Рез.
| style="text-align: center;"| USART1EN
| style="text-align: center;"| Рез.
| style="text-align: center;"| SPI1EN
| style="text-align: center;"| TIM1EN
| style="text-align: center;"| Рез.
| style="text-align: center;"| ADC1

EN

| colspan="4" style="text-align: center;"| Резерв
| colspan="2" style="text-align: center;"| IOPDEN
| colspan="2" style="text-align: center;"| IOPCEN
| style="text-align: center;"| Рез.
| style="text-align: center;"| IOPAEN
| style="text-align: center;"| Рез.
| style="text-align: center;"| AFIOEN
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Знач. сброса
|-
| style="text-align: center;"| [31:15]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [14]
| rowspan="3" style="text-align: center;"| USART1EN
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит включения тактового сигнала интерфейса USART1
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Тактовый сигнал включен
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Тактовый сигнал отключен
|-
| style="text-align: center;"| [13]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [12]
| rowspan="3" style="text-align: center;"| SPI1EN
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит включения тактового сигнала интерфейса SPI1
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Тактовый сигнал включен
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Тактовый сигнал отключен
|-
| rowspan="3" style="text-align: center;"| [11]
| rowspan="3" style="text-align: center;"| USART1EN
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит включения тактового сигнала интерфейса TIM1
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Тактовый сигнал включен
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Тактовый сигнал отключен
|-
| style="text-align: center;"| [10]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [9]
| rowspan="3" style="text-align: center;"| ADC1EN
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит включения тактового сигнала интерфейса ADC1
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Тактовый сигнал включен
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Тактовый сигнал отключен
|-
| style="text-align: center;"| [8:6]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [5]
| rowspan="3" style="text-align: center;"| IOPDEN
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит включения тактового сигнала порта I/O D
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Тактовый сигнал включен
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Тактовый сигнал отключен
|-
| rowspan="3" style="text-align: center;"| [4]
| rowspan="3" style="text-align: center;"| IOPCEN
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит включения тактового сигнала порта I/O C
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Тактовый сигнал включен
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Тактовый сигнал отключен
|-
| style="text-align: center;"| [3]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [2]
| rowspan="3" style="text-align: center;"| IOPAEN
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит включения тактового сигнала порта I/O A
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Тактовый сигнал включен
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Тактовый сигнал отключен
|-
| style="text-align: center;"| [1]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [0]
| rowspan="3" style="text-align: center;"| AFIOEN
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит включения тактового сигнала вспомогательных функций портов
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Тактовый сигнал включен
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Тактовый сигнал отключен
|}

<span id="регистр-включения-тактирования-периферийной-шины-pb1-rcc_apb1pcenr"></span>
=== 3.4.8 Регистр включения тактирования периферийной шины PB1 (RCC_APB1PCENR)  ===

<blockquote>Смещение адреса: 0x1С
</blockquote>
{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="3" style="text-align: center;"| Резерв
| style="text-align: center;"| PWREN
| colspan="6" style="text-align: center;"| Резерв
| style="text-align: center;"| I2C1EN
| colspan="5" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="4" style="text-align: center;"| Резерв
| style="text-align: center;"| WWDGEN
| colspan="10" style="text-align: center;"| Резерв
| style="text-align: center;"| TIM2EN
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Знач. сброса
|-
| style="text-align: center;"| [31:29]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [28]
| rowspan="3" style="text-align: center;"| PWREN
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит включения тактового сигнала интерфейса управления питанием
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Тактовый сигнал включен
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Тактовый сигнал отключен
|-
| style="text-align: center;"| [27:22]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [21]
| rowspan="3" style="text-align: center;"| I2C1EN
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит включения тактового сигнала интерфейса I2C1
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Тактовый сигнал включен
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Тактовый сигнал отключен
|-
| style="text-align: center;"| [20:12]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [11]
| rowspan="3" style="text-align: center;"| WWDGEN
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит включения тактового сигнала интерфейса WWGD
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Тактовый сигнал включен
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Тактовый сигнал отключен
|-
| style="text-align: center;"| [10:1]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [0]
| rowspan="3" style="text-align: center;"| TIM2EN
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит включения тактового сигнала интерфейса TIM2
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Тактовый сигнал включен
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Тактовый сигнал отключен
|}

<span id="controlstatus-register-rcc_rstsckr"></span>
=== 3.4.9 Control/Status Register (RCC_RSTSCKR)  ===

<blockquote>Смещение адреса: 0x24
</blockquote>
{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! colspan="3" style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| style="text-align: center;"| LPWR

RSTF

| style="text-align: center;"| WW

DG

RSTF

| style="text-align: center;"| IW

DG

RSTF

| style="text-align: center;"| SFT

RSTF

| style="text-align: center;"| POR

RSTF

| style="text-align: center;"| PIN

RSTF

| style="text-align: center;"| Рез.
| style="text-align: center;"| RM

VF

| colspan="10" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| colspan="3" style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="15" style="text-align: center;"| Резерв
| style="text-align: center;"| LSI

RDY

| colspan="2" style="text-align: center;"| LSI

ON

|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Знач. сброса
|-
| rowspan="4" style="text-align: center;"| [31]
| rowspan="4" style="text-align: center;"| LPWRRSTF
| rowspan="4" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Флаг сброса по низкому питанию
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Событие было
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| События не было
|-
| colspan="2" style="text-align: left;"| Устанавливается в 1 аппаратно при возникновении события; очищается программной записью в бит RMVF
|-
| rowspan="4" style="text-align: center;"| [30]
| rowspan="4" style="text-align: center;"| WWDG RSTF
| rowspan="4" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Флаг события сброса сторожевого таймера окна
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Событие было
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| События не было
|-
| colspan="2" style="text-align: left;"| Устанавливается в 1 аппаратно при возникновении события; очищается программной записью в бит RMVF
|-
| rowspan="4" style="text-align: center;"| [29]
| rowspan="4" style="text-align: center;"| IWDG RSTF
| rowspan="4" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Флаг события сброса сторожевого таймера
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Событие было
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| События не было
|-
| colspan="2" style="text-align: left;"| Устанавливается в 1 аппаратно при возникновении события; очищается программной записью в бит RMVF
|-
| rowspan="4" style="text-align: center;"| [28]
| rowspan="4" style="text-align: center;"| SFTRSTF
| rowspan="4" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Флаг события программного сброса
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Событие было
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| События не было
|-
| colspan="2" style="text-align: left;"| Устанавливается в 1 аппаратно при возникновении события; очищается программной записью в бит RMVF
|-
| rowspan="4" style="text-align: center;"| [27]
| rowspan="4" style="text-align: center;"| PORRSTF
| rowspan="4" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Флаг события сброса PowerUp/PowerDn
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Событие было
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| События не было
|-
| colspan="2" style="text-align: left;"| Устанавливается в 1 аппаратно при возникновении события; очищается программной записью в бит RMVF
|-
| rowspan="4" style="text-align: center;"| [26]
| rowspan="4" style="text-align: center;"| PINRSTF
| rowspan="4" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Флаг события сброса по внешнему сбросу (пин NRST)
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Событие было
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| События не было
|-
| colspan="2" style="text-align: left;"| Устанавливается в 1 аппаратно при возникновении события; очищается программной записью в бит RMVF
|-
| style="text-align: center;"| [25]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [24]
| rowspan="3" style="text-align: center;"| RMVF
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Флаг управляющий сбросом флагов событий
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Сбросить флаги событий
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет эффекта
|-
| style="text-align: center;"| [23:2]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="4" style="text-align: center;"| [1]
| rowspan="4" style="text-align: center;"| LSIRDY
| rowspan="4" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Флаг готовности низкочастотного тактового генератора (LSI) устанавливается аппаратно
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Генератор LSI стабилен
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Генератор LSI не стабилен
|-
| colspan="2" style="text-align: left;"| Примечание: После сброса LSION, требуется 3 LSI такта для сброса этого флага
|-
| rowspan="3" style="text-align: center;"| [0]
| rowspan="3" style="text-align: center;"| LSION
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит включения низкочастотного тактирования (LSI)
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включить осциллятор LSI (128КГц)
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключить осциллятор LSI (128КГц)
|}

''Примечание: Флаг очистки сброса может быть очищен за исключением бита BIT1, который очищается при включении питания.''

<span id="глава-4-независимый-сторожевой-таймер-iwdg"></span>
= Глава 4 Независимый сторожевой таймер (IWDG)  =

<blockquote>Система оснащена независимым сторожевым таймером (IWDG), который предназначен для обнаружения логических ошибок и сбоев программного обеспечения, вызванных внешними воздействиями окружающей среды. Источник тактового сигнала IWDG берется от низкочастотного генератора (LSI) и может работать независимо от основной программы, что делает его подходящим для приложений, где не требуется высокая точность.
</blockquote>
<span id="основные-возможности"></span>
== 4.1 Основные возможности  ==

* '''12-битный саморазрядуемый счетчик'''
* '''Источник тактовой частоты''': делитель LSI, может работать в режиме пониженного энергопотребления.
* '''Условие сброса''': Значение счетчика уменьшается до нуля

<span id="описание-функции"></span>
== 4.2 Описание функции ==

<span id="начало-формы"></span>
== Начало формы ==

<span id="принцип-работы-и-применение"></span>
==  4.2.1 Принцип работы и применение ==

<blockquote>Независимый сторожевой таймер использует в качестве источника тактового сигнала генератор LSI, и его функция продолжает работать даже в режимах отключения питания и ожидания. Когда счетчик сторожевого таймера самостоятельно уменьшается до нуля, генерируется системный сброс, поэтому время ожидания составляет (значение перезагрузки + 1) тактовый цикл.
</blockquote>
Рисунок 4-1 Блок-схема структуры независимого сторожевого таймераНачало формы

<blockquote>[[File:media/image10.png|507x183px]]
</blockquote>
* Включить независимый сторожевой таймер

<blockquote>После системного сброса сторожевой таймер выключен, и запись значения 0xCCCC в регистр '''IWDG_CTLR''' включает его, после чего он не может быть снова отключён, если только не произойдёт новый сброс. Если бит включения аппаратного независимого сторожевого таймера ('''IWDG_SW''') установлен в байтах пользовательских опций, то IWDG будет автоматически включён после сброса микроконтроллера.
</blockquote>
* Конфигурация сторожевого таймера

Сторожевой таймер представляет собой внутренний 12-битный счётчик, который работает по принципу уменьшения. Когда значение счётчика достигает нуля, происходит системный сброс. Чтобы включить функцию IWDG, необходимо выполнить следующие действия:

# '''Базовое время счёта:''' Источником тактового сигнала IWDG является LSI; через регистр '''IWDG_PSCR''' устанавливается значение деления LSI, которое используется в качестве базового времени счёта для IWDG. Метод работы заключается в том, чтобы сначала записать значение 0x5555 в регистр '''IWDG_CTLR''', а затем изменить значение деления в регистре '''IWDG_PSCR'''. Бит '''PVU''' в регистре состояния '''IWDG_STATR''' указывает статус обновления значения деления, и это значение можно изменять и считывать только при завершении обновления.
# '''Значение перезагрузки:''' Используется для обновления текущего значения счётчика в автономном сторожевом таймере, причём счётчик уменьшается на это значение. Бит '''RVU''' в регистре статуса '''IWDG_STATR''' показывает состояние обновления значения перезагрузки, и регистр '''IWDG_RLDR''' может быть изменён и прочитан только при завершённом обновлении.
# '''Включение сторожевого таймера:''' Запись значения 0xCCCC в регистр '''IWDG_CTLR''' активирует функцию сторожевого таймера.
# '''«Кормление собаки»:''' То есть обновление текущего значения счётчика перед тем, как счётчик сторожевого таймера уменьшится до нуля, чтобы предотвратить системный сброс. Для этого следует записать значение 0xAAAA в регистр '''IWDG_CTLR''', что позволит оборудованию обновить значение регистра '''IWDG_RLDR''' в счётчике сторожевого таймера. Это действие должно выполняться регулярно после активации функции сторожевого таймера, иначе произойдёт сброс системы по сигналу сторожевого таймера.

<span id="режим-наладки"></span>
=== 4.2.2 Режим наладки  ===

<blockquote>Когда система переходит в режим отладки, счётчик IWDG может быть настроен через регистр модуля отладки таким образом, чтобы продолжать работу или останавливаться.
</blockquote>
<span id="описание-регистров-2"></span>
== 4.3 Описание регистров  ==

Таблица 4-1 Список регистров, связанных с IWDG

{| class="wikitable"
|-
! style="text-align: center;"| '''Наименование'''
! style="text-align: center;"| '''Адрес'''
! style="text-align: center;"| '''Описание'''
! style="text-align: center;"| '''Значение сброса'''
|-
| style="text-align: left;"| R16_IWDG_CTLR
| style="text-align: left;"| 0x40003000
| style="text-align: left;"| Регистр управления
| style="text-align: center;"| 0x0000
|-
| style="text-align: left;"| R16_IWDG_PSCR
| style="text-align: left;"| 0x40003004
| style="text-align: left;"| Регистр прескейлера
| style="text-align: center;"| 0x0000
|-
| style="text-align: left;"| R16_IWDG_RLDR
| style="text-align: left;"| 0x40003008
| style="text-align: left;"| Регистр перезагрузки
| style="text-align: center;"| 0x0FFF
|-
| style="text-align: left;"| R16_IWDG_STATR
| style="text-align: left;"| 0x4000300C
| style="text-align: left;"| Регистр статуса
| style="text-align: center;"| 0x0000
|}

<span id="регистр-управления-iwdg_ctlr"></span>
=== 4.3.1 Регистр управления (IWDG_CTLR)  ===

Адрес смещения: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 15
! style="text-align: center;"| 14
! style="text-align: center;"| 13
! style="text-align: center;"| 12
! style="text-align: center;"| 11
! style="text-align: center;"| 10
! style="text-align: center;"| 9
! style="text-align: center;"| 8
! style="text-align: center;"| 7
! style="text-align: center;"| 6
! style="text-align: center;"| 5
! style="text-align: center;"| 4
! style="text-align: center;"| 3
! style="text-align: center;"| 2
! style="text-align: center;"| 1
! style="text-align: center;"| 0
|-
| colspan="16" style="text-align: center;"| KEY[15:0]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| rowspan="4" style="text-align: center;"| [15:0]
| rowspan="4" style="text-align: center;"| KEY
| rowspan="4" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| Используйте следующие ключи:
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 00xAAAA:
| style="text-align: left;"| Кормление сторожевого таймера. Загрузка значения регистра IWDG_RLDR в счетчик независимого сторожевого таймера.
|-
| style="text-align: right;"| 0x5555:
| style="text-align: left;"| Позволяет модификацию регистров R16_IWDG_PSCR и R16_IWDG_RLDR.
|-
| style="text-align: right;"| 0xCCCC:
| style="text-align: left;"| Запустите сторожевой таймер, если он еще не был запущен с использованием пользовательских настроек.
|}

<span id="регистр-прескейлера-iwdg_pscr"></span>
=== 4.3.2 Регистр прескейлера (IWDG_PSCR)  ===

Адрес смещения: 0x04

{| class="wikitable"
|-
! style="text-align: center;"| 15
! style="text-align: center;"| 14
! style="text-align: center;"| 13
! style="text-align: center;"| 12
! style="text-align: center;"| 11
! style="text-align: center;"| 10
! style="text-align: center;"| 9
! style="text-align: center;"| 8
! style="text-align: center;"| 7
! style="text-align: center;"| 6
! style="text-align: center;"| 5
! style="text-align: center;"| 4
! style="text-align: center;"| 3
! style="text-align: center;"| 2
! style="text-align: center;"| 1
! style="text-align: center;"| 0
|-
| colspan="13" style="text-align: center;"| Резерв
| colspan="3" style="text-align: center;"| PR[2:0]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [15:3]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="11" style="text-align: center;"| [2:0]
| rowspan="11" style="text-align: center;"| PR[2:0]
| rowspan="11" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Коэффициент деления тактового сигнала IWDG: перед изменением этого поля запишите значение 0x5555 в регистр KEY.
| rowspan="11" style="text-align: center;"| 0
|-
| style="text-align: right;"| 000:
| style="text-align: left;"| Делитель 4
|-
| style="text-align: right;"| 001:
| style="text-align: left;"| Делитель 8
|-
| style="text-align: right;"| 010:
| style="text-align: left;"| Делитель 16
|-
| style="text-align: right;"| 011:
| style="text-align: left;"| Делитель 32
|-
| style="text-align: right;"| 100:
| style="text-align: left;"| Делитель 64
|-
| style="text-align: right;"| 101:
| style="text-align: left;"| Делитель 128
|-
| style="text-align: right;"| 110:
| style="text-align: left;"| Делитель 256
|-
| style="text-align: right;"| 111:
| style="text-align: left;"| Делитель 256
|-
| colspan="2" style="text-align: left;"| Время счета IWDG основано на базе LSI, деленной на коэффициент деления.
|-
| colspan="2" style="text-align: left;"| ''Примечание: Перед чтением значения этого поля убедитесь, что бит '''PVU''' в регистре '''IWDG_STATR''' равен 0, иначе прочитанное значение будет недействительным.''
|}

<span id="регистр-перезагрузки-iwdg_rldr"></span>
=== 4.3.3 Регистр перезагрузки (IWDG_RLDR)  ===

Адрес смещения: 0x08

{| class="wikitable"
|-
! style="text-align: center;"| 15
! style="text-align: center;"| 14
! style="text-align: center;"| 13
! style="text-align: center;"| 12
! style="text-align: center;"| 11
! style="text-align: center;"| 10
! style="text-align: center;"| 9
! style="text-align: center;"| 8
! style="text-align: center;"| 7
! style="text-align: center;"| 6
! style="text-align: center;"| 5
! style="text-align: center;"| 4
! style="text-align: center;"| 3
! style="text-align: center;"| 2
! style="text-align: center;"| 1
! style="text-align: center;"| 0
|-
| colspan="4" style="text-align: center;"| Резерв
| colspan="12" style="text-align: center;"| RL[11:0]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [15:12]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [11:0]
| rowspan="3" style="text-align: center;"| RL[11:0]
| rowspan="3" style="text-align: center;"| RW
| style="text-align: left;"| Значение перезагрузки счетчика. Запишите 0x5555 в регистр '''KEY''' перед изменением этого поля.
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: left;"| Когда в регистр '''KEY''' записывается значение 0xAAAA, значение этого поля загружается в счетчик аппаратно, после чего счетчик начинает уменьшаться от этого значения.
|-
| style="text-align: left;"| ''Примечание: Перед чтением или записью значения этого поля убедитесь, что бит '''RVU''' в регистре '''IWDG_STATR''' равен 0, иначе чтение или запись данного поля будут недействительны.''
|}

<span id="регистр-статуса-iwdg_statr"></span>
=== 4.3.4 Регистр статуса (IWDG_STATR)  ===

Адрес смещения: 0x0C

{| class="wikitable"
|-
! style="text-align: center;"| 15
! style="text-align: center;"| 14
! style="text-align: center;"| 13
! style="text-align: center;"| 12
! style="text-align: center;"| 11
! style="text-align: center;"| 10
! style="text-align: center;"| 9
! style="text-align: center;"| 8
! style="text-align: center;"| 7
! style="text-align: center;"| 6
! style="text-align: center;"| 5
! style="text-align: center;"| 4
! style="text-align: center;"| 3
! style="text-align: center;"| 2
! style="text-align: center;"| 1
! style="text-align: center;"| 0
|-
| colspan="14" style="text-align: center;"| Резерв
| style="text-align: left;"| RVU
| style="text-align: left;"| PVU
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [15:12]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="4" style="text-align: center;"| [1]
| rowspan="4" style="text-align: center;"| RVU
| rowspan="4" style="text-align: center;"|  
| colspan="2" style="text-align: left;"| Флаг обновления значения перезагрузки. Устанавливается или сбрасывается аппаратно в 0.
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Идет процесс обновления значения перезагрузки.
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Завершение обновления перезагрузки (до 5 циклов LSI).
|-
| colspan="2" style="text-align: left;"| ''Примечание: Регистр перезагрузки значений '''IWDG_RLDR''' может быть доступен для чтения или записи только после того, как бит '''RVU''' будет очищен до 0.''
|-
| rowspan="4" style="text-align: center;"| [0]
| rowspan="4" style="text-align: center;"| PVU
| rowspan="4" style="text-align: center;"|  
| colspan="2" style="text-align: left;"| Флаг обновления коэффициента деления тактовой частоты. Устанавливается или сбрасывается аппаратно в 0.
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Идет обновление значения коэффициента деления тактовой частоты.
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Завершение обновления значения коэффициента деления тактовой частоты (до 5 циклов LSI).
|-
| colspan="2" style="text-align: left;"| ''Примечание: Регистр коэффициента деления '''IWDG_PSCR''' может быть доступен для чтения или записи только после того, как бит '''PVU''' будет очищен до 0.''
|}

<blockquote>''Примечание: После обновления значения предделителя или значения перезагрузки нет необходимости ждать сброса битов '''RVU''' или '''PVU''', и выполнение следующего кода может продолжиться. (Эта операция записи будет выполнена до завершения даже в режиме пониженного энергопотребления.)''
</blockquote>
<span id="section"></span>
= <br />
 =

<span id="глава-5-оконный-сторожевой-таймер-начало-формы-wwdg"></span>
= Глава 5 Оконный сторожевой таймер Начало формы (WWDG)  =

<blockquote>Оконный сторожевой таймер обычно используется для мониторинга работы системы на предмет программных сбоев, таких как внешние помехи, непредвиденные логические ошибки и другие условия. Он требует обновления счетчика (подачи сторожевого таймера) в пределах определенного временного окна (с верхним и нижним пределами); в противном случае раньше или позже этого временного окна схема сторожевого таймера сгенерирует системный сброс.
</blockquote>
<span id="основные-характеристики-1"></span>
== 5.1 Основные характеристики ==

* Программируемый 7-битный счетчик с убыванием
* Двойное условие сброса: значение счетчика меньше 0x40 или значение счетчика перезагружается вне временного окна
* Функция раннего уведомления пробуждения (EWI) для своевременной подачи сторожевого таймера, предотвращающей системный сброс

<span id="описание-функций"></span>
== 5.2 Описание функций ==

<span id="принцип-работы-и-применение-1"></span>
=== 5.2.1 Принцип работы и применение ===

<blockquote>Работа оконного сторожевого таймера основана на 7-битном счетчике с убыванием, который подключен к шине HB и считает частоту деления источника тактовой частоты WWDG_CLK (HCLK/4096) с коэффициентом деления, установленным в поле WDGTB[1:0] регистра конфигурации WWDG_CFGR. Счетчик находится в свободном состоянии выполнения, и счет продолжается независимо от того, включена функция сторожевого таймера или нет. На рисунке 5-1 показана блок-схема внутренней структуры оконного сторожевого таймера.
</blockquote>
Рисунок 5-1 Блок-схема структуры оконного сторожевого таймера

'''-'''

'''W6'''

'''W5'''

'''W4'''

'''W3'''

'''W2'''

'''W1'''

'''W0'''

'''WDGA'''

'''T6'''

'''T5'''

'''T4'''

'''T3'''

'''T2'''

'''T1'''

'''T0'''

'''/4096'''

'''WDGTB[1:0]'''

'''HCLK'''

'''Watchdog control register(WWDG_CTLR)'''

'''RESET'''

'''Запись WWDG_CTLR[6:0]'''

'''Регистр конфигурации сторожевого таймера(WWDG_CFGR)'''

'''T[6:0]'''

'''&gt;'''

'''W[6:0]'''

'''WWDG_CLK'''

'''WWDG enable control, software on'''

* Включение оконного сторожевого таймера

<blockquote>После системного сброса сторожевой таймер выключен. Установка бита '''WDGA''' в регистре '''WWDG_CTLR''' включает сторожевой таймер, и после этого его нельзя отключить повторно, пока не произойдет сброс.

''Примечание: Функционирование сторожевого таймера можно косвенно остановить, установив регистр '''RCC_APB1PCENR''' для отключения источника тактовой частоты WWDG и приостановки счета '''WWDG_CLK''', либо установив регистр '''RCC_APB1PRSTR''' для сброса модуля WWDG, что эквивалентно роли сброса.''
</blockquote>
* Настройка сторожевого таймера

Сторожевой таймер представляет собой внутренний 7-битный счётчик, который непрерывно уменьшает своё значение и поддерживает доступ на чтение и запись. Чтобы воспользоваться функцией сброса сторожевого таймера, необходимо выполнить следующие действия:

# '''База времени счёта:''' Через битовые поля '''WDGTB'''[1:0] регистра '''WWDG_CFGR''', обратите внимание, что модуль WWDG блока RCC должен быть включен.
# '''Счётчик окна:''' Установите битовые поля '''W'''[6:0] в регистре '''WWDG_CFGR'''. Этот счётчик используется оборудованием для сравнения с текущим значением счётчика. Его значение задаётся программным обеспечением пользователя и не изменяется. Оно служит максимальным пределом для временного окна.
# '''Включение сторожевого таймера:''' Установив бит WDGA в регистре '''WWGD_CTLR''' в значение 1, включаем функцию сторожевого таймера. При этом возможно выполнение системного сброса.
# '''«Кормление собаки»:''' То есть обновление текущего значения счётчика, для чего необходимо настроить битовые поля '''T'''[6:0] регистра '''WWGD_CTLR'''. Эта операция должна выполняться в рамках заданного временного окна после включения функции сторожевого таймера. В противном случае произойдёт сброс системы по сигналу сторожевого таймера.

* Временное окно «кормления собаки»

<blockquote>Как показано на Рисунке 5-2, заштрихованная область — это зона мониторинга оконного сторожевого таймера. Верхнее время t2 соответствует моменту, когда текущее значение счётчика достигает значения окна W[6:0], а нижнее время t3 — моменту, когда текущее значение счётчика становится равным 0x3F. В течение этого интервала времени t2 &lt; t &lt; t3 можно провести операцию «кормления собаки» (записать T[6:0]), чтобы обновить текущее значение счётчика.

Рисунок 5-2 Режим счёта оконного сторожевого таймера
</blockquote>
'''RESET'''

'''T6 bit'''

'''Обновление запрещено'''

'''Обновление разрешено'''

'''0'''

'''x3F'''

'''W[6:0]'''

'''Max=0x7F'''

'''Y[6:0] CNT Текущее значение'''

'''Время'''

'''t1'''

'''t2'''

'''t3'''

'''Обновление будет сброшено в зоне запрета обновления'''

'''i'''

'''<u>nd</u>'''

'''o'''

'''<u>w</u>'''

'''ar'''

'''<u>ea</u>'''

'''<u>W</u>'''

'''HCLK1'''

'''Timeout:T *4096*2 *(T[5:0]+1])'''

'''WDGTB'''

'''Счетчик будет сброшен, когда значение CNT станет меньше 0x40.'''

* Сброс сторожевого таймера

# Когда значение счётчика '''T'''[6:0] меняется с 0x40 на 0x3F из-за отсутствия своевременной операции «кормления собаки», произойдёт «сброс оконного сторожевого таймера», и будет сгенерирован системный сброс. То есть, оборудование обнаруживает, что бит '''T6''' равен нулю, и происходит системный сброс.

<blockquote>''Примечание: Приложение может установить бит '''T6''' в ноль программным способом, чтобы вызвать системный сброс, что аналогично функции программного сброса.''
</blockquote>
<ol start="2" style="list-style-type: decimal;">
<li><p>Когда выполняется действие обновления счётчика в запрещённое для «кормления» время, т.е. операция записи битового поля '''T'''[6:0] производится в период времени t1 ≤ t ≤ t2, произойдёт «сброс оконного сторожевого таймера» и будет выполнен системный сброс.</p></li></ol>

* Предварительное пробуждение

<blockquote>Чтобы предотвратить системный сброс, вызванный несвоевременным обновлением счётчика, модуль сторожевого таймера предоставляет уведомление о раннем прерывании пробуждения ('''EWI'''). Когда счётчик самостоятельно уменьшается до 0x40, генерируется сигнал раннего пробуждения, и флаг '''EWIF''' устанавливается в 1. Если бит '''EWI''' установлен, одновременно будет вызвано прерывание оконного сторожевого таймера. В этот момент остаётся всего один такт счётчика (самоуменьшение до 0x3F) до аппаратного сброса, и приложение может немедленно выполнить операцию «кормления собаки» в течение этого времени.
</blockquote>
<span id="режим-наладки-1"></span>
=== 5.2.2 Режим наладки  ===

<blockquote>Когда система переходит в режим отладки, счётчик WWDG может быть настроен через регистр модуля отладки таким образом, чтобы продолжить работу или остановиться.
</blockquote>
<span id="описание-регистров-3"></span>
== 5.3 Описание регистров  ==

<blockquote>Таблица 5-1 Список регистров, связанных с WWDG
</blockquote>
{| class="wikitable"
|-
! style="text-align: center;"| '''Наименование'''
! style="text-align: center;"| '''Адрес'''
! style="text-align: center;"| '''Описание'''
! style="text-align: center;"| '''Значение сброса'''
|-
| style="text-align: left;"| R16_WWDG_CTLR
| style="text-align: left;"| 0x40002C00
| style="text-align: left;"| Регистр управления
| style="text-align: left;"| 0x007F
|-
| style="text-align: left;"| R16_WWDG_CFGR
| style="text-align: left;"| 0x40002C04
| style="text-align: left;"| Регистр настройки
| style="text-align: left;"| 0x007F
|-
| style="text-align: left;"| R16_WWDG_STATR
| style="text-align: left;"| 0x40002C08
| style="text-align: left;"| Регистр статуса
| style="text-align: left;"| 0x0000
|}

<span id="регистр-управления-wwdg_ctlr"></span>
=== 5.3.1 Регистр управления (WWDG_CTLR)  ===

Адрес смещения: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 15
! style="text-align: center;"| 14
! style="text-align: center;"| 13
! style="text-align: center;"| 12
! style="text-align: center;"| 11
! style="text-align: center;"| 10
! style="text-align: center;"| 9
! style="text-align: center;"| 8
! style="text-align: center;"| 7
! style="text-align: center;"| 6
! style="text-align: center;"| 5
! style="text-align: center;"| 4
! style="text-align: center;"| 3
! style="text-align: center;"| 2
! style="text-align: center;"| 1
! style="text-align: center;"| 0
|-
| colspan="8" style="text-align: center;"| Резерв
| style="text-align: left;"| WDGA
| colspan="7" style="text-align: center;"| T[6:0]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [15:8]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [7]
| rowspan="3" style="text-align: center;"| WDGA
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит разрешения сброса сторожевого таймера окна.
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включить функцию сторожевого таймера (которая генерирует сигнал сброса).
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключить функцию сторожевого таймера. Программная запись 1 включена, но только позволяет оборудованию сбросить 0 после сброса.
|-
| style="text-align: center;"| [6:0]
| style="text-align: center;"| T[6:0]
| style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| 7-битный самоуменьшающийся счетчик уменьшается на 1 каждые 4096 * 2^WDGTB циклов HCLK. Сброс сторожевого таймера генерируется, когда счетчик уменьшает свое значение с 0x40 до 0x3F, то есть, когда T6 переходит к 0.
| style="text-align: center;"| 7Fh
|}

<span id="регистр-конфигурации-wwdg_cfgr"></span>
=== 5.3.2 Регистр конфигурации (WWDG_CFGR)  ===

Адрес смещения: 0x04

{| class="wikitable"
|-
! style="text-align: center;"| 15
! style="text-align: center;"| 14
! style="text-align: center;"| 13
! style="text-align: center;"| 12
! style="text-align: center;"| 11
! style="text-align: center;"| 10
! style="text-align: center;"| 9
! style="text-align: center;"| 8
! style="text-align: center;"| 7
! style="text-align: center;"| 6
! style="text-align: center;"| 5
! style="text-align: center;"| 4
! style="text-align: center;"| 3
! style="text-align: center;"| 2
! style="text-align: center;"| 1
! style="text-align: center;"| 0
|-
| colspan="6" style="text-align: center;"| Резерв
| style="text-align: left;"| EWI
| colspan="2" style="text-align: center;"| WDGTB[1:0]
| colspan="7" style="text-align: center;"| W[6:0]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [15:8]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [9]
| style="text-align: center;"| EWI
| style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит включения прерывания раннего пробуждения. Если этот бит установлен в 1, генерируется прерывание при достижении счетчиком значения 0x40. Этот бит может быть сброшен в 0 только аппаратно после сброса.
| style="text-align: center;"| 0
|-
| rowspan="5" style="text-align: center;"| [8:7]
| rowspan="5" style="text-align: center;"| WDGTB [1:0]
| rowspan="5" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Выбор коэффициента деления тактового сигнала для оконного сторожевого таймера.
| rowspan="5" style="text-align: center;"| 0
|-
| style="text-align: right;"| 00:
| style="text-align: left;"| Делитель 1, база времени счета =HCLK/4096
|-
| style="text-align: right;"| 01:
| style="text-align: left;"| Делитель 2, база времени счета =HCLK/4097/2
|-
| style="text-align: right;"| 10:
| style="text-align: left;"| Делитель 4, база времени счета =HCLK/4098/4
|-
| style="text-align: right;"| 11:
| style="text-align: left;"| Делитель 8, база времени счета =HCLK/4099/8
|-
| style="text-align: center;"| [6:0]
| style="text-align: center;"| W[6:0]
| style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| 7-битное окно оконного сторожевого таймера. Используется для сравнения со значением счетчика. Операция кормления собаки может выполняться только тогда, когда значение счетчика меньше значения окна и больше 0x3F.
| style="text-align: center;"| 7Fh
|}

<span id="регистр-статуса-wwdg_statr"></span>
=== 5.3.3 Регистр статуса (WWDG_STATR)  ===

Адрес смещения: 0x08

{| class="wikitable"
|-
! style="text-align: center;"| 15
! style="text-align: center;"| 14
! style="text-align: center;"| 13
! style="text-align: center;"| 12
! style="text-align: center;"| 11
! style="text-align: center;"| 10
! style="text-align: center;"| 9
! style="text-align: center;"| 8
! style="text-align: center;"| 7
! style="text-align: center;"| 6
! style="text-align: center;"| 5
! style="text-align: center;"| 4
! style="text-align: center;"| 3
! style="text-align: center;"| 2
! style="text-align: center;"| 1
! style="text-align: center;"| 0
|-
| colspan="15" style="text-align: center;"| Резерв
| style="text-align: left;"| EWIF
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [15:1]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [0]
| style="text-align: center;"| EWIF
| style="text-align: center;"| RW
| style="text-align: left;"| Флаг прерывания раннего пробуждения. Когда счетчик достигает значения 0x40, этот бит устанавливается аппаратно и должен быть сброшен в 0 программно; настройка пользователя недействительна. Даже если EWI не установлен, этот бит все равно будет устанавливаться, как обычно, при возникновении события.
| style="text-align: center;"| 0
|}

<span id="глава-6-прерывания-и-события-pfic"></span>
= <br />
Глава 6 Прерывания и события (PFIC)  =

<blockquote>Серия CH32V003 имеет встроенный программируемый быстрый контроллер прерываний (PFIC), поддерживающий до 255 векторов прерываний. Текущая система управляет 23 периферийными каналами прерываний и 4 основными каналами прерываний, остальные зарезервированы.
</blockquote>
<span id="основные-возможности-1"></span>
== 6.1 Основные возможности  ==

<span id="pfic"></span>
=== 6.1.1 PFIC  ===

* 23 периферийных прерывания, каждое прерывание имеет независимые биты триггера и маски, со специальными битами состояния
* Программируемое многоуровневое вложение прерываний, максимальная глубина вложения 2 уровня, глубина аппаратного стека 2 уровня
* Быстрая система входа и выхода из прерывания с автоматической аппаратной обработкой стека
* Механизм обработки прерываний Vector Table Free (VTF), прямое программирование доступа к адресам вектора прерывания двумя способами

<span id="системный-таймер"></span>
== 6.2 Системный таймер  ==

* Серия CH32V003

<blockquote>Ядро оснащено 32-битным суммирующим счётчиком (SysTick), который поддерживает HCLK или HCLK/8 в качестве временной базы с высоким приоритетом и может использоваться в качестве эталонного времени после калибровки.
</blockquote>
<span id="таблица-векторов-прерываний-и-исключений"></span>
== 6.3 Таблица векторов прерываний и исключений ==

<blockquote>Таблица 6-1 Таблица векторов серии CH32V003
</blockquote>
{| class="wikitable"
|-
! style="text-align: center;"| No
! style="text-align: center;"| Приоритет
! style="text-align: center;"| Тип
! style="text-align: center;"| Имя
! style="text-align: center;"| Описание
! style="text-align: center;"| Адрес входа
|-
| style="text-align: center;"| 0
| style="text-align: center;"| -
| style="text-align: center;"| -
| style="text-align: center;"| -
| style="text-align: center;"| -
| style="text-align: left;"| 0x00000000
|-
| style="text-align: center;"| 1
| style="text-align: center;"| -
| style="text-align: center;"| -
| style="text-align: center;"| -
| style="text-align: center;"| -
| style="text-align: left;"| 0x00000004
|-
| style="text-align: center;"| 2
| style="text-align: center;"| -2
| style="text-align: center;"| fixed
| style="text-align: center;"| NMI
| style="text-align: left;"| Немаскируемые прерывания
| style="text-align: left;"| 0x00000008
|-
| style="text-align: center;"| 3
| style="text-align: center;"| -1
| style="text-align: center;"| fixed
| style="text-align: center;"| HardFault
| style="text-align: left;"| Аномальные прерывания
| style="text-align: left;"| 0x0000000С
|-
| style="text-align: center;"| 4-11
| style="text-align: center;"| -
| style="text-align: center;"| -
| style="text-align: center;"|  
| style="text-align: left;"| Зарезервировано
| style="text-align: left;"| 0x00000010- 0x0000002С
|-
| style="text-align: center;"| 12
| style="text-align: center;"| 0
| style="text-align: center;"| prog
| style="text-align: center;"| SysTick
| style="text-align: left;"| Прерывание системного таймера
| style="text-align: left;"| 0x00000030
|-
| style="text-align: center;"| 13
| style="text-align: center;"| -
| style="text-align: center;"| -
| style="text-align: center;"|  
| style="text-align: left;"| Зарезервировано
| style="text-align: left;"| 0x00000034
|-
| style="text-align: center;"| 14
| style="text-align: center;"| 1
| style="text-align: center;"| prog
| style="text-align: center;"| SW
| style="text-align: left;"| Програмные прерывания
| style="text-align: left;"| 0x00000038
|-
| style="text-align: center;"| 15
| style="text-align: center;"| -
| style="text-align: center;"| -
| style="text-align: center;"|  
| style="text-align: left;"| Зарезервировано
| style="text-align: left;"| 0x0000003С
|-
| style="text-align: center;"| 16
| style="text-align: center;"| 2
| style="text-align: center;"| prog
| style="text-align: center;"| WWDG
| style="text-align: left;"| Прерывание таймера оконного сторожевого таймера
| style="text-align: left;"| 0x00000040
|-
| style="text-align: center;"| 17
| style="text-align: center;"| 3
| style="text-align: center;"| prog
| style="text-align: center;"| PVD
| style="text-align: left;"| Прерывание детектора напряжения питания (EXTI)
| style="text-align: left;"| 0x00000044
|-
| style="text-align: center;"| 18
| style="text-align: center;"| 4
| style="text-align: center;"| prog
| style="text-align: center;"| FLASH
| style="text-align: left;"| Глобальное прерывание Flash
| style="text-align: left;"| 0x00000048
|-
| style="text-align: center;"| 19
| style="text-align: center;"| 5
| style="text-align: center;"| prog
| style="text-align: center;"| RCC
| style="text-align: left;"| Прерывания сброса и тактирования
| style="text-align: left;"| 0x0000004С
|-
| style="text-align: center;"| 20
| style="text-align: center;"| 6
| style="text-align: center;"| prog
| style="text-align: center;"| EXTI7_0
| style="text-align: left;"| Прерывания EXTI линии 0-7
| style="text-align: left;"| 0x00000050
|-
| style="text-align: center;"| 21
| style="text-align: center;"| 7
| style="text-align: center;"| prog
| style="text-align: center;"| AWU
| style="text-align: left;"| Прерывание пробуждения
| style="text-align: left;"| 0x00000054
|-
| style="text-align: center;"| 22
| style="text-align: center;"| 8
| style="text-align: center;"| prog
| style="text-align: center;"| DMA_CH1
| style="text-align: left;"| Глобальное прерывание DMA1 канал 1
| style="text-align: left;"| 0x00000058
|-
| style="text-align: center;"| 23
| style="text-align: center;"| 9
| style="text-align: center;"| prog
| style="text-align: center;"| DMA_CH2
| style="text-align: left;"| Глобальное прерывание DMA1 канал 2
| style="text-align: left;"| 0x0000005С
|-
| style="text-align: center;"| 24
| style="text-align: center;"| 10
| style="text-align: center;"| prog
| style="text-align: center;"| DMA_CH3
| style="text-align: left;"| Глобальное прерывание DMA1 канал 3
| style="text-align: left;"| 0x00000060
|-
| style="text-align: center;"| 25
| style="text-align: center;"| 11
| style="text-align: center;"| prog
| style="text-align: center;"| DMA_CH4
| style="text-align: left;"| Глобальное прерывание DMA1 канал 4
| style="text-align: left;"| 0x00000064
|-
| style="text-align: center;"| 26
| style="text-align: center;"| 12
| style="text-align: center;"| prog
| style="text-align: center;"| DMA_CH5
| style="text-align: left;"| Глобальное прерывание DMA1 канал 5
| style="text-align: left;"| 0x00000068
|-
| style="text-align: center;"| 27
| style="text-align: center;"| 13
| style="text-align: center;"| prog
| style="text-align: center;"| DMA_CH6
| style="text-align: left;"| Глобальное прерывание DMA1 канал 6
| style="text-align: left;"| 0x0000006С
|-
| style="text-align: center;"| 28
| style="text-align: center;"| 14
| style="text-align: center;"| prog
| style="text-align: center;"| DMA_CH7
| style="text-align: left;"| Глобальное прерывание DMA1 канал 7
| style="text-align: left;"| 0x00000070
|-
| style="text-align: center;"| 29
| style="text-align: center;"| 15
| style="text-align: center;"| prog
| style="text-align: center;"| ADC
| style="text-align: left;"| Глобальное прерывание АЦП
| style="text-align: left;"| 0x00000074
|-
| style="text-align: center;"| 30
| style="text-align: center;"| 16
| style="text-align: center;"| prog
| style="text-align: center;"| I2C1_EV
| style="text-align: left;"| Прерывание событий I2C1
| style="text-align: left;"| 0x00000078
|-
| style="text-align: center;"| 31
| style="text-align: center;"| 17
| style="text-align: center;"| prog
| style="text-align: center;"| I2C1_ER
| style="text-align: left;"| Прерывание ошибок I2C1
| style="text-align: left;"| 0x0000007C
|-
| style="text-align: center;"| 32
| style="text-align: center;"| 18
| style="text-align: center;"| prog
| style="text-align: center;"| USART1
| style="text-align: left;"| Глобальное прерывание USART1
| style="text-align: left;"| 0x00000080
|-
| style="text-align: center;"| 33
| style="text-align: center;"| 19
| style="text-align: center;"| prog
| style="text-align: center;"| SPI1
| style="text-align: left;"| Глобальное прерывание SPI1
| style="text-align: left;"| 0x00000084
|-
| style="text-align: center;"| 34
| style="text-align: center;"| 20
| style="text-align: center;"| prog
| style="text-align: center;"| TIM1BRK
| style="text-align: left;"| Прерывание останова TIM1
| style="text-align: left;"| 0x00000088
|-
| style="text-align: center;"| 35
| style="text-align: center;"| 21
| style="text-align: center;"| prog
| style="text-align: center;"| TIM1UP
| style="text-align: left;"| Прерывание обновления TIM1
| style="text-align: left;"| 0x0000008С
|-
| style="text-align: center;"| 36
| style="text-align: center;"| 22
| style="text-align: center;"| prog
| style="text-align: center;"| TIM1TRG
| style="text-align: left;"| Прерывание вызываемое TIM1
| style="text-align: left;"| 0x00000090
|-
| style="text-align: center;"| 37
| style="text-align: center;"| 23
| style="text-align: center;"| prog
| style="text-align: center;"| TIM1CC
| style="text-align: left;"| Прерывание TIM1 захвата и сравнения
| style="text-align: left;"| 0x00000094
|-
| style="text-align: center;"| 38
| style="text-align: center;"| 24
| style="text-align: center;"| prog
| style="text-align: center;"| TIM2
| style="text-align: left;"| Глобальное прерывание TIM2
| style="text-align: left;"| 0x00000098
|}

<span id="контроллер-внешних-прерываний-и-событий-exti"></span>
== 6.4 Контроллер внешних прерываний и событий (EXTI)  ==

<span id="обзор-1"></span>
=== 6.4.1 Обзор ===

Рисунок 6-1 Блок-схема интерфейса внешнего прерывания (EXTI)

'''HBbus'''

'''Интерфейс переферии'''

'''INTFR'''

'''INTENR'''

'''SWIEVR'''

'''RTENR'''

'''FTENR'''

'''HCLK'''

'''10'''

'''10'''

'''10'''

'''10'''

'''10'''

'''Генератор импульсов'''

'''EVENR'''

'''Схема детектора фронтов'''

'''В контроллер прерываний PFIC'''

'''10'''

'''10'''

'''10'''

'''10'''

'''10'''

'''10'''

'''10'''

'''10'''

'''Input'''

'''Line'''

<blockquote>Как видно из рисунка 6-1, источником запуска внешнего прерывания может быть программное прерывание ('''SWIEVR''') или реальный внешний канал прерывания. Сигнал внешнего канала прерывания сначала пройдет через схему детектора фронтов. Как только возникает одно из сигналов программного прерывания или внешнего прерывания, оно будет выведено на две схемы с вентилем ИЛИ, разрешения события и разрешения прерывания, через схему с вентиль ИЛИ на рисунке. Пока разрешено хотя бы одно прерывание или событие, будет сгенерировано прерывание или событие. Процессор получает доступ к шести регистрам EXTI через интерфейс HB.Начало формы
</blockquote>
<span id="событие-пробуждения"></span>
=== 6.4.2 Событие пробуждения  ===

Система может вывести микроконтроллер из режима сна, вызванного командой WFE, посредством события пробуждения. Событие пробуждения генерируется одним из двух следующих способов:

* '''Разрешение прерывания в периферийном регистре''', но без разрешения этого прерывания в PFIC ядра, и одновременное разрешение бита '''SEVONPEND''' в ядре. Например, в EXTI это означает разрешить прерывание EXTI, но не разрешать прерывание EXTI в PFIC, и одновременно разрешить бит '''SEVONPND'''. Когда микроконтроллер просыпается от команды WFE, ему нужно сбросить бит флага прерывания EXTI и бит ожидания PFIC.
* '''Конфигурация канала EXTI как канала события''' устраняет необходимость для микроконтроллера сбрасывать бит флага прерывания и бит ожидающего состояния PFIC после пробуждения от команды WFE.

<span id="описание"></span>
=== 6.4.3 Описание ===

Использование внешнего прерывания требует настройки соответствующего канала внешнего прерывания, то есть выбора соответствующего фронта срабатывания и разрешения соответствующего прерывания. Когда установленный фронт срабатывания появляется на канале внешнего прерывания, генерируется запрос на прерывание, и соответствующий бит флага прерывания устанавливается. Флаг можно сбросить, записав 1 в бит флага.

Шаги использования внешних аппаратных прерываний.

# Конфигурация операций GPIO.
# Настройка бита разрешения прерывания ('''EXTI_INTENR''') для соответствующего канала внешнего прерывания.
# Настройка фронта срабатывания ('''EXTI_RTENR''' или '''EXTI_FTENR''') для выбора нарастающего фронта, спадающего фронта или двойного фронта.
# Настройка прерываний EXTI в PFIC ядра, чтобы обеспечить их корректное реагирование.

Шаги для использования внешних аппаратных событий.

# Конфигурация операций GPIO.
# Настройте бит разрешения события ('''EXTI_EVENR''') для соответствующего канала внешнего прерывания.
# Настройте фронт срабатывания ('''EXTI_RTENR''' или '''EXTI_FTENR''') для выбора нарастающего фронта, спадающего фронта или двойного фронта.

Шаги по использованию программного прерывания/события.

# Разрешите внешние прерывания ('''EXTI_INTENR''') или внешние события ('''EXTI_EVENR''').
# Если используются функции обслуживания прерываний, прерывание EXTI необходимо настроить в PFIC ядра.
# Установите запуск программного прерывания ('''EXTI_SWIEVR'''), то есть будет сгенерировано прерывание.

<span id="внешняя-карта-событий"></span>
=== 6.4.4 Внешняя карта событий ===

<blockquote>Таблица 6-2 Соответствие прерываний EXTI
</blockquote>
{| class="wikitable"
|-
! style="text-align: center;"| Внешние прерывания/ линии событий
! style="text-align: center;"| Описание таблицы событий
|-
| style="text-align: center;"| EXTI0~EXTI7
| style="text-align: left;"| Контакты Px0–Px7 (где x = A/C/D) могут использоваться для внешней функции прерывания/события. Конфигурация осуществляется через регистр AFIO_EXTICR.
|-
| style="text-align: center;"| EXTI8
| style="text-align: left;"| Событие PVD: превышение порогового значения напряжения контроля.Начало формы

Конец формы

|-
| style="text-align: center;"| EXTI9
| style="text-align: left;"| События авто-пробуждения
|}

<span id="описание-регистров-4"></span>
== 6.5 Описание регистров  ==

<span id="регистры-exti"></span>
=== 6.5.1 Регистры EXTI  ===

<blockquote>Таблица 6-3 Список регистров, связанных с EXTI
</blockquote>
{| class="wikitable"
|-
! style="text-align: center;"| '''Наименование'''
! style="text-align: center;"| '''Адрес'''
! style="text-align: center;"| '''Описание'''
! style="text-align: center;"| '''Значение сброса'''
|-
| style="text-align: left;"| R32_EXTI_INTENR
| style="text-align: center;"| 0x40010400
| style="text-align: left;"| Регистр включения прерываний
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_EXTI_EVENR
| style="text-align: center;"| 0x40010404
| style="text-align: left;"| Регистр включения событий
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_EXTI_RTENR
| style="text-align: center;"| 0x40010408
| style="text-align: left;"| Регистр включения триггеров восходящих фронтов
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_EXTI_FTENR
| style="text-align: center;"| 0x4001040C
| style="text-align: left;"| Регистр включения триггеров нисходящих фронтов
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_EXTI_SWIEVR
| style="text-align: center;"| 0x40010410
| style="text-align: left;"| Регистр программного прерывания события
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_EXTI_INTFR
| style="text-align: center;"| 0x40010414
| style="text-align: left;"| Регистр флагов прерываний
| style="text-align: center;"| 0x0000xxxx
|}

<span id="регистр-включения-прерываний-exti_intenr"></span>
==== 6.5.1.1 Регистр включения прерываний (EXTI_INTENR)  ====

Адрес смещения: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="6" style="text-align: center;"| Резерв
| style="text-align: left;"| MR9
| style="text-align: left;"| MR8
| style="text-align: left;"| MR7
| style="text-align: left;"| MR6
| style="text-align: left;"| MR5
| style="text-align: left;"| MR4
| style="text-align: left;"| MR3
| style="text-align: left;"| MR2
| style="text-align: left;"| MR1
| style="text-align: left;"| MR0
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [15:1]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [9:0]
| rowspan="3" style="text-align: center;"| MRx
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Разрешить сигнал запроса прерывания для внешнего канала прерываний x.
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включить прерывание по линии x
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Маскировать прерывание по линии x
|}

<span id="регистр-включения-событий-exti_evenr"></span>
==== 6.5.1.2 Регистр включения событий (EXTI_EVENR)  ====

Адрес смещения: 0x04

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="6" style="text-align: center;"| Резерв
| style="text-align: left;"| MR9
| style="text-align: left;"| MR8
| style="text-align: left;"| MR7
| style="text-align: left;"| MR6
| style="text-align: left;"| MR5
| style="text-align: left;"| MR4
| style="text-align: left;"| MR3
| style="text-align: left;"| MR2
| style="text-align: left;"| MR1
| style="text-align: left;"| MR0
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [15:1]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [9:0]
| rowspan="3" style="text-align: center;"| MRx
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Разрешить сигнал запроса события для внешнего канала прерываний x.
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Событие включает канал x
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Событие отключает канал x
|}

<span id="регистр-разрешения-срабатывания-по-нарастающему-фронту-exti_rtenr"></span>
==== 6.5.1.3 Регистр разрешения срабатывания по нарастающему фронту (EXTI_RTENR)  ====

Адрес смещения: 0x08

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="6" style="text-align: center;"| Резерв
| style="text-align: center;"| TR9
| style="text-align: center;"| TR8
| style="text-align: center;"| TR7
| style="text-align: center;"| TR6
| style="text-align: center;"| TR5
| style="text-align: center;"| TR4
| style="text-align: center;"| TR3
| style="text-align: center;"| TR2
| style="text-align: center;"| TR1
| style="text-align: center;"| TR0
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [15:1]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [9:0]
| rowspan="3" style="text-align: center;"| TRx
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Разрешить срабатывание по нарастающему фронту внешнего канала прерывания x.
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Разрешить срабатывание по нарастающему фронту для этого канала.
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключить срабатывание по нарастающему фронту для этого канала.
|}

<span id="регистр-разрешения-срабатывания-по-спадающему-фронту-exti_ftenr"></span>
==== 6.5.1.4 Регистр разрешения срабатывания по спадающему фронту (EXTI_FTENR) ====

Адрес смещения: 0x0С

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="6" style="text-align: center;"| Резерв
| style="text-align: center;"| TR9
| style="text-align: center;"| TR8
| style="text-align: center;"| TR7
| style="text-align: center;"| TR6
| style="text-align: center;"| TR5
| style="text-align: center;"| TR4
| style="text-align: center;"| TR3
| style="text-align: center;"| TR2
| style="text-align: center;"| TR1
| style="text-align: center;"| TR0
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [15:1]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [9:0]
| rowspan="3" style="text-align: center;"| TRx
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Разрешить срабатывание по ниспадающему фронту внешнего канала прерывания x
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Разрешить срабатывание по ниспадающему фронту для этого канала.
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключить срабатывание по ниспадающему фронту для этого канала.
|}

<span id="регистр-событий-программных-прерываний-exti_swievr"></span>
==== 6.5.1.5 Регистр событий программных прерываний (EXTI_SWIEVR)  ====

Адрес смещения: 0x10

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
! style="text-align: center;"|
|-
| colspan="17" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
| style="text-align: center;"|
|-
| colspan="6" style="text-align: center;"| Резерв
| style="text-align: center;"| SWIER9
| style="text-align: center;"| SWIER8
| style="text-align: center;"| SWIER7
| style="text-align: center;"| SWIER6
| style="text-align: center;"| SWIER5
| style="text-align: center;"| SWIER4
| style="text-align: center;"| SWIER3
| style="text-align: center;"| SWIER2
| style="text-align: center;"| SWIER1
| colspan="2" style="text-align: center;"| SWIER0
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [15:10]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [9:0]
| style="text-align: center;"| SWIERx
| style="text-align: center;"| RW
| style="text-align: left;"| Программное прерывание установлено на соответствующий внешний канал прерывания. Установка его здесь приводит к тому, что флаг прерывания (EXTI_INTFR) соответствует биту позиции, и если разрешение прерывания (EXTI_INTENR) или разрешение события (EXTI_EVENR) включены, то будет сгенерировано прерывание или событие.
| style="text-align: center;"| 0
|}

<span id="регистр-флагов-прерываний-exti_intfr"></span>
==== 6.5.1.6 Регистр флагов прерываний (EXTI_INTFR)  ====

Адрес смещения: 0x14

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="6" style="text-align: center;"| Резерв
| style="text-align: center;"| IF9
| style="text-align: center;"| IF8
| style="text-align: center;"| IF7
| style="text-align: center;"| IF6
| style="text-align: center;"| IF5
| style="text-align: center;"| IF4
| style="text-align: center;"| IF3
| style="text-align: center;"| IF2
| style="text-align: center;"| IF1
| style="text-align: center;"| IF0
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [15:10]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [9:0]
| style="text-align: center;"| IFx
| style="text-align: center;"| RW
| style="text-align: left;"| Флаг прерывания: данный бит указывает, что произошло соответствующее внешнее прерывание. Запись значения &quot;1&quot; очищает этот бит.
| style="text-align: center;"| 0
|}

<span id="pfic-регистры"></span>
=== 6.5.2 PFIC Регистры  ===

Таблица 6-4 Список регистров, связанных с PFIC

{| class="wikitable"
|-
! style="text-align: center;"| '''Наименование'''
! style="text-align: center;"| '''Адрес'''
! style="text-align: center;"| '''Описание'''
! style="text-align: center;"| '''Значение сброса'''
|-
| style="text-align: left;"| R32_PFIC_ISR1
| style="text-align: center;"| 0xE000E000
| style="text-align: left;"| Регистр состояния разрешения прерывания PFIC 1
| style="text-align: center;"| 0x0000000C
|-
| style="text-align: left;"| R32_PFIC_ISR2
| style="text-align: center;"| 0xE000E004
| style="text-align: left;"| Регистр состояния разрешения прерывания PFIC 2
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_PFIC_IPR1
| style="text-align: center;"| 0xE000E020
| style="text-align: left;"| Регистр состояния ожидания прерывания PFIC 1
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_PFIC_IPR2
| style="text-align: center;"| 0xE000E024
| style="text-align: left;"| Регистр состояния ожидания прерывания PFIC 2
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_PFIC_

ITHRESDR

| style="text-align: center;"| 0xE000E040
| style="text-align: left;"| Регистр конфигурации порога приоритета прерывания PFIC
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_PFIC_CFGR
| style="text-align: center;"| 0xE000E048
| style="text-align: left;"| Регистр конфигурации прерывания PFIC
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_PFIC_GISR
| style="text-align: center;"| 0xE000E04C
| style="text-align: left;"| Регистр глобального состояния прерывания PFIC
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_PFIC_VTFIDR
| style="text-align: center;"| 0xE000E050
| style="text-align: left;"| Регистр конфигурации идентификатора VTF прерывания PFIC
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_PFIC_

VTFADDRR0

| style="text-align: center;"| 0xE000E060
| style="text-align: left;"| Регистр смещения адреса прерывания VTF PFIC 0
| style="text-align: center;"| 0x00000000
|-
| style="text-align: center;"| R32_PFIC_

VTFADDRR1

| style="text-align: center;"| 0xE000E064
| style="text-align: left;"| Регистр смещения адреса прерывания VTF PFIC 1
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_PFIC_IENR1
| style="text-align: center;"| 0xE000E100
| style="text-align: left;"| Регистр установки разрешения прерывания PFIC 1
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_PFIC_IENR2
| style="text-align: center;"| 0xE000E104
| style="text-align: left;"| Регистр установки разрешения прерывания PFIC 2Начало формыКонец формы
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_PFIC_IRER1
| style="text-align: center;"| 0xE000E180
| style="text-align: left;"| Регистр очистки разрешения прерывания PFIC 1
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_PFIC_IRER2
| style="text-align: center;"| 0xE000E184
| style="text-align: left;"| Регистр очистки разрешения прерывания PFIC 2
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_PFIC_IPSR1
| style="text-align: center;"| 0xE000E200
| style="text-align: left;"| Регистр установки ожидания прерывания PFIC 1
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_PFIC_IPSR2
| style="text-align: center;"| 0xE000E204
| style="text-align: left;"| Регистр установки ожидания прерывания PFIC 2
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_PFIC_IPRR1
| style="text-align: center;"| 0xE000E280
| style="text-align: left;"| Регистр очистки ожидания прерывания PFIC 1
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_PFIC_IPRR2
| style="text-align: center;"| 0xE000E284
| style="text-align: left;"| Регистр очистки ожидания прерывания PFIC 2
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_PFIC_IACTR1
| style="text-align: center;"| 0xE000E300
| style="text-align: left;"| Регистр состояния активации прерывания PFIC 1
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_PFIC_IACTR2
| style="text-align: center;"| 0xE000E304
| style="text-align: left;"| Регистр состояния активации прерывания PFIC 2
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_PFIC_IPRIORx
| style="text-align: center;"| 0xE000E400
| style="text-align: left;"| Регистр конфигурации приоритета прерывания PFIC
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_PFIC_SCTLR
| style="text-align: center;"| 0xE000ED10
| style="text-align: left;"| Регистр управления системой PFIC
| style="text-align: center;"| 0x00000000
|}

''Примечание:''

# ''Значение по умолчанию регистра PFIC_ISR1 равно 0xC, то есть NMI и исключение всегда включены по умолчанию.''
# ''NMI и EXC поддерживают операции очистки и установки ожидания прерывания, но не поддерживают операции очистки и установки разрешения прерывания.''

<span id="pfic-регистр-состояния-разрешения-прерываний-1-pfic_isr1"></span>
==== 6.5.2.1 PFIC Регистр состояния разрешения прерываний 1 (PFIC_ISR1)  ====

Адрес смещения: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| INTENSTA[31:16]
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| style="text-align: center;"| Резерв
| style="text-align: center;"| INTENSTA14
| style="text-align: center;"| Резерв
| style="text-align: center;"| INTENSTA12
| colspan="8" style="text-align: center;"| Резерв
| style="text-align: center;"| INTENSTA3
| style="text-align: center;"| INTENSTA2
| colspan="2" style="text-align: center;"| SWIER1
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| rowspan="3" style="text-align: center;"| [31:16]
| rowspan="3" style="text-align: center;"| INT ENSTA
| rowspan="3" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| 16#-31# Статус включено ли конкретное прерывание (interrupt) в данный момент времени
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Если значение равно 1, это означает, что данное прерывание включено. То есть, когда возникает условие, которое должно вызывать это прерывание, процессор перейдет к обработке соответствующей процедуры обработки прерывания
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Если же значение равно 0, это говорит о том, что прерывание в данный момент отключено. Даже если условие для вызова прерывания возникнет, оно не будет обработано процессором
|-
| style="text-align: center;"| [15]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [14]
| rowspan="3" style="text-align: center;"| INT ENSTA
| rowspan="3" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| 14# Статус включено ли конкретное прерывание (interrupt) в данный момент времени
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включено
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключено
|-
| style="text-align: center;"| [13]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [12]
| rowspan="3" style="text-align: center;"| INT ENSTA
| rowspan="3" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| 12# Статус включено ли конкретное прерывание (interrupt) в данный момент времени
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включено
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключено
|-
| style="text-align: center;"| [11:4]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [3:2]
| rowspan="3" style="text-align: center;"| INT ENSTA
| rowspan="3" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| 2#-#3 Статус включено ли конкретное прерывание (interrupt) в данный момент времени
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включено
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключено
|-
| style="text-align: center;"| [1:0]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|}

<span id="pfic-регистр-состояния-разрешения-прерываний-2-pfic_isr2"></span>
==== 6.5.2.2 PFIC Регистр состояния разрешения прерываний 2 (PFIC_ISR2)  ====

Адрес смещения: 0x04

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="9" style="text-align: center;"| Резерв
| colspan="7" style="text-align: center;"| INTENSTA[6:0]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:7]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [6:0]
| rowspan="3" style="text-align: center;"| INT ENSTA
| rowspan="3" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| 32#-38# Статус включено ли конкретное прерывание (interrupt) в данный момент времени
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включено
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключено
|}

<span id="pfic-регистр-состояния-ожидающих-прерываний-1-pfic_ipr1"></span>
==== 6.5.2.3 PFIC Регистр состояния ожидающих прерываний 1 (PFIC_IPR1)  ====

Адрес смещения: 0x20

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| PENDSTA[31:16]
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| style="text-align: left;"| Резерв
| style="text-align: left;"| PEN<br />
DST<br />
A14
| style="text-align: left;"| Резерв
| style="text-align: left;"| PEN<br />
DST<br />
A12
| colspan="8" style="text-align: center;"| Резерв
| style="text-align: left;"| PEN<br />
DST<br />
A3
| style="text-align: left;"| PEN<br />
DST<br />
A2
| colspan="2" style="text-align: center;"| Резерв
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| rowspan="3" style="text-align: center;"| [31:16]
| rowspan="3" style="text-align: center;"| INT ENSTA
| rowspan="3" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| 16#-31# Прервать текущий ожидаемый статус
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Текущий номер прерывания находится в ожидании
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Текущий номер прерывания не находится в ожидании
|-
| style="text-align: center;"| [15]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [14]
| rowspan="3" style="text-align: center;"| INT ENSTA
| rowspan="3" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| 14# Прервать текущий ожидаемый статус
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Текущий номер прерывания находится в ожидании
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Текущий номер прерывания не находится в ожидании
|-
| style="text-align: center;"| [13]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [12]
| rowspan="3" style="text-align: center;"| INT ENSTA
| rowspan="3" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| 12# Прервать текущий ожидаемый статус
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Текущий номер прерывания находится в ожидании
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Текущий номер прерывания не находится в ожидании
|-
| style="text-align: center;"| [11:4]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [3:2]
| rowspan="3" style="text-align: center;"| INT ENSTA
| rowspan="3" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| 2#-3# Прервать текущий ожидаемый статус
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Текущий номер прерывания находится в ожидании
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Текущий номер прерывания не находится в ожидании
|-
| style="text-align: center;"| [1:0]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|}

<span id="pfic-регистр-состояния-ожидающих-прерываний-2-pfic_ipr2"></span>
==== 6.5.2.4 PFIC Регистр состояния ожидающих прерываний 2 (PFIC_IPR2)  ====

Адрес смещения: 0x24

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="9" style="text-align: center;"| Резерв
| colspan="7" style="text-align: center;"| PENDSTA[38:32]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:7]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [6:0]
| rowspan="3" style="text-align: center;"| PENDSTA
| rowspan="3" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| 32#-38# Прервать текущий ожидаемый статус
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Текущий номер прерывания находится в ожидании
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Текущий номер прерывания не находится в ожидании
|}

<span id="pfic-регистр-конфигурации-порога-приоритета-прерываний-pfic_ithresdr"></span>
==== 6.5.2.5 PFIC Регистр конфигурации порога приоритета прерываний (PFIC_ITHRESDR)  ====

Адрес смещения: 0x40

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="8" style="text-align: center;"| Резерв
| colspan="8" style="text-align: center;"| THRESHOLD[7:0]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:8]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [7:0]
| rowspan="3" style="text-align: center;"| THRESHOLD<br />
[7:0]
| rowspan="3" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Значение настройки порога приоритета прерывания.<br />
Значение приоритета прерывания ниже установленного значения, при зависании, не выполняет обслуживание прерывания; этот регистр со значением 0 означает, что функция регистра порога недействительна.
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| [7:6]:
| style="text-align: left;"| порог приоритета.
|-
| style="text-align: right;"| [5:0]:
| style="text-align: left;"| зарезервировано, фиксировано на 0, запись недействительна.
|}

<span id="pfic-регистр-конфигурации-прерываний-pfic_cfgr"></span>
==== 6.5.2.6 PFIC Регистр конфигурации прерываний (PFIC_CFGR)  ====

Адрес смещения: 0x48

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| KEYCODE[15:0]
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="8" style="text-align: center;"| Резерв
| style="text-align: left;"| RESETSYS
| colspan="7" style="text-align: center;"| Резерв
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:16]
| style="text-align: center;"| KEYCODE [15:0]
| style="text-align: center;"| WO
| style="text-align: left;"| Соответственно разным битам управления целевым объектом, соответствующие данные идентификации безопасности доступа необходимо записывать одновременно для изменения, а считываемые данные фиксированы на 0.<br />
KEY1 = 0xFA05<br />
KEY2 = 0xBCAF<br />
KEY3 = 0xBEEF
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [15:8]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [7]
| style="text-align: center;"| RESETSYS
| style="text-align: center;"| WO
| style="text-align: left;"| Сброс системы (одновременная запись в KEY3). Автоматическая очистка 0. Запись 1 действительна, запись 0 недействительна.<br />
''Примечание: та же функция, что и у бита '''SYSRESET''' регистра '''PFIC_SCTLR'''.''
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [6:0]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|}

<span id="pfic-глобальный-регистр-состояния-прерываний-pfic_gisr"></span>
==== 6.5.2.7 PFIC Глобальный регистр состояния прерываний (PFIC_GISR)  ====

Адрес смещения: 0x4C

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="6" style="text-align: center;"| Резерв
| style="text-align: left;"| GPENDSTA
| style="text-align: left;"| GACTSTA
| colspan="8" style="text-align: center;"| NESTSTA[7:0]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:10]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [9]
| rowspan="3" style="text-align: center;"| GPEND STA
| rowspan="3" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Наличие прерываний, которые в настоящее время находятся в ожидании.
| style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Есть
| rowspan="2" style="text-align: left;"|
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет
|-
| rowspan="3" style="text-align: center;"| [8]
| rowspan="3" style="text-align: center;"| GACTSTA
| rowspan="3" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Наличие прерываний, которые в настоящее время выполняются.
| style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Есть
| rowspan="2" style="text-align: left;"|
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет
|-
| rowspan="4" style="text-align: center;"| [7:0]
| rowspan="4" style="text-align: center;"| NESTSTA [7:0]
| rowspan="4" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Текущий статус вложенности прерываний: в настоящий момент поддерживается максимум 2 уровня вложенности и максимальная глубина аппаратного стека также составляет 2 уровня.
| style="text-align: center;"| 0
|-
| style="text-align: right;"| 0x03:
| style="text-align: left;"| Идёт обработка прерывания второго уровня
| rowspan="3" style="text-align: left;"|
|-
| style="text-align: right;"| 0x01:
| style="text-align: left;"| Идёт обработка прерывания первого уровня
|-
| style="text-align: right;"| Other:
| style="text-align: left;"| Прерывания не выполняются
|}

<span id="pfic-регистр-конфигурации-идентификатора-прерывания-vtf-pfic_vtfidr"></span>
==== 6.5.2.8 PFIC Регистр конфигурации идентификатора прерывания VTF (PFIC_VTFIDR)  ====

Адрес смещения: 0x50

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="8" style="text-align: center;"| VTFID1
| colspan="8" style="text-align: center;"| VTFID0
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:16]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [15:8]
| style="text-align: left;"| VTFID1
| style="text-align: center;"| RW
| style="text-align: left;"| Настройте номер прерывания для VTF прерывание 1
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [7:0]
| style="text-align: left;"| VTFID0
| style="text-align: center;"| RW
| style="text-align: left;"| Настройте номер прерывания для прерывания VTF
| style="text-align: center;"| 0
|}

<span id="pfic-регистр-адреса-прерывания-vtf-0-pfic_vtfaddrr0"></span>
==== 6.5.2.9 PFIC Регистр адреса прерывания VTF 0 (PFIC_VTFADDRR0)  ====

Адрес смещения: 0x60

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| ADDR0[31:16]
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="15" style="text-align: center;"| ADDR0[15:1]
| style="text-align: left;"| VTF0EN
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:1]
| style="text-align: center;"| ADDR0[31:1]
| style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Адрес программы обслуживания прерывания VTF 0<br />
биты [31:1], бит 0 равен 0
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [0]
| rowspan="3" style="text-align: center;"| VTF0EN
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит разрешения прерывания VTF 0
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: left;"| 1:
| style="text-align: left;"| Разрешить прерывание канала VTF 0
|-
| style="text-align: left;"| 0:
| style="text-align: left;"| Отключить
|}

<span id="pfic-регистр-адреса-прерывания-vtf-1-pfic_vtfaddrr1"></span>
==== 6.5.2.10 PFIC Регистр адреса прерывания VTF 1 (PFIC_VTFADDRR1)  ====

Адрес смещения: 0x64

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| ADDR1[31:16]
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="15" style="text-align: center;"| ADDR1[15:1]
| style="text-align: left;"| VTF1EN
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:1]
| style="text-align: center;"| ADDR1[31:1]
| style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Адрес программы обслуживания прерывания VTF 1<br />
биты [31:1], бит 0 равен 0
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [0]
| rowspan="3" style="text-align: center;"| VTF1EN
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит разрешения прерывания VTF 1
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: left;"| 1:
| style="text-align: left;"| Разрешить прерывание канала VTF 1
|-
| style="text-align: left;"| 0:
| style="text-align: left;"| Отключить
|}

<span id="pfic-регистр-установки-разрешения-прерываний-1-pfic_ienr1"></span>
==== 6.5.2.11 PFIC Регистр установки разрешения прерываний 1 (PFIC_IENR1)  ====

Адрес смещения: 0x100

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| INTEN[31:16]
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| style="text-align: center;"| Рез.
| style="text-align: center;"| INTEN14
| style="text-align: center;"| Рез.
| style="text-align: center;"| INTEN12
| colspan="12" style="text-align: center;"| Резерв
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| rowspan="3" style="text-align: center;"| [31:16]
| rowspan="3" style="text-align: center;"| INTEN
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| 16#-31# Управление разрешением прерываний
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Разрешение соответствующего номеру бита прерывания
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет эффекта
|-
| style="text-align: center;"| [31:16]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [14]
| rowspan="3" style="text-align: center;"| INTEN
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| 14# Управление разрешением прерываний
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Разрешение соответствующего номеру бита прерывания
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет эффекта
|-
| style="text-align: center;"| [13]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [12]
| rowspan="3" style="text-align: center;"| INTEN
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| 12# Управление разрешением прерываний
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Разрешение соответствующего номеру бита прерывания
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет эффекта
|-
| style="text-align: center;"| [11:0]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|}

<blockquote>'''6.5.2.12 PFIC''' '''Регистр установки разрешения прерываний 2 (PFIC_IENR2)'''
</blockquote>
Адрес смещения: 0x104

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="9" style="text-align: center;"| Резерв
| colspan="7" style="text-align: center;"| INTEN[38:32]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:7]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [6:0]
| rowspan="3" style="text-align: center;"| INTEN
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| 32#-38# Управление разрешением прерываний
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Разрешение соответствующего номеру бита прерывания
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет эффекта
|}

<span id="pfic-регистр-очистки-разрешения-прерываний-1-pfic_irer1"></span>
==== 6.5.2.13 PFIC Регистр очистки разрешения прерываний 1 (PFIC_IRER1)  ====

Адрес смещения: 0x180

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| INTRSET[31:16]
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| style="text-align: center;"| Рез.
| style="text-align: center;"| INTRSET14
| style="text-align: center;"| Рез.
| style="text-align: center;"| INTRSET12
| colspan="12" style="text-align: center;"| Резерв
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| rowspan="3" style="text-align: center;"| [31:16]
| rowspan="3" style="text-align: center;"| INTRSET
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| 16#-31# Сброс разрешения прерывания
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Сброс соответствующего номеру бита разрешения прерывания
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет эффекта
|-
| style="text-align: center;"| [31:16]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [14]
| rowspan="3" style="text-align: center;"| INTRSET
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| 14# Сброс разрешения прерывания
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Сброс соответствующего номеру бита разрешения прерывания
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет эффекта
|-
| style="text-align: center;"| [13]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [12]
| rowspan="3" style="text-align: center;"| INTRSET
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| 12# Сброс разрешения прерывания
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Сброс соответствующего номеру бита разрешения прерывания
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет эффекта
|-
| style="text-align: center;"| [11:0]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| 0
|}

<span id="pfic-регистр-очистки-разрешения-прерываний-2-pfic_irer2"></span>
==== 6.5.2.14 PFIC Регистр очистки разрешения прерываний 2 (PFIC_IRER2)  ====

Адрес смещения: 0x184

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="9" style="text-align: center;"| Резерв
| colspan="7" style="text-align: center;"| INTRSET[38:32]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:7]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [6:0]
| rowspan="3" style="text-align: center;"| INTRSET 32_38
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| 32#-38# Сброс разрешения прерывания
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Сброс соответствующего номеру бита разрешения прерывания
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет эффекта
|}

<span id="pfic-регистр-настройки-ожидающих-прерываний-1-pfic_ipsr1"></span>
==== 6.5.2.15 PFIC Регистр настройки ожидающих прерываний 1 (PFIC_IPSR1)  ====

Адрес смещения: 0x200

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| PENDSET[31:16]
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| style="text-align: center;"| Рез.
| style="text-align: center;"| PENDSET14
| style="text-align: center;"| Рез.
| style="text-align: center;"| PENDSET12
| colspan="8" style="text-align: center;"| Резерв
| style="text-align: center;"| PENDSET3
| style="text-align: center;"| PENDSET2
| colspan="2" style="text-align: center;"| Резерв
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| rowspan="3" style="text-align: center;"| [31:16]
| rowspan="3" style="text-align: center;"| PENDSET
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| 16#-31# Установка паузы прерывания
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Прерывание с соответствующим номером ожидает
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет эффекта
|-
| style="text-align: center;"| [15]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [14]
| rowspan="3" style="text-align: center;"| PENDSET
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| 14# Установка паузы прерывания
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Прерывание с соответствующим номером ожидает
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет эффекта
|-
| style="text-align: center;"| [13]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [12]
| rowspan="3" style="text-align: center;"| PENDSET
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| 12# Установка паузы прерывания
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Прерывание с соответствующим номером ожидает
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет эффекта
|-
| style="text-align: center;"| [11:4]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [3:2]
| rowspan="3" style="text-align: center;"| PENDSET
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| 2#-3# Установка паузы прерывания
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Прерывание с соответствующим номером ожидает
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет эффекта
|-
| style="text-align: center;"| [1:0]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|}

<span id="pfic-регистр-настройки-ожидающих-прерываний-2-pfic_ipsr2"></span>
==== 6.5.2.16 PFIC Регистр настройки ожидающих прерываний 2 (PFIC_IPSR2)  ====

Адрес смещения: 0x204

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="9" style="text-align: center;"| Резерв
| colspan="7" style="text-align: center;"| PENDSET[38:32]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:7]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [6:0]
| rowspan="3" style="text-align: center;"| PENDSET
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| 32#-38# Установка ожидания прерывания
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Прерывание с соответствующим номером ожидает
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет эффекта
|}

<span id="pfic-регистр-очистки-ожидающих-прерываний-1-pfic_iprr1"></span>
==== 6.5.2.17 PFIC Регистр очистки ожидающих прерываний 1 (PFIC_IPRR1)  ====

Адрес смещения: 0x280

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! colspan="2" style="text-align: center;"| 19
! colspan="2" style="text-align: center;"| 18
! colspan="2" style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="19" style="text-align: center;"| PENDRST[31:16]
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| colspan="2" style="text-align: center;"| 3
| colspan="2" style="text-align: center;"| 2
| colspan="2" style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| style="text-align: center;"| Рез.
| style="text-align: center;"| PENDRST

14

| style="text-align: center;"| Рез.
| style="text-align: center;"| PENDRST12
| colspan="9" style="text-align: center;"| Резерв
| colspan="2" style="text-align: center;"| PENDRST3
| colspan="2" style="text-align: center;"| PENDRST2
| colspan="2" style="text-align: center;"| Резерв
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| rowspan="3" style="text-align: center;"| [31:16]
| rowspan="3" style="text-align: center;"| PENDRST
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| 16#-31# Сброс паузы прерывания
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Сброс ожидания с прерывания с соответствующим номером
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет эфекта
|-
| style="text-align: center;"| [15]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [14]
| rowspan="3" style="text-align: center;"| PENDRST
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| 14# Сброс паузы прерывания
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Сброс ожидания с прерывания с соответствующим номером
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет эфекта
|-
| style="text-align: center;"| [13]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [12]
| rowspan="3" style="text-align: center;"| PENDRST
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| 12# Сброс паузы прерывания
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Сброс ожидания с прерывания с соответствующим номером
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет эфекта
|-
| style="text-align: center;"| [11:4]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [3:2]
| rowspan="3" style="text-align: center;"| PENDRST
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| 2#-3# Сброс паузы прерывания
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Сброс ожидания с прерывания с соответствующим номером
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет эфекта
|-
| style="text-align: center;"| [1:0]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|}

<span id="pfic-регистр-очистки-ожидающих-прерываний-2-pfic_iprr2"></span>
==== 6.5.2.18 PFIC Регистр очистки ожидающих прерываний 2 (PFIC_IPRR2)  ====

Адрес смещения: 0x284

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="9" style="text-align: center;"| Резерв
| colspan="7" style="text-align: center;"| PENDRST[38:32]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:7]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [6:0]
| rowspan="3" style="text-align: center;"| PENDRST
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| 32#-38# Сброс паузы прерывания
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Сброс ожидания с прерывания с соответствующим номером
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет эфекта
|}

<span id="pfic-регистр-состояния-активации-прерывания-1-pfic_iactr1"></span>
==== 6.5.2.19 PFIC Регистр состояния активации прерывания 1 (PFIC_IACTR1)  ====

Адрес смещения: 0x300

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| IACTS[31:16]
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| style="text-align: left;"| Рез.
| style="text-align: left;"| IACTS14
| style="text-align: left;"| Рез.
| style="text-align: left;"| IACTS12
| colspan="8" style="text-align: center;"| Резерв
| style="text-align: left;"| IACTS3
| style="text-align: left;"| IACTS2
| colspan="2" style="text-align: center;"| Резерв
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| rowspan="3" style="text-align: center;"| [31:16]
| rowspan="3" style="text-align: center;"| IACTS
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| 16#-31# Статус выполнения прерывания
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Прерывание с соответствующим номером выполняется
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Прерывание с соответствующим номером не выполняется
|-
| style="text-align: center;"| [15]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [14]
| rowspan="3" style="text-align: center;"| IACTS
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| 14# Статус выполнения прерывания
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Прерывание с соответствующим номером выполняется
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Прерывание с соответствующим номером не выполняется
|-
| style="text-align: center;"| [13]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [12]
| rowspan="3" style="text-align: center;"| IACTS
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| 12# Статус выполнения прерывания
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Прерывание с соответствующим номером выполняется
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Прерывание с соответствующим номером не выполняется
|-
| style="text-align: center;"| [11:4]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [3:2]
| rowspan="3" style="text-align: center;"| IACTS
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| 2#-3# Статус выполнения прерывания
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Прерывание с соответствующим номером выполняется
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Прерывание с соответствующим номером не выполняется
|-
| style="text-align: center;"| [1:0]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|}

<span id="pfic-регистр-состояния-активации-прерывания-2-pfic_iactr2"></span>
==== 6.5.2.20 PFIC Регистр состояния активации прерывания 2 (PFIC_IACTR2)  ====

Адрес смещения: 0x304

{| class="wikitable"
|-
! style="text-align: center;"| 31
! colspan="2" style="text-align: center;"| 30
! style="text-align: center;"| 29
! colspan="2" style="text-align: center;"| 28
! style="text-align: center;"| 27
! colspan="3" style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="20" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| colspan="2" style="text-align: center;"| 14
| style="text-align: center;"| 13
| colspan="2" style="text-align: center;"| 12
| style="text-align: center;"| 11
| colspan="3" style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="13" style="text-align: center;"| Резерв
| colspan="7" style="text-align: center;"| IACTS [38:32]
|-
| colspan="2" style="text-align: center;"| Бит
| colspan="3" style="text-align: center;"| Название
| colspan="3" style="text-align: center;"| Доступ
| colspan="12" style="text-align: center;"| Описание
|-
| colspan="2" style="text-align: center;"| [31:7]
| colspan="3" style="text-align: center;"| Res
| colspan="3" style="text-align: center;"| RO
| colspan="12" style="text-align: left;"| Резерв
|-
| rowspan="3" colspan="2" style="text-align: center;"| [6:0]
| rowspan="3" colspan="3" style="text-align: center;"| IACTS
| rowspan="3" colspan="3" style="text-align: center;"| RO
| colspan="12" style="text-align: left;"| 32#-38# Статус выполнения прерывания
|-
| style="text-align: right;"| 1:
| colspan="11" style="text-align: left;"| Прерывание с соответствующим номером выполняется
|-
| style="text-align: right;"| 0:
| colspan="11" style="text-align: left;"| Прерывание с соответствующим номером не выполняется
|}

<span id="pfic-регистр-конфигурации-приоритета-прерываний"></span>
==== 6.5.2.21 PFIC Регистр конфигурации приоритета прерываний  ====

<span id="pfic_ipriorx-x0-63"></span>
==== (PFIC_IPRIORx) (x=0-63)  ====

Адрес смещения: 0x400-0x4FF

<blockquote>Контроллер поддерживает 256 прерываний (от 0 до 255), каждое из которых использует 8 бит для установки управляющего приоритета.
</blockquote>
{| class="wikitable"
|-
! style="text-align: left;"|
! style="text-align: left;"| 31
! style="text-align: right;"| 24
! style="text-align: left;"| 23
! style="text-align: right;"| 16
! style="text-align: left;"| 15
! style="text-align: right;"| 8
! style="text-align: left;"| 7
! style="text-align: right;"| 0
|-
| style="text-align: left;"| IPRIOR63
| colspan="2" style="text-align: center;"| PRIO_255
| colspan="2" style="text-align: center;"| PRIO_254
| colspan="2" style="text-align: center;"| PRIO_253
| colspan="2" style="text-align: center;"| PRIO_252
|-
| style="text-align: center;"| …
| colspan="2" style="text-align: center;"| …
| colspan="2" style="text-align: center;"| …
| colspan="2" style="text-align: center;"| …
| colspan="2" style="text-align: center;"| …
|-
| style="text-align: left;"| IPRIORx
| colspan="2" style="text-align: center;"| PRIO_(4x+3)
| colspan="2" style="text-align: center;"| PRIO_(4x+2)
| colspan="2" style="text-align: center;"| PRIO_(4x+1)
| colspan="2" style="text-align: center;"| PRIO_(4x+0)
|-
| style="text-align: center;"| …
| colspan="2" style="text-align: center;"| …
| colspan="2" style="text-align: center;"| …
| colspan="2" style="text-align: center;"| …
| colspan="2" style="text-align: center;"| …
|-
| style="text-align: left;"| IPRIOR0
| colspan="2" style="text-align: center;"| PRIO_3
| colspan="2" style="text-align: center;"| PRIO_2
| colspan="2" style="text-align: center;"| PRIO_1
| colspan="2" style="text-align: center;"| PRIO_0
|}

{| class="wikitable"
|-
! style="text-align: center;"| '''Бит'''
! style="text-align: center;"| '''Имя'''
! style="text-align: center;"| '''Доступ'''
! style="text-align: center;"| '''Описание'''
! style="text-align: center;"| '''Значение сброса'''
|-
| style="text-align: center;"| [2047:2040]
| style="text-align: center;"| IP_255
| style="text-align: center;"| RW
| style="text-align: center;"| Такое же что и у IP_0
| style="text-align: center;"| 0
|-
| style="text-align: center;"| …
| style="text-align: center;"| …
| style="text-align: center;"| …
| style="text-align: center;"| …
| style="text-align: center;"| …
|-
| style="text-align: center;"| [31:24]
| style="text-align: center;"| IP_3
| style="text-align: center;"| RW
| style="text-align: center;"| Такое же что и у IP_0
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [23:16]
| style="text-align: center;"| IP_2
| style="text-align: center;"| RW
| style="text-align: center;"| Такое же что и у IP_0
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [15:8]
| style="text-align: center;"| IP_1
| style="text-align: center;"| RW
| style="text-align: center;"| Такое же что и у IP_0
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [7:0]
| style="text-align: center;"| IP_0
| style="text-align: center;"| RW
| style="text-align: left;"| Конфигурация приоритета прерывания ноль. [7:6:4]: биты управления приоритетом.<br />
Если вложенность не настроена, отсутствуют биты предварительной выборки.<br />
Бит 7 является предварительным выбором, если настроены два уровня вложенности. [5:0]: зарезервировано, установлено на 0, запись недействительна.
| style="text-align: center;"| 0
|}

<span id="регистр-управления-системой-pfic-pfic_sctlr"></span>
==== 6.5.2.22 Регистр управления системой PFIC (PFIC_SCTLR)  ====

Адрес смещения: 0xD10

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! colspan="2" style="text-align: center;"| 21
! colspan="2" style="text-align: center;"| 20
! colspan="2" style="text-align: center;"| 19
! colspan="2" style="text-align: center;"| 18
! colspan="2" style="text-align: center;"| 17
! colspan="2" style="text-align: center;"| 16
|-
| style="text-align: center;"| SYS

RESET

| colspan="21" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| colspan="2" style="text-align: center;"| 5
| colspan="2" style="text-align: center;"| 4
| colspan="2" style="text-align: center;"| 3
| colspan="2" style="text-align: center;"| 2
| colspan="2" style="text-align: center;"| 1
| colspan="2" style="text-align: center;"| 0
|-
| colspan="11" style="text-align: center;"| Резерв
| colspan="2" style="text-align: left;"| SET<br />
EVE<br />
NT
| colspan="2" style="text-align: center;"| SEV<br />
ON

PEND

| colspan="2" style="text-align: left;"| WFIT

OWFE

| colspan="2" style="text-align: left;"| SLEEP

DEEP

| colspan="2" style="text-align: left;"| SLEEP

ON

EXIT

| style="text-align: left;"| Рез.
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31]
| style="text-align: center;"| Res
| style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| Системный сброс.<br />
Автоматически очищается в 0.<br />
Запись 1 – сброс, запись 0 – недействителен, эффект такой же, как у регистра PFIC_CFGR.
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [30:6]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [5]
| style="text-align: center;"| SETEVENT
| style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| Установить событие для пробуждения в случае ожидания (WFE)
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [4]
| rowspan="3" style="text-align: center;"| SEV ONPEND
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Когда происходит событие или возникает состояние ожидания прерывания, система может быть разбужена после выполнения инструкции WFE, либо если инструкция WFE не была выполнена, то система будет немедленно разбужена перед выполнением следующей команды.
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| разрешенные события и все прерывания (включая неразрешенные прерывания) могут разбудить систему
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| только разрешенные события и разрешенные прерывания могут разбудить систему
|-
| rowspan="3" style="text-align: center;"| [3]
| rowspan="3" style="text-align: center;"| WFITO WFE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Выполнить команду WFI так, как будто это команда WFE.
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Обрабатывать следующую команду WFI как команду WFE
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет эффекта
|-
| rowspan="3" style="text-align: center;"| [2]
| rowspan="3" style="text-align: center;"| SLEEP DEEP
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Режим низкого потребления питания системой управления
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Глубокий сон
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Сон
|-
| rowspan="3" style="text-align: center;"| [1]
| rowspan="3" style="text-align: center;"| SLEEP ONEXIT
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Состояние системы после выхода управления из программы обработки прерывания
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Система переходит в режим энергосбережения
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Система переходит в основную программу
|-
| style="text-align: center;"| [0]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв 
| style="text-align: center;"| 0
|}

<span id="специальные-регистры-csr"></span>
=== 6.5.3 Специальные регистры CSR ===

<blockquote>Архитектура RISC-V определяет ряд регистров управления и состояния ('''CSR'''), предназначенных для настройки, идентификации или регистрации рабочего состояния. Регистры '''CSR''' являются внутренними для ядра и используют выделенное 12-битное адресное пространство; микросхема CH32V003 дополнительно содержит несколько регистров, определенных производителем, помимо стандартных регистров, описанных в документации привилегированной архитектуры RISC-V, к которым требуется доступ с использованием инструкции csr.

''Примечание: Эти регистры помечены как &quot;'''MRW''', '''MRO''', '''MRW1'''&quot; и требуют, чтобы система находилась в машинном режиме для доступа к ним.''
</blockquote>
<span id="регистр-управления-системой-прерываний-intsyscr"></span>
==== 6.5.3.1 Регистр управления системой прерываний (INTSYSCR) ====

Адрес смещения: 0x804

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="14" style="text-align: center;"| Резерв
| style="text-align: left;"| INESTEN
| style="text-align: left;"| HWSTKEN
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:2]
| style="text-align: center;"| Res
| style="text-align: center;"| MRO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [1]
| rowspan="3" style="text-align: center;"| INESTEN
| rowspan="3" style="text-align: center;"| MRO
| colspan="2" style="text-align: left;"| Разрешение вложенных прерываний
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Функция вложенных прерываний включена
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Функция вложенных прерываний отключена
|-
| rowspan="3" style="text-align: center;"| [0]
| rowspan="3" style="text-align: center;"| HWSTKEN
| rowspan="3" style="text-align: center;"| MRO
| colspan="2" style="text-align: left;"| Включение аппаратного стека
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Функция аппаратного стекирования включена
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Функция аппаратного стекирования отключена
|}

<span id="регистр-базовой-адресации-входа-в-исключение-mtvec"></span>
==== 6.5.3.2 Регистр базовой адресации входа в исключение (MTVEC) ====

Адрес смещения: 0x305

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| BASEADDR[31:16]
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="14" style="text-align: center;"| BASEADDR[15:2]
| style="text-align: left;"| MODE1
| style="text-align: left;"| MODE0
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:2]
| style="text-align: center;"| BASEADDR<br />
[31:2]
| style="text-align: center;"| MRW
| colspan="2" style="text-align: left;"| Адрес таблицы векторов прерываний
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [1]
| rowspan="3" style="text-align: center;"| MODE1
| rowspan="3" style="text-align: center;"| MRW
| colspan="2" style="text-align: left;"| Таблица векторов прерываний определяет шаблоны
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Идентифицировать по абсолютному адресу, поддерживать полный диапазон, но необходимо прыгать
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Идентификация по команде перехода, ограниченный диапазон, поддержка непрыгающих инструкций
|-
| rowspan="3" style="text-align: center;"| [0]
| rowspan="3" style="text-align: center;"| MODE0
| rowspan="3" style="text-align: center;"| MRW
| colspan="2" style="text-align: left;"| Выбор режима адреса входа при прерывании или исключении
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Смещение адреса на основе номера прерывания, умноженного на 4
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Использование единого адреса входа.
|}

<span id="stk-описание-регистров"></span>
=== 6.5.4 STK Описание регистров ===

<blockquote>Таблица 6-5 Список регистров, связанных со стеком (STK)
</blockquote>
{| class="wikitable"
|-
! style="text-align: center;"| '''Наименование'''
! style="text-align: center;"| '''Адрес'''
! style="text-align: center;"| '''Описание'''
! style="text-align: center;"| '''Значение сброса'''
|-
| style="text-align: left;"| R32_STK_CTLR
| style="text-align: left;"| 0xE000F000
| style="text-align: left;"| Регистр управления системным счетчиком
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_STK_SR
| style="text-align: left;"| 0xE000F004
| style="text-align: left;"| Регистр состояния системного счетчика
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_STK_CNTL
| style="text-align: left;"| 0xE000F008
| style="text-align: left;"| Регистр системного счетчика
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_STK_CMPLR
| style="text-align: left;"| 0xE000F010
| style="text-align: left;"| Регистр сравнения счета
| style="text-align: left;"| 0x00000000
|}

<span id="регистр-управления-системным-счетчиком-stk_ctlr"></span>
==== 6.5.4.1 Регистр управления системным счетчиком (STK_CTLR)  ====

Адрес смещения: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| style="text-align: left;"| SWIE
| colspan="15" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="12" style="text-align: center;"| Резерв
| style="text-align: left;"| STRE
| style="text-align: left;"| STCLK
| style="text-align: left;"| STIE
| style="text-align: left;"| STE
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| rowspan="4" style="text-align: center;"| [31]
| rowspan="4" style="text-align: center;"| SWIE
| rowspan="4" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Разрешение генерации программного прерывания (SWI)
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Генерация программных прерываний
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключить генерацию
|-
| colspan="2" style="text-align: left;"| После входа в программное прерывание требуется очистить его в 0 программно, иначе оно будет непрерывно вызываться
|-
| style="text-align: center;"| [30:4]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [3]
| rowspan="3" style="text-align: center;"| STRE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит разрешения автоматического перезагрузки счетчика
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Повторный счет с нуля после достижения значения сравнения
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Досчитать до значения сравнения и продолжать счет вверх, досчитать до 0 и снова начать считать вниз от максимального значения
|-
| rowspan="3" style="text-align: center;"| [2]
| rowspan="3" style="text-align: center;"| STCLK
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит выбора источника тактовой частоты для счетчика
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| HCLK используется в качестве временной базы
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| HCLK/8 используется в качестве временной базы
|-
| rowspan="3" style="text-align: center;"| [1]
| rowspan="3" style="text-align: center;"| STIE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит управления разрешением прерывания от счетчика
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Разрешить прерывание от счетчика
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Запретить прерывание от счетчика
|-
| rowspan="3" style="text-align: center;"| [0]
| rowspan="3" style="text-align: center;"| STE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит управления включением системного счетчика
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включить системный счетчик STK
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Выключить системный счетчик STK, и счет прекращается
|}

<span id="регистр-состояния-системного-счетчика-stk_sr"></span>
==== 6.5.4.2 Регистр состояния системного счетчика (STK_SR)  ====

Адрес смещения: 0x04

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="15" style="text-align: center;"| Резерв
| style="text-align: left;"| CNTIF
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:1]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [0]
| rowspan="3" style="text-align: center;"| MODE1
| rowspan="3" style="text-align: center;"| RW0
| colspan="2" style="text-align: left;"| Флаг сравнения значений счета, запись 0 очищает флаг, запись 1 делает его недействительным
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Значение прямого счета достигло значения сравнения
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Значение сравнения не было достигнуто
|}

<span id="регистр-системного-счетчика-stk_cntl"></span>
==== 6.5.4.3 Регистр системного счетчика (STK_CNTL)  ====

Адрес смещения: 0x08

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| CNT[31:16]
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="16" style="text-align: center;"| CNT[15:0]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:0]
| style="text-align: center;"| Res
| style="text-align: center;"| RW
| style="text-align: left;"| Текущее значение счетчика сравнения 32 бита
| style="text-align: center;"| 0
|}

<span id="регистр-сравнения-счета-stk_cmplr"></span>
==== 6.5.4.4 Регистр сравнения счета (STK_CMPLR)  ====

Адрес смещения: 0x10

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| CMP[31:16]
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="16" style="text-align: center;"| CMP[15:0]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:0]
| style="text-align: center;"| Res
| style="text-align: center;"| RW
| style="text-align: left;"| Установка значения для сравнения счетчика 32 бита
| style="text-align: center;"| 0
|}

<span id="глава-7-общие-входы-выходы-gpio-и-их-альтернативные-функции-gpioafio"></span>
= <br />
Глава 7 Общие входы-выходы (GPIO) и их альтернативные функции (GPIO/AFIO)  =

<blockquote>Порт GPIO может быть сконфигурирован для различных режимов ввода или вывода, оснащен встроенными подтягивающими или тянущими резисторами, которые могут быть отключены, и может быть настроен для выполнения функций типа push-pull или open-drain. Порт GPIO также может мультиплексироваться для других функций.
</blockquote>
<span id="основные-характеристики-2"></span>
== 7.1 Основные характеристики ==

<blockquote>Каждый контакт порта может быть настроен на один из нескольких режимов:
</blockquote>
* Floating input (вход с плавающим потенциалом)
* Open drain output (выход с открытым стоком)
* Pull-up input (вход с подтяжкой вверх)
* Push-pull output (выход типа push-pull)
* Dropdown input (вход с подтягиванием вниз)
* Multiplexing the inputs and outputs of functions (мультиплексирование входов и выходов функций)

<blockquote>Многие контакты имеют возможность мультиплексирования, и многие другие периферийные устройства отображают свои выходные и входные каналы на эти контакты. Конкретное использование этих мультиплексированных контактов должно определяться индивидуально для каждого периферийного устройства, а содержание того, мультиплексируются ли эти контакты и переназначаются, объясняется в данной главе.
</blockquote>
<span id="описание-функций-1"></span>
== 7.2 Описание функций  ==

<span id="обзор-2"></span>
=== 7.2.1 Обзор  ===

<blockquote>Рисунок 7-1 Блок-схема базовой структуры модуля GPIO

[[File:media/image11.png|560x332px]]

''Примечание: (1) VDDx — это VDD, когда GPIO работает в нормальном режиме ввода-вывода, и VDDx — это VDD_FT, когда GPIO используется в режиме FT.''

Как показано на рисунке 7-1 структура порта ввода-вывода, каждый контакт имеет две защитные диоды внутри чипа, и порт ввода-вывода может быть разделён на модули драйвера ввода и вывода. Из них драйвер ввода имеет опциональные слабые подтягивающие и тянущие резисторы, которые могут быть подключены к АЦП и другим аналоговым периферийным устройствам; если ввод осуществляется на цифровое периферийное устройство, то он должен пройти через триггер Шмитта TTL, а затем подключиться к регистрам ввода GPIO или другим мультиплексированным периферийным устройствам. Драйвер вывода имеет пару МОП-транзисторов, и порт ввода-вывода можно настроить на открытый сток или выходной сигнал типа push-pull путём настройки того, включены ли верхний и нижний МОП-транзисторы; драйвер вывода также может быть настроен внутри для управления выводом через GPIO или другие мультиплексированные периферийные устройства.
</blockquote>
<span id="функция-инициализации-gpio"></span>
=== 7.2.2 Функция инициализации GPIO  ===

Сразу после сброса порты GPIO работают в начальном состоянии, при котором большинство портов ввода-вывода находятся в состоянии плавающего ввода, но существуют также связанные с периферией выводы, такие как HSE, работающие на функции мультиплексирования периферии. За конкретной информацией об инициализации обратитесь к главе, связанной с описанием выводов.

<span id="внешние-прерывания"></span>
=== 7.2.3 Внешние прерывания  ===

<blockquote>Все порты GPIO могут быть настроены с внешними каналами ввода прерываний, но один внешний канал ввода прерываний может быть сопоставлен максимум с одним контактом GPIO, и номер последовательного порта внешнего прерывания должен совпадать с номером бита порта GPIO. Например, PA1 (или PC1, PD1 и т.д.) может быть сопоставлено только с EXTI1, и EXTI1 может принимать только один из PA1, PC1 или PD1 и так далее. Отображение обеих сторон является взаимно однозначным.
</blockquote>
<span id="функции-мультиплексирования"></span>
=== 7.2.4 Функции мультиплексирования  ===

Важно отметить следующее при использовании функции мультиплексирования:

* Для использования функции мультиплексирования в направлении ввода порт должен быть настроен в мультиплексированный режим ввода, а настройка подтягивания может быть установлена в соответствии с фактическими потребностями.
* Для использования функции мультиплексирования в направлении вывода порт должен быть настроен в мультиплексированный режим вывода, и можно выбрать тип push-pull или open-drain в зависимости от реальной ситуации.
* В случае двунаправленного мультиплексирования порт должен быть настроен в режим мультиплексированного вывода, а драйвер — в режим плавающего ввода.

Один и тот же порт ввода-вывода может иметь несколько периферийных устройств, мультиплексируемых на этот контакт, поэтому для максимального увеличения пространства для каждой периферии мультиплексированные контакты периферийных устройств могут быть переназначены на другие контакты в дополнение к контактам по умолчанию, избегая занятых контактов.

<span id="механизм-блокировки"></span>
=== 7.2.5 Механизм блокировки ( ===

<span id="locking-mechanism"></span>
=== Locking Mechanism) ===

<blockquote>Механизм блокировки фиксирует конфигурацию порта ввода-вывода. После определенной последовательности записи конфигурация выбранного контакта ввода-вывода будет заблокирована и не сможет изменяться до следующего сброса.
</blockquote>
<span id="настройка-входа"></span>
=== 7.2.6 Настройка входа  ===

<blockquote>Рисунок 7-2 Блок-схема структуры конфигурации ввода модуля GPIO

[[File:media/image12.png|500x275px]]
</blockquote>
Когда порт ввода-вывода настроен в режим ввода, выходной драйвер отключается, подтягивание и опускание ввода выбираются, и никакие мультиплексированные функции или аналоговые входы не подключаются. Данные на каждом порту ввода-вывода собираются в регистр данных ввода на каждом такте HB, и уровень сигнала соответствующего контакта определяется чтением соответствующего бита регистра данных ввода.

<span id="конфигурация-выхода"></span>
=== 7.2.7 Конфигурация выхода  ===

<blockquote>Рисунок 7-3 Блок-схема структуры конфигурации вывода модуля GPIO

[[File:media/image13.png|509x282px]]

Когда порт ввода-вывода настроен на режим вывода, пара МОП-транзисторов в выходном драйвере может быть настроена на режим push-pull или open-drain в зависимости от необходимости, без использования функции мультиплексирования. Подтягивающие и тянущие резисторы драйвера ввода отключаются, активируется триггер Шмитта TTL, и уровни, появляющиеся на контактах ввода-вывода, будут собираться в регистры данных ввода на каждом такте HB. Таким образом, чтение регистров данных ввода даст состояние ввода-вывода, а в режиме вывода push-pull доступ к регистрам данных вывода даст последнее записанное значение.
</blockquote>
<span id="конфигурация-функции-мультиплексирования"></span>
=== 7.2.8 Конфигурация функции мультиплексирования  ===

<blockquote>Рисунок 7-4 Структура модуля GPIO при его мультиплексировании другой периферией

[[File:media/image14.png|509x282px]]

При включении мультиплексирования включается выходной драйвер, который может быть настроен на режим открытого стока или push-pull в зависимости от требований, включается триггер Шмитта, соединяются линии ввода и вывода функции мультиплексирования, но отключаются регистры выходных данных, и уровни, появляющиеся на контактах ввода-вывода, будут собираться в регистры данных ввода на каждом такте HB. В режиме открытого стока чтение регистра данных ввода даст текущее состояние порта ввода-вывода; в режиме push-pull чтение регистра выходных данных даст последнее записанное значение.
</blockquote>
<span id="конфигурация-аналогового-входа"></span>
=== 7.2.9 Конфигурация аналогового входа  ===

<blockquote>Рисунок 7-5 Структура конфигурации модуля GPIO в качестве аналогового входа

[[File:media/image15.png|509x283px]]
</blockquote>
Когда включен аналоговый вход, буфер вывода отключается, вход триггера Шмитта в драйвере ввода отключается для предотвращения генерации потребления на порту ввода-вывода, подтягивающие и тянущие резисторы отключаются, и регистр чтения входных данных всегда будет содержать 0.

<span id="настройки-gpio-для-периферийных-устройств"></span>
=== 7.2.10 Настройки GPIO для периферийных устройств ===

<blockquote>В следующей таблице рекомендуются соответствующие конфигурации порта GPIO для каждого контакта периферийного устройства.
</blockquote>
Таблица 7-1. Таймер управления с расширенными функциями (TIM1)

{| class="wikitable"
|-
! style="text-align: center;"| Пин TIM1
! style="text-align: center;"| Конфигурация
! style="text-align: center;"| GPIO конфигурация
|-
| rowspan="2" style="text-align: center;"| TIM1_CHx
| style="text-align: left;"| Канал x захват входа (Input Capture)
| style="text-align: left;"| Плавающий вход (Floating Input)
|-
| style="text-align: left;"| Канал x выход сравнения (Output Compare)
| style="text-align: left;"| Мультиплексированные выходы с push-pull конфигурацией
|-
| style="text-align: left;"| TIM1_CHxN
| style="text-align: left;"| Комплиментарный выход канала x
| style="text-align: left;"| Мультиплексированные выходы с push-pull конфигурацией
|-
| style="text-align: left;"| TIM1_BKIN
| style="text-align: left;"| Прерывающий вход (Brake Input)
| style="text-align: left;"| Плавающий вход (Floating Input)
|-
| style="text-align: left;"| TIM1_ETR
| style="text-align: left;"| Внешние активируемый вход тактирования
| style="text-align: left;"| Плавающий вход (Floating Input)
|}

Таблица 7-2 Универсальный таймер (TIM2)Начало формы

{| class="wikitable"
|-
! style="text-align: center;"| Пин TIM2
! style="text-align: center;"| Конфигурация
! style="text-align: center;"| GPIO конфигурация
|-
| rowspan="2" style="text-align: center;"| TIM2_CHx
| style="text-align: left;"| Канал x захват входа (Input Capture)
| style="text-align: left;"| Плавающий вход (Floating Input)
|-
| style="text-align: left;"| Канал x выход сравнения (Output Compare)
| style="text-align: left;"| Мультиплексированные выходы с push-pull конфигурацией
|-
| style="text-align: left;"| TIM1_ETR
| style="text-align: left;"| Внешние активируемый вход тактирования
| style="text-align: left;"| Плавающий вход (Floating Input)
|}

Таблица 7-3 Универсальный синхронно-асинхронный приемопередатчик (USART)Начало формы

{| class="wikitable"
|-
! style="text-align: center;"| Пин USART
! style="text-align: center;"| Конфигурация
! style="text-align: center;"| GPIO конфигурация
|-
| rowspan="2" style="text-align: center;"| USARTx_TX
| style="text-align: left;"| Полнодуплексный режим (Full duplex)
| style="text-align: left;"| Мультиплексированные выходы с push-pull конфигурацией

Начало формы

Конец формы

|-
| style="text-align: left;"| Полудуплексный режим (Half-duplex)
| style="text-align: left;"| Мультиплексированные выходы с открытым стоком

Начало формы

Конец формы

|-
| rowspan="2" style="text-align: center;"| USARTx_RX
| style="text-align: left;"| Полнодуплексный режим (Full duplex)
| style="text-align: left;"| Плавающий вход или вход с подтягивающим резистором

Начало формы

Конец формы

|-
| style="text-align: left;"| Полудуплексный режим (Half-duplex)
| style="text-align: left;"| Не используется
|-
| style="text-align: left;"| USARTx_CK
| style="text-align: left;"| Синхронный режим
| style="text-align: left;"| Мультиплексированный выход с push-pull конфигурацией
|-
| style="text-align: left;"| USARTx_RTS
| style="text-align: left;"| Управление потоком данных с помощью сигнала RTS (Request to Send)
| style="text-align: left;"| Мультиплексированный выход с push-pull конфигурацией
|-
| style="text-align: left;"| USARTx_CTS
| style="text-align: left;"| Управление потоком данных с помощью сигнала CTS (Clear to Send)
| style="text-align: left;"| Плавающий вход или вход с подтягивающим резистором

Начало формы

Конец формы

|}

Таблица 7-4 Модули последовательного периферийного интерфейса (SPI)

{| class="wikitable"
|-
! style="text-align: center;"| Пин SPI
! style="text-align: center;"| Конфигурация
! style="text-align: center;"| GPIO конфигурация
|-
| rowspan="2" style="text-align: center;"| SPIx_SCK
| style="text-align: left;"| Режим мастера
| style="text-align: left;"| Мультиплексированный выход с push-pull конфигурацией
|-
| style="text-align: left;"| Режим слейва
| style="text-align: left;"| Плавающий вход (Floating Input)
|-
| rowspan="4" style="text-align: center;"| SPIx_MOSI
| style="text-align: left;"| Полнодуплексный режим мастера
| style="text-align: left;"| Мультиплексированный выход с push-pull конфигурацией
|-
| style="text-align: left;"| Полнодуплексный режим слейва
| style="text-align: left;"| Плавающий вход или вход с подтягивающим резистором

Начало формы

Конец формы

|-
| style="text-align: left;"| Простая двунаправленная линия данных/ режим мастера
| style="text-align: left;"| Мультиплексированные выходы с push-pull конфигурацией

Начало формы

Конец формы

|-
| style="text-align: left;"| Простая двунаправленная линия данных/ режим слейва
| style="text-align: left;"| Не используется
|-
| rowspan="4" style="text-align: center;"| SPIx_MISO
| style="text-align: left;"| Полнодуплексный режим мастера
| style="text-align: left;"| Плавающий вход или вход с подтягивающим резистором

Начало формы

Конец формы

|-
| style="text-align: left;"| Полнодуплексный режим слейва
| style="text-align: left;"| Мультиплексированный выход с push-pull конфигурацией
|-
| style="text-align: left;"| Простая двунаправленная линия данных/ режим мастера
| style="text-align: left;"| Не используется
|-
| style="text-align: left;"| Простая двунаправленная линия данных/ режим слейва
| style="text-align: left;"| Мультиплексированный выход с push-pull конфигурацией
|-
| rowspan="3" style="text-align: center;"| SPIx_NSS
| style="text-align: left;"| Аппаратный режим мастера или слейва
| style="text-align: left;"| Вход с плавающим состоянием, подтяжкой к питанию или к земле
|-
| style="text-align: left;"| Аппаратный режим мастера/ Режим включения вывода NSS
| style="text-align: left;"| Мультиплексированный выход с push-pull конфигурацией
|-
| style="text-align: left;"| Программный режим
| style="text-align: left;"| Не используется
|}

Таблица 7-5 Модуль внутренней интегрированной шины (I2C)

{| class="wikitable"
|-
! style="text-align: center;"| Пин SPI
! style="text-align: center;"| Конфигурация
! style="text-align: center;"| GPIO конфигурация
|-
| style="text-align: left;"| I2C_SCL
| style="text-align: left;"| Выход тактового синхросигнала шины I2C
| style="text-align: left;"| Выход с открытым стоком (open-drain)
|-
| style="text-align: left;"| I2C_SDA
| style="text-align: left;"| Выход данных шины I2C
| style="text-align: left;"| Выход с открытым стоком (open-drain)
|}

Таблица 7-6 Аналого-цифровые преобразователи (ADC)

{| class="wikitable"
|-
! style="text-align: center;"| Пин ADC
! style="text-align: center;"| GPIO конфигурация
|-
| style="text-align: center;"| ADC
| style="text-align: left;"| Аналоговый вход
|}

Таблица 7-7 Другие настройки функций ввода/вывода

{| class="wikitable"
|-
! style="text-align: center;"| Пины
! style="text-align: center;"| Возможные конфигурации
! style="text-align: center;"| GPIO конфигурация
|-
| style="text-align: center;"| MCO
| style="text-align: left;"| Выход тактовых импульсов
| style="text-align: left;"| Мультиплексированный выход с push-pull конфигурацией
|-
| style="text-align: center;"| EXTI
| style="text-align: left;"| Вход внешних прерываний
| style="text-align: left;"| Вход с плавающим состоянием, подтяжкой к питанию или к земле
|-
| style="text-align: center;"| OPA
| style="text-align: left;"| Вход операционного усилителя
| style="text-align: left;"| Плавающий вход (Floating Input)
|}

<span id="конфигурация-альтернативных-функций-gpioначало-формы"></span>
=== 7.2.11 Конфигурация альтернативных функций GPIOНачало формы ===

<span id="timer-alternate-function-remapping"></span>
=== <br />
7.2.11.1 Timer Alternate Function Remapping  ===

Таблица 7-8 Переназначение альтернативных функций TIM1

{| class="wikitable"
|-
! style="text-align: center;"| Alternate<br />
function
! style="text-align: center;"| TIM1_RM=00 Default mapping
! style="text-align: center;"| TIM1_RM=01 Partial mapping
! style="text-align: center;"| TIM1_RM=10 Partial mapping
! style="text-align: center;"| TIM1_RM=11<br />
Full mapping
|-
| style="text-align: left;"| TIM1_ETR
| style="text-align: center;"| PC5
| style="text-align: center;"| PC5
| style="text-align: center;"| PD4
| style="text-align: center;"| PC2
|-
| style="text-align: left;"| TIM1_CH1
| style="text-align: center;"| PD2
| style="text-align: center;"| PC6
| style="text-align: center;"| PD2
| style="text-align: center;"| PC4
|-
| style="text-align: left;"| TIM1_CH2
| style="text-align: center;"| PA1
| style="text-align: center;"| PC7
| style="text-align: center;"| PA1
| style="text-align: center;"| PC7
|-
| style="text-align: left;"| TIM1_CH3
| style="text-align: center;"| PC3
| style="text-align: center;"| PC0
| style="text-align: center;"| PC3
| style="text-align: center;"| PC5
|-
| style="text-align: left;"| TIM1_CH4
| style="text-align: center;"| PC4
| style="text-align: center;"| PD3
| style="text-align: center;"| PC4
| style="text-align: center;"| PD4
|-
| style="text-align: left;"| TIM1_BKIN
| style="text-align: center;"| PC2
| style="text-align: center;"| PC1
| style="text-align: center;"| PC2
| style="text-align: center;"| PC1
|-
| style="text-align: left;"| TIM1_CH1N
| style="text-align: center;"| PD0
| style="text-align: center;"| PC3
| style="text-align: center;"| PD0
| style="text-align: center;"| PC3
|-
| style="text-align: left;"| TIM1_CH2N
| style="text-align: center;"| PA2
| style="text-align: center;"| PC4
| style="text-align: center;"| PA2
| style="text-align: center;"| PD2
|-
| style="text-align: left;"| TIM1_CH3N
| style="text-align: center;"| PD1
| style="text-align: center;"| PD1
| style="text-align: center;"| PD1
| style="text-align: center;"| PC6
|}

''Примечание: Для функции отображения TIM1_CH1 в таблице условие следующее: TIM1_1_RM=0. Когда TIM1_1_RM=1, TIM1_CH1 отображается на LSI (для калибровки LSI).''

Таблица 7-9 Переназначение альтернативных функций TIM2

{| class="wikitable"
|-
! style="text-align: center;"| Alternate<br />
function
! style="text-align: center;"| TIM2_RM=00 Default mapping
! style="text-align: center;"| TIM2_RM=01 Partial mapping
! style="text-align: center;"| TIM2_RM=10 Partial mapping
! style="text-align: center;"| TIM2_RM=11<br />
Full mapping
|-
| style="text-align: left;"| TIM2_ETR
| style="text-align: center;"| PD4
| style="text-align: center;"| PC5
| style="text-align: center;"| PC1
| style="text-align: center;"| PC1
|-
| style="text-align: left;"| TIM2_CH1
| style="text-align: center;"| PD4
| style="text-align: center;"| PC5
| style="text-align: center;"| PC1
| style="text-align: center;"| PC1
|-
| style="text-align: left;"| TIM2_CH2
| style="text-align: center;"| PD3
| style="text-align: center;"| PC2
| style="text-align: center;"| PD3
| style="text-align: center;"| PC7
|-
| style="text-align: left;"| TIM2_CH3
| style="text-align: center;"| PC0
| style="text-align: center;"| PD2
| style="text-align: center;"| PC0
| style="text-align: center;"| PD6
|-
| style="text-align: left;"| TIM2_CH4
| style="text-align: center;"| PD7
| style="text-align: center;"| PC1
| style="text-align: center;"| PD7
| style="text-align: center;"| PD5
|}

Начало формы

<span id="переназначение-альтернативных-функций-usart"></span>
==== 7.2.11.2 Переназначение альтернативных функций USART ====

Таблица 7-10 Переназначение альтернативных функций USART1

{| class="wikitable"
|-
! style="text-align: center;"| Alternate<br />
function
! style="text-align: center;"| USART1_RM=00 Default mapping
! style="text-align: center;"| USART1_RM=01 Partial mapping
! style="text-align: center;"| USART1_RM=10 Partial mapping
! style="text-align: center;"| USART1_RM=11<br />
Full mapping
|-
| style="text-align: left;"| USART1_CK
| style="text-align: center;"| PD4
| style="text-align: center;"| PD7
| style="text-align: center;"| PD7
| style="text-align: center;"| PC5
|-
| style="text-align: left;"| USART1_TX
| style="text-align: center;"| PD5
| style="text-align: center;"| PD0
| style="text-align: center;"| PD6
| style="text-align: center;"| PC0
|-
| style="text-align: left;"| USART1_RX
| style="text-align: center;"| PD6
| style="text-align: center;"| PD1
| style="text-align: center;"| PD5
| style="text-align: center;"| PC1
|-
| style="text-align: left;"| USART1_CTS
| style="text-align: center;"| PD3
| style="text-align: center;"| PC3
| style="text-align: center;"| PC6
| style="text-align: center;"| PC6
|-
| style="text-align: left;"| USART1_RTS
| style="text-align: center;"| PC2
| style="text-align: center;"| PC2
| style="text-align: center;"| PC7
| style="text-align: center;"| PC7
|}

Начало формы

<span id="переназначение-альтернативных-функций-spiначало-формы"></span>
==== <br />
7.2.11.3 Переназначение альтернативных функций SPIНачало формы ====

Таблица 7-11 Переназначение альтернативных функций SPI

{| class="wikitable"
|-
! style="text-align: center;"| Альтернативная функция
! style="text-align: center;"| SPI1_RM=0 Default mapping
! style="text-align: center;"| SPI1_RM=1 Remapping
|-
| style="text-align: left;"| SPI1_NSS
| style="text-align: center;"| PC1
| style="text-align: center;"| PC0
|-
| style="text-align: left;"| SPI1_SCK
| style="text-align: center;"| PC5
| style="text-align: center;"| PC5
|-
| style="text-align: left;"| SPI1_MISO
| style="text-align: center;"| PC7
| style="text-align: center;"| PC7
|-
| style="text-align: left;"| SPI1_MOSI
| style="text-align: center;"| PC6
| style="text-align: center;"| PC6
|}

<span id="переназначение-альтернативных-функций-i2c"></span>
==== 7.2.11.4 Переназначение альтернативных функций I2C ====

Таблица 7-12 Переназначение альтернативных функций I2C

{| class="wikitable"
|-
! style="text-align: center;"| Альтернативная функция
! style="text-align: center;"| I2C1_RM=00 Default mapping
! style="text-align: center;"| I2C1_RM=01<br />
Remapping
! style="text-align: center;"| I2C1_RM=1x<br />
Remapping
|-
| style="text-align: left;"| I2C1_SCL
| style="text-align: center;"| PC2
| style="text-align: center;"| PD1
| style="text-align: center;"| PC5
|-
| style="text-align: left;"| I2C1_SDA
| style="text-align: center;"| PC1
| style="text-align: center;"| PD0
| style="text-align: center;"| PC6
|}

<span id="переназначение-альтернативных-функций-adc"></span>
==== 7.2.11.4 Переназначение альтернативных функций ADC  ====

Таблица 7-13 Переназначение альтернативных функций внешнего триггерного запуска преобразования АЦП

{| class="wikitable"
|-
! style="text-align: center;"| Альтернативная функция
! style="text-align: center;"| ADC_ETRGINJ_RM=0 Default mapping
! style="text-align: center;"| ADC_ETRGINJ_RM=1 Remapping
|-
| style="text-align: left;"| Внешний триггерный запуск преобразования АЦП
| style="text-align: center;"| PD1
| style="text-align: center;"| PA1
|}

Таблица 7-14 Переназначение альтернативных функций внешнего триггерного правила преобразования АЦП

{| class="wikitable"
|-
! style="text-align: center;"| Альтернативная функция
! style="text-align: center;"| ADC_ETRGINJ_RM=0 Default mapping
! style="text-align: center;"| ADC_ETRGREG_RM=1 Remapping
|-
| style="text-align: left;"| Внешнее правило триггерного преобразования АЦП
| style="text-align: center;"| PD3
| style="text-align: center;"| PC2
|}

<span id="описание-регистров-5"></span>
== 7.3 Описание регистров ==

<span id="описание-регистров-gpio"></span>
=== 7.3.1 Описание регистров GPIO ===

<blockquote>Если не указано иное, регистры GPIO должны оперировать словами (выполнять операции с этими регистрами с использованием 32 бит).
</blockquote>
Таблица 7-8 Список регистров, связанных с GPIO

{| class="wikitable"
|-
! style="text-align: center;"| '''Наименование'''
! style="text-align: center;"| '''Адрес'''
! style="text-align: center;"| '''Описание'''
! style="text-align: center;"| '''Значение сброса'''
|-
| style="text-align: left;"| R32_GPIOA_CFGLR
| style="text-align: center;"| 0x40010800
| style="text-align: left;"| Регистр конфигурации порта PA младший
| style="text-align: center;"| 0x44444444
|-
| style="text-align: left;"| R32_GPIOC_CFGLR
| style="text-align: center;"| 0x40011000
| style="text-align: left;"| Регистр конфигурации порта PC младший
| style="text-align: center;"| 0x44444444
|-
| style="text-align: left;"| R32_GPIOD_CFGLR
| style="text-align: center;"| 0x40011400
| style="text-align: left;"| Регистр конфигурации порта PD младший
| style="text-align: center;"| 0x44444444
|-
| style="text-align: left;"| R32_GPIOA_INDR
| style="text-align: center;"| 0x40010808
| style="text-align: left;"| Регистр приема данных порта PA
| style="text-align: center;"| 0x000000XX
|-
| style="text-align: left;"| R32_GPIOC_INDR
| style="text-align: center;"| 0x40011008
| style="text-align: left;"| Регистр приема данных порта PC
| style="text-align: center;"| 0x000000XX
|-
| style="text-align: left;"| R32_GPIOD_INDR
| style="text-align: center;"| 0x40011408
| style="text-align: left;"| Регистр приема данных порта PD
| style="text-align: center;"| 0x000000XX
|-
| style="text-align: left;"| R32_GPIOA_OUTDR
| style="text-align: center;"| 0x4001080C
| style="text-align: left;"| Регистр передачи данных в порт PAНачало формы

Конец формы

| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_GPIOC_OUTDR
| style="text-align: center;"| 0x4001100C
| style="text-align: left;"| Регистр передачи данных в порт PCНачало формы

Конец формы

| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_GPIOD_OUTDR
| style="text-align: center;"| 0x4001140C
| style="text-align: left;"| Регистр передачи данных в порт PD
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_GPIOA_BSHR
| style="text-align: center;"| 0x40010810
| style="text-align: left;"| Регистр установки/сброса порта PA
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_GPIOC_BSHR
| style="text-align: center;"| 0x40011010
| style="text-align: left;"| Регистр установки/сброса порта PC
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_GPIOD_BSHR
| style="text-align: center;"| 0x40011410
| style="text-align: left;"| Регистр установки/сброса порта PDНачало формы

Конец формы

| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_GPIOA_BCR
| style="text-align: center;"| 0x40010814
| style="text-align: left;"| Регистр сброса порта PA
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_GPIOC_BCR
| style="text-align: center;"| 0x40011014
| style="text-align: left;"| Регистр сброса порта PCНачало формы

Конец формы

| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_GPIOD_BCR
| style="text-align: center;"| 0x40011414
| style="text-align: left;"| Регистр сброса порта PD
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_GPIOA_LCKR
| style="text-align: center;"| 0x40010818
| style="text-align: left;"| Регистр блокировки конфигурации порта PA
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_GPIOC_LCKR
| style="text-align: center;"| 0x40011018
| style="text-align: left;"| Регистр блокировки конфигурации порта PC
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_GPIOD_LCKR
| style="text-align: center;"| 0x40011418
| style="text-align: left;"| Регистр блокировки конфигурации порта PDНачало формы

Конец формы

| style="text-align: center;"| 0x00000000
|}

<span id="младший-регистр-конфигурации-порта-gpiox_cfglr-xacd"></span>
==== 7.3.1.1 Младший регистр конфигурации порта (GPIOx_CFGLR) (x=A/C/D) ====

Смещение адреса: 0x00

Начало формы

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="2" style="text-align: center;"| CNF7
| colspan="2" style="text-align: center;"| MODE7
| colspan="2" style="text-align: center;"| CNF6
| colspan="2" style="text-align: center;"| MODE6
| colspan="2" style="text-align: center;"| CNF5
| colspan="2" style="text-align: center;"| MODE5
| colspan="2" style="text-align: center;"| CNF4
| colspan="2" style="text-align: center;"| MODE4
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="2" style="text-align: center;"| CNF3
| colspan="2" style="text-align: center;"| MODE3
| colspan="2" style="text-align: center;"| CNF2
| colspan="2" style="text-align: center;"| MODE2
| colspan="2" style="text-align: center;"| CNF1
| colspan="2" style="text-align: center;"| MODE1
| colspan="2" style="text-align: center;"| CNF0
| colspan="2" style="text-align: center;"| MODE0
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:30]
| rowspan="10" style="text-align: center;"| CNFy[1:0]
| rowspan="10" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| (y=0-7), биты конфигурации для порта x, посредством которых соответствующий порт конфигурируется. Когда находится в режиме ввода (MODE=00b)
| style="text-align: center;"| 01b
|-
| rowspan="2" style="text-align: center;"| [27:26]
| style="text-align: left;"| 00:
| style="text-align: left;"| Режим аналогового входа
| rowspan="4" style="text-align: left;"|
|-
| style="text-align: left;"| 01:
| style="text-align: left;"| Высокоимпендансный вход
|-
| rowspan="2" style="text-align: center;"| [23:22]
| style="text-align: left;"| 10:
| style="text-align: left;"| С подтяжкой к плюсу или нулю
|-
| style="text-align: left;"| 11:
| style="text-align: left;"| Зарезервировано
|-
| style="text-align: center;"| [19:18]
| colspan="2" style="text-align: left;"| В режиме ввода при MODE&gt;00b
| style="text-align: left;"|
|-
| style="text-align: center;"| [15:14]
| style="text-align: left;"| 00:
| style="text-align: left;"| Универсальный режим выхода с подтяжкой
| rowspan="4" style="text-align: left;"|
|-
| style="text-align: center;"| [11:10]
| style="text-align: left;"| 01:
| style="text-align: left;"| Универсальный режим выхода с открытым коллектором
|-
| style="text-align: center;"| [7:6]
| style="text-align: left;"| 10:
| style="text-align: left;"| Ружим мультиплексированного выхода с push-pull
|-
| style="text-align: center;"| [3:2]
| style="text-align: left;"| 11:
| style="text-align: left;"| Ружим мультиплексированного выхода с открытым коллектором
|-
| style="text-align: center;"| [29:28
| rowspan="8" style="text-align: center;"| MODEy [1:0]
| rowspan="8" style="text-align: center;"| RW
| rowspan="4" colspan="2" style="text-align: left;"| (y=0-7), выбор режима работы порта X осуществляется настройкой соответствующих битов конфигурации. Эти биты позволяют сконфигурировать соответствующий порт.
| rowspan="4" style="text-align: center;"| 00b
|-
| style="text-align: center;"| [25:24]
|-
| style="text-align: center;"| [21:20]
|-
| style="text-align: center;"| [17:16]
|-
| style="text-align: center;"| [13:12]
| style="text-align: left;"| 00:
| style="text-align: left;"| Режим входа
| rowspan="4" style="text-align: left;"|
|-
| style="text-align: center;"| [9:8]
| style="text-align: left;"| 01:
| style="text-align: left;"| Режим выхода, максимальная скорость 10 МГц
|-
| style="text-align: center;"| [5:4]
| style="text-align: left;"| 10:
| style="text-align: left;"| Режим выхода, максимальная скорость 2 МГц
|-
| style="text-align: center;"| [1:0]
| style="text-align: left;"| 11:
| style="text-align: left;"| Режим выхода, максимальная скорость 30 МГц
|}

'''<br />
7.3.1.2 Регистр ввода порта (GPIOx_INDR) (x=A/C/D)'''

Смещение адреса: 0x08

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="8" style="text-align: center;"| Резерв
| style="text-align: left;"| IDR7
| style="text-align: left;"| IDR6
| style="text-align: left;"| IDR5
| style="text-align: left;"| IDR4
| style="text-align: left;"| IDR3
| style="text-align: left;"| IDR2
| style="text-align: left;"| IDR1
| style="text-align: left;"| IDR0
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:8]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [7:0]
| style="text-align: center;"| IDRy
| style="text-align: center;"| RO
| style="text-align: left;"| (y=0-7) — это данные ввода порта. Эти биты доступны только для чтения и могут быть прочитаны только в 16-битной форме. Чтение этих значений представляет собой высокий и низкий уровни соответствующего бита.
| style="text-align: center;"| X
|}

'''7.3.1.3 Регистр вывода порта (GPIOx_OUTDR) (x=A/C/D)'''

'''Начало формы'''

Смещение адреса: 0x0С

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="8" style="text-align: center;"| Резерв
| style="text-align: left;"| ODR7
| style="text-align: left;"| ODR6
| style="text-align: left;"| ODR5
| style="text-align: left;"| ODR4
| style="text-align: left;"| ODR3
| style="text-align: left;"| ODR2
| style="text-align: left;"| ODR1
| style="text-align: left;"| ODR0
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:8]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [7:0]
| rowspan="3" style="text-align: center;"| IDRy
| rowspan="3" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| (y=0-7) — это данные, выводимые портом. Эти данные могут оперироваться только в 16-битной форме. Порт вывода передает значения этих регистров наружу.<br />
Для режимов с входами с подтяжкой вниз.
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: left;"| 0:
| style="text-align: left;"| Вход с подтяжкой к нулю
|-
| style="text-align: left;"| 1:
| style="text-align: left;"| Вход с подтяжкой к плюсу
|}

'''7.3.1.4 Регистр сброса/установки порта (GPIOx_BSHR) (x=A/C/D)'''

Смещение адреса: 0x10

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="8" style="text-align: center;"| Резерв
| style="text-align: center;"| BR7
| style="text-align: center;"| BR6
| style="text-align: center;"| BR5
| style="text-align: center;"| BR4
| style="text-align: center;"| BR3
| style="text-align: center;"| BR2
| style="text-align: center;"| BR1
| style="text-align: center;"| BR0
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="8" style="text-align: center;"| Резерв
| style="text-align: center;"| BS7
| style="text-align: center;"| BS6
| style="text-align: center;"| BS5
| style="text-align: center;"| BS4
| style="text-align: center;"| BS3
| style="text-align: center;"| BS2
| style="text-align: center;"| BS1
| style="text-align: center;"| BS0
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:24]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [23:16]
| style="text-align: center;"| BRy
| style="text-align: center;"| WO
| style="text-align: left;"| (y=0-7), соответствующие биты OUTDR очищаются для этих бит местоположения, и запись нуля не оказывает никакого эффекта. К этим битам можно получить доступ только в 16-битной форме. Если оба бита BR и BS установлены, действует бит BS.
| style="text-align: center;"|  
|-
| style="text-align: center;"| [31:24]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [7:0]
| style="text-align: center;"| Bsy
| style="text-align: center;"| WO
| style="text-align: left;"| (y=0-7), для которых биты местоположения установят соответствующие биты OUTDR в указанное положение, запись нуля не окажет никакого эффекта. Доступ к этим битам возможен только в 16-битной форме. Если оба бита BR и BS установлены, действует бит BS.
| style="text-align: center;"|  
|}

'''7.3.1.5 Регистр сброса порта (GPIOx_BCR) (x=A/C/D)'''

Смещение адреса: 0x14

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="8" style="text-align: center;"| Резерв
| style="text-align: left;"| BR7
| style="text-align: left;"| BR6
| style="text-align: left;"| BR5
| style="text-align: left;"| BR4
| style="text-align: left;"| BR3
| style="text-align: left;"| BR2
| style="text-align: left;"| BR1
| style="text-align: left;"| BR0
|}

'''Начало формы'''

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:8]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [7:0]
| style="text-align: center;"| Bry
| style="text-align: center;"| WO
| style="text-align: left;"| (y=0-7), соответствующие биты OUTDR сбрасываются для этих бит местоположения, и запись нуля не оказывает никакого эффекта. Доступ к этим битам возможен только в 16-битной форме.
| style="text-align: center;"| 0
|}

'''7.3.1.6 Регистр блокировки конфигурации порта (GPIOx_LCKR) (x=A/C/D)'''

Смещение адреса: 0x18

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="7" style="text-align: center;"| Резерв
| style="text-align: left;"| LCKK
| style="text-align: left;"| LCK7
| style="text-align: left;"| LCK6
| style="text-align: left;"| LCK5
| style="text-align: left;"| LCK4
| style="text-align: left;"| LCK3
| style="text-align: left;"| LCK2
| style="text-align: left;"| LCK1
| style="text-align: left;"| LCK0
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:9]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [8]
| style="text-align: center;"| LCKK
| style="text-align: center;"| RW
| style="text-align: left;"| Ключ блокировки, который может быть записан в определенной последовательности для блокировки, но он может быть считан в любое время. Он читается как 0 когда блокировка не активна, и 1, когда блокировка активна. Последовательность записи ключа блокировки следующая:<br />
-записать 1<br />
- записать 0<br />
- записать 1<br />
- считать 0<br />
- считать 1.<br />
Последний шаг не является обязательным, но может использоваться для подтверждения активности ключа блокировки. Любая ошибка при записи последовательности не позволит активировать блокировку, и значение LCK[7:0] не может быть изменено во время записи последовательности. После активации блокировки конфигурация порта может быть изменена только после следующего сброса.
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [7:0]
| style="text-align: center;"| LCKy
| style="text-align: center;"| RW
| style="text-align: left;"| (y=0-7), эти биты устанавливаются в 1 для указания блокировки конфигурации соответствующего порта. Эти биты могут быть изменены только до разблокировки LCKK. Заблокированная конфигурация относится к регистрам конфигурации GPIOx_CFGLR.
| style="text-align: center;"| 0
|}

<span id="описание-регистров-afio"></span>
=== 7.3.2 Описание регистров AFIO ===

<blockquote>Если не указано иное, регистры AFIO должны оперировать словами (выполнять операции с этими регистрами с использованием 32 бит)

Table 7-9 List of AFIO-related registers
</blockquote>
{| class="wikitable"
|-
! style="text-align: center;"| '''Наименование'''
! style="text-align: center;"| '''Адрес'''
! style="text-align: center;"| '''Описание'''
! style="text-align: center;"| '''Значение сброса'''
|-
| style="text-align: left;"| R32_AFIO_PCFR1
| style="text-align: left;"| 0x40010004
| style="text-align: left;"| Remap Register 1
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_AFIO_EXTICR
| style="text-align: left;"| 0x40010008
| style="text-align: left;"| External interrupt configuration register 1
| style="text-align: left;"| 0x00000001
|}

'''7.3.2.1 Регистр переназначения 1 (AFIO_PCFR1)'''

Смещение адреса: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! colspan="2" style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! colspan="2" style="text-align: center;"| 23
! colspan="2" style="text-align: center;"| 22
! colspan="2" style="text-align: center;"| 21
! colspan="2" style="text-align: center;"| 20
! style="text-align: center;"| 19
! colspan="2" style="text-align: center;"| 18
! colspan="2" style="text-align: center;"| 17
! colspan="2" style="text-align: center;"| 16
! style="text-align: left;"|
|-
| colspan="6" style="text-align: center;"| Резерв
| colspan="4" style="text-align: center;"| SWCFG[2:0]
| colspan="2" style="text-align: left;"| TIM1_IREMAP
| colspan="2" style="text-align: left;"| I2C1REMAP1
| colspan="2" style="text-align: left;"| USART1_RM1
| colspan="3" style="text-align: center;"| Резерв
| colspan="2" style="text-align: left;"| ADC_ETRGREG_R<br />
M
| colspan="2" style="text-align: left;"| ADC_ETRGINJ_R<br />
M
| colspan="2" style="text-align: left;"| Рез.
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| colspan="2" style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| colspan="2" style="text-align: center;"| 7
| colspan="2" style="text-align: center;"| 6
| colspan="2" style="text-align: center;"| 5
| colspan="2" style="text-align: center;"| 4
| style="text-align: center;"| 3
| colspan="2" style="text-align: center;"| 2
| colspan="2" style="text-align: center;"| 1
| colspan="2" style="text-align: center;"| 0
| style="text-align: left;"|
|-
| style="text-align: left;"| PA12_RM
| colspan="6" style="text-align: center;"| Резерв
| colspan="2" style="text-align: center;"| TIM2_RM
| colspan="4" style="text-align: center;"| TIM1_RM
| colspan="6" style="text-align: center;"| Резерв
| colspan="2" style="text-align: left;"| USART1_RM
| colspan="2" style="text-align: left;"| I2C1_RM
| colspan="2" style="text-align: left;"| SPI1_RM
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:9]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="4" style="text-align: center;"| [26:24]
| rowspan="4" style="text-align: center;"| SWCFG [2:0]
| rowspan="4" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Эти биты используются для настройки портов ввода-вывода для функций SW и трассировки. SWD (SDI) — это интерфейс отладки для доступа к ядру. Он всегда используется в качестве порта SWD после системного сброса.
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 0xx:
| style="text-align: left;"| SWD (SDI) включен
|-
| style="text-align: right;"| 100:
| style="text-align: left;"| Отключить SWD (SDI), пин будет функционировать как GPIO
|-
| colspan="2" style="text-align: left;"| другие: не верно
|-
| rowspan="3" style="text-align: center;"| [23]
| rowspan="3" style="text-align: center;"| TIM1_IREMAP
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Управление выбором канала 1 таймера 1.
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Выбрать внешние пины
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Выбрать внутренние импульсы LSI
|-
| rowspan="4" style="text-align: center;"| [22]
| rowspan="4" style="text-align: center;"| I2C1REMAP1
| rowspan="4" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит высокого уровня переназначения I2C1 (используется совместно с битом 1 регистра AFIO_PCFR1 I2C1_RM [22,1]).
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 00:
| style="text-align: left;"| карта по умолчанию (SCL/PC2, SDA/PC1).
|-
| style="text-align: right;"| 01:
| style="text-align: left;"| Переназначение (SCL/PD1, SDA/PD0).
|-
| style="text-align: right;"| 1x:
| style="text-align: left;"| Переназначение (SCL/PC5, SDA/PC6)
|-
| rowspan="5" style="text-align: center;"| [21]
| rowspan="5" style="text-align: center;"| USART1_RM1
| rowspan="5" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Конфигурация высокого уровня переназначения USART1 (используется вместе с битом 2 регистра AFIO PCFR1 USART1RM [21,2]).
| rowspan="5" style="text-align: center;"| 0
|-
| style="text-align: right;"| 00:
| style="text-align: left;"| По умолчанию (CK/PD4, TX/PD5, RX/PD6, CTS/PD3, RTS/PC2).
|-
| style="text-align: right;"| 01:
| style="text-align: left;"| Переназначение (CK/PD7, TX/PD0, RX/PD1, CTS/PC3, RTS/PC2, SW_RX/PD0).
|-
| style="text-align: right;"| 10:
| style="text-align: left;"| Переназначение (CK/PD7, TX/PD6, RX/PD5,<br />
CTS/PC6, RTS/PC7, SW_RX/PD6)
|-
| style="text-align: right;"| 11:
| style="text-align: left;"| Переназначение (CK/PC5, TX/PC0, RX/PC1, CTS/PC6, RTS/PC7, SW_RX/PC0)
|-
| style="text-align: center;"| [20:19]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [18]
| rowspan="3" style="text-align: center;"| ADC_ETRGREG_R<br />
M
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит переназначения для правила преобразования внешнего триггера АЦП.
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Правило преобразования внешнего триггера АЦП подключено к PD3
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Правило преобразования внешнего триггера АЦП подключено к PC2
|-
| rowspan="3" style="text-align: center;"| [17]
| rowspan="3" style="text-align: center;"| ADC_ETRGINJ_RM
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит переназначения для правила преобразования внешнего триггера АЦП.
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Правило преобразования внешнего триггера АЦП подключено к PD3
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Правило преобразования внешнего триггера АЦП подключено к PC2
|-
| style="text-align: center;"| [16]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [15]
| rowspan="3" style="text-align: center;"| PA12_RM
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит переназначения контактов PA1 и PA2, этот бит может быть прочитан или записан пользователем. Он контролирует правильную работу PA1 и PA2 (установлен в 1, когда подключен к контакту внешней кварцевой цепи).
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Контакт используется как GPIO и мультиплексируемую функцию.
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Отсутствие функциональной роли для контактов.
|-
| style="text-align: center;"| [14:10]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="5" style="text-align: center;"| [9:8]
| rowspan="5" style="text-align: center;"| TIM2_RM [1:0]
| rowspan="5" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Биты переназначения для таймера 2. Эти биты могут быть прочитаны и записаны пользователем. Они контролируют отображение каналов таймера 2 с 1 по 4 и внешнего триггера (ETR) на портах GPIO.
| rowspan="5" style="text-align: center;"| 0
|-
| style="text-align: right;"| 00:
| style="text-align: left;"| По умолчанию (CH1/ETR/PD4, CH2/PD3,<br />
CH3/PC0, CH4/PD7)
|-
| style="text-align: right;"| 01:
| style="text-align: left;"| Переназначение (CH1/ETR/PC5, CH2/PC2,<br />
CH3/PD2, CH4/PC1)
|-
| style="text-align: right;"| 10:
| style="text-align: left;"| Переназначение (CH1/ETR/PC1, CH2/PD3,<br />
CH3/PC0, CH4/PD7)
|-
| style="text-align: right;"| 11:
| style="text-align: left;"| Переназначение (CH1/ETR/PC1,<br />
CH2/PC7, CH3/PD6, CH4/PD5)
|-
| rowspan="5" style="text-align: center;"| [7:6]
| rowspan="5" style="text-align: center;"| TIM1_RM[1:0]
| rowspan="5" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Биты переназначения для таймера 1. Эти биты могут быть прочитаны и записаны пользователем. Они контролируют отображение каналов с 1 по 4, 1N по 3N, внешний триггер (ETR) и вход тормоза (BKIN) таймера 1 на портах GPIO.
| rowspan="5" style="text-align: center;"| 0
|-
| style="text-align: right;"| 00:
| style="text-align: left;"| По умолчанию (ETR/PC5, CH1/PD2,<br />
CH2/PA1, CH3/PC3, CH4/PC4, BKIN/PC2,<br />
CH1N/PD0, CH2N/PA2, CH3N/PD1)
|-
| style="text-align: right;"| 01:
| style="text-align: left;"| Переназначение (ETR/PC5, CH1/PC6,<br />
CH2/PC7, CH3/PC0, CH4/PD3, BKIN/PC1,<br />
CH1N/PC3, CH2N/PC4, CH3N/PD1)
|-
| style="text-align: right;"| 10:
| style="text-align: left;"| Переназначение (ETR/PD4, CH1/PD2,<br />
CH2/PA1, CH3/PC3, CH4/PC4, BKIN/PC2,<br />
CH1N/PD0, CH2N/PA2, CH3N/PD1)
|-
| style="text-align: right;"| 11:
| style="text-align: left;"| Переназначение (ETR/PC2, CH1/PC4,<br />
CH2/PC7, CH3/PC5, CH4/PD4, BKIN/PC1,<br />
CH1N/PC3, CH2N/PD2, CH3N/PC6)
|-
| style="text-align: center;"| [5:3]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="5" style="text-align: center;"| [2]
| rowspan="5" style="text-align: center;"| USART1_RM
| rowspan="5" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Низкоуровневый бит конфигурации переназначения USART1 (используется совместно с битом 21 регистра AFIO PCFR1 USART1REMAP1 [21,2]).
| rowspan="5" style="text-align: center;"| 0
|-
| style="text-align: right;"| 00:
| style="text-align: left;"| По умолчанию (CK/PD4, TX/PD5,<br />
RX/PD6, CTS/PD3, RTS/PC2)
|-
| style="text-align: right;"| 01:
| style="text-align: left;"| Переназначение (CK/PD7, TX/PD0, RX/PD1,<br />
CTS/PC3, RTS/PC2, SW_RX/PD0)
|-
| style="text-align: right;"| 10:
| style="text-align: left;"| Переназначение (CK/PD7, TX/PD6, RX/PD5,<br />
CTS/PC6, RTS/PC7, SW_RX/PD6)
|-
| style="text-align: right;"| 11:
| style="text-align: left;"| Переназначение (CK/PC5, TX/PC0, RX/PC1,<br />
CTS/PC6, RTS/PC7, SW_RX/PC0)
|-
| rowspan="4" style="text-align: center;"| [1]
| rowspan="4" style="text-align: center;"| I2C1_RM
| rowspan="4" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Низкоуровневый бит переназначения I2C1 (используется совместно с битом 22 регистра AFIO_PCFR1 I2C1_RM1 [22,1]).
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 00:
| style="text-align: left;"| По умолчанию (SCL/PC2, SDA/PC1)
|-
| style="text-align: right;"| 01:
| style="text-align: left;"| Переназначение (SCL/ PD1, SDA/ PD0)
|-
| style="text-align: right;"| 1x:
| style="text-align: left;"| Переназначение (SCL/PC5, SDA/PC6)
|-
| rowspan="3" style="text-align: center;"| [0]
| rowspan="3" style="text-align: center;"| SPI1_RM
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Переназначение SPI1. Этот бит может быть прочитан или записан пользователем. Он контролирует отображение функций мультиплексирования NSS, SCK, MISO и MOSI интерфейса SPI1 на порты GPIO.
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| По умолчанию (NSS/PC1, CK/PC5,<br />
MISO/PC7, MOSI/PC6)
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Переназначение (NSS/PC0, CK/PC5, MISO/PC7,<br />
MOSI/PC6)
|}

'''7.3.2.2 Регистр конфигурации внешних прерываний 1 (AFIO_EXTICR)'''

Смещение адреса: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="2" style="text-align: center;"| EXTI7
| colspan="2" style="text-align: center;"| EXTI6
| colspan="2" style="text-align: center;"| EXTI5
| colspan="2" style="text-align: center;"| EXTI4
| colspan="2" style="text-align: center;"| EXTI3
| colspan="2" style="text-align: center;"| EXTI2
| colspan="2" style="text-align: center;"| EXTI1
| colspan="2" style="text-align: center;"| EXTI0
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:9]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [15:14]
| rowspan="8" style="text-align: center;"| EXTIx[1:0]
| rowspan="8" style="text-align: center;"| RW
| rowspan="3" colspan="2" style="text-align: left;"| (x=0-7), бит конфигурации внешнего прерывания. Используется для определения, к каким портам подключены контакты внешнего прерывания.
| rowspan="8" style="text-align: center;"| 0
|-
| style="text-align: center;"| [13:12]
|-
| style="text-align: center;"| [11:10]
|-
| style="text-align: center;"| [9:8]
| style="text-align: right;"| 00:
| style="text-align: left;"| x пин порта PA
|-
| style="text-align: center;"| [7:6]
| style="text-align: right;"| 10:
| style="text-align: left;"| x пин порта PC
|-
| style="text-align: center;"| [5:4]
| style="text-align: right;"| 11:
| style="text-align: left;"| x пин порта PB
|-
| style="text-align: center;"| [3:2]
| rowspan="2" colspan="2" style="text-align: center;"|  
|-
| style="text-align: center;"| [1:0]
|}

<span id="глава-8-управление-прямым-доступом-к-памяти-dma"></span>
= <br />
Глава 8 Управление прямым доступом к памяти (DMA)  =

<blockquote>Контроллер прямого доступа к памяти (DMA) обеспечивает высокоскоростной метод передачи данных между периферийными устройствами и памятью или между памятью и памятью без вмешательства процессора, а данные могут быть быстро перемещены с помощью DMA для экономии ресурсов процессора для других операций. Каждый канал контроллера DMA предназначен для управления запросами на доступ к памяти от одного или нескольких периферийных устройств. Также существует арбитр для координации приоритетов между каналами.
</blockquote>
<span id="основные-характеристики-3"></span>
== 8.1 Основные характеристики ==

* Несколько независимых настраиваемых каналов
* Каждый канал напрямую подключен к выделенному аппаратному запросу DMA и поддерживает программный триггер
* Управление буфером с поддержкой циклов
* Приоритет запросов между несколькими каналами может быть установлен программированием (очень высокий, высокий, средний и низкий), а при равенстве приоритет определяется номером канала (чем ниже номер канала, тем выше приоритет)
* Поддерживает передачу данных &quot;периферия-память&quot;, &quot;память-периферия&quot; и &quot;память-память&quot;
* В качестве источников и целей доступа можно использовать флеш-память, SRAM, периферийный SRAM и периферии HB
* Программируемое количество байт для передачи данных: до 65 535

<span id="описание-функций-2"></span>
== 8.2 Описание функций ==

<span id="обработка-каналов-dma"></span>
=== 8.2.1 Обработка каналов DMA ===

<blockquote>'''1) Приоритеты арбитража'''

Запросы DMA, поступающие от нескольких независимых каналов, поступают в контроллер DMA через логическую схему типа &quot;ИЛИ&quot;, и в любой момент времени обслуживается только один из них. Арбитр внутри модуля выбирает, какой доступ к периферии или памяти следует инициировать, исходя из приоритета поступившего запроса.

С помощью программного управления приложение может настроить уровень приоритета для каждого канала индивидуально, установив соответствующие значения бит '''PL'''[1:0] в регистре конфигурации DMA ('''DMA_CFGRx'''). Доступны четыре уровня приоритета: самый высокий, высокий, средний и низкий. Если уровни приоритета, установленные программно, совпадают у нескольких каналов, то выбор между ними производится на основании фиксированного аппаратного приоритета: чем меньше номер канала, тем выше его приоритет по сравнению с другими каналами.

'''2) Конфигурация DMA'''

Когда контроллер DMA получает сигнал запроса, он обращается к запрашиваемой периферии или памяти и устанавливает передачу данных между периферией или памятью и памятью. Он состоит из следующих трех основных этапов работы.

'''4) Статус обработки DMA'''
</blockquote>
<span id="начало-формы-1"></span>
==== Начало формы ====

* '''Передача половины данных''': Соответствует установке бита '''HTIFx''' в регистре '''DMA_INTFR'''. Флаг, указывающий на передачу половины байтов DMA, будет сгенерирован, когда количество передач DMA уменьшится менее чем наполовину от начального установленного значения, и если установлен бит '''HTIE''' в регистре '''DMA_CCRx''', произойдет прерывание. Аппаратное обеспечение использует этот флаг, чтобы предупредить приложение о том, что оно может подготовиться к новому циклу передачи данных.
* '''Завершение передачи''': Соответствует настройке бита '''TCIFx''' в регистре '''DMA_INTFR'''. Когда количество передаваемых байтов DMA уменьшается до нуля, генерируется флаг завершения передачи DMA, и, если установлен бит '''TCIE''' в регистре '''DMA_CCRx''', происходит прерывание.
* '''Ошибка передачи''': Соответствует установленной аппаратуре биту '''TEIFx''' в регистре '''DMA_INTFR'''. Чтение или запись в зарезервированную область адреса приведет к возникновению ошибки передачи DMA. Одновременно аппаратное обеспечение модуля автоматически сбросит бит '''EN''' в регистре '''DMA_CCRx''' соответствующего канала, в котором произошла ошибка, и канал будет отключен. Если установлен бит '''TEIE''' в регистре '''DMA_CCRx''', также произойдет прерывание.

<blockquote>Когда приложение запрашивает статус канала DMA, оно сначала может получить доступ к биту '''GIFx''' регистра DMA_INTFR, чтобы определить, какой канал в настоящее время испытывает событие DMA, а затем обработать конкретное содержание события DMA для этого канала.
</blockquote>
<span id="программируемый-общий-размер-передаваемых-данныхширина-битов-данныхвыравнивание"></span>
=== 8.2.2 Программируемый общий размер передаваемых данных/ширина битов данных/выравнивание  ===

<blockquote>Общий размер данных, передаваемых за один цикл работы канала DMA, программируется до 65535 раз, и количество оставшихся байтов для передачи указывается в регистре '''DMA_CNTRx'''. При '''EN'''=0 записывается установленное значение, а при '''EN'''=1, когда канал передачи DMA включен, этот регистр становится атрибутом только для чтения со значением, уменьшающимся после каждой передачи.

Значение данных, извлекаемое из периферии и памяти, поддерживает функцию автоматического увеличения указателя адреса с программируемым увеличением указателя. Первый адрес передаваемых данных, к которому они обращаются, хранится в регистрах '''DMA_PADDRx''' и '''DMA_MADDRx'''. Путём установки бита '''PINC''' или положения '''MINC''' равным 1 в регистре '''DMA_CFGRx''' соответственно можно включить режим автоувеличения адреса периферии или автоувеличения адреса памяти. '''PSIZE'''[1:0] задаёт размер данных и размер автоувеличения для извлечения адреса периферии. '''MSIZE'''[1:0] задает размер данных для извлечения из памяти и размер её автоувеличения, включая три варианта: 8-битные, 16-битные и 32-битные. Конкретные методы передачи данных перечислены в следующей таблице.

Таблица 8-1 Передача DMA с различной шириной битов данных ('''PINC'''='''MINC'''=1)
</blockquote>
{| class="wikitable"
|-
! style="text-align: center;"| Размерность бит источника
! style="text-align: center;"| Заданная ширина бит
! style="text-align: center;"| Номер передачи
! style="text-align: center;"| Источник: адрес/данные
! style="text-align: center;"| Приемник: адрес/данные
! style="text-align: center;"| Операции передачи
|-
| style="text-align: center;"| 8
| style="text-align: center;"| 8
| style="text-align: center;"| 4
| style="text-align: left;"| 0x00/B0<br />
0x01/B1<br />
0x02/B2<br />
0x03/B3
| style="text-align: left;"| 0x00/B0<br />
0x01/B1<br />
0x02/B2<br />
0x03/B3
| rowspan="9"| * Инкремент исходного адреса выровнен с шириной бита данных, установленной в источнике, и принимает значение, равное ширине бита данных источника.
* Инкрементация целевого адреса выравнивается с шириной бит данных целевой настройки и принимает значение, равное ширине бит данных цели.
* Передача данных DMA, отправленных на цель, основана на принципе: старший бит размера данных недостаточен для формирования 0, переполнение старшего бита размера данных удаляется.
* Режим хранения данных: режим малого конца, низкий адрес хранит младшие байты, высокий адрес хранит старшие байты.

|-
| style="text-align: center;"| 8
| style="text-align: center;"| 16
| style="text-align: center;"| 4
| style="text-align: left;"| 0x00/B0<br />
0x01/B1<br />
0x02/B2<br />
0x03/B3
| style="text-align: left;"| 0x00/00B0<br />
0x02/00B1<br />
0x04/00B2<br />
0x06/00B3
|-
| style="text-align: center;"| 8
| style="text-align: center;"| 32
| style="text-align: center;"| 4
| style="text-align: left;"| 0x00/B0<br />
0x01/B1<br />
0x02/B2<br />
0x03/B3
| style="text-align: left;"| 0x00/000000B0<br />
0x04/000000B1<br />
0x08/000000B2<br />
0x0C/000000B3
|-
| style="text-align: center;"| 16
| style="text-align: center;"| 8
| style="text-align: center;"| 4
| style="text-align: left;"| 0x00/B1B0<br />
0x02/B3B2<br />
0x04/B5B4<br />
0x06/B7B6
| style="text-align: left;"| 0x00/B0<br />
0x01/B2<br />
0x02/B4<br />
0x03/B6
|-
| style="text-align: center;"| 16
| style="text-align: center;"| 16
| style="text-align: center;"| 4
| style="text-align: left;"| 0x00/B1B0<br />
0x02/B3B2<br />
0x04/B5B4<br />
0x06/B7B6
| style="text-align: left;"| 0x00/B1B0<br />
0x02/B3B2<br />
0x04/B5B4<br />
0x06/B7B6
|-
| style="text-align: center;"| 16
| style="text-align: center;"| 32
| style="text-align: center;"| 4
| style="text-align: left;"| 0x00/B1B0<br />
0x02/B3B2<br />
0x04/B5B4<br />
0x06/B7B6
| style="text-align: left;"| 0x00/0000B1B0<br />
0x04/0000B3B2<br />
0x08/0000B5B4<br />
0x0C/0000B7B6
|-
| style="text-align: center;"| 32
| style="text-align: center;"| 8
| style="text-align: center;"| 4
| style="text-align: left;"| 0x00/B3B2B1B0<br />
0x04/B7B6B5B4<br />
0x08/BBBAB9B8<br />
0x0C/BFBEBDBC
| style="text-align: left;"| 0x00/B0<br />
0x01/B4<br />
0x02/B8<br />
0x03/BC
|-
| style="text-align: center;"| 32
| style="text-align: center;"| 16
| style="text-align: center;"| 4
| style="text-align: left;"| 0x00/B3B2B1B0<br />
0x04/B7B6B5B4<br />
0x08/BBBAB9B8<br />
0x0C/BFBEBDBC
| style="text-align: left;"| 0x00/B1B0<br />
0x02/B5B4<br />
0x04/B9B8<br />
0x06/BDBC
|-
| style="text-align: center;"| 32
| style="text-align: center;"| 32
| style="text-align: center;"| 4
| style="text-align: left;"| 0x00/B3B2B1B0<br />
0x04/B7B6B5B4<br />
0x08/BBBAB9B8<br />
0x0C/BFBEBDBC
| style="text-align: left;"| 0x00/B3B2B1B0<br />
0x04/B7B6B5B4<br />
0x08/BBBAB9B8<br />
0x0C/BFBEBDBC
|}

<span id="сопоставление-запросов-dma-dma-request-mapping"></span>
=== 8.2.3 Сопоставление запросов DMA (DMA Request Mapping)  ===

<span id="контроллер-dma-предоставляет-семь-каналов-каждый-из-которых-соответствует-нескольким-запросам-периферийных-устройств.-включать-или-отключать-функцию-dma-для-каждого-периферийного-устройства-можно-независимо-устанавливая-соответствующие-биты-управления-dma-в-соответствующих-регистрах-периферийного-оборудования.-вот-конкретные-соответствия."></span>
=== Контроллер DMA предоставляет семь каналов, каждый из которых соответствует нескольким запросам периферийных устройств. Включать или отключать функцию DMA для каждого периферийного устройства можно независимо, устанавливая соответствующие биты управления DMA в соответствующих регистрах периферийного оборудования. Вот конкретные соответствия.  ===

<blockquote>Рисунок 8-1 DMA1 марта запросов

[[File:media/image16.png|610x567px]]

Таблица 8-2 Таблица сопоставления периферийных устройств DMA1 для каждого канала
</blockquote>
{| class="wikitable"
|-
! style="text-align: center;"| Переферия
! style="text-align: center;"| Канал 1
! style="text-align: center;"| Канал 2
! style="text-align: center;"| Канал 3
! style="text-align: center;"| Канал 4
! style="text-align: center;"| Канал 5
! style="text-align: center;"| Канал 6
! style="text-align: center;"| Канал 7
|-
| style="text-align: center;"| ADC1
| style="text-align: center;"| ADC1
| style="text-align: center;"|  
| style="text-align: center;"|  
| style="text-align: center;"|  
| style="text-align: center;"|  
| style="text-align: center;"|  
| style="text-align: center;"|  
|-
| style="text-align: center;"| SPI1
| style="text-align: center;"|  
| style="text-align: center;"| SPI1_RX
| style="text-align: center;"| SPI1_TX
| style="text-align: center;"|  
| style="text-align: center;"|  
| style="text-align: center;"|  
| style="text-align: center;"|  
|-
| style="text-align: center;"| USART1
| style="text-align: center;"|  
| style="text-align: center;"|  
| style="text-align: center;"|  
| style="text-align: center;"| USART1_TX
| style="text-align: center;"| USART1_RX
| style="text-align: center;"|  
| style="text-align: center;"|  
|-
| style="text-align: center;"| I2C1
| style="text-align: center;"|  
| style="text-align: center;"|  
| style="text-align: center;"|  
| style="text-align: center;"|  
| style="text-align: center;"|  
| style="text-align: center;"| I2C1_TX
| style="text-align: center;"| I2C1_RX
|-
| style="text-align: center;"| TIM1
| style="text-align: center;"|  
| style="text-align: center;"| TIM1_CH1
| style="text-align: center;"| TIM1_CH2
| style="text-align: center;"| TIM1_CH4 TIM1_TRIG TIM1_COM
| style="text-align: center;"| TIM1_UP
| style="text-align: center;"| TIM1_CH3
| style="text-align: center;"|  
|-
| style="text-align: center;"| TiIM2
| style="text-align: center;"| TIM2_CH3
| style="text-align: center;"| TIM2_UP
| style="text-align: center;"|  
| style="text-align: center;"|  
| style="text-align: center;"| TIM2_CH1
| style="text-align: center;"|  
| style="text-align: center;"| TIM2_CH2 TIM2_CH4
|}

<span id="описание-регистров-6"></span>
== 8.3 Описание регистров  ==

<blockquote>Таблица 8-3 Список регистров, связанных с DMA
</blockquote>
{| class="wikitable"
|-
! style="text-align: center;"| '''Наименование'''
! style="text-align: center;"| '''Адрес'''
! style="text-align: center;"| '''Описание'''
! style="text-align: center;"| '''Значение сброса'''
|-
| style="text-align: left;"| R32_DMA_INTFR
| style="text-align: left;"| 0x40020000
| style="text-align: left;"| Регистр статуса прерываний DMA
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_DMA_INTFCR
| style="text-align: left;"| 0x40020004
| style="text-align: left;"| Регистр флагов сброса прерываний DMA
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_DMA_CFGR1
| style="text-align: left;"| 0x40020008
| style="text-align: left;"| Регистр конфигурации DMA канал 1
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_DMA_CNTR1
| style="text-align: left;"| 0x4002000C
| style="text-align: left;"| Регистр количества данных DMA канал 1
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_DMA_PADDR1
| style="text-align: left;"| 0x40020010
| style="text-align: left;"| Регистр адреса периферийного уст-ва DMA кан. 1
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_DMA_MADDR1
| style="text-align: left;"| 0x40020014
| style="text-align: left;"| Регистр адреса памяти DMA канала 1
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_DMA_CFGR2
| style="text-align: left;"| 0x4002001C
| style="text-align: left;"| Регистр конфигурации DMA канал 2
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_DMA_CNTR2
| style="text-align: left;"| 0x40020020
| style="text-align: left;"| Регистр количества данных DMA канал 2
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_DMA_PADDR2
| style="text-align: left;"| 0x40020024
| style="text-align: left;"| Регистр адреса периферийного уст-ва DMA кан. 2
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_DMA_MADDR2
| style="text-align: left;"| 0x40020028
| style="text-align: left;"| Регистр адреса памяти DMA канала 2
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_DMA_CFGR3
| style="text-align: left;"| 0x40020030
| style="text-align: left;"| Регистр конфигурации DMA канал 3
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_DMA_CNTR3
| style="text-align: left;"| 0x40020034
| style="text-align: left;"| Регистр количества данных DMA канал 3
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_DMA_PADDR3
| style="text-align: left;"| 0x40020038
| style="text-align: left;"| Регистр адреса периферийного уст-ва DMA кан. 3
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_DMA_MADDR3
| style="text-align: left;"| 0x4002003C
| style="text-align: left;"| Регистр адреса памяти DMA канала 3
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_DMA_CFGR4
| style="text-align: left;"| 0x40020044
| style="text-align: left;"| Регистр конфигурации DMA канал 4
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_DMA_CNTR4
| style="text-align: left;"| 0x40020048
| style="text-align: left;"| Регистр количества данных DMA канал 4
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_DMA_PADDR4
| style="text-align: left;"| 0x4002004C
| style="text-align: left;"| Регистр адреса периферийного уст-ва DMA кан. 4
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_DMA_MADDR4
| style="text-align: left;"| 0x40020050
| style="text-align: left;"| Регистр адреса памяти DMA канала 4
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_DMA_CFGR5
| style="text-align: left;"| 0x40020058
| style="text-align: left;"| Регистр конфигурации DMA канал 5
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_DMA_CNTR5
| style="text-align: left;"| 0x4002005C
| style="text-align: left;"| Регистр количества данных DMA канал 5
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_DMA_PADDR5
| style="text-align: left;"| 0x40020060
| style="text-align: left;"| Регистр адреса периферийного уст-ва DMA кан. 5
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_DMA_MADDR5
| style="text-align: left;"| 0x40020064
| style="text-align: left;"| Регистр адреса памяти DMA канала 5
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_DMA_CFGR6
| style="text-align: left;"| 0x4002006C
| style="text-align: left;"| Регистр конфигурации DMA канал 6
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_DMA_CNTR6
| style="text-align: left;"| 0x40020070
| style="text-align: left;"| Регистр количества данных DMA канал 6
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_DMA_PADDR6
| style="text-align: left;"| 0x40020074
| style="text-align: left;"| Регистр адреса периферийного уст-ва DMA кан. 6
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_DMA_MADDR6
| style="text-align: left;"| 0x40020078
| style="text-align: left;"| Регистр адреса памяти DMA канала 6
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_DMA_CFGR7
| style="text-align: left;"| 0x40020080
| style="text-align: left;"| Регистр конфигурации DMA канал 7
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_DMA_CNTR7
| style="text-align: left;"| 0x40020084
| style="text-align: left;"| Регистр количества данных DMA канал 7
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_DMA_PADDR7
| style="text-align: left;"| 0x40020088
| style="text-align: left;"| Регистр адреса периферийного уст-ва DMA кан. 7
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_DMA_MADDR7
| style="text-align: left;"| 0x4002008C
| style="text-align: left;"| Регистр адреса памяти DMA канала 7
| style="text-align: left;"| 0x00000000
|}

<span id="регистр-состояния-прерывания-dma-dma_intfr"></span>
=== 8.3.1 Регистр состояния прерывания DMA (DMA_INTFR) ===

Смещение адреса: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="4" style="text-align: center;"| Резерв
| style="text-align: left;"| TEIF7
| style="text-align: left;"| HTIF7
| style="text-align: left;"| TCIF7
| style="text-align: left;"| GIF7
| style="text-align: left;"| TEIF6
| style="text-align: left;"| HTIF6
| style="text-align: left;"| TCIF6
| style="text-align: left;"| GIF6
| style="text-align: left;"| TEIF5
| style="text-align: left;"| HTIF5
| style="text-align: left;"| TCIF5
| style="text-align: left;"| GIF5
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| style="text-align: left;"| TEIF4
| style="text-align: left;"| HTIF4
| style="text-align: left;"| TCIF4
| style="text-align: left;"| GIF4
| style="text-align: left;"| TEIF3
| style="text-align: left;"| HTIF3
| style="text-align: left;"| TCIF3
| style="text-align: left;"| GIF3
| style="text-align: left;"| TEIF2
| style="text-align: left;"| HTIF2
| style="text-align: left;"| TCIF2
| style="text-align: left;"| GIF2
| style="text-align: left;"| TEIF1
| style="text-align: left;"| HTIF1
| style="text-align: left;"| TCIF1
| style="text-align: left;"| GIF1
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:28]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="4" style="text-align: center;"| [27]/[23]/

[19]/[15]/

[11]/[7]/

[3]

| rowspan="4" style="text-align: center;"| TEIFx
| rowspan="4" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Флаг ошибки передачи для канала x (x=1/2/3/4/5/6/7).
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Возникла ошибка передачи на канале x.
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет ошибк передачи на канале x.
|-
| colspan="2" style="text-align: left;"| Этот флаг устанавливается аппаратно и сбрасывается программным путем записью бита CTEIFx.
|-
| rowspan="4" style="text-align: center;"| [26]/[22]/

[18]/[14]/

[10]/[6]/[2]

| rowspan="4" style="text-align: center;"| HTIFx
| rowspan="4" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Флаг половины передачи для канала x (x=1/2/3/4/5/6/7).
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| На канале x произошло событие, соответствующее половине передачи.
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет события, соответствующего половине передачи, на канале x.
|-
| colspan="2" style="text-align: left;"| Этот флаг устанавливается аппаратно и сбрасывается программным путем записью бита CHTIFx.
|-
| rowspan="4" style="text-align: center;"| [25]/[21]/

[17]/[13]/

[9]/[5]/[1]

| rowspan="4" style="text-align: center;"| TCIFx
| rowspan="4" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Флаг завершения передачи для канала x (x=1/2/3/4/5/6/7)
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Событие завершения передачи было сгенерировано на канале x.
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет события завершения передачи на канале x
|-
| colspan="2" style="text-align: left;"| Этот флаг устанавливается аппаратно и сбрасывается программным путем записью бита CTCIFx.
|-
| rowspan="4" style="text-align: center;"| [24]/[20]/

[16]/[12]/

[8]/[4]/[0]

| rowspan="4" style="text-align: center;"| GIFx
| rowspan="4" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Глобальный флаг прерывания для канала x (x=1/2/3/4/5/6/7)
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| На канале x был сгенерирован флаг TEIFx, либо HTIFx, либо TCIFx.
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| На канале x не было сгенерировано ни флага TEIFx, ни HTIFx, ни TCIFx.
|-
| colspan="2" style="text-align: left;"| Этот флаг устанавливается аппаратно и сбрасывается программным путем записью бита CGIFx.
|}

<span id="регистр-очистки-флагов-прерываний-dma-dma_intfcr"></span>
=== 8.3.2 Регистр очистки флагов прерываний DMA (DMA_INTFCR) ===

Смещение адреса: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="4" style="text-align: center;"| Резерв
| style="text-align: left;"| CTEIF7
| style="text-align: left;"| CHTIF7
| style="text-align: left;"| CTCIF7
| style="text-align: left;"| CGIF7
| style="text-align: left;"| CTEIF6
| style="text-align: left;"| CHTIF6
| style="text-align: left;"| CTCIF6
| style="text-align: left;"| CGIF6
| style="text-align: left;"| CTEIF5
| style="text-align: left;"| CHTIF5
| style="text-align: left;"| CTCIF5
| style="text-align: left;"| CGIF5
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| style="text-align: left;"| CTEIF4
| style="text-align: left;"| CHTIF4
| style="text-align: left;"| CTCIF4
| style="text-align: left;"| CGIF4
| style="text-align: left;"| CTEIF3
| style="text-align: left;"| CHTIF3
| style="text-align: left;"| CTCIF3
| style="text-align: left;"| CGIF3
| style="text-align: left;"| CTEIF2
| style="text-align: left;"| CHTIF2
| style="text-align: left;"| CTCIF2
| style="text-align: left;"| CGIF2
| style="text-align: left;"| CTEIF1
| style="text-align: left;"| CHTIF1
| style="text-align: left;"| CTCIF1
| style="text-align: left;"| CGIF1
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:28]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [27]/[23]/

[19]/[15]/

[11]/[7]/

[3]

| rowspan="3" style="text-align: center;"| CTEIFx
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| Очистить флаг ошибки передачи для канала x (x=1/2/3/4/5/6/7)
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Очистить флаг TEIFx в регистре DMA_INTFR
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Без эффекта.
|-
| rowspan="3" style="text-align: center;"| [26]/[22]/

[18]/[14]/

[10]/[6]/[2]

| rowspan="3" style="text-align: center;"| CHTIFx
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| Очистить флаг половины передачи для канала x (x=1/2/3/4/5/6/7)
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Очистить флаг HTIFx в регистре DMA_INTFR
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Без эффекта.
|-
| rowspan="3" style="text-align: center;"| [25]/[21]/

[17]/[13]/

[9]/[5]/[1]

| rowspan="3" style="text-align: center;"| CTCIFx
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| Очистить флаг завершения передачи для канала x (x=1/2/3/4/5/6/7)
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Очистить флаг TCIFx в регистре DMA_INTFR
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Без эффекта.
|-
| rowspan="3" style="text-align: center;"| [24]/[20]/

[16]/[12]/

[8]/[4]/[0]

| rowspan="3" style="text-align: center;"| CGIFx
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| Очистить глобальный флаг прерывания для канала x (x=1/2/3/4/5/6/7)
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Очистить флаги TEIFx/HTIFx/TCIFx/GIFx в регистре DMA_INTFR
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Без эффекта.
|}

<span id="регистр-конфигурации-канала-x-dma-dma_cfgrx-x1234567"></span>
=== 8.3.3 Регистр конфигурации канала x DMA (DMA_CFGRx) (x=1/2/3/4/5/6/7) ===

'''Начало формы'''

Смещение адреса: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| style="text-align: center;"| Рез.
| style="text-align: center;"| MEM2MEM
| colspan="2" style="text-align: center;"| PL
| colspan="2" style="text-align: center;"| MSIZE
| colspan="2" style="text-align: center;"| PSIZE
| style="text-align: center;"| MINC
| style="text-align: center;"| PINC
| style="text-align: center;"| CIRC
| style="text-align: center;"| DIR
| style="text-align: center;"| TEIE
| style="text-align: center;"| HTIE
| style="text-align: center;"| TCIE
| style="text-align: center;"| EN
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:28]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [14]
| rowspan="3" style="text-align: center;"| MEM2 MEM
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Разрешение режима память-память.
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включить режим передачи данных между памятями.
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключить режим передачи данных между памятями.
|-
| rowspan="5" style="text-align: center;"| [13:12]
| rowspan="5" style="text-align: center;"| PL
| rowspan="5" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Установка приоритета канала.
| rowspan="5" style="text-align: center;"| 0
|-
| style="text-align: left;"| 00:
| style="text-align: left;"| Низкий
|-
| style="text-align: left;"| 01:
| style="text-align: left;"| Средний
|-
| style="text-align: left;"| 10:
| style="text-align: left;"| Высокий
|-
| style="text-align: left;"| 11:
| style="text-align: left;"| Очень высокий
|-
| rowspan="5" style="text-align: center;"| [11:10]
| rowspan="5" style="text-align: center;"| MSIZE
| rowspan="5" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Настройка разрядности данных адреса памяти.
| rowspan="5" style="text-align: center;"| 0
|-
| style="text-align: left;"| 00:
| style="text-align: left;"| 8 бит
|-
| style="text-align: left;"| 01:
| style="text-align: left;"| 16 бит
|-
| style="text-align: left;"| 10:
| style="text-align: left;"| 32 бита
|-
| style="text-align: left;"| 11:
| style="text-align: left;"| Зарезервировано
|-
| rowspan="5" style="text-align: center;"| [9:8]
| rowspan="5" style="text-align: center;"| PSIZE
| rowspan="5" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Настройка разрядности данных адреса периферии.
| rowspan="5" style="text-align: center;"| 0
|-
| style="text-align: left;"| 00:
| style="text-align: left;"| 8 бит
|-
| style="text-align: left;"| 01:
| style="text-align: left;"| 16 бит
|-
| style="text-align: left;"| 10:
| style="text-align: left;"| 32 бита
|-
| style="text-align: left;"| 11:
| style="text-align: left;"| Зарезервировано
|-
| rowspan="3" style="text-align: center;"| [7]
| rowspan="3" style="text-align: center;"| MINC
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Разрешение инкрементального режима адреса памяти
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включить операцию инкремента адреса памяти
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Адрес памяти остается неизменным
|-
| rowspan="3" style="text-align: center;"| [6]
| rowspan="3" style="text-align: center;"| PINC
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Разрешение инкрементального режима адреса периферии
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включить инкрементальную операцию адреса периферии
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Адрес периферии остается неизменным
|-
| rowspan="3" style="text-align: center;"| [5]
| rowspan="3" style="text-align: center;"| CIRC
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Разрешение циклического режима работы канала DMA
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включает циклическую операцию
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Выполнить однократную операцию
|-
| rowspan="3" style="text-align: center;"| [4]
| rowspan="3" style="text-align: center;"| DIR
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Направление передачи данных
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Чтение из памяти
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Чтение с периферии
|-
| rowspan="3" style="text-align: center;"| [3]
| rowspan="3" style="text-align: center;"| TEIE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Управление включением прерывания при ошибке передачи
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Разрешить прерывание при ошибке передачи
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Запретить прерывание при ошибке передачи
|-
| rowspan="3" style="text-align: center;"| [2]
| rowspan="3" style="text-align: center;"| HTIE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Управление включением прерывания при достижении половины передачи
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Разрешить прерывание при достижении половины передачи
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Запретить прерывание при достижении половины передачи
|-
| rowspan="3" style="text-align: center;"| [1]
| rowspan="3" style="text-align: center;"| TCIE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Управление включением прерывания по завершению передачи
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Разрешить прерывание по завершению передачи
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Запретить прерывание по завершению передачи
|-
| rowspan="4" style="text-align: center;"| [0]
| rowspan="4" style="text-align: center;"| EN
| rowspan="4" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Управление включением канала
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Канал включен
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Канал отключен
|-
| colspan="2" style="text-align: left;"| Когда возникает ошибка передачи DMA, аппаратное обеспечение автоматически очищает этот бит до 0 и отключает канал
|}

<span id="регистр-количества-данных-канала-x-dma-dma_cntrx-x1234567"></span>
=== 8.3.4 Регистр количества данных канала x DMA (DMA_CNTRx) (x=1/2/3/4/5/6/7) ===

Смещение адреса: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="16" style="text-align: center;"| NDT[15:0]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:16]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [15:0]
| style="text-align: center;"| NDT[15:0]
| style="text-align: center;"| RW
| style="text-align: left;"| Количество передач данных, диапазон 0-65535. Этот регистр может быть записан только тогда, когда канал не работает (EN=0 для DMA_CFGRx). После включения канала этот регистр становится доступным только для чтения и указывает количество оставшихся ожидающих передач (содержание регистра уменьшается после каждой передачи DMA). Когда канал находится в циклическом режиме, содержимое регистра будет автоматически перезагружено к ранее настроенному значению.
| style="text-align: center;"| 0
|}

<span id="регистр-адреса-периферии-канала-x-dma-dma_paddrx-x1234567"></span>
=== 8.3.5 Регистр адреса периферии канала x DMA (DMA_PADDRx) (x=1/2/3/4/5/6/7) ===

Смещение адреса: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| PA[31:16]
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="16" style="text-align: center;"| PA[15:0]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:0]
| style="text-align: center;"| PA[31:0]
| style="text-align: center;"| RW
| style="text-align: left;"| Базовый адрес периферии, который служит исходным или целевым адресом для передачи данных периферии. Когда PSIZE[1:0] = '01' (16 бит), модуль автоматически игнорирует бит0, и операционный адрес автоматически выравнивается по границе двух байтов; когда PSIZE[1:0] = '10' (32 бита), модуль автоматически игнорирует биты [1:0], и операционный адрес автоматически выравнивается по границе четырех байтов.
| style="text-align: center;"| 0
|}

<blockquote>''Note: This register can only be changed when EN=0 and cannot be written when EN=1.''
</blockquote>
<span id="регистр-адреса-памяти-канала-x-dma-dma_maddrx-x1234567"></span>
=== 8.3.6 Регистр адреса памяти канала x DMA (DMA_MADDRx) (x=1/2/3/4/5/6/7) ===

<span id="начало-формы-2"></span>
=== Начало формы ===

Смещение адреса: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| MA[31:16]
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="16" style="text-align: center;"| MA[15:0]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:0]
| style="text-align: center;"| MA[31:0]
| style="text-align: center;"| RW
| style="text-align: left;"| Адрес данных памяти, который служит исходным или целевым адресом для передачи данных. Когда MSIZE[1:0] = '01' (16 бит), модуль автоматически игнорирует бит0, и операционный адрес автоматически выравнивается по границе двух байтов; когда MSIZE[1:0] = '10' (32 бита), модуль автоматически игнорирует биты [1:0], и операционный адрес автоматически выравнивается по границе четырех байтов.
| style="text-align: center;"| 0
|}

<blockquote>''Note: This register can only be changed when EN=0 and cannot be written when EN=1.''
</blockquote>
<span id="глава-9-аналого-цифровой-преобразователь-ацп"></span>
= Глава 9 Аналого-цифровой преобразователь (АЦП) =

<span id="начало-формы-3"></span>
= Начало формы =

<blockquote>Модуль АЦП содержит 10-битный аналого-цифровой преобразователь последовательных приближений с входной тактовой частотой до 24 МГц. Он поддерживает выборку до 8 внешних каналов и 2 внутренних источников сигналов. Можно выполнять одиночное преобразование и непрерывное преобразование каналов, автоматическое сканирование между каналами, прерывистый режим, режим внешнего запуска, двойную выборку, задержку запуска и многое другое. С помощью функции аналогового сторожевого таймера можно контролировать напряжение на канале, чтобы убедиться, что оно находится в пределах порогового диапазона.
</blockquote>
<span id="основные-возможности-2"></span>
== 9.1 Основные возможности  ==

* Разрешение 10 бит
* Поддержка 8 внешних каналов и 2 внутренних источников сигналов для выборки
* Многочисленные методы преобразования выборок для нескольких каналов: однократная, непрерывная, сканирующая, запускаемая, прерывистая и т.д.
* Режимы выравнивания данных: выровненные слева, выровненные справа
* Время выборки может быть запрограммировано отдельно для каждого канала
* Как обычное, так и инъекционное преобразование поддерживают внешний запуск
* Аналоговый сторожевой таймер для мониторинга напряжения на канале, функция самокалибровки
* Диапазон входного сигнала канала АЦП: 0 ≤ VIN ≤ VDDA
* Задержка запуска

<span id="описание-функциональности"></span>
== 9.2 Описание функциональности ==

<span id="структура-модуля"></span>
=== 9.2.1 Структура модуля  ===

<blockquote>Рисунок 9-1 Блок-схема модуля АЦП

[[File:media/image17.png|602x572px]]
</blockquote>
<span id="конфигурирование-adc"></span>
=== 9.2.2 Конфигурирование ADC ===

<span id="включение-модуля"></span>
====  1) Включение модуля ====

<blockquote>Бит ADON, установленный в 1 в регистре '''ADC_CTLR2''', указывает, что модуль АЦП включен. Когда модуль АЦП переходит в состояние включения ('''ADON'''=1) из режима пониженного энергопотребления ('''ADON'''=0), требуется период задержки tSTAB для стабилизации модуля. После этого бит '''ADON''' снова устанавливается в 1 и используется в качестве сигнала начала для старта преобразования АЦП программным обеспечением. Сбросив бит '''ADON''', можно завершить текущее преобразование и перевести модуль АЦП в режим пониженного энергопотребления, в котором АЦП практически не потребляет энергию.
</blockquote>
<span id="тактирование-1"></span>
====  2) Тактирование  ====

<blockquote>Работа регистра модуля основана на тактовой частоте '''HBCLK''' (шина HB), а опорная частота его блока преобразования, '''ADCCLK''', конфигурируется полем '''ADCPRE''' регистра '''RCC_CFGR0''' для деления частоты. За подробной информацией обратитесь к техническому описанию CH32V003DS0.
</blockquote>
<span id="конфигурирование-каналов"></span>
====  3) Конфигурирование каналов  ====

<blockquote>Модуль АЦП предоставляет 10 источников выборки каналов, включая 8 внешних каналов и 2 внутренних канала. Они могут быть сконфигурированы в две группы преобразования: обычные группы и группы инъекции. Это позволяет достичь группового преобразования, состоящего из серии преобразований в любом порядке на любом количестве каналов.
</blockquote>
* Обычная группа: состоит максимум из 16 преобразований. Каналы обычной группы и порядок их преобразования устанавливаются в регистре '''ADC_RSQRx'''. Общее количество преобразований в обычной группе должно быть записано в '''L'''[3:0] регистра '''ADC_RSQR1'''.
* Группа инъекции: состоит максимально из 4 преобразований. Каналы группы инъекции и порядок их преобразований устанавливаются в регистре '''ADC_ISQR'''. Общее число преобразований в группе инъекции должно быть указано в '''JL'''[1:0] регистра '''ADC_ISQR'''.

<blockquote>''Примечание: Если во время преобразования изменяются регистры '''ADC_RSQRx''' или '''ADC_ISQR''', текущее преобразование прекращается, и новый стартовый сигнал отправляется в АЦП для преобразования вновь выбранной группы.''

2 внутренних канала.
</blockquote>
* '''Внутреннее опорное напряжение Vref''': подключено к каналу ADC_IN8.
* '''Напряжение внутренней калибровки Vcal''': подключено к каналу ADC_IN9, выбираемое двумя шагами.
* Начало формы

<span id="калибровка"></span>
====  4) Калибровка  ====

<blockquote>АЦП имеет встроенный режим самотестирования. Сеанс калибровки значительно снижает погрешность точности, вызванную изменениями в банках внутренних конденсаторов. Во время калибровки код коррекции ошибок рассчитывается для каждого конденсатора, который используется для устранения ошибок, возникающих на каждом конденсаторе в последующих преобразованиях. Инициализируйте регистр калибровки, установив положение '''RSTCAL''' в регистре '''ADC_CTLR2''' в 1, и дождитесь, пока аппаратное обеспечение '''RSTCAL''' очистит 0, что указывает на завершение инициализации. Установите бит '''CAL''', чтобы запустить функцию калибровки. После завершения калибровки аппаратное обеспечение автоматически очистит бит '''CAL''' и сохранит код калибровки в '''ADC_RDATAR'''. После этого можно начинать нормальную функцию преобразования. Рекомендуется проводить калибровку АЦП при включении модуля АЦП.

''Примечание: Прежде чем приступить к калибровке, необходимо убедиться, что модуль АЦП находится во включенном состоянии ('''ADON'''=1) не менее двух полных циклов тактового сигнала АЦП.''
</blockquote>
<span id="программируемое-время-выборки"></span>
====  5) Программируемое время выборки ====

<blockquote>ЦП использует несколько циклов '''ADCCLK''' для выборки входного напряжения. Количество циклов выборки для канала можно изменить, используя биты '''SMPx'''[2:0] в регистрах '''ADC_SAMPTR1''' и '''ADC_SAMPTR2'''.

Каждому каналу можно присвоить отдельное время выборки. Общее время преобразования вычисляется следующим образом.Начало формы

T<sub>CONV</sub> = время выборки + 11T<sub>ADCCLK</sub>

Преобразование каналов по правилам АЦП поддерживает функцию DMA. Значение преобразования канала по правилам сохраняется в регистре данных '''ADC_RDATAR'''. Чтобы предотвратить несвоевременное получение данных из регистра '''ADC_RDATAR''' при последовательном преобразовании нескольких каналов по правилу, можно включить функцию DMA АЦП. Аппаратное обеспечение будет генерировать запрос DMA в конце преобразования канала по правилу (установлен '''EOC''') и передавать преобразованные данные из регистра '''ADC_RDATAR''' по заданному пользователем адресу назначения. После завершения настройки канала модуля контроллера DMA запишите позицию DMA в регистре '''ADC_CTLR2''' в 1, чтобы включить функцию DMA для АЦП.

''Примечание: Преобразование группы инъекции не поддерживает функцию DMA.''
</blockquote>
<span id="выравнивание-данныхначало-формы"></span>
====  6) Выравнивание данныхНачало формы ====

<span id="источник-внешнего-запуска"></span>
=== 9.2.3 Источник внешнего запуска ===

<blockquote>Начало преобразования АЦП может быть инициировано внешним событием. Если установлены биты '''EXTTRIG''' или '''JEXTTRIG''' в регистре '''ADC_CTLR2''', преобразование канала обычной группы или группы инъекции может быть запущено внешним событием соответственно. В этом случае конфигурация битов '''EXTSEL'''[2:0] и '''JEXTSEL'''[2:0] определяет источник внешнего события для обычной группы и группы инъекции.

''Примечание: Когда для преобразования АЦП по правилу или инъекции выбран внешний сигнал запуска, только его передний фронт может начать преобразование.''
</blockquote>
Таблица 9-3 Источники внешнего запуска для каналов обычной группы

{| class="wikitable"
|-
! style="text-align: left;"| EXTSEL[2:0]
! style="text-align: left;"| Источник триггерного сигнала
! style="text-align: center;"| Тип
|-
| style="text-align: center;"| 000
| style="text-align: left;"| TRGO событие таймера TIM1
| rowspan="6" style="text-align: center;"| Внутренний сигнал от встроенных в чип таймеров
|-
| style="text-align: center;"| 001
| style="text-align: left;"| CC1 событие таймера TIM1
|-
| style="text-align: center;"| 010
| style="text-align: left;"| CC2 событие таймера TIM1
|-
| style="text-align: center;"| 011
| style="text-align: left;"| TRGO событие таймера TIM2
|-
| style="text-align: center;"| 100
| style="text-align: left;"| CC1 событие таймера TIM2
|-
| style="text-align: center;"| 101
| style="text-align: left;"| CC2 событие таймера TIM2
|-
| style="text-align: center;"| 110
| style="text-align: left;"| События PD3/PC2
| style="text-align: center;"| От внешних пинов
|-
| style="text-align: center;"| 111
| style="text-align: left;"| Программный триггер SWSTART
| style="text-align: center;"| Программно управляемые биты
|}

Таблица 9-4 Внешние источники триггеров для каналов инъекционной группы

{| class="wikitable"
|-
! style="text-align: left;"| JEXTSEL[2:0]
! style="text-align: left;"| Источник триггерного сигнала
! style="text-align: center;"| Тип
|-
| style="text-align: center;"| 000
| style="text-align: left;"| СС3 событие таймера TIM1
| rowspan="6" style="text-align: center;"| Внутренний сигнал от встроенных в чип таймеров
|-
| style="text-align: center;"| 001
| style="text-align: left;"| CC4 событие таймера TIM1
|-
| style="text-align: center;"| 010
| style="text-align: left;"| CC3 событие таймера TIM2
|-
| style="text-align: center;"| 011
| style="text-align: left;"| CC4 событие таймера TIM2
|-
| style="text-align: center;"| 100
| style="text-align: center;"| -
|-
| style="text-align: center;"| 101
| style="text-align: center;"| -
|-
| style="text-align: center;"| 110
| style="text-align: left;"| События PD1/PA2
| style="text-align: center;"| От внешних пинов
|-
| style="text-align: center;"| 111
| style="text-align: left;"| Программный триггер JSWSTART
| style="text-align: center;"| Программно управляемые биты
|}

<span id="режим-преобразования"></span>
=== 9.2.4 Режим преобразования ===

<blockquote>Таблица 9-5 Комбинации режимов преобразованияНачало формы
</blockquote>
{| class="wikitable"
|-
! colspan="5" style="text-align: center;"| Биты ADC_CTLR1 и ADC_CTLR2 управления регистра
! rowspan="2" style="text-align: center;"| Режим преобразования АЦП
|-
! style="text-align: center;"| CONT
! style="text-align: center;"| SCAN
! style="text-align: center;"| RDISCEN/IDISCEN
! style="text-align: center;"| JAUTO
! style="text-align: center;"| Запуск события
|-
| rowspan="7" style="text-align: center;"| 0
| rowspan="2" style="text-align: center;"| 0
| rowspan="4" style="text-align: center;"| 0
| rowspan="3" style="text-align: center;"| 0
| style="text-align: center;"| ADON позиция 1
| style="text-align: left;"| Режим одиночного одноканального преобразования: Канал правила выполняет одно преобразование
|-
| style="text-align: center;"| Метод внешнего приггера
| style="text-align: left;"| Режим одиночного одноканального преобразования: Одно преобразование выполняется на одном из каналов правил или каналов инъекции
|-
| rowspan="2" style="text-align: center;"| 1
| style="text-align: center;"| ADON позиция 1 или метод внешнего триггера
| style="text-align: left;"| Режим одиночного сканирования: выполняет одиночное преобразование всех выбранных каналов группы правил (ADC_RSQRx) или всех каналов группы инъекции (ADC_ISQR) последовательно по одному. Метод триггерной инъекции: Когда процесс преобразования каналов группы правил может быть вставлен во все преобразования каналов группы инъекции, а затем продолжить преобразование каналов группы правил позже; но преобразование каналов группы правил не будет вставлено при преобразовании каналов группы инъекции
|-
| style="text-align: center;"| 1
| style="text-align: center;"| ADON позиция 1 или метод внешнего триггера
| style="text-align: left;"| Режим одиночного сканирования: выполняет одиночное преобразование всех выбранных каналов группы правил (ADC_RSQRx) или всех каналов группы инъекции (ADC_ISQR) последовательно по одному. Автоматический метод инъекции: После того как завершится преобразование канала группы правил, автоматически начнется преобразование каналов группы инъекции
|-
| rowspan="2" style="text-align: center;"| 0
| rowspan="2" style="text-align: center;"| 1 (RDISCEN и IDISCEN не могут одновременно быть равны 1)
| style="text-align: center;"| 0
| style="text-align: center;"| Метод внешнего приггера
| style="text-align: left;"| Режим единичной прерывистой работы: Каждый раз, когда начинается событие, выполняется короткая последовательность переходов номеров каналов (количество определено DISCNUM[2:0]), и ее нельзя перезапускать, пока не будут завершены все выбранные переходы каналов.

''Примечание: Управляющие биты IDISCEN и RDISCEN выбираются соответственно для группы правил и группы инъекции, и режим прерывистой работы не может быть настроен одновременно для группы правил и группы инъекции''

|-
| style="text-align: center;"| 1
| style="text-align: center;"| -
| style="text-align: left;"| Отключение этого режима
|-
| style="text-align: center;"| 1
| style="text-align: center;"| 1
| style="text-align: center;"| X
| style="text-align: center;"| -
| style="text-align: left;"| Такого режима нет
|-
| rowspan="3" style="text-align: center;"| 1
| style="text-align: center;"| 0
| style="text-align: center;"| 0
| style="text-align: center;"| 0
| rowspan="3" style="text-align: center;"| ADON позиция 1 или метод внешнего триггера
| rowspan="3" style="text-align: left;"| Непрерывный режим одного канала/сканирования: повторять новый цикл переходов в конце каждого цикла до тех пор, пока CONT не очистит 0 для завершения
|-
| rowspan="2" style="text-align: center;"| 1
| rowspan="2" style="text-align: center;"| 0
| style="text-align: center;"| 0
|-
| style="text-align: center;"| 1
|}

<blockquote>''Примечание: Внешние события запуска для обычных групп и групп инъекции различаются, и бит ''''ACON'''' может инициировать только преобразование канала обычной группы, поэтому события инициации для преобразования каналов обычной группы и группы инъекции являются независимыми.''
</blockquote>
<span id="единичный-одноканальный-режим-преобразования"></span>
====  1) Единичный одноканальный режим преобразования  ====

<blockquote>В этом режиме выполняется только одно преобразование для текущего канала. Этот режим выполняет преобразование канала, который отсортирован первым в обычной группе или группе инъекции, где он инициируется установкой бита '''ADON''' в положении 1 регистра '''ADC_CTLR2''' (только для каналов обычной группы) или может быть инициирован внешним запуском (для каналов обычной группы или каналов инъекции). После завершения преобразования выбранного канала оно завершится. Если преобразование выполняется для канала обычной группы, данные преобразования сохраняются в 16-битном регистре '''ADC_RDATAR''', устанавливается флаг '''EOC''', и вызывается прерывание АЦП, если установлен бит '''EOCIE'''. Если преобразование выполняется для канала группы инъекции, данные преобразования сохраняются в 16-битном регистре '''ADC_IDATAR1''', устанавливаются флаги '''EOC''' и '''JEOC''', и возникает прерывание АЦП, если установлены биты '''JEOCIE''' или '''EOCIE'''.
</blockquote>
<span id="преобразование-в-режиме-однократного-сканирования"></span>
====  2) Преобразование в режиме однократного сканирования ====

<blockquote>Режим сканирования АЦП включается путем установки бита '''SCAN''' в регистре '''ADC_CTLR1''' в 1. Этот режим используется для сканирования группы аналоговых каналов и выполнения однократного преобразования для всех каналов, выбранных регистром '''ADC_RSQRx''' (для обычных каналов) или '''ADC_ISQR''' (для каналов инъекции), по одному, и следующий канал в той же группе преобразуется автоматически, когда завершается преобразование текущего канала. В режиме сканирования существует разделение на режимы запуска инъекции и автоматической инъекции в зависимости от состояния бита '''JAUTO'''.
</blockquote>
* '''Запуск инъекции'''

<blockquote>Бит '''JAUTO''' равен 0. Когда во время сканирования каналов обычной группы происходит событие запуска преобразования канала группы инъекции, текущее преобразование сбрасывается, и последовательность каналов инъекции выполняется в одном сканировании, и прерванное преобразование последнего канала обычной группы возобновляется после завершения сканирующего преобразования всех выбранных каналов группы инъекции.

Если во время текущего сканирования последовательности каналов группы инъекции происходит событие начала преобразования канала обычной группы, преобразование группы инъекции не прерывается, но последовательность преобразований правила выполняется повторно после завершения последовательности преобразований инъекции.

''Примечание: При использовании преобразований с запуском инъекции необходимо обеспечить, чтобы интервал между событиями запуска был больше, чем сама последовательность инъекции. Например, если общее время, необходимое для завершения преобразования последовательности инъекции, составляет 28 '''ADCCLK''', то минимальное значение интервала событий для запуска канала инъекции равно 29 '''ADCCLK'''.''
</blockquote>
* '''Автоматическая инъекция'''

<blockquote>Бит '''JAUTO''' установлен в 1, и преобразование выбранного канала группы инъекции выполняется автоматически после сканирования всех каналов, выбранных для преобразования группой правил. Этот метод позволяет преобразовать до 20 последовательностей преобразований в регистрах '''ADC_RSQRx''' и '''ADC_ISQR'''. В этом режиме внешняя активация канала инъекции должна быть отключена ('''IEXTTRIG JEXTTRIG'''=0).

''Примечание: Для коэффициента предварительного масштабирования тактовой частоты АЦП ('''ADCPRE'''[1:0]), равного 4–8, автоматически вставляется интервал 1 '''ADCCLK''' при переключении с обычного преобразования на последовательность инъекции или с преобразования инъекции на последовательность правил; когда коэффициент предварительного масштабирования тактовой частоты составляет 2, вводится задержка в два интервала '''ADCCLK'''.''
</blockquote>
<span id="преобразование-в-режиме-единичного-прерывистого-режима"></span>
====  3) Преобразование в режиме единичного прерывистого режима  ====

<blockquote>Режимом прерывистой работы для обычной группы или группы инъекции управляет установка бита '''RDISCEN''' или '''IDISCEN''' в регистре '''ADC_CTLR1''' в 1. Этот режим отличается от сканирования полного набора каналов в режиме сканирования, но делит набор каналов на несколько коротких последовательностей, и каждое внешнее событие запуска выполнит короткую последовательность переходов сканирования. Длина короткой последовательности n (n &lt;= 8) определяется в '''DISCNUM'''[2:0] регистра '''ADC_CTLR1''', когда '''RDISCEN''' равно 1, это означает прерывающийся режим работы для группы правил, а общая длина для преобразования определяется в '''L'''[3:0]. в регистре '''ADC_RSQR1'''; когда '''IDISCEN''' установлено на 1, это прерывающаяся работа для группы инъекции, и общая длина для конвертации определяется в '''JL'''[1:0] в регистре '''ADC_ISQR'''. Невозможно установить оба режима для обычной и группы инъекций в прерывистом режиме.

Пример прерывистого режима работы для обычной группы.

'''RDISCEN'''=1, '''DISCNUM'''[2:0]=3, '''L'''[3:0]=8, каналы для преобразования = 1, 3, 2, 5, 8, 2, 7

Первый внешний триггер: последовательность преобразований: 1, 3, 2

Второй внешний триггер: последовательность преобразований: 5, 8, 4

Третий внешний триггер: последовательность преобразований: 10, 6, при генерации событий '''EOC'''

Четвертый внешний триггер: последовательность преобразований: 1, 3, 2

'''IDISCEN'''=1, '''DISCNUM'''[2:0]=1, '''JL'''[1:0]=3, каналы для преобразования: 1, 3, 2

Первый внешний триггер: последовательность преобразований: 1

Второй внешний триггер: последовательность преобразований: 3

Третий внешний триггер: преобразуются каналы: 2, генерируются события '''EOC''' и '''JEOC'''

Четвертый внешний триггер: начинается новая последовательность преобразований: 1

''Примечание:''
</blockquote>
# ''При преобразовании обычной группы или группы инъекции в прерывистом режиме последовательность преобразований не начинает автоматически начинаться с самого начала после завершения. Когда все подгруппы были преобразованы, следующее событие триггера запускает преобразование первой подгруппы.''
# ''Вы не можете одновременно использовать автоинъекцию ('''JAUTO'''=1) и прерывистый режим.''
# ''Вы не сможете настроить прерываемый режим как для обычных групп, так и для групп инъекции, и вы можете использовать прерывистую работу только для одной группы преобразований.''

<span id="непрерывное-преобразование"></span>
====  4) Непрерывное преобразование  ====

<blockquote>В режиме непрерывного преобразования новое преобразование начинается сразу после завершения предыдущего преобразования. Преобразование не останавливается на последнем канале выбранной группы, а продолжается с первого канала выбранной группы. Запускающими событиями в этом режиме являются внешние триггерные события, а бит '''ADON''' устанавливается в 1. После настройки запуска бит '''CONT''' должен быть установлен в 1.

Если производится преобразование обычного канала, данные преобразования хранятся в регистре '''ADC_RDATAR''', устанавливается флаг окончания преобразования '''EOC''', и если установлен бит '''EOCIE''', генерируется прерывание. При преобразовании канала инжекции данные преобразования сохраняются в регистре '''ADC_IDATARx''', устанавливается флажок завершения преобразования '''JEOC''', а если установлен флаг '''JEOCIE''', создается прерывание.
</blockquote>
<span id="сторожевой-таймер-ацп"></span>
=== 9.2.5 Сторожевой таймер АЦП ===

<blockquote>Флаг состояния аналогового сторожа (AWD) устанавливается, если аналоговое напряжение, которое преобразуется АЦП, ниже низкого порога или выше высокого порога. Настройки порогов находятся в десяти младших значащих разрядах регистров ADC_WDHTR и ADC_WDLTR. Бит AWDIE в регистре ADC_CTLR1 устанавливается для генерации соответствующего прерывания.

Рисунок 9-4 Область порога сторожевого таймера АЦП
</blockquote>
ADC_WDHTR

ADC_WDLTR

Нижний предупредительный порог

Верхний предупредительный порог

Зона предупреждения

Значения преобразования аналогового напряжения

<blockquote>Настройте биты '''AWDSGL''', '''AWDEN''', '''JAWDEN''' и '''AWDCH'''[4:0] в регистре '''ADC_CTLR1''' для выбора канала для сигнализации аналогового сторожа, как показано в следующей таблице.
</blockquote>
Таблица 9-6 Выбор канала аналогового сторожевого таймера

{| class="wikitable"
|-
! rowspan="2" style="text-align: center;"| Имитация канала оповещения сторожа
! colspan="4" style="text-align: center;"| Биты управления регистром ADC_CTLR1
|-
! style="text-align: center;"| AWDSGL
! style="text-align: center;"| AWDEN
! style="text-align: center;"| JAWDEN
! style="text-align: center;"| AWDCH[4:0]
|-
| style="text-align: left;"| Отсутствие реакции
| style="text-align: center;"| Ignore
| style="text-align: center;"| 0
| style="text-align: center;"| 0
| style="text-align: center;"| Ignore
|-
| style="text-align: left;"| Все инжектированные каналы
| style="text-align: center;"| 0
| style="text-align: center;"| 0
| style="text-align: center;"| 1
| style="text-align: center;"| Ignore
|-
| style="text-align: left;"| Все обычные каналы
| style="text-align: center;"| 0
| style="text-align: center;"| 1
| style="text-align: center;"| 0
| style="text-align: center;"| Ignore
|-
| style="text-align: left;"| Все обычные и инжектированные каналы
| style="text-align: center;"| 0
| style="text-align: center;"| 1
| style="text-align: center;"| 1
| style="text-align: center;"| Ignore
|-
| style="text-align: left;"| Один инжектированый канал
| style="text-align: center;"| 1
| style="text-align: center;"| 0
| style="text-align: center;"| 1
| style="text-align: center;"| Зависит от номера канала
|-
| style="text-align: left;"| Один обычный канал
| style="text-align: center;"| 1
| style="text-align: center;"| 1
| style="text-align: center;"| 0
| style="text-align: center;"| Зависит от номера канала
|-
| style="text-align: left;"| Один инжектированный и обычный канал
| style="text-align: center;"| 1
| style="text-align: center;"| 1
| style="text-align: center;"| 1
| style="text-align: center;"| Зависит от номера канала
|}

<span id="описание-регистров-7"></span>
== 9.3 Описание регистров  ==

<blockquote>Таблица 9-7 Список регистров, связанных с АЦП
</blockquote>
{| class="wikitable"
|-
! style="text-align: center;"| '''Наименование'''
! style="text-align: center;"| '''Адрес'''
! style="text-align: center;"| '''Описание'''
! style="text-align: center;"| '''Значение сброса'''
|-
| style="text-align: left;"| R32_ADC_STATR
| style="text-align: left;"| 0x40012400
| style="text-align: left;"| ADC регистр статуса
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_ADC_CTLR1
| style="text-align: left;"| 0x40012404
| style="text-align: left;"| ADC регистр управления 1
| style="text-align: left;"| 0x02000000
|-
| style="text-align: left;"| R32_ADC_CTLR2
| style="text-align: left;"| 0x40012408
| style="text-align: left;"| ADC регистр управления 2
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_ADC_SAMPTR1
| style="text-align: left;"| 0x4001240C
| style="text-align: left;"| ADC регистр времени выборки 1
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_ADC_SAMPTR2
| style="text-align: left;"| 0x40012410
| style="text-align: left;"| ADC регистр времени выборки 2
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_ADC_IOFR1
| style="text-align: left;"| 0x40012414
| style="text-align: left;"| ADC регистр смещения данных канала инъекции 1
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_ADC_IOFR2
| style="text-align: left;"| 0x40012418
| style="text-align: left;"| ADC регистр смещения данных канала инъекции 2
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_ADC_IOFR3
| style="text-align: left;"| 0x4001241C
| style="text-align: left;"| ADC регистр смещения данных канала инъекции 3
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_ADC_IOFR4
| style="text-align: left;"| 0x40012420
| style="text-align: left;"| ADC регистр смещения данных канала инъекции 4
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_ADC_WDHTR
| style="text-align: left;"| 0x40012424
| style="text-align: left;"| ADC Регистр верхнего порога сторожевого таймера
| style="text-align: left;"| 0x000003FF
|-
| style="text-align: left;"| R32_ADC_WDLTR
| style="text-align: left;"| 0x40012428
| style="text-align: left;"| ADC Регистр нижнего порога сторожевого таймера
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_ADC_RSQR1
| style="text-align: left;"| 0x4001242C
| style="text-align: left;"| ADC Регистр регулярной последовательности 1
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_ADC_RSQR2
| style="text-align: left;"| 0x40012430
| style="text-align: left;"| ADC Регистр регулярной последовательности 2
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_ADC_RSQR3
| style="text-align: left;"| 0x40012434
| style="text-align: left;"| ADC Регистр регулярной последовательности 3
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_ADC_ISQR
| style="text-align: left;"| 0x40012438
| style="text-align: left;"| ADC Регистр инжектируемой последовательности
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_ADC_IDATAR1
| style="text-align: left;"| 0x4001243C
| style="text-align: left;"| ADC Регистр инжектируемых данных 1
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_ADC_IDATAR2
| style="text-align: left;"| 0x40012440
| style="text-align: left;"| ADC Регистр инжектируемых данных 2
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_ADC_IDATAR3
| style="text-align: left;"| 0x40012444
| style="text-align: left;"| ADC Регистр инжектируемых данных 3
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_ADC_IDATAR4
| style="text-align: left;"| 0x40012448
| style="text-align: left;"| ADC Регистр инжектируемых данных 4
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_ADC_RDATAR
| style="text-align: left;"| 0x4001244C
| style="text-align: left;"| ADC Регистр регулярных данных
| style="text-align: left;"| 0x00000000
|-
| style="text-align: left;"| R32_ADC_DLYR
| style="text-align: left;"| 0x40012450
| style="text-align: left;"| ADC Регистр задержанных данных
| style="text-align: left;"| 0x00000000
|}

<span id="adc-регистр-статуса-adc_statr"></span>
=== 9.3.1 ADC Регистр статуса (ADC_STATR)  ===

Смещение адреса: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="11" style="text-align: center;"| Резерв
| style="text-align: center;"| STRT
| style="text-align: center;"| JSTRT
| style="text-align: center;"| JEOC
| style="text-align: center;"| EOC
| style="text-align: center;"| AWD
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:5]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="4" style="text-align: center;"| [4]
| rowspan="4" style="text-align: center;"| STRT
| rowspan="4" style="text-align: center;"| RW0
| colspan="2" style="text-align: left;"| Состояние начала перехода канала правила
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Преобразование канала правила было начато
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Преобразование канала правила не было начато
|-
| colspan="2" style="text-align: left;"| Этот бит устанавливается в 1 аппаратурой и сбрасывается в 0 программно (запись 1 недействительна)
|-
| rowspan="4" style="text-align: center;"| [3]
| rowspan="4" style="text-align: center;"| JSTRT
| rowspan="4" style="text-align: center;"| RW0
| colspan="2" style="text-align: center;"| Состояние начала преобразования канала инъекции
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Преобразование канала инъекции было начато
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Преобразование канала инъекции не было начато
|-
| colspan="2" style="text-align: left;"| Этот бит устанавливается в 1 аппаратурой и сбрасывается в 0 программно (запись 1 недействительна)
|-
| rowspan="4" style="text-align: center;"| [2]
| rowspan="4" style="text-align: center;"| JEOC
| rowspan="4" style="text-align: center;"| RW0
| colspan="2" style="text-align: left;"| Состояние завершения преобразования группы каналов инъекции
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Преобразование завершено
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Преобразование не завершено
|-
| colspan="2" style="text-align: left;"| Этот бит устанавливается в 1 аппаратурой (все каналы инъекции были преобразованы) и сбрасывается в 0 программно (запись 1 недействительна)
|-
| rowspan="4" style="text-align: center;"| [1]
| rowspan="4" style="text-align: center;"| EOC
| rowspan="4" style="text-align: center;"| RW0
| colspan="2" style="text-align: left;"| Состояние завершения преобразования
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Преобразование завершено
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Преобразование не завершено
|-
| colspan="2" style="text-align: left;"| Этот бит устанавливается в 1 аппаратурой (завершение преобразования группы каналов правил или инъекции), сбрасывается в 0 программно (запись 1 недействительна) или при чтении ADC_RDATAR.
|-
| rowspan="4" style="text-align: center;"| [0]
| rowspan="4" style="text-align: center;"| AWD
| rowspan="4" style="text-align: center;"| RW0
| colspan="2" style="text-align: left;"| Бит флага аналогового сторожевого таймера
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Возникновение событий имитируемого сторожевого таймера
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Нет события имитируемого сторожевого таймера произошло
|-
| colspan="2" style="text-align: left;"| Этот бит устанавливается в 1 аппаратурой (значение преобразования выходит за пределы диапазона регистров ADC_WDHTR и ADC_WDLTR) и сбрасывается в 0 программно (запись 1 недействительна)
|}

<span id="adc-регистр-управления-1-adc_ctlr1"></span>
=== 9.3.2 ADC Регистр управления 1 (ADC_CTLR1)  ===

Смещение адреса: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="5" style="text-align: center;"| Резерв
| colspan="2" style="text-align: center;"| CALVOL
| style="text-align: center;"| Рез.
| style="text-align: center;"| AWDEN
| style="text-align: center;"| JAWDEN
| colspan="6" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="3" style="text-align: center;"| DISCNUM
| style="text-align: center;"| JDISCEN
| style="text-align: center;"| DISCEN
| style="text-align: center;"| JAUTO
| style="text-align: center;"| AWDSGL
| style="text-align: center;"| SCAN
| style="text-align: center;"| JEOCIE
| style="text-align: center;"| AWDIE
| style="text-align: center;"| EOCIE
| colspan="5" style="text-align: center;"| AWDCH
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:27]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="4" style="text-align: center;"| [26:25]
| rowspan="4" style="text-align: center;"| CALVOL [1:0]
| rowspan="4" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Выбор калибровочного напряжения
| rowspan="4" style="text-align: center;"| 01b
|-
| style="text-align: left;"| 01:
| style="text-align: left;"| Калибровочное напряжение 2/4 от AVDD
|-
| style="text-align: left;"| 10:
| style="text-align: left;"| Калибровочное напряжение 3/4 от AVDD
|-
| style="text-align: left;"| XX:
| style="text-align: left;"| Недопустимо
|-
| style="text-align: center;"| [24]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| 23
| rowspan="3" style="text-align: center;"| AWDEN
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит включения функции аналогового сторожевого таймера на управляющем канале
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включить аналоговый сторожевой таймер на управляющем канале
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключить аналоговый сторожевой таймер на управляющем канале
|-
| rowspan="3" style="text-align: center;"| [22]
| rowspan="3" style="text-align: center;"| JAWDEN
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит включения функции аналогового сторожевого таймера на канале инъекции
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включить аналоговый сторожевой таймер на канале инъекции
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключить аналоговый сторожевой таймер на канале инъекции
|-
| style="text-align: center;"| [24]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="4" style="text-align: center;"| [15:13]
| rowspan="4" style="text-align: center;"| DISCNUM [2:0]
| rowspan="4" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Количество управляющих каналов, которые будут преобразованы после внешнего запуска в прерывистом режиме
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 000:
| style="text-align: left;"| Канал 1
|-
| style="text-align: center;"| …
| style="text-align: left;"|  
|-
| style="text-align: right;"| 111:
| style="text-align: left;"| Канал 8
|-
| rowspan="3" style="text-align: center;"| 12
| rowspan="3" style="text-align: center;"| JDISCEN
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит включения прерывистого режима (intermittent mode) на канале инъекции
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включить прерывистый режим на канале инъекции
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключить прерывистый режим на канале инъекции
|-
| rowspan="3" style="text-align: center;"| [11]
| rowspan="3" style="text-align: center;"| DISCEN
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит включения прерывистого режима (intermittent mode) на управляющем канале
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включает прерывистый режим на управляющем канале
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключает прерывистый режим на управляющем канале
|-
| rowspan="4" style="text-align: center;"| [10]
| rowspan="4" style="text-align: center;"| JAUTO
| rowspan="4" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| После завершения открытия управляющего канала бит разрешения группы каналов инъекции автоматически переключается
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Разрешить автоматическое переключение группы каналов инъекции
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Запретить автоматическое преобразование группы каналов инъекции
|-
| colspan="2" style="text-align: left;"| ''Примечание: Этот режим требует отключения функции внешнего триггера для канала инъекции''
|-
| rowspan="3" style="text-align: center;"| [9]
| rowspan="3" style="text-align: center;"| AWDSGL
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| В режиме сканирования используйте бит включения аналогового сторожевого таймера на одном канале
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Использовать аналоговый сторожевой таймер на одном канале (выбор AWDCH[4:0])
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Использовать аналоговый сторожевой таймер на всех каналах
|-
| rowspan="3" style="text-align: center;"| [8]
| rowspan="3" style="text-align: center;"| SCAN
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит включения режима сканирования
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включить режим сканирования (непрерывное преобразование всех выбранных каналов ADC_IOFRx и ADC_RSQRx)
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключить режим сканирования
|-
| rowspan="3" style="text-align: center;"| [7]
| rowspan="3" style="text-align: center;"| JEOCIE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит разрешения прерывания по завершению преобразования группы каналов инъекции
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Разрешить генерацию прерывания при завершении преобразования группы каналов инъекции (флаг IEOC JEOC)
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Запретить генерацию прерывания завершения преобразования группы каналов инъекции
|-
| rowspan="4" style="text-align: center;"| [6]
| rowspan="4" style="text-align: center;"| AWDIE
| rowspan="4" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит разрешения прерывания аналогового сторожевого таймера
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Разрешить прерывание аналогового сторожевого таймера
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Запретить прерывание аналогового сторожевого таймера
|-
| colspan="2" style="text-align: left;"| ''ПРИМЕЧАНИЕ: В режиме сканирования это прерывание остановит сканирование, если оно произойдет''
|-
| rowspan="3" style="text-align: center;"| [5]
| rowspan="3" style="text-align: center;"| EOCIE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит разрешения прерывания по окончанию преобразования (группа каналов правила или инъекции)
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Разрешить прерывание по окончанию преобразования (флаг EOC)
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Запретить прерывание по окончанию преобразования
|-
| rowspan="4" style="text-align: center;"| [4:0]
| rowspan="4" style="text-align: center;"| AWDCH [4:0]
| rowspan="4" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Биты выбора канала аналогового сторожевого таймера
| rowspan="4" style="text-align: center;"| 0
|-
| colspan="2" style="text-align: left;"| 00000: Аналоговый входной канал 0
|-
| colspan="2" style="text-align: center;"| ***
|-
| colspan="2" style="text-align: left;"| 01111: Аналоговый входной канал 15
|}

<span id="adc-регистр-управления-2-adc_ctlr2"></span>
=== 9.3.3 ADC Регистр управления 2 (ADC_CTLR2)  ===

Смещение адреса: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="9" style="text-align: center;"| Резерв
| style="text-align: center;"| SWSTART
| style="text-align: center;"| JSWSTART
| style="text-align: center;"| EXTTRIG
| colspan="3" style="text-align: center;"| EXTSEL
| style="text-align: center;"| Рез.
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| style="text-align: center;"| JEXTTRIG
| colspan="3" style="text-align: center;"| JEXTSEL
| style="text-align: center;"| ALIGN
| colspan="2" style="text-align: center;"| Резерв
| style="text-align: center;"| DMA
| colspan="4" style="text-align: center;"| Резерв
| style="text-align: center;"| RSTCAL
| style="text-align: center;"| CAL
| style="text-align: center;"| CONT
| style="text-align: center;"| ADON
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:23]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="4" style="text-align: center;"| [22]
| rowspan="4" style="text-align: center;"| SWSTART
| rowspan="4" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Чтобы начать преобразование управляющего канала, необходимо установить программный триггер на
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Инициировать преобразование управляющего канала
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Сброс состояния
|-
| colspan="2" style="text-align: left;"| Этот бит устанавливается программно и сбрасывается аппаратно до 0, когда начинается преобразование.
|-
| rowspan="4" style="text-align: center;"| [21]
| rowspan="4" style="text-align: center;"| JSWSTART
| rowspan="4" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Для инициирования перехода канала инъекции установите программный триггер на:
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| инициирует переход канала инъекции
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| сброс состояния
|-
| colspan="2" style="text-align: left;"| Этот бит устанавливается программно и сбрасывается до 0 аппаратно или программно при начале преобразования.
|-
| rowspan="3" style="text-align: center;"| [20]
| rowspan="3" style="text-align: center;"| EXTTRIG
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Разрешение режима перехода по внешнему триггеру для управляющего канала
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Использование внешних событий для инициации преобразований
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключение функции активации внешним событием
|-
| rowspan="9" style="text-align: center;"| [19:17]
| rowspan="9" style="text-align: center;"| EXTSEL [2:0]
| rowspan="9" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Выбор внешнего события для инициирования преобразования управляющего канала
| rowspan="9" style="text-align: center;"| 0
|-
| style="text-align: right;"| 000:
| style="text-align: left;"| Событие TRGO таймера 1
|-
| style="text-align: right;"| 001:
| style="text-align: left;"| Событие CC1 таймера 1
|-
| style="text-align: right;"| 010:
| style="text-align: left;"| Событие CC2 таймера 1
|-
| style="text-align: right;"| 011:
| style="text-align: left;"| Событие TRGO таймера 2
|-
| style="text-align: right;"| 100:
| style="text-align: left;"| Событие CC1 таймера 2
|-
| style="text-align: right;"| 101:
| style="text-align: left;"| Событие CC2 таймера 2
|-
| style="text-align: right;"| 110:
| style="text-align: left;"| События PD3/PC2
|-
| style="text-align: right;"| 111:
| style="text-align: left;"| Программный триггер SWSTART
|-
| style="text-align: center;"| [16]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [15]
| rowspan="3" style="text-align: center;"| JEXTTRIG
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Разрешение режима перехода по внешнему триггеру для канала инъекции
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Использование внешних событий для инициации преобразований
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключение функции активации внешним событием
|-
| rowspan="9" style="text-align: center;"| [14:12]
| rowspan="9" style="text-align: center;"| JEXTSEL [2:0]
| rowspan="9" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Выбор внешнего события для инициирования преобразования канала инъекции:
| rowspan="9" style="text-align: center;"| 0
|-
| style="text-align: right;"| 000:
| style="text-align: left;"| Событие CC3 таймера 1
|-
| style="text-align: right;"| 001:
| style="text-align: left;"| Событие CC4 таймера 1
|-
| style="text-align: right;"| 010:
| style="text-align: left;"| Событие CC3 таймера 2
|-
| style="text-align: right;"| 011:
| style="text-align: left;"| Событие CC4 таймера 2
|-
| style="text-align: right;"| 100:
| style="text-align: left;"| Зарезервировано
|-
| style="text-align: right;"| 101:
| style="text-align: left;"| Зарезервировано
|-
| style="text-align: right;"| 110:
| style="text-align: left;"| PD1/PA2
|-
| style="text-align: right;"| 111:
| style="text-align: left;"| Программный триггер JSWSTART
|-
| rowspan="3" style="text-align: center;"| [11]
| rowspan="3" style="text-align: center;"| ALIGN
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Выравнивание данных
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| выравнивание по левому краю
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| выравнивание по правому краю
|-
| style="text-align: center;"| [10:9]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [8]
| rowspan="3" style="text-align: center;"| DMA
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: center;"| Режим прямого доступа к памяти (DMA):
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включить режим DMA
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключить режим DMA
|-
| style="text-align: center;"| [7:4]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="4" style="text-align: center;"| [3]
| rowspan="4" style="text-align: center;"| RSTCAL
| rowspan="4" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Сброс калибровки: этот бит устанавливается программно и очищается аппаратно после завершения сброса.
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Инициализация регистров калибровки.
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Регистр калибровки инициализирован.
|-
| colspan="2" style="text-align: left;"| Примечание: Если RSTCAL установлен во время выполнения преобразования, для очистки регистра калибровки требуются дополнительные циклы.
|-
| rowspan="3" style="text-align: center;"| [2]
| rowspan="3" style="text-align: center;"| CAL
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Калибровка АЦП: этот бит устанавливается программно и сбрасывается аппаратно в конце калибровки.
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Начало калибровки.
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Калибровка завершена.
|-
| rowspan="4" style="text-align: center;"| [1]
| rowspan="4" style="text-align: center;"| CONT
| rowspan="4" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Разрешение непрерывного преобразования:
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Режим непрерывного преобразования.
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Режим однократного преобразования.
|-
| colspan="2" style="text-align: left;"| Если этот бит установлен, преобразование будет продолжаться до тех пор, пока бит не будет сброшен.
|-
| rowspan="5" style="text-align: center;"| [0]
| rowspan="5" style="text-align: center;"| ADON
| rowspan="5" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Включение/выключение АЦП
| rowspan="5" style="text-align: center;"| 0
|-
| colspan="2" style="text-align: left;"| Когда этот бит равен 0, запись 1 выведет АЦП из режима энергосбережения; когда этот бит равен 1, запись 1 запустит преобразование.
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включить АЦП и начать преобразование.
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Выключить преобразование/калибровку АЦП и перейти в режим энергосбережения.
|-
| colspan="2" style="text-align: left;"| ''Примечание: Преобразование инициируется только тогда, когда изменяется только бит ADON в регистре, и новое преобразование не инициируется, если изменяются какие-либо другие биты.''
|}

''Примечание: Преобразование инициируется только тогда, когда изменяется только ADON в регистре, и никакое новое преобразование не инициируется.''

<span id="adc-регистр-времени-выборки-1-adc_samptr1"></span>
=== 9.3.4 ADC Регистр времени выборки 1 (ADC_SAMPTR1)  ===

Смещение адреса: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="14" style="text-align: center;"| Резерв
| colspan="2" style="text-align: center;"| SMP15[2:1]
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| style="text-align: left;"| SMP15[0]
| colspan="3" style="text-align: center;"| SMP14[2:0]
| colspan="3" style="text-align: center;"| SMP13[2:0]
| colspan="3" style="text-align: center;"| SMP12[2:0]
| colspan="3" style="text-align: center;"| SMP11[2:0]
| colspan="3" style="text-align: center;"| SMP10[2:0]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:18]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="6" style="text-align: center;"| [17:0]
| rowspan="6" style="text-align: center;"| SMPx[2:0]
| rowspan="6" style="text-align: center;"| RW
| style="text-align: left;"| SMPx[2:0]: конфигурация времени выборки для канала x.
| rowspan="6" style="text-align: center;"| 0
|-
| style="text-align: left;"| 000: 3 цикла; 001: 9 циклов.
|-
| style="text-align: left;"| 010: 15 циклов; 011: 30 циклов.
|-
| style="text-align: left;"| 100: 43 цикла; 101: 57 циклов.
|-
| style="text-align: left;"| 110: 73 цикла; 111: 241 цикл.
|-
| style="text-align: left;"| Эти биты используются для независимого выбора времени выборки для каждого канала, и значение конфигурации канала должно оставаться постоянным в течение цикла выборки.
|}

<span id="adc-регистр-времени-выборки-2-adc_samptr2"></span>
=== 9.3.5 ADC Регистр времени выборки 2 (ADC_SAMPTR2)  ===

Смещение адреса: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="2" style="text-align: center;"| Резерв
| colspan="3" style="text-align: center;"| SMP9[2:0]
| colspan="3" style="text-align: center;"| SMP8[2:0]
| colspan="3" style="text-align: center;"| SMP7[2:0]
| colspan="3" style="text-align: center;"| SMP6[2:0]
| colspan="2" style="text-align: center;"| SMP5[2:1]
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| style="text-align: left;"| SMP5[0]
| colspan="3" style="text-align: center;"| SMP4[2:0]
| colspan="3" style="text-align: center;"| SMP3[2:0]
| colspan="3" style="text-align: center;"| SMP2[2:0]
| colspan="3" style="text-align: center;"| SMP1[2:0]
| colspan="3" style="text-align: center;"| SMP0[2:0]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:30]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="6" style="text-align: center;"| [29:0]
| rowspan="6" style="text-align: center;"| SMPx[2:0]
| rowspan="6" style="text-align: center;"| RW
| style="text-align: left;"| SMPx[2:0]: конфигурация времени выборки для канала x.
| rowspan="6" style="text-align: center;"| 0
|-
| style="text-align: left;"| 000: 3 цикла; 001: 9 циклов.
|-
| style="text-align: left;"| 010: 15 циклов; 011: 30 циклов.
|-
| style="text-align: left;"| 100: 43 цикла; 101: 57 циклов.
|-
| style="text-align: left;"| 110: 73 цикла; 111: 241 цикл.
|-
| style="text-align: left;"| Эти биты используются для независимого выбора времени выборки для каждого канала, и значение конфигурации канала должно оставаться постоянным в течение цикла выборки.
|}

<span id="adc-регистр-смещения-данных-инжектируемого-канала-x-adc_iofrx-x1234"></span>
=== 9.3.6 ADC Регистр смещения данных инжектируемого канала x (ADC_IOFRx) (x=1/2/3/4)  ===

Смещение адреса: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="6" style="text-align: center;"| Резерв
| colspan="10" style="text-align: center;"| JOFFSETx[11:0]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:10]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="2" style="text-align: center;"| [9:0]
| rowspan="2" style="text-align: center;"| JOFFSETx [11:0]
| rowspan="2" style="text-align: center;"| RW
| style="text-align: left;"| Значение смещения данных для канала инъекции x.
| rowspan="2" style="text-align: center;"| 0
|-
| style="text-align: left;"| При преобразовании каналов инъекции это значение определяет величину, которая вычитается из исходных данных преобразования. Результат преобразования можно прочитать в регистре ADC_IDATARx.
|}

<span id="adc-регистр-верхнего-порога-сторожевого-таймера-adc_wdhtr"></span>
=== 9.3.7 ADC Регистр верхнего порога сторожевого таймера (ADC_WDHTR)  ===

Смещение адреса: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="6" style="text-align: center;"| Резерв
| colspan="10" style="text-align: center;"| HT[9:0]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:10]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [9:0]
| style="text-align: center;"| HT[9:0]
| style="text-align: center;"| RW
| style="text-align: left;"| Значение настройки высокого порога аналогового сторожевого таймера
| style="text-align: center;"| 3FFh
|}

<blockquote>''Примечание: Вы можете изменять значения WDHTR и WDLTR во время процесса преобразования, но они вступят в силу только при следующем преобразовании.''
</blockquote>
<span id="adc-регистр-нижнего-порога-сторожевого-таймера-adc_wdltr"></span>
=== 9.3.8 ADC Регистр нижнего порога сторожевого таймера (ADC_WDLTR)  ===

Смещение адреса: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="6" style="text-align: center;"| Резерв
| colspan="10" style="text-align: center;"| LT[9:0]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:10]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [9:0]
| style="text-align: center;"| LT[9:0]
| style="text-align: center;"| RW
| style="text-align: left;"| Значение настройки низкого порога аналогового сторожевого таймера
| style="text-align: center;"| 0
|}

<blockquote>''Примечание: Вы можете изменять значения WDHTR и WDLTR во время процесса преобразования, но они вступят в силу только при следующем преобразовании.''
</blockquote>
<span id="adc-регистр-регулярной-последовательности-1adc_rsqr1"></span>
=== 9.3.9 ADC Регистр регулярной последовательности 1(ADC_RSQR1)  ===

Смещение адреса: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="8" style="text-align: center;"| Резерв
| colspan="4" style="text-align: center;"| L[3:0]
| colspan="4" style="text-align: center;"| SQ16[4:1]
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| style="text-align: left;"| SQ16[0]
| colspan="5" style="text-align: center;"| SQ16[4:0
| colspan="5" style="text-align: center;"| SQ14[4:0]
| colspan="5" style="text-align: center;"| SQ13[4:0]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:10]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [23:20]
| style="text-align: center;"| L[3:0]
| style="text-align: center;"| RW
| style="text-align: left;"| Количество каналов, подлежащих преобразованию в обычной последовательности преобразования каналов.<br />
0000-1111: 1-16 преобразований.
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [19:15]
| style="text-align: center;"| SQ16[4:0]
| style="text-align: center;"| RW
| style="text-align: left;"| Номер 16-го канала преобразования в управляющей последовательности (0-9).
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [14:10]
| style="text-align: center;"| SQ15[4:0]
| style="text-align: center;"| RW
| style="text-align: left;"| Номер 15-го канала преобразования в управляющей последовательности (0-9).
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [9:5]
| style="text-align: center;"| SQ14[4:0]
| style="text-align: center;"| RW
| style="text-align: left;"| Номер 14-го канала преобразования в управляющей последовательности (0-9).
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [4:0]
| style="text-align: center;"| SQ13[4:0]
| style="text-align: center;"| RW
| style="text-align: left;"| Номер 13-го канала преобразования в управляющей последовательности (0-9).
| style="text-align: center;"| 0
|}

<span id="adc-регистр-регулярной-последовательности-2adc_rsqr2"></span>
=== 9.3.10 ADC Регистр регулярной последовательности 2(ADC_RSQR2)  ===

Смещение адреса: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="2" style="text-align: center;"| Резерв
| colspan="5" style="text-align: center;"| SQ12[4:0]
| colspan="5" style="text-align: center;"| SQ11[4:0]
| colspan="4" style="text-align: center;"| SQ10[4:1]
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| style="text-align: left;"| SQ10[0]
| colspan="5" style="text-align: center;"| SQ9[4:0]
| colspan="5" style="text-align: center;"| SQ8[4:0]
| colspan="5" style="text-align: center;"| SQ7[4:0]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:30]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [29:25]
| style="text-align: center;"| SQ12[4:0]
| style="text-align: center;"| RW
| style="text-align: left;"| Номер 12-го канала преобразования в управляющей последовательности (0-9).
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [24:20]
| style="text-align: center;"| SQ11[4:0]
| style="text-align: center;"| RW
| style="text-align: left;"| Номер 11-го канала преобразования в управляющей последовательности (0-9).
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [19:15]
| style="text-align: center;"| SQ10[4:0]
| style="text-align: center;"| RW
| style="text-align: left;"| Номер 10-го канала преобразования в управляющей последовательности (0-9).
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [14:10]
| style="text-align: center;"| SQ9[4:0]
| style="text-align: center;"| RW
| style="text-align: left;"| Номер 9-го канала преобразования в управляющей последовательности (0-9).
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [9:5]
| style="text-align: center;"| SQ8[4:0]
| style="text-align: center;"| RW
| style="text-align: left;"| Номер 8-го канала преобразования в управляющей последовательности (0-9).
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [4:0]
| style="text-align: center;"| SQ7[4:0]
| style="text-align: center;"| RW
| style="text-align: left;"| Номер 7-го канала преобразования в управляющей последовательности (0-9).
| style="text-align: center;"| 0
|}

<span id="adc-регистр-регулярной-последовательности-3adc_rsqr3"></span>
=== 9.3.11 ADC Регистр регулярной последовательности 3(ADC_RSQR3)  ===

Смещение адреса: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="2" style="text-align: center;"| Резерв
| colspan="5" style="text-align: center;"| SQ6[4:0]
| colspan="5" style="text-align: center;"| SQ5[4:0]
| colspan="4" style="text-align: center;"| SQ4[4:1]
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| style="text-align: left;"| SQ4[0]
| colspan="5" style="text-align: center;"| SQ3[4:0]
| colspan="5" style="text-align: center;"| SQ2[4:0]
| colspan="5" style="text-align: center;"| SQ1[4:0]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:30]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [29:25]
| style="text-align: center;"| SQ6[4:0]
| style="text-align: center;"| RW
| style="text-align: left;"| Номер 6-го канала преобразования в управляющей последовательности (0-9).
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [24:20]
| style="text-align: center;"| SQ5[4:0]
| style="text-align: center;"| RW
| style="text-align: left;"| Номер 5-го канала преобразования в управляющей последовательности (0-9).
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [19:15]
| style="text-align: center;"| SQ4[4:0]
| style="text-align: center;"| RW
| style="text-align: left;"| Номер 4-го канала преобразования в управляющей последовательности (0-9).
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [14:10]
| style="text-align: center;"| SQ3[4:0]
| style="text-align: center;"| RW
| style="text-align: left;"| Номер 3-го канала преобразования в управляющей последовательности (0-9).
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [9:5]
| style="text-align: center;"| SQ2[4:0]
| style="text-align: center;"| RW
| style="text-align: left;"| Номер 2-го канала преобразования в управляющей последовательности (0-9).
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [4:0]
| style="text-align: center;"| SQ1[4:0]
| style="text-align: center;"| RW
| style="text-align: left;"| Номер 1-го канала преобразования в управляющей последовательности (0-9).
| style="text-align: center;"| 0
|}

<span id="adc-регистр-инжектируемой-последовательности-adc_isqr"></span>
=== 9.3.12 ADC Регистр инжектируемой последовательности (ADC_ISQR)  ===

Смещение адреса: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="10" style="text-align: center;"| Резерв
| colspan="2" style="text-align: center;"| JL[1:0]
| colspan="4" style="text-align: center;"| JSQ4[4:1]
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| style="text-align: left;"| ОSQ4[0]
| colspan="5" style="text-align: center;"| JSQ3[4:0]
| colspan="5" style="text-align: center;"| JSQ2[4:0]
| colspan="5" style="text-align: center;"| JSQ1[4:0]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:22]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| style="text-align: left;"| [21:20]
| style="text-align: left;"| JL[1:0]
| style="text-align: left;"| RW
| style="text-align: left;"| Количество каналов, подлежащих преобразованию в последовательности преобразования каналов инъекции.<br />
00-11: 1-4 преобразования.
| style="text-align: center;"| 0
|-
| style="text-align: left;"| [19:15]
| style="text-align: left;"| JSQ4[4:0]
| style="text-align: left;"| RW
| style="text-align: left;"| Номер четвертого канала преобразования в последовательности инъекции (0-9).<br />
''Примечание: Программное обеспечение записывает и назначает номер канала (0-9) в качестве четвертого в последовательности для преобразования.''
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [14:10]
| style="text-align: left;"| JSQ3[4:0]
| style="text-align: left;"| RW
| style="text-align: left;"| Номер третьего канала преобразования в последовательности инъекции (0-9).
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [9:5]
| style="text-align: left;"| JSQ2[4:0]
| style="text-align: left;"| RW
| style="text-align: left;"| Номер второго канала преобразования в последовательности инъекции (0-9).
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [4:0]
| style="text-align: left;"| JSQ1[4:0]
| style="text-align: left;"| RW
| style="text-align: left;"| Номер первого канала преобразования в последовательности инъекции (0-9).
| style="text-align: center;"| 0
|}

<blockquote>''Примечание: В отличие от обычной последовательности преобразований, если длина '''JL'''[1:0] меньше 4, порядок преобразования начинается с (4 - '''JL''').''

''Например, когда '''JL'''[1:0]=3 (4 инжектированных перехода в секвенсере), АЦП будет преобразовывать каналы в следующем порядке: '''JSQ1'''[4:0], '''JSQ2'''[4:0], '''JSQ3'''[4:0] и '''JSQ4'''[4:0].''

''Когда '''JL'''[1:0]=2 (3 инжектированных перехода в секвенсере), АЦП будет преобразовывать каналы в следующем порядке: '''JSQ2'''[4:0], '''JSQ3'''[4:0] и '''JSQ4'''[4:0]; Когда '''JL'''[1:0]==1 (два инжектированных перехода в секвенсер), АЦП сначала преобразует '''JSQ3'''[4:0], а затем '''JSQ4'''[4:0].''

''Когда '''JL'''[1:0] == 0 (одно инжектированное преобразование ввода в секвенсере), АЦП будет преобразовывать только каналы '''JSQ4'''[4:0]. Если '''ADCx_ISQR'''[21:0]=10 00111 00011 00111 00010, АЦП преобразует каналы в следующем порядке: '''JSQ2'''[4:0], '''JSQ3'''[4:0], и '''JSQ4'''[4:0], указывая, что сканирующие преобразования выполняются в следующем порядке каналов: 7, 3, 7.''
</blockquote>
<span id="adc-регистр-инжектируемых-данных-adc_idatarx-x1234"></span>
=== 9.3.13 ADC Регистр инжектируемых данных (ADC_IDATARx) (x=1/2/3/4)  ===

Смещение адреса: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="16" style="text-align: center;"| JDATA[15:0]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:16]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [15:0]
| style="text-align: center;"| JDATA [15:0]
| style="text-align: center;"| RO
| style="text-align: left;"| Данные преобразования канала инъекции (данные выровнены по левому или правому краю).
| style="text-align: center;"| 0
|}

<span id="adc-регистр-регулярных-данных-adc_rdatar"></span>
=== 9.3.14 ADC Регистр регулярных данных (ADC_RDATAR)  ===

Смещение адреса: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="16" style="text-align: center;"| DATA[15:0]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:16]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [15:0]
| style="text-align: center;"| DATA [15:0]
| style="text-align: center;"| RO
| style="text-align: left;"| Данные преобразования управляющего канала (данные выровнены по левому или правому краю).
| style="text-align: center;"| 0
|}

<span id="adc-регистр-задержанных-данных-adc_dlyr"></span>
=== 9.3.15 ADC Регистр задержанных данных (ADC_DLYR)  ===

Смещение адреса: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 31
! style="text-align: center;"| 30
! style="text-align: center;"| 29
! style="text-align: center;"| 28
! style="text-align: center;"| 27
! style="text-align: center;"| 26
! style="text-align: center;"| 25
! style="text-align: center;"| 24
! style="text-align: center;"| 23
! style="text-align: center;"| 22
! style="text-align: center;"| 21
! style="text-align: center;"| 20
! style="text-align: center;"| 19
! style="text-align: center;"| 18
! style="text-align: center;"| 17
! style="text-align: center;"| 16
|-
| colspan="16" style="text-align: center;"| Резерв
|-
| style="text-align: center;"| 15
| style="text-align: center;"| 14
| style="text-align: center;"| 13
| style="text-align: center;"| 12
| style="text-align: center;"| 11
| style="text-align: center;"| 10
| style="text-align: center;"| 9
| style="text-align: center;"| 8
| style="text-align: center;"| 7
| style="text-align: center;"| 6
| style="text-align: center;"| 5
| style="text-align: center;"| 4
| style="text-align: center;"| 3
| style="text-align: center;"| 2
| style="text-align: center;"| 1
| style="text-align: center;"| 0
|-
| colspan="6" style="text-align: center;"| Резерв
| style="text-align: left;"| DLYSRC
| colspan="9" style="text-align: center;"| DLYVLU[8:0]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [31:10]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [9]
| rowspan="3" style="text-align: center;"| DLYSRC
| rowspan="3" style="text-align: center;"| RW
| style="text-align: left;"| Выбор задержки источника внешнего триггера
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: left;"| 0: Задержка внешнего триггера управляющего канала
|-
| style="text-align: left;"| 1: Задержка внешнего триггера канала инъекции
|-
| style="text-align: center;"| [8:0]
| style="text-align: center;"| DLYVLU [8:0]
| style="text-align: center;"| RW
| style="text-align: left;"| Данные задержки внешнего триггера, конфигурация времени задержки, единица: тактовый цикл АЦП
| style="text-align: center;"| 0
|}

<span id="глава-10.-таймер-управления-с-расширенными-функциями-adtm"></span>
= <br />
Глава 10. Таймер управления с расширенными функциями (ADTM)  =

<blockquote>Модуль таймера управления с расширенными функциями содержит мощный 16-битный таймер с авто перезагрузкой, TIM1, который может использоваться для измерения ширины импульса или генерации импульсов, ШИМ-сигналов и т.д. Он применяется в управлении двигателями, источниках питания и других приложениях.
</blockquote>
<span id="основные-возможности-3"></span>
== 10.1 Основные возможности  ==

<blockquote>Основные особенности таймера управления с расширенными функциями TIM1 включают:.
</blockquote>
* 16-битный счетчик с авто перезагрузкой, поддерживающий режимы инкрементального режима счета, декрементального режима счёта и комбинированного инкрементально-декрементального режима.
* 16-битный прескейлер с динамически настраиваемыми коэффициентами деления от 1 до 65536.
* Поддержка четырех независимых каналов сравнения/захвата.
* Каждый канал сравнения/захвата поддерживает несколько режимов работы, таких как захват входных сигналов, сравнение выходных сигналов, генерация ШИМ-сигнала и однократная генерация импульса.
* Комплементарные выходы с возможностью программирования мертвого времени (Dead Time).
* Возможность управления таймером внешними сигналами.
* Обновление состояния таймера через заданный интервал времени с использованием счетчика повторений.
* Перезапуск таймера или установка его в состояние &quot;OK&quot; с помощью сигнала торможения.
* Поддержка использования DMA в нескольких режимах.
* Работа с инкрементальными энкодерами.
* Каскадирование и синхронизация между несколькими таймерами.

<span id="принципы-и-структура"></span>
== 10.2 Принципы и структура  ==

<blockquote>Этот раздел посвящен внутреннему устройству таймеров управления с расширенными функциями (Advanced Control Timer).
</blockquote>
<span id="обзор-3"></span>
=== 10.2.1 Обзор  ===

<blockquote>Как показано на Рисунке 10-1, структура таймера управления с расширенными функциями может быть условно разделена на три части: блок входного тактового сигнала, ядро счетчика и часть канала сравнения/захвата.

Таймер управления с расширенными функциями может получать тактовый сигнал от шины HB ('''CK_INT'''), внешнего входа тактового сигнала ('''TIMx_ETR'''), других таймеров с выходом тактового сигнала ('''ITRx''') или входа канала сравнения/захвата ('''TIMx_CHx'''). Эти сигналы после различных операций фильтрации и деления преобразуются в сигнал '''CK_PSC''', который подается на секцию ядра счетчика. Кроме того, эти сложные источники тактовых сигналов могут также выводиться как '''TRGO (Trigger Go)''' для других периферийных устройств, таких как таймеры и АЦП.

Центральным элементом таймера является 16-битный счетчик ('''CNT'''), на который поступает сигнал '''CK_CNT''', полученный путем деления '''CK_PSC''' с помощью предделителя ('''PSC'''). Вспомогательный счетчик подсчитывает количество раз, когда регистр '''ATRLR''' загружает начальное значение в '''CNT''', и генерирует определенное событие, когда достигнуто число, установленное в регистре повтора ('''RPTCR''').

У таймера имеется четыре набора каналов сравнения/захвата, каждый из которых может принимать импульсы с отдельных выводов или выводить сигналы на выводы, то есть каналы сравнения/захвата поддерживают как входной, так и выходной режимы. Вход каждого канала регистра захвата поддерживает операции фильтрации, деления и обнаружения фронтов, поддерживает взаимную активацию между каналами, а также обеспечивает тактовый сигнал для основного счетчика '''CNT'''. Каждый канал сравнения/захвата имеет набор регистров сравнения/захвата ('''CHxCVR'''), которые сравнивают значения с главным счетчиком ('''CNT''') для формирования импульсных сигналов.

.

Рисунок 10-1. Блок-схема структуры таймера управления с расширенными функциями.

[[File:media/image20.png|611x632px]]
</blockquote>
<span id="вход-источника-сигнала"></span>
=== <br />
10.2.2 Вход источника сигнала  ===

<blockquote>Рисунок 10-2. Блок-схема источника сигнала '''CK_PSC''' для таймера управления с расширенными функциями.
</blockquote>
'''Encoder'''

'''mode'''

'''External clock'''

'''mode 1'''

'''External clock'''

'''mode 2'''

'''Internal clock'''

'''mode'''

'''CK_PSC'''

'''TI2F'''

'''TI1F'''

'''or'''

'''or'''

'''TRGI'''

'''ETRF'''

'''CK_INT'''

'''or'''

''')'''

'''('''

'''internal clock'''

'''TS[2:0]'''

'''TIMx_SMCR'''

'''xx'''

'''0'''

'''100'''

'''101'''

'''110'''

'''111'''

'''ITRx'''

'''<u>TI1_ED</u>'''

'''<u>TI1FP1</u>'''

'''TI2FP2'''

'''<u>ETRF</u>'''

'''0'''

'''1'''

'''CC2P'''

'''TIMx_CCER'''

'''Edge'''

'''detector'''

'''<u>TI2F_Rising</u>'''

'''TI2F_Falling'''

'''Filter'''

'''ICF[3:0]'''

'''TIMx_CCMR1'''

'''TI2'''

'''ETR pin'''

'''ETP'''

'''TIMx_SMCR'''

'''0'''

'''1'''

'''ETR'''

'''Divider'''

'''/1,/2,/4,/8'''

'''ETPS[1:0]'''

'''TIMx_SMCR'''

'''ETF[3:0]'''

'''TIMx_SMCR'''

'''ETRP'''

'''f'''

'''DTS'''

'''Filter'''

'''downcounter'''

'''ECE'''

'''TIMx_SMCR'''

'''SMS[2:0]'''

<blockquote>Для тактового сигнала '''CK_PSC''' таймера управления с расширенными функциями существует множество источников, которые можно разделить на 4 категории:
</blockquote>
# Маршрут ввода тактового сигнала от внешнего вывода ('''ETR'''): '''ETR''' → '''ETRP''' → '''ETRF''';
# Маршрут ввода внутреннего тактового сигнала APB: '''CK_INT''';
# Маршрут от вывода канала сравнения/захвата ('''TIMx_CHx'''): '''TIMx_CHx''' → '''TIx''' → '''TIxFPx'''; этот маршрут также используется в режиме энкодера;
# Вход от других внутренних таймеров: '''ITRx''';

<blockquote>Реальная операция может быть разделена на 4 категории путем определения выбора входного импульса для источника '''CK_PSC''':
</blockquote>
# Выбор внутреннего тактового источника ('''CK_INT''');
# Внешний тактовый источник, режим 1;
# Внешний тактовый источник, режим 2;
# Режим энкодера.

<blockquote>Эти 4 операции позволяют выбирать любой из перечисленных выше 4 источников тактового сигнала.
</blockquote>
<span id="внутренний-источник-тактирования-ck_int"></span>
==== 10.2.2.1 Внутренний источник тактирования (CK_INT)  ====

<blockquote>Если поле '''SMS''' удерживается в состоянии 000b для запуска таймера управления с расширенными функциями, то выбирается внутренний тактовый источник ('''CK_INT''') в качестве тактового сигнала. В этом случае '''CK_INT''' становится '''CK_PSC'''.
</blockquote>
<span id="внешний-источник-тактирования-mode-1"></span>
==== 10.2.2.2 Внешний источник тактирования Mode 1  ====

Когда область '''SMS''' установлена в 111b, включается внешний тактовый источник Mode 1. При активации внешнего тактового источника 1, в качестве источника '''CK_PSC''' выбирается '''TRGI'''. Важно отметить, что источник '''TRGI''' также должен быть выбран путем конфигурации области '''TS'''. Область '''TS''' может выбрать следующие типы импульсов в качестве источников тактового сигнала:

# Внутренние триггеры ('''ITRx''', где x = 0, 1, 2, 3).
# Сигнал после прохождения через детектор фронта канала захвата 1 ('''TI1F_ED''').
# Сигналы '''TI1FP1''', '''TI2FP2''' канала захвата.
# Сигнал '''ETRF''' от входа внешнего тактового вывода

<span id="внешний-источник-тактирования-mode-2"></span>
==== 10.2.2.3 Внешний источник тактирования Mode 2  ====

<blockquote>Используйте внешний режим триггера 2 для подсчета на каждом восходящем или нисходящем фронте входного сигнала внешнего тактового вывода. Когда позиция '''ECE''' установлена, используется внешний тактовый источник режима 2. При использовании внешнего тактового источника режима 2, в качестве '''CK_PSC''' выбирается '''ETRF'''. Пин '''ETR''' превращается в '''ETRP''' после прохождения через необязательный инвертор ('''ETP'''), делитель ('''ETPS'''), а затем в '''ETRF''' после прохождения через фильтр ('''ETF''').

При установке битов позиции '''ECE''' и '''SMS''' на 111b, это эквивалентно выбору '''ETRF''' в качестве входа областью '''TS'''
</blockquote>
<span id="режим-энкодера"></span>
==== 10.2.2.4 Режим энкодера  ====

<blockquote>Установка '''SMS''' на 001b, 010b или 011b включит режим энкодера. Включение режима энкодера позволяет выбрать определенный уровень в '''TI1FP1''' и '''TI2FP2''' для передачи сигнала с другим перепадом фронта в качестве сигнала. Этот режим используется при работе с внешним энкодером. За подробностями о конкретных функциях обратитесь к разделу 10.3.9
</blockquote>
<span id="счетчики-и-переферия"></span>
=== 10.2.3 Счетчики и переферия  ===

<blockquote>'''CK_PSC''' поступает на предделитель ('''PSC''') для деления. '''PSC''' является 16-битным, и реальный коэффициент деления равен значению '''R16_TIMx_PSC''' + 1. '''CK_PSC''' проходит через '''PSC''' и становится '''CK_INT'''. Изменение значения '''R16_TIM1_PSC''' не вступает в силу немедленно, но обновляется в '''PSC''' после события обновления. Событием обновления является очистка и сброс бита '''UG'''. Ядро таймера представляет собой 16-битный счётчик ('''CNT'''). В конечном итоге '''CK_CNT''' подаётся на '''CNT''', который поддерживает режимы инкрементного счёта, декрементного счёта и комбинированного инкрементно-декрементного счёта. Также имеется регистр автоматической перезагрузки ('''ATRLR'''), который перезагружает начальное значение для '''CNT''' в конце каждого цикла счёта. Есть также вспомогательный счётчик, который отслеживает количество раз, когда '''ATRLR''' перезагружал начальное значение для '''CNT''', и может генерировать определённое событие, когда достигается количество раз, установленное в регистре счётчика повторений ('''RPTCR''').
</blockquote>
<span id="каналы-сравнениязахвата-и-периферии"></span>
=== 10.2.4 Каналы сравнения/захвата и периферии  ===

<blockquote>Ядром таймера являются регистры сравнения/захвата, которые дополняются цифровой фильтрацией, делением частоты и мультиплексированием между каналами в секции входных периферийных компонентов, компаратором и управлением выхода в выходной секции.

Рисунок 10-3. Блок-схема структуры канала сравнения/захвата

[[File:media/image21.png|609x810px]]

Блок-схема структуры канала сравнения/захвата показана на рисунке 10-3. Сигнал поступает с вывода канала x и опционально формируется как '''TIx''' (источником '''TI1''' может быть не только '''CH1''', см. блок-схему структуры таймера 10-1), '''TI1''' проходит через фильтр ('''ICF'''[3:0]), формируя '''TI1F''', затем делится на '''TI1F_Rising''' и '''TI1FP_Falling''' через детектор фронта, эти два сигнала выбираются ('''CC1P''') для создания '''TI1FP1''', '''TI1FP1''' и '''TI2FP1''' из второго канала отправляются вместе в '''CC1S''' для выбора и превращаются в '''IC1''', который отправляется в регистр сравнения/захвата после деления '''ICPS'''.

Регистр сравнения/захвата состоит из регистра предварительной загрузки и теневого регистра, а процесс чтения/записи выполняется только над регистром предварительной загрузки. В режиме захвата захват происходит в теневом регистре, а затем копируется в регистр предварительной загрузки; в режиме сравнения содержимое регистра предварительной загрузки копируется в теневой регистр, а затем содержимое теневого регистра сравнивается с основным счетчиком ('''CNT''')
</blockquote>
<span id="функциональность-и-реализация"></span>
== 10.3 Функциональность и реализация ==

<blockquote>Реализация сложных функций таймера управления с расширенными возможностями осуществляется посредством работы каналов сравнения/захвата таймера, схемы ввода тактового сигнала, счетчика и периферийных компонентов. Тактовый сигнал, подаваемый на таймер, может поступать из множества источников, включая ввод от канала сравнения/захвата. Работа канала сравнения/захвата и выбор источника тактового сигнала непосредственно определяют его функциональность. Канал сравнения/захвата является двунаправленным и может работать как в режиме ввода, так и в режиме вывода.
</blockquote>
<span id="режим-захвата-входа-input-capture"></span>
=== 10.3.1 Режим захвата входа (Input Capture)  ===

<blockquote>Режим захвата входного сигнала является одной из базовых функций таймера. Принцип работы режима захвата входного сигнала заключается в том, что событие захвата происходит, когда обнаруживается определенный фронт сигнала '''ICxPS''', и текущее значение счетчика фиксируется в регистре сравнения/захвата ('''R16_TIMx_CHCTLRx'''). Когда происходит событие захвата, устанавливается флаг '''CCxIF''' (в '''R16_TIMx_INTFR'''), и если разрешено прерывание или DMA, генерируется соответствующее прерывание или запрос DMA. Если флаг '''CCxIF''' уже установлен, когда происходит событие захвата, то устанавливается бит '''CCxOF'''. Флаг '''CCxIF''' может быть сброшен программно или аппаратно при чтении регистра сравнения/захвата. Бит '''CCxOF''' сбрасывается программно. Пример использования режима захвата на входе для канала 1 приведен ниже.
</blockquote>
# Настройте область '''CCxS''' для выбора источника сигнала '''ICx'''. Например, установите значение 10b и выберите '''TI1FP1''' в качестве источника '''IC1''' вместо использования значений по умолчанию, где область '''CCxS''' по умолчанию делает модуль сравнения/захвата каналом вывода.
# Настройте область '''ICxF''' для установки цифрового фильтра для сигнала '''TI'''. Цифровой фильтр будет выборочно считывать сигнал с определенной частотой указанное количество раз, а затем выдавать скачок. Эта частота выборки и количество выборок определяется полем '''ICxF'''.
# Настройте бит '''CCxP''' для установки полярности сигнала '''TIxFPx'''. Например, оставьте бит '''CC1P''' низким и выберите переходы по нарастающему фронту.
# Настройте область '''ICxPS''' для установки коэффициента пересчета сигнала '''ICx'''. Например, оставляйте '''ICxPS''' равным 00b без пересчета.
# Настройте бит '''CCxE''' для разрешения записи значения основного счетчика ('''CNT''') в регистр сравнения/захвата. Установите бит '''CC1E'''.
# Настройте биты '''CCxIE''' и '''CCxDE''' по мере необходимости, чтобы определить, следует ли разрешить прерывания или DMA. На этом завершается конфигурация канала сравнения/захвата.

<blockquote>Когда захваченный импульс подается на '''TI1''', значение основного счетчика ('''CNT''') записывается в регистр сравнения/захвата, устанавливается бит '''CC1IF''', и бит '''CCIOF''' устанавливается, если ранее был установлен бит '''CC1IF'''. Если установлен бит '''CC1IE''', то генерируется прерывание; если установлен бит '''CC1DE''', генерируется запрос DMA. Событие захвата на входе может быть сгенерировано программно путем записи в регистр генерации событий ('''TIMx_SWEVGR''')

.
</blockquote>
<span id="режимы-выходного-сравнения-compare-output"></span>
=== 10.3.2 Режимы выходного сравнения (Compare Output) ===

Режим выходного сравнения является одной из основных функций таймера. Принцип работы этого режима заключается в том, что при совпадении значения основного счетчика ('''CNT''') со значением регистра сравнения/захвата на выходе формируется конкретное изменение или волна. Поле '''OCxM''' (в '''R16_TIMx_CHCTLRx''') и бит '''CCxP''' (в '''R16_TIMx_CCER''') определяют, будет ли на выходе зафиксирован высокий или низкий уровень, или же произойдет смена уровня. Бит '''CCxIF''' также устанавливается, когда генерируется событие совпадения сравнения. Если заранее установлен бит '''CCxIE''', генерируется прерывание; если заранее установлен бит '''CCxDE''', генерируется запрос DMA.

Для настройки режима выходного сравнения выполните следующие действия:

<ol start="4" style="list-style-type: decimal;">
<li><p>Настройте источник тактового сигнала и значение авто перезагрузки основного счетчика ('''CNT''').</p></li>
<li><p>Установите значение для сравнения в регистр сравнения/захвата ('''R16_TIMx_CHxCVR''').</p></li>
<li><p>Если требуется сгенерировать прерывание, установите бит '''CCxIE'''.</p></li>
<li><p>Оставьте '''OCxPE''' равным 0, чтобы отключить регистр предварительной загрузки регистра сравнения.</p></li>
<li><p>Настройте режим вывода, установив поле '''OCxM''' и бит '''CCxP'''.</p></li>
<li><p>Включите вывод, установив бит '''CCxE'''.</p></li>
<li><p>Установите бит '''CEN''' для запуска таймера.</p></li></ol>

<span id="режим-принудительного-вывода-forced-output"></span>
=== 10.3.3 Режим принудительного вывода (Forced Output)  ===

<blockquote>Шаблон вывода канала сравнения/захвата таймера может быть принудительно изменен программным обеспечением для вывода определенного уровня без необходимости сравнивать теневой регистр регистра сравнения/захвата с основным счетчиком. Для этого нужно установить '''OCxM''' в значение 100b, что приведет к принудительному снижению уровня '''OCxREF''', или установить '''OCxM''' в 101b, чтобы принудительно повысить уровень '''OCxREF'''.

Обратите внимание, что при принудительном установлении '''OCxM''' на 100b или 101b процесс сравнения внутренних основных счетчиков и регистров сравнения/захвата все равно продолжается, соответствующие флаги устанавливаются, и продолжают генерироваться прерывания и запросы DMA.
</blockquote>
<span id="режим-входа-шим-pwm-input"></span>
=== 10.3.4 Режим входа ШИМ (PWM Input)  ===

<blockquote>Режим ввода ШИМ используется для измерения коэффициента заполнения и частоты сигнала ШИМ и является специальным случаем режима захвата входного сигнала. Операция аналогична режиму захвата входного сигнала, за исключением следующих отличий: ШИМ занимает два канала сравнения/захвата, и полярность ввода этих двух каналов установлена противоположной, один из сигналов настроен как вход триггера, а '''SMS''' установлен в режим сброса.

Например, чтобы измерить период и частоту входящего сигнала ШИМ от '''TI1''', необходимы следующие операции.
</blockquote>
# Установите '''TI1''' ('''TI1FP1''') в качестве входа сигнала '''IC1'''. Установите '''CC1S''' на 01b.
# Установите '''TI1FP1''' на активный передний фронт. Держите '''CC1P''' на нуле.
# Установите '''TI1''' ('''TI1FP2''') в качестве входа для сигнала '''IC2'''. Установите '''CC2S''' на 10b.
# Выберите '''TI1FP2''' для активного заднего фронта. Установите '''CC2P''' на 1.
# Выберите '''TI1FP1''' в качестве источника тактового сигнала. Установите '''TS''' на 101b.
# Установите '''SMS''' в режим сброса, то есть 100b.
# Разрешите захват входного сигнала. Устанавливайте '''cc1e''' и '''cc2e'''.

<blockquote>Таким образом, значение регистра сравнения/захвата 1 является периодом ШИМ, а значение регистра сравнения/захвата 2 – его коэффициентом заполнения.
</blockquote>
<span id="режим-выхода-шим-pwm-output"></span>
=== 10.3.5 Режим выхода ШИМ (PWM Output)  ===

<blockquote>Режим вывода ШИМ является одной из базовых функций таймера. Режим вывода ШИМ чаще всего используется для определения частоты ШИМ с помощью значения перезагрузки и коэффициента заполнения с использованием регистра сравнения/захвата. Чтобы использовать режим ШИМ 1 или 2, установите 110b или 111b в поле '''OCxM''', установите бит '''OCxPE''' для включения регистра предварительной загрузки и, наконец, установите бит '''ARPE''' для разрешения автоматической перезагрузки регистра предварительной загрузки. Поскольку значение регистра предварительной загрузки может быть отправлено в теневой регистр только при возникновении события обновления, необходимо установить бит '''UG''' для инициализации всех регистров перед началом счета основным счетчиком. В режиме ШИМ основной счетчик и регистр сравнения/захвата всегда находятся в процессе сравнения, и в зависимости от бита '''CMS''' таймер способен выводить сигналы ШИМ, выровненные по краю или центру.

'''Выравнивание по краю'''

При использовании выравнивания по краю основной счетчик увеличивается или уменьшается, и в сценарии режима ШИМ 1 '''OCxREF''' находится в высоком состоянии, когда значение основного счетчика больше, чем у регистра сравнения/захвата, и переходит в низкое состояние, когда оно меньше (например, когда основной счетчик достигает значения '''R16_TIMx_ATRLR''' и возвращается к нулевым значениям).

'''Центровка'''

При использовании центрированных режимов основной счетчик работает в чередующихся режимах инкрементного и декрементного счета, и '''OCxREF''' совершает подъемы и спады, когда значения основного счетчика и регистра сравнения/захвата совпадают. Однако флаги сравнения устанавливаются в разное время в трех центральных режимах выравнивания. При использовании центрально выровненных режимов рекомендуется сгенерировать флаг программного обновления (установить бит '''UG''') перед запуском основного счетчика.
</blockquote>
<span id="комплиментарные-выходы-и-мертвые-зоны-complementary-outputs-and-dead-zones"></span>
=== 10.3.6 Комплиментарные выходы и мертвые зоны (Complementary Outputs and Dead Zones) ===

<blockquote>Канал сравнения/захвата обычно имеет два выходных контакта (у четвертого канала сравнения/захвата есть только один выходной контакт), и он может выводить два комплементарных сигнала ('''OCx''' и '''OCxN'''). Для '''OCx''' и '''OCxN''' можно независимо настроить полярность с помощью битов '''CCxP''' и '''CCxNP''', включить независимый вывод с помощью '''CCxE''' и '''CCxNE''', а также независимо управлять выводом с помощью бит '''MOE''', '''OIS''', '''OISN''', '''OSSI''' и '''OSSR''' для контроля мертвого времени и других параметров. Одновременное включение выходов '''OCx''' и '''OCxN''' вставляет зону задержки, и для каждого канала предусмотрен генератор зоны задержки на 10 бит. '''OCx''' и '''OCxN''' формируются на основе ассоциации с '''OCxREF'''. Если оба сигнала '''OCx''' и '''OCxN''' активны на высоком уровне, тогда '''OCx''' совпадает с '''OCxREF''', за исключением того, что передний фронт '''OCx''' соответствует задержке относительно '''OCxREF''', а '''OCxN''' является обратной величиной '''OCxREF''' таким образом, что его передний фронт будет иметь задержку относительно заднего фронта опорного сигнала. Если задержка превышает эффективную ширину выходного сигнала, соответствующий импульс не будет сгенерирован. На рис. 10-4 изображены отношения между '''OCx''', '''OCxN''' и '''OCxREF''' с учетом зоны задержки.Начало формы

Рисунок 10-4. Комплементарные выходы и зона задержки.Начало формы
</blockquote>
<span id="сигнал-тормоза-brake-signal"></span>
=== 10.3.7 Сигнал тормоза (Brake Signal) ===

Когда генерируется сигнал тормоза, сигнал разрешения вывода и недействительный уровень модифицируются в соответствии с битами '''MOE''', '''OIS''', '''OISN''', '''OSSI''' и '''OSSR'''. Однако ни в какой момент времени '''OCx''' и '''OCxN''' не будут находиться на активном уровне. Источник события тормоза может исходить от вывода тормозного контакта или это может быть событие отказа тактового сигнала, которое генерируется системой безопасности тактового сигнала ('''CSS'''). После сброса системы функция тормоза отключается по умолчанию (бит '''MOE''' установлен на низкий уровень), а установка бита '''BKE''' включает функцию тормоза. Полярность входного тормозного сигнала можно задать, установив '''BKP''', а сигналы '''BKE''' и '''BKP''' могут быть записаны одновременно, и перед реальной записью есть задержка на один такт HB, поэтому вам нужно подождать один цикл HB, чтобы правильно считать записанное значение. При наличии выбранного уровня на контакте тормоза система выполнит следующие действия.

# Биту '''MOE''' присваивается значение &quot;0&quot;, и вывод устанавливается в неактивное, холостое или сбросовое состояние в зависимости от настройки бита '''SOOI'''.
# После очистки бита '''MOE''' каждый выходной канал выводит уровень, определяемый битом '''OISx'''.
# При использовании комплементарных выходов выходные данные переходят в нулевое состояние в соответствии с полярностью.
# Если установлен бит '''BIE''', генерируется прерывание, когда установлен бит '''BIF'''; если установлен бит BDE, создается запрос DMA.
# Если установлено значение '''AOE''', бит '''MOE''' автоматически устанавливается при следующем событии обновления '''UEV'''.

<span id="режим-одного-импульса-single-pulse"></span>
=== 10.3.8 Режим одного импульса (Single Pulse)  ===

<blockquote>Режим одиночного импульса позволяет микроконтроллеру реагировать на определенное событие, генерируя импульс после задержки, при этом длина и ширина импульса программируемые. Установка бита '''OPM''' позволяет основному счетчику останавливаться, когда генерируется следующее событие обновления '''UEV''' (счетчик сбрасывается до нуля).

Как показано на Рисунке 10-5, на выходе OC1 необходимо сгенерировать положительный импульс длительностью Tpulse после задержки Tdelay при обнаружении переднего фронта на входе TI2.

Рисунок 10-5. Генерация одиночного импульса.

[[File:media/image32.png|469x296px]]
</blockquote>
# Настройте '''TI2''' как триггер. Установите поле '''CC2S''' на 01b, чтобы сопоставить '''TI2FP2''' с '''TI2'''; установите бит '''CC2P''' на 0b, чтобы установить '''TI2FP2''' на детектирование переднего фронта; установите поле '''TS''' на 110b, чтобы установить '''TI2FP2''' в качестве источника триггера; установите поле '''SMS''' на 110b для использования '''TI2FP2''' для запуска счетчика.
# Задержка Tdelay определяется значением регистра захвата сравнения, а длительность Tpulse определяется значениями регистра автоматического перезагрузки и регистра захвата/сравнения.

<span id="режим-энкодера-encoder"></span>
=== 10.3.9 Режим энкодера (Encoder)  ===

<blockquote>Режим энкодера является типичным применением таймера и может использоваться для доступа к выходному сигналу энкодера с двумя фазами. Направление счета основного счетчика синхронизируется с направлением вращения оси энкодера, и каждый импульс, поступающий от энкодера, вызывает увеличение или уменьшение значения основного счетчика на единицу. Чтобы использовать энкодер, установите поле '''SMS''' на 001b (подсчёт только по переднему фронту '''TI2'''), 010b (счёт только по переднему фронту '''TI1''') или 011b (учет обоих фронтов '''TI1''' и '''TI2'''). Подключите энкодер к входу каналов сравнения/захвата 1 и 2 и установите значение для регистра перезагрузки, которое может быть увеличено. В режиме энкодера внутренние регистры захвата сравнения, предельное деление, регистр повторного счёта и другие компоненты таймера работают нормально. В следующей таблице показаны взаимосвязь направления счёта с сигналом энкодера.

Таблица 10-1. Взаимосвязь между направлением счёта таймера и сигналом энкодера в этом режиме.
</blockquote>
{| class="wikitable"
|-
! rowspan="2" style="text-align: center;"| Сонфигурация эфективного фронта
! rowspan="2" style="text-align: center;"| Уровень подчиненного сигнала
! colspan="2" style="text-align: center;"| Фронт сигнала TI1FP
! colspan="2" style="text-align: center;"| Фронт сигнала TI2FP2
|-
! style="text-align: center;"| Позитивный фронт
! style="text-align: center;"| Негативный фронт
! style="text-align: center;"| Позитивный фронт
! style="text-align: center;"| Негативный фронт
|-
| rowspan="2" style="text-align: center;"| Счет только на фронте TI1
| style="text-align: center;"| Высокий
| style="text-align: center;"| Счет вниз
| style="text-align: center;"| Счет вверх
| rowspan="2" colspan="2" style="text-align: center;"| Нет счета
|-
| style="text-align: center;"| Низкий
| style="text-align: center;"| Счет вверх
| style="text-align: center;"| Счет вниз
|-
| rowspan="2" style="text-align: center;"| Счет только на фронте TI2
| style="text-align: center;"| Высокий
| rowspan="2" colspan="2" style="text-align: center;"| Нет счета
| style="text-align: center;"| Счет вверх
| style="text-align: center;"| Счет вниз
|-
| style="text-align: center;"| Низкий
| style="text-align: center;"| Счет вниз
| style="text-align: center;"| Счет вверх
|-
| rowspan="2" style="text-align: center;"| Счет по обеим фронтам TI1 и TI2
| style="text-align: center;"| Высокий
| style="text-align: center;"| Счет вниз
| style="text-align: center;"| Счет вверх
| style="text-align: center;"| Счет вверх
| style="text-align: center;"| Счет вниз
|-
| style="text-align: center;"| Низкий
| style="text-align: center;"| Счет вверх
| style="text-align: center;"| Счет вниз
| style="text-align: center;"| Счет вниз
| style="text-align: center;"| Счет вверх
|}

<span id="режим-синхронизации-таймеров"></span>
=== 10.3.10 Режим синхронизации таймеров  ===

<blockquote>Таймеры способны генерировать тактовые импульсы ('''TRGO''') и принимать входы от других таймеров ('''ITRx'''). Источники '''ITRx''' ('''TRGO''' от других таймеров) различаются для разных таймеров. Соединения внутренних триггеров таймера приведены в Таблице 10-2.

Table 10-2 TIMx подключение внутренних триггеров
</blockquote>
{| class="wikitable"
|-
! style="text-align: center;"| Подчиненный таймер
! style="text-align: center;"| ITR0 (TS=000)
! style="text-align: center;"| ITR0 (TS=001)
! style="text-align: center;"| ITR0 (TS=010)
! style="text-align: center;"| ITR0 (TS=011)
|-
| style="text-align: center;"| TIM1
| style="text-align: center;"|  
| style="text-align: center;"| TIM2
| style="text-align: center;"|  
| style="text-align: center;"|  
|-
| style="text-align: center;"| TIM2
| style="text-align: center;"| TIM1
| style="text-align: center;"|  
| style="text-align: center;"|  
| style="text-align: center;"|  
|}

<span id="режим-наладки-2"></span>
=== 10.3.11 Режим наладки  ===

<blockquote>Когда система входит в режим отладки, таймер продолжает работу или останавливается в зависимости от настроек модуля DBG.
</blockquote>
<span id="описание-регистров-8"></span>
== 10.4 Описание регистров  ==

<blockquote>Table 10-3 TIM1-related registers list
</blockquote>
{| class="wikitable"
|-
! style="text-align: center;"| '''Наименование'''
! style="text-align: center;"| '''Адрес'''
! style="text-align: center;"| '''Описание'''
! style="text-align: center;"| '''Значение сброса'''
|-
| style="text-align: left;"| R16_TIM1_CTLR1
| style="text-align: center;"| 0x40012C00
| style="text-align: left;"| Регистр управления 1
| style="text-align: center;"| 0x0000
|-
| style="text-align: left;"| R16_TIM1_CTLR2
| style="text-align: center;"| 0x40012C04
| style="text-align: left;"| Регистр управления 2
| style="text-align: center;"| 0x0000
|-
| style="text-align: left;"| R16_TIM1_SMCFGR
| style="text-align: center;"| 0x40012C08
| style="text-align: left;"| Регистр управления режимом ведомого устройства
| style="text-align: center;"| 0x0000
|-
| style="text-align: left;"| R16_TIM1_DMAINTENR
| style="text-align: center;"| 0x40012C0C
| style="text-align: left;"| Регистр разрешения DMA/прерывания
| style="text-align: center;"| 0x0000
|-
| style="text-align: left;"| R16_TIM1_INTFR
| style="text-align: center;"| 0x40012C10
| style="text-align: left;"| Регистр статуса прерывания
| style="text-align: center;"| 0x0000
|-
| style="text-align: left;"| R16_TIM1_SWEVGR
| style="text-align: center;"| 0x40012C14
| style="text-align: left;"| Регистр генерации событий
| style="text-align: center;"| 0x0000
|-
| style="text-align: left;"| R16_TIM1_CHCTLR1
| style="text-align: center;"| 0x40012C18
| style="text-align: left;"| Регистр управления сравнением/захватом 1
| style="text-align: center;"| 0x0000
|-
| style="text-align: left;"| R16_TIM1_CHCTLR2
| style="text-align: center;"| 0x40012C1C
| style="text-align: left;"| Регистр управления сравнением/захватом 2
| style="text-align: center;"| 0x0000
|-
| style="text-align: left;"| R16_TIM1_CCER
| style="text-align: center;"| 0x40012C20
| style="text-align: left;"| Регистр разрешения сравнения/захвата
| style="text-align: center;"| 0x0000
|-
| style="text-align: left;"| R16_TIM1_CNT
| style="text-align: center;"| 0x40012C24
| style="text-align: left;"| Счётчики
| style="text-align: center;"| 0x0000
|-
| style="text-align: left;"| R16_TIM1_PSC
| style="text-align: center;"| 0x40012C28
| style="text-align: left;"| Прескейлер тактовой частоты счёта
| style="text-align: center;"| 0x0000
|-
| style="text-align: left;"| R16_TIM1_ATRLR
| style="text-align: center;"| 0x40012C2C
| style="text-align: left;"| Регистр значения авто перезагрузки
| style="text-align: center;"| 0xFFFF
|-
| style="text-align: left;"| R16_TIM1_RPTCR
| style="text-align: center;"| 0x40012C30
| style="text-align: left;"| Регистра значения счётчика повторов
| style="text-align: center;"| 0x0000
|-
| style="text-align: left;"| R32_TIM1_CH1CVR
| style="text-align: center;"| 0x40012C34
| style="text-align: left;"| Регистрация сравнения/захвата 1
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_TIM1_CH2CVR
| style="text-align: center;"| 0x40012C38
| style="text-align: left;"| Реестр сравнения/захвата 2
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_TIM1_CH3CVR
| style="text-align: center;"| 0x40012C3C
| style="text-align: left;"| Реал реестра сравнения/захвата 3
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R32_TIM1_CH4CVR
| style="text-align: center;"| 0x40012C40
| style="text-align: left;"| Редактор сравнения/захвата 4
| style="text-align: center;"| 0x00000000
|-
| style="text-align: left;"| R16_TIM1_BDTR
| style="text-align: center;"| 0x40012C44
| style="text-align: left;"| Реквизиты тормоза и мёртвого времени
| style="text-align: center;"| 0x0000
|-
| style="text-align: left;"| R16_TIM1_DMACFGR
| style="text-align: center;"| 0x40012C48
| style="text-align: left;"| Запись управления DMA
| style="text-align: center;"| 0x0000
|-
| style="text-align: left;"| R16_TIM1_DMAADR
| style="text-align: center;"| 0x40012C4C
| style="text-align: left;"| Адрес записи DMA для непрерывного режимаНачало формы

Конец формы

| style="text-align: center;"| 0x0000
|}

<span id="регистр-управления-1-tim1_ctlr1"></span>
=== 10.4.1 Регистр управления 1 (TIM1_CTLR1) ===

Смещение адреса: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 15
! style="text-align: center;"| 14
! style="text-align: center;"| 13
! style="text-align: center;"| 12
! style="text-align: center;"| 11
! style="text-align: center;"| 10
! style="text-align: center;"| 9
! style="text-align: center;"| 8
! style="text-align: center;"| 7
! style="text-align: center;"| 6
! style="text-align: center;"| 5
! style="text-align: center;"| 4
! style="text-align: center;"| 3
! style="text-align: center;"| 2
! style="text-align: center;"| 1
! style="text-align: center;"| 0
|-
| style="text-align: left;"| CAPLVL
| style="text-align: left;"| CAPOV
| colspan="4" style="text-align: center;"| Резерв
| style="text-align: left;"| CKD[1:0]
| style="text-align: left;"| DLYVLU[8:0]
| style="text-align: left;"| ARPE
| colspan="2" style="text-align: center;"| CMS[1:0]
| style="text-align: left;"| DIR
| style="text-align: left;"| OPM
| style="text-align: left;"| URS
| style="text-align: left;"| UDIS
| style="text-align: left;"| CEN
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| rowspan="4" style="text-align: center;"| [15]
| rowspan="4" style="text-align: center;"| CAPLVL
| rowspan="4" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| В режиме захвата по обоим фронтам включен индикатор уровня захвата
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключение функции индикации
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включение функции индикации
|-
| colspan="2" style="text-align: left;"| ''Примечание: При включении, бит [16] регистра CHxCVR указывает уровень, соответствующий захваченному значению''
|-
| rowspan="3" style="text-align: center;"| [14]
| rowspan="3" style="text-align: center;"| CAPOV
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Конфигурация режима значения захвата
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Значением захвата является текущее значение счетчика
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Значение CHxCVR равно 0xFFFF, когда переполнение счетчика генерируется до момента захвата
|-
| style="text-align: center;"| [13:10]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="5" style="text-align: center;"| [9:8]
| rowspan="5" style="text-align: center;"| CKD[1:0]
| rowspan="5" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Эти два бита определяют коэффициент деления между частотой тактовой частоты таймера (CK_INT), временем мертвого состояния и тактовой частотой выборки, используемой генератором мертвого времени и цифровым фильтром (ETR, TIx)
| rowspan="5" style="text-align: center;"| 0
|-
| style="text-align: right;"| 00:
| style="text-align: left;"| Tdts=Tck_int
|-
| style="text-align: right;"| 01:
| style="text-align: left;"| Tdts=Tck_int x 2
|-
| style="text-align: right;"| 10:
| style="text-align: left;"| Tdts=Tck_int x 4
|-
| style="text-align: right;"| 11:
| style="text-align: left;"| Зарезервировано
|-
| rowspan="3" style="text-align: center;"| [7]
| rowspan="3" style="text-align: center;"| ARPE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Разряд разрешения предзагрузки авто перезагрузки
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Разрешает регистр автоматического значения перезагрузки (ATRLR)
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Регистр автоматического значения перезагрузки (ATRLR) отключен
|-
| rowspan="6" style="text-align: center;"| [6:5]
| rowspan="6" style="text-align: center;"| CMS[1:0]
| rowspan="6" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Выбор режима центрального выравнивания временем мертвого состояния и тактовой частотой выборки, используемой генератором мертвого времени и цифровым фильтром (ETR, TIx)
| rowspan="6" style="text-align: center;"| 0
|-
| style="text-align: right;"| 00:
| style="text-align: left;"| Режим выравнивания по краю. Счетчик считает вверх или вниз на основе бита направления (DIR)
|-
| style="text-align: right;"| 01:
| style="text-align: left;"| Центральный режим выравнивания 1. Счетчик попеременно считает вверх и вниз. Флаг прерывания сравнения выхода канала, настроенного как выход (CCxS = 00 в регистре CHCTLRx), устанавливается только тогда, когда счетчик считает вниз
|-
| style="text-align: right;"| 10:
| style="text-align: left;"| Центральный режим выравнивания 2. Счетчик попеременно считает вверх и вниз. Флаг прерывания сравнения выхода канала, настроенного как выход (CCxS = 00 в регистре CHCTLRx), устанавливается только тогда, когда счетчик считает вверх
|-
| style="text-align: right;"| 11:
| style="text-align: left;"| Центральный режим выравнивания 3. Счетчик попеременно считает вверх и вниз. Флаг прерывания сравнения выхода канала, настроенного как выход (CCxS = 00 в регистре CHCTLRx), устанавливается как при счете вверх, так и при счете вниз
|-
| colspan="2" style="text-align: left;"| ''Примечание: Когда счетчик включен (CEN = 1), переход от режима выравнивания по краю к центрально выровненному режиму не допускается.''
|-
| rowspan="4" style="text-align: center;"| [4]
| rowspan="4" style="text-align: center;"| DIR
| rowspan="4" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Направление счета
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Режим счета счетчика инкрементальный
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Режим счёта счётчика десятичный
|-
| colspan="2" style="text-align: left;"| ''Примечание: Этот бит недействителен, когда счетчик настроен в режиме центрального выравнивания или режиме энкодера.''
|-
| rowspan="3" style="text-align: center;"| [3]
| rowspan="3" style="text-align: center;"| OPM
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Режим одиночного импульса
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Счётчик останавливается (сбрасывая бит CEN) при наступлении следующего события обновления
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Счетчик не останавливается при наступлении следующего события обновления
|-
| rowspan="3" style="text-align: center;"| [2]
| rowspan="3" style="text-align: center;"| URS
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Источник запроса на обновление, которым программное обеспечение выбирает источник события UEV
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Если разрешено прерывание обновления или запрос DMA, то прерывание обновления или запрос DMA генерируются только в случае переполнения/недополнения счетчика
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Если включено прерывание обновления или запрос DMA, прерывание обновления или запрос DMA могут быть вызваны любым из следующих событий:<br />
- Переполнение/недополонение счетчика<br />
- Установка позиции UG<br />
- Обновления, генерируемые в режиме ведомого устройства
|-
| rowspan="3" style="text-align: center;"| [1]
| rowspan="3" style="text-align: center;"| UDIS
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Отключение обновлений, программное обеспечение разрешает/запрещает генерацию событий UEV с помощью этого бита
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| UEV отключено. Никакое событие обновления не генерируется, и регистры (ARR, PSC, CCRx) сохраняют свои значения. Если установлен бит UG или аппаратный сброс выдан контроллером режима, счетчики и предварительный делитель сбрасываются
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| UEV разрешено. События обновления (UEV) генерируются одним из следующих событий:<br />
- Переполнение/недолив счетчика<br />
- Установка положения UG<br />
- Обновления, управляемые ведомым режимом<br />
Регистры с кэшированием загружают свои предварительно загруженные значения
|-
| rowspan="4" style="text-align: center;"| [0]
| rowspan="4" style="text-align: center;"| CEN
| rowspan="4" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Включение счетчика
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включить счетчик
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Выключить счетчик
|-
| colspan="2" style="text-align: left;"| ''Примечание: Внешний тактовый сигнал, режим с пропусканием тактов и режим энкодера не будут работать до тех пор, пока бит CEN не будет установлен программным обеспечением. Режим триггера может автоматически установить бит CEN аппаратно''
|}

<span id="регистр-управления-2-tim1_ctlr2"></span>
=== 10.4.2 Регистр управления 2 (TIM1_CTLR2)  ===

Смещение адреса: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 15
! style="text-align: center;"| 14
! style="text-align: center;"| 13
! style="text-align: center;"| 12
! style="text-align: center;"| 11
! style="text-align: center;"| 10
! style="text-align: center;"| 9
! style="text-align: center;"| 8
! style="text-align: center;"| 7
! style="text-align: center;"| 6
! style="text-align: center;"| 5
! style="text-align: center;"| 4
! style="text-align: center;"| 3
! style="text-align: center;"| 2
! style="text-align: center;"| 1
! style="text-align: center;"| 0
|-
| style="text-align: left;"| Рез.
| style="text-align: left;"| OIS4
| style="text-align: left;"| OIS3N
| style="text-align: left;"| OIS3
| style="text-align: left;"| OIS2N
| style="text-align: left;"| OIS2
| style="text-align: left;"| OIS1N
| style="text-align: left;"| OIS1
| style="text-align: left;"| TI1S
| colspan="3" style="text-align: center;"| MMS[2:0]
| style="text-align: left;"| CCDS
| style="text-align: left;"| CCUS
| style="text-align: left;"| Рез.
| style="text-align: left;"| CCPC
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [15]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="4" style="text-align: center;"| [14]
| rowspan="4" style="text-align: center;"| OIS4
| rowspan="4" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Состояние покоя вывода 4
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Когда MOE=0, если реализован OC4N, OC4=1 после мёртвой зоны
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Когда MOE=0, если реализован OC4N, OC4=0 после мёртвой зоны
|-
| colspan="2" style="text-align: left;"| ''Примечание: Этот бит нельзя изменить после того, как установлено значение блокировки (регистр TIMx_BDTR) уровня 1, 2 или 3''
|-
| rowspan="4" style="text-align: center;"| [13]
| rowspan="4" style="text-align: center;"| OIS3N
| rowspan="4" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Состояние покоя вывода 3
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Когда MOE = 0, OC3N = 1 после мертвой зоны
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Когда MOE = 0, OC3N = 0 после мертвой зоны
|-
| colspan="2" style="text-align: left;"| ''Примечание: Этот бит невозможно изменить после установки уровня блокировки (регистр TIMx_BDTR) 1, 2 или 3.''
|-
| style="text-align: center;"| [12]
| style="text-align: center;"| OIS3
| style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Состояние покоя вывода 3 аналогично состоянию покоя вывода 4 (OIS4).
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [11]
| style="text-align: center;"| OIS2N
| style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Состояние покоя вывода 2 аналогично состоянию покоя вывода 3 (OIS3N).
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [10]
| style="text-align: center;"| OIS2
| style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Состояние покоя вывода 2 аналогично состоянию покоя вывода 4 (OIS4).
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [9]
| style="text-align: center;"| OIS1N
| style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Состояние покоя вывода 1 аналогично состоянию покоя вывода 3 (OIS3N).
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [8]
| style="text-align: center;"| OIS1
| style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Состояние покоя вывода 1 аналогично состоянию покоя вывода 4 (OIS4).
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [7]
| rowspan="3" style="text-align: center;"| TI1S
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Выбор TI1
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Выводы TIMx_CH1, TIMx_CH2 и TIMx_CH3 подключены ко входу TI1 после гетеродинирования
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Выход TIMx_CH1 напрямую подключён ко входу TI1
|-
| rowspan="9" style="text-align: center;"| [6:4]
| rowspan="9" style="text-align: center;"| MMS[2:0]
| rowspan="9" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Выбор главного режима: Эти 3 бита используются для выбора информации о синхронизации (TRGO), отправляемой подчиненному таймеру в главном режиме. Возможные комбинации следующие.
| rowspan="9" style="text-align: center;"| 0
|-
| style="text-align: right;"| 000:
| style="text-align: left;"| Бит UG регистра сброса TIMx_EGR используется в качестве выходного сигнала триггера (TRGO). В случае сброса, вызванного входным сигналом триггера (от контроллера режима в режиме сброса), существует задержка в сигнале на TRGO относительно реального сброса.
|-
| style="text-align: right;"| 001:
| style="text-align: left;"| Разрешение - Сигнал включения счетчика CNT_EN используется в качестве выходного триггерного сигнала (TRGO). Иногда требуется одновременно запустить несколько таймеров или управлять включением таймеров в течение некоторого периода времени. Сигнал разрешения счетчика формируется логическим ИЛИ сигнала входа триггера в управляющем бите CEN и режиме пропуска. Когда сигнал разрешения счетчика управляется входным триггером, возникает задержка на TRGO, если не выбран главный/подчиненный режим (см. описание бита MSM в регистре TIMx_SMCR).
|-
| style="text-align: right;"| 010:
| style="text-align: left;"| Обновление - Событие обновления выбирается в качестве входного триггерного сигнала (TRGO). Например, часы основного таймера могут использоваться в качестве предварительного делителя для подчиненного таймера.
|-
| style="text-align: right;"| 011:
| style="text-align: left;"| Импульс сравнения - при возникновении захвата или успешного сравнения, когда флаг CC1IF должен быть установлен (даже если он уже высок), выходной триггер посылает положительный импульс (TRGO).
|-
| style="text-align: right;"| 100:
| style="text-align: left;"| Сигнал сравнения-OC1REF используется в качестве выходного тригга (TRGO).
|-
| style="text-align: right;"| 101:
| style="text-align: left;"| Сигнал сравнения-OC2REF используется в качестве выходного тригтера (TRGO).
|-
| style="text-align: right;"| 110:
| style="text-align: left;"| Сигнал сравнения-OC3REF используется в качестве выходного тригтерного сигнала (TRGO).
|-
| style="text-align: right;"| 111:
| style="text-align: left;"| Сигнализация сравнения-OC4REF используется как выходной тригерный сигнал (TRGO).
|-
| rowspan="3" style="text-align: center;"| [3]
| rowspan="3" style="text-align: center;"| CCDS
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Выбор захвата DMA для сравнения
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Отправка запроса DMA для CHxCVR при возникновении события обновления.
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Генерировать запрос DMA для CHxCVR, когда происходит CHxCVR.
|-
| rowspan="4" style="text-align: center;"| [2]
| rowspan="4" style="text-align: center;"| CCUS
| rowspan="4" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Биты выбора управления сравнением захвата обновления
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Если CCPC установлен, их можно обновить, установив бит COM или нарастающим фронтом на TRGI.
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Если установлен CCPC, они могут быть обновлены только путем установки бита COM.
|-
| colspan="2" style="text-align: left;"| ''Примечание: Этот бит работает только для каналов с дополнительными выходами.''
|-
| style="text-align: center;"| [1]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="4" style="text-align: center;"| [0]
| rowspan="4" style="text-align: center;"| CCPC
| rowspan="4" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Биты управления предварительным загрузчиком сравнения захвата.
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Биты CCxE, CCxNE и OCxM предварительно загружены, и при установке этого бита они обновляются только при установке бита COM.
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Биты CCxE, CCxNE и OCxM не являются предварительно загруженными.
|-
| colspan="2" style="text-align: left;"| ''Примечание: Этот бит работает только для каналов с дополнительными выходами.''
|}

<span id="регистр-управления-режимом-ведомого-устройства-tim1_smcfgr"></span>
=== 10.4.3 Регистр управления режимом ведомого устройства (TIM1_SMCFGR)  ===

Смещение адреса: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 15
! style="text-align: center;"| 14
! style="text-align: center;"| 13
! style="text-align: center;"| 12
! style="text-align: center;"| 11
! style="text-align: center;"| 10
! style="text-align: center;"| 9
! style="text-align: center;"| 8
! style="text-align: center;"| 7
! style="text-align: center;"| 6
! style="text-align: center;"| 5
! style="text-align: center;"| 4
! style="text-align: center;"| 3
! style="text-align: center;"| 2
! style="text-align: center;"| 1
! style="text-align: center;"| 0
|-
| style="text-align: left;"| ETP
| style="text-align: left;"| ECE
| colspan="2" style="text-align: center;"| ETPS[1:0]
| colspan="4" style="text-align: center;"| ETF[3:0]
| style="text-align: left;"| MSM
| colspan="3" style="text-align: center;"| TS[2:0]
| style="text-align: left;"| Рез.
| colspan="3" style="text-align: center;"| SMS[2:0]
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| rowspan="3" style="text-align: center;"| [15]
| rowspan="3" style="text-align: center;"| ETP
| rowspan="3" style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Выбор полярности триггера ETR: этот бит выбирает, подавать ли сигнал ETR напрямую или использовать его инвертированное значение
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Инвертировать ETR, активен при низком уровне или спаде
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Прямой сигнал ETR, активен при высоком уровне или нарастающем фронте
|-
| rowspan="4" style="text-align: center;"| [14]
| rowspan="4" style="text-align: center;"| ECE
| rowspan="4" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Выбор включения внешнего тактового режима 2
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включает внешний тактовый режим 2
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключает внешний тактовый режим 2
|-
| colspan="2" style="text-align: left;"| '''''Примечание 1''': Режим ведомого устройства может использоваться одновременно с внешним тактовым режимом 2: режим сброса, режим с шиной и режим запуска; однако, в этом случае TRGI не может быть подключено к ETRF (бит TS не может иметь значение '111').<br />
'''Примечание 2''': Когда включены оба внешних тактовых режима 1 и 2, вход внешнего тактового сигнала будет ETRF.''
|-
| rowspan="5" style="text-align: center;"| [13:12]
| rowspan="5" style="text-align: center;"| ETPS[1:0]
| rowspan="5" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Внешний сигнал запуска (ETRP) делит частоту этого сигнала, которая не может превышать максимум 1/4 частоты TIMxCLK, и может быть преобразована через эту область
| rowspan="5" style="text-align: center;"| 0
|-
| style="text-align: right;"| 00:
| style="text-align: left;"| Делитель отключён
|-
| style="text-align: right;"| 01:
| style="text-align: left;"| Частота ETRP делится на 2
|-
| style="text-align: right;"| 10:
| style="text-align: left;"| Частота ETRP делится на 4
|-
| style="text-align: right;"| 11:
| style="text-align: left;"| Частота ETRP делится на 8
|-
| rowspan="16" style="text-align: center;"| [11:8]
| rowspan="16" style="text-align: center;"| ETF[3:0]
| rowspan="16" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Фильтрация с внешней синхронизацией фактически представляет собой счетчик событий, который использует определенную частоту дискретизации для регистрации до N событий, а затем генерирует скачок на выходе.
| rowspan="16" style="text-align: center;"| 0
|-
| style="text-align: left;"| 0001:
| style="text-align: left;"| частота дискретизации Fsampling = Fck_int, N = 2
|-
| style="text-align: left;"| 0010:
| style="text-align: left;"| частота дискретизации Fsampling = Fck_int, N = 4
|-
| style="text-align: left;"| 0011:
| style="text-align: left;"| частота дискретизации Fsampling = Fck_int, N = 8
|-
| style="text-align: left;"| 0100:
| style="text-align: left;"| частота дискретизации Fsampling = Fdts / 2, N = 6
|-
| style="text-align: left;"| 0101:
| style="text-align: left;"| частота дискретизации Fsampling = Fdts / 2, N = 8
|-
| style="text-align: left;"| 0110:
| style="text-align: left;"| частота дискретизации Fsampling = Fdts / 4, N = 6
|-
| style="text-align: left;"| 0111:
| style="text-align: left;"| частота дискретизации Fsampling = Fdts / 4, N = 8
|-
| style="text-align: left;"| 1000:
| style="text-align: left;"| частота дискретизации Fsampling = Fdts / 8, N = 6
|-
| style="text-align: left;"| 1001:
| style="text-align: left;"| частота дискретизации Fsampling = Fdts / 8, N = 8
|-
| style="text-align: left;"| 1010:
| style="text-align: left;"| частота дискретизации Fsampling = Fdts / 16, N = 5
|-
| style="text-align: left;"| 1011:
| style="text-align: left;"| частота дискретизации Fsampling = Fdts / 16, N = 6
|-
| style="text-align: left;"| 1100:
| style="text-align: left;"| частота дискретизации Fsampling = Fdts / 16, N = 8
|-
| style="text-align: left;"| 1101:
| style="text-align: left;"| частота дискретизации Fsampling = Fdts / 32, N = 5
|-
| style="text-align: left;"| 1110:
| style="text-align: left;"| частота дискретизации Fsampling = Fdts / 32, N = 6
|-
| style="text-align: left;"| 1111:
| style="text-align: left;"| частота дискретизации Fsampling = Fdts / 32, N = 8
|-
| rowspan="3" style="text-align: center;"| [7]
| rowspan="3" style="text-align: center;"| MSM
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Выбор режима ведущий/ведомый
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Событие на входе запуска (TRGI) задерживается, чтобы обеспечить идеальную синхронизацию между текущим таймером (через TRGO) и его подчиненным таймером. Это полезно, когда требуется синхронизация нескольких таймеров с одним внешним событием
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Не функционирует
|-
| rowspan="10" style="text-align: center;"| [6:4]
| rowspan="10" style="text-align: center;"| TS[2:0]
| rowspan="10" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Поле выбора триггера, эти 3 бита выбирают источник триггерного входа, используемый для синхронизации счетчика.
| rowspan="10" style="text-align: center;"| 0
|-
| style="text-align: right;"| 000:
| style="text-align: left;"| Внутренний триггер 0 (ITR0)
|-
| style="text-align: right;"| 001:
| style="text-align: left;"| Внутренний триггер 1 (ITR1)
|-
| style="text-align: right;"| 010:
| style="text-align: left;"| Внутренний триггер 2 (ITR2)
|-
| style="text-align: right;"| 011:
| style="text-align: left;"| Внутренний триггер 3 (ITR3)
|-
| style="text-align: right;"| 100:
| style="text-align: left;"| Детектор фронтов TI1 (TI1F_ED)
|-
| style="text-align: right;"| 101:
| style="text-align: left;"| Фильтрованный вход таймера 1 (TI1FP1)
|-
| style="text-align: right;"| 110:
| style="text-align: left;"| Фильтрованный вход таймера 2 (TI2FP2)
|-
| style="text-align: right;"| 111:
| style="text-align: left;"| Внешний вход триггера (ETRF)
|-
| colspan="2" style="text-align: left;"| Изменения происходят только тогда, когда SMS равен 0.<br />
''Примечание: Подробные сведения см. в таблице 10-2.''
|-
| style="text-align: center;"| [3]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="9" style="text-align: center;"| [2:0]
| rowspan="9" style="text-align: center;"| SMS[2:0]
| rowspan="9" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Поле выбора режима ввода. Выбирает режим работы часов и триггера основного счетчика.
| rowspan="9" style="text-align: center;"| 0
|-
| style="text-align: right;"| 000:
| style="text-align: left;"| работает от внутреннего тактового сигнала CK_INT.
|-
| style="text-align: right;"| 001:
| style="text-align: left;"| режим энкодера 1, где основной счетчик увеличивает или уменьшает счет при переходе TI2FP2 в зависимости от уровня TI1FP1.
|-
| style="text-align: right;"| 010:
| style="text-align: left;"| режим энкодера 2, где основной счетчик увеличивает или уменьшает счет при переходе TI1FP1 в зависимости от уровня TI2FP2.
|-
| style="text-align: right;"| 011:
| style="text-align: left;"| режим энкодера 3, где основной счетчик увеличивает и уменьшает счет на переходах TI1FP1 и TI2FP2 в зависимости от уровня другого сигнала.
|-
| style="text-align: right;"| 100:
| style="text-align: left;"| режим сброса, где нарастающий фронт триггерного входа (TRGI) инициализирует счетчик и генерирует сигнал для обновления регистров.
|-
| style="text-align: right;"| 101:
| style="text-align: left;"| режим с шиной, когда триггерный вход (TRGI) находится в высоком состоянии, часы счетчика включаются; когда триггерный вход становится низким, счетчик останавливается, и запуск и остановка счетчика контролируются.
|-
| style="text-align: right;"| 110:
| style="text-align: left;"| режим запуска, где счетчик начинается по нарастающему фронту триггерного входа TRGI, и контролируется только начало счета.
|-
| style="text-align: right;"| 111:
| style="text-align: left;"| Внешний тактовый режим 1, нарастающий фронт выбранного триггерного входа (TRGI) управляет счетчиком.
|}

'''10.4.4 Регистр разрешения DMA/прерывания (TIM1_DMAINTENR)'''

Смещение адреса: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 15
! style="text-align: center;"| 14
! style="text-align: center;"| 13
! style="text-align: center;"| 12
! style="text-align: center;"| 11
! style="text-align: center;"| 10
! style="text-align: center;"| 9
! style="text-align: center;"| 8
! style="text-align: center;"| 7
! style="text-align: center;"| 6
! style="text-align: center;"| 5
! style="text-align: center;"| 4
! style="text-align: center;"| 3
! style="text-align: center;"| 2
! style="text-align: center;"| 1
! style="text-align: center;"| 0
|-
| style="text-align: left;"| Рез.
| style="text-align: left;"| TDE
| style="text-align: left;"| COMDE
| style="text-align: left;"| CC4DE
| style="text-align: left;"| CC3DE
| style="text-align: left;"| CC2DE
| style="text-align: left;"| CC1DE
| style="text-align: left;"| UDE
| style="text-align: left;"| BIE
| style="text-align: left;"| TIE
| style="text-align: left;"| COMIE
| style="text-align: left;"| CC4IE
| style="text-align: left;"| CC3IE
| style="text-align: left;"| CC2IE
| style="text-align: left;"| CC1IE
| style="text-align: left;"| UIE
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [15]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [12]
| rowspan="3" style="text-align: center;"| TDE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Установка бита разрешения запроса DMA
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Разрешить генерацию запросов DMA
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Генерация запросов DMA отключена
|-
| rowspan="3" style="text-align: center;"| [13]
| rowspan="3" style="text-align: center;"| COMDE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит разрешения запроса DMA для COM
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Разрешены запросы DMA для COM
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Запросы DMA для COM отключены
|-
| rowspan="3" style="text-align: center;"| [12]
| rowspan="3" style="text-align: center;"| CC2DE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит разрешения DMA для канала 2 захвата сравнеия
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Разрешено сравнение запросов DMA для канала захвата 2
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Сравнение запросов DMA для канала захвата 2 запрещено
|-
| rowspan="3" style="text-align: center;"| [11]
| rowspan="3" style="text-align: center;"| CC3DE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит разрешения DMA для канала 3 захвата сравнеия
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Разрешено сравнение запросов DMA для канала захвата 3
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Сравнение запросов DMA для канала захвата 3 запрещено
|-
| rowspan="3" style="text-align: center;"| [10]
| rowspan="3" style="text-align: center;"| CC2DE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит разрешения DMA для канала 2 захвата сравнеия
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Разрешено сравнение запросов DMA для канала захвата 2
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Сравнение запросов DMA для канала захвата 2 запрещено
|-
| rowspan="3" style="text-align: center;"| [9]
| rowspan="3" style="text-align: center;"| CC1DE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит разрешения DMA для канала 1 захвата сравнеия
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Разрешено сравнение запросов DMA для канала захвата 1
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Сравнение запросов DMA для канала захвата 1 запрещено
|-
| rowspan="3" style="text-align: center;"| [8]
| rowspan="3" style="text-align: center;"| UDE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Обновлен бит разрешения запроса DMA
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Разрешены обновления через DMA-запросы
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Обновления через DMA-запросы отключены
|-
| rowspan="3" style="text-align: center;"| [7]
| rowspan="3" style="text-align: center;"| BIE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит разрешения тормоза прерывания
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Разрешить прерывание тормозов
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Прерывание тормозов запрещено
|-
| rowspan="3" style="text-align: center;"| [6]
| rowspan="3" style="text-align: center;"| TIE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит разрешения прерывания
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Включить возможность вызова прерываний
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Вызов прерываний отключен
|-
| rowspan="3" style="text-align: center;"| [5]
| rowspan="3" style="text-align: center;"| COMIE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит разрешения прерывания COM
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Разрешить прерывания COM
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Прерывания COM отключены
|-
| rowspan="3" style="text-align: center;"| [4]
| rowspan="3" style="text-align: center;"| CC4IE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит разрешения прерывания для канала сравнения-захвата 4
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Разрешить сравнение прерываний для канала захвата 4
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключить сравнение прерываний для канала захвата 4
|-
| rowspan="3" style="text-align: center;"| [3]
| rowspan="3" style="text-align: center;"| CC3IE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит разрешения прерывания для канала сравнения-захвата 3
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Разрешить сравнение прерываний для канала захвата 3
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключить сравнение прерываний для канала захвата 3
|-
| rowspan="3" style="text-align: center;"| [2]
| rowspan="3" style="text-align: center;"| CC2IE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит разрешения прерывания для канала сравнения-захвата 2
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Разрешить сравнение прерываний для канала захвата 2
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключить сравнение прерываний для канала захвата 2
|-
| rowspan="3" style="text-align: center;"| [1]
| rowspan="3" style="text-align: center;"| CC1IE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит разрешения прерывания для канала сравнения-захвата 1
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Разрешить сравнение прерываний для канала захвата 1
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключить сравнение прерываний для канала захвата 1
|-
| rowspan="3" style="text-align: center;"| [0]
| rowspan="3" style="text-align: center;"| UIE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Обновите бит разрешения прерывания
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Разрешить прерывание обновлений
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Прерывание обновлений отключено
|}

<span id="регистр-статуса-прерывания-tim1_intfr"></span>
=== 10.4.5 Регистр статуса прерывания (TIM1_INTFR) ===

Смещение адреса: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 15
! style="text-align: center;"| 14
! style="text-align: center;"| 13
! style="text-align: center;"| 12
! style="text-align: center;"| 11
! style="text-align: center;"| 10
! style="text-align: center;"| 9
! style="text-align: center;"| 8
! style="text-align: center;"| 7
! style="text-align: center;"| 6
! style="text-align: center;"| 5
! style="text-align: center;"| 4
! style="text-align: center;"| 3
! style="text-align: center;"| 2
! style="text-align: center;"| 1
! style="text-align: center;"| 0
|-
| colspan="3" style="text-align: center;"| Рез.
| style="text-align: left;"| CC4OF
| style="text-align: left;"| CC3OF
| style="text-align: left;"| CC2OF
| style="text-align: left;"| CC1OF
| style="text-align: left;"| Рез.
| style="text-align: left;"| BIF
| style="text-align: left;"| TIF
| style="text-align: left;"| COMIF
| style="text-align: left;"| CC4IF
| style="text-align: left;"| CC3IF
| style="text-align: left;"| CC2IF
| style="text-align: left;"| CC1IF
| style="text-align: left;"| UIF
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [15:13]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [12]
| style="text-align: center;"| CC4OF
| style="text-align: center;"| RW0
| colspan="2" style="text-align: left;"| Захват/сравнение 4 флага переполнения захвата<br />
см. описание CC1OF
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [11]
| style="text-align: center;"| CC3OF
| style="text-align: center;"| RW0
| colspan="2" style="text-align: left;"| Захват/сравнение 3 флага переполнения захвата<br />
см. описание CC1OF
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [10]
| style="text-align: center;"| CC2OF
| style="text-align: center;"| RW0
| colspan="2" style="text-align: left;"| Захват/сравнение 2 флага переполнения захвата<br />
см. описание CC1OF
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [9]
| rowspan="3" style="text-align: center;"| CC1OF
| rowspan="3" style="text-align: center;"| RW0
| colspan="2" style="text-align: left;"| Флаг переполнения захвата 1Этот флаг устанавливается только аппаратным обеспечением, когда соответствующий канал настроен в режиме захвата входного сигнала. Он сбрасывается программно путем записи в него значения '0'
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Значение счетчика было захвачено в регистре TIMx_CCR1, в то время как флаг CC1IF уже был установлен
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Переполнение не обнаружено
|-
| style="text-align: center;"| [8]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [7]
| rowspan="3" style="text-align: center;"| BIF
| rowspan="3" style="text-align: center;"| RW0
| colspan="2" style="text-align: left;"| Бит флага прерывания тормоза, после того как сигнал на входе тормоза становится действительным, может быть очищен программно
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| На входе тормозной шины обнаружен допустимый уровень сигнала
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Событие торможения не генерируется
|-
| rowspan="3" style="text-align: center;"| [6]
| rowspan="3" style="text-align: center;"| TIF
| rowspan="3" style="text-align: center;"| RW0
| colspan="2" style="text-align: left;"| Бит флага прерывания триггера, при возникновении события триггера, устанавливается аппаратно для этого бита и может быть очищен программно. События триггера включают обнаружение допустимого фронта на входе TRGI в любом режиме, кроме режима с шлюзованием (gated), либо любого фронта в шлюзуемом режиме
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Генерация события триггера
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Событие триггера не генерируется.
|-
| rowspan="3" style="text-align: center;"| [5]
| rowspan="3" style="text-align: center;"| COMIF
| rowspan="3" style="text-align: center;"| RW0
| colspan="2" style="text-align: left;"| Бит флага прерывания COM: этот бит устанавливается аппаратно и сбрасывается программно после генерации события COM. События COM, включая обновления CCxE, CCxNE, OCxM, происходят
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Генерация события COM
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Событие COM не генерируется.
|-
| style="text-align: center;"| [4]
| style="text-align: center;"| CC4IF
| style="text-align: center;"| RW0
| colspan="2" style="text-align: left;"| Флаг прерывания захвата/сравнения 4<br />
смотри описание CC1IF
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [3]
| style="text-align: center;"| CC3IF
| style="text-align: center;"| RW0
| colspan="2" style="text-align: left;"| Флаг прерывания захвата/сравнения 3<br />
смотри описание CC1IF
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [2]
| style="text-align: center;"| CC2IF
| style="text-align: center;"| RW0
| colspan="2" style="text-align: left;"| Флаг прерывания захвата/сравнения 2<br />
смотри описание CC1IF
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [1]
| rowspan="3" style="text-align: center;"| CC1IF
| rowspan="3" style="text-align: center;"| RW0
| colspan="2" style="text-align: left;"| Флаг прерывания захвата/сравнения 1<br />
Если канал CC1 настроен как выход: Этот флаг устанавливается аппаратно, когда значение счетчика совпадает со значением сравнения, за исключением некоторых случаев в центре-ориентированном режиме (см. описание битов CMS в регистре TIMx_CR1). Он сбрасывается программно. 0: Нет совпадений. 1: Содержимое счетчика TIMx_CNT соответствует содержимому регистра TIMx_CCR1. Когда содержимое TIMx_CCR1 больше содержимого TIMx_ARR, бит CC1IF устанавливается на переполнении счетчика (в режимах прямого счета и счета вверх/вниз) или при его уменьшении до нуля (в режиме обратного счета).<br />
Если канал CC1 настроен как вход: Этот бит устанавливается аппаратно при захвате. Он сбрасывается программно или при чтении регистра TIMx_CCR1
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Значение счетчика было захвачено в регистр TIMx_CCR1 (Обнаружен фронт на IC1, который соответствует выбранной полярности)
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Захвата входного сигнала не произошло
|-
| rowspan="3" style="text-align: center;"| [0]
| rowspan="3" style="text-align: center;"| UIF
| rowspan="3" style="text-align: center;"| RW0
| colspan="2" style="text-align: left;"| Бит флага прерывания обновления: этот бит устанавливается аппаратно, когда происходит событие обновления, и сбрасывается программно
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Прерывание по обновлению произошло
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Событие обновления не произошло. Следующие сценарии вызывают события обновления:<br />
Если UDIS = 0, когда значение повторяющего счетчика переполняется или уменьшается до нуля.<br />
Если URS = 0 и UDIS = 0, когда устанавливается бит UG, или когда основной счетчик перезапускается программно.<br />
Если URS = 0 и UDIS = 0, когда счетчик CNT перезагружается событием триггера.
|}

<span id="регистр-генерации-событий-tim1_swevgr"></span>
=== 10.4.6 Регистр генерации событий (TIM1_SWEVGR) ===

Смещение адреса: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 15
! style="text-align: center;"| 14
! style="text-align: center;"| 13
! style="text-align: center;"| 12
! style="text-align: center;"| 11
! style="text-align: center;"| 10
! style="text-align: center;"| 9
! style="text-align: center;"| 8
! style="text-align: center;"| 7
! style="text-align: center;"| 6
! style="text-align: center;"| 5
! style="text-align: center;"| 4
! style="text-align: center;"| 3
! style="text-align: center;"| 2
! style="text-align: center;"| 1
! style="text-align: center;"| 0
|-
| colspan="8" style="text-align: center;"| Рез.
| style="text-align: left;"| BG
| style="text-align: left;"| TG
| style="text-align: left;"| COMG
| style="text-align: left;"| CC4G
| style="text-align: left;"| CC3G
| style="text-align: left;"| CC2G
| style="text-align: left;"| CC1G
| style="text-align: left;"| UG
|}

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| style="text-align: center;"| [15:8]
| style="text-align: center;"| Res
| style="text-align: center;"| RO
| colspan="2" style="text-align: left;"| Резерв
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [7]
| rowspan="3" style="text-align: center;"| BG
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| Бит генерации события торможения, устанавливаемый и сбрасываемый программно, используется для генерации события торможения
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| енерирует событие торможения. В этом случае MOE=0, BIF=1; если соответствующие прерывание и DMA включены, генерируются соответствующие прерывание и DMA
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Без действия
|-
| rowspan="3" style="text-align: center;"| [6]
| rowspan="3" style="text-align: center;"| TG
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| Бит генерации события триггера, устанавливаемый программно и сбрасываемый аппаратно, используется для генерации события триггера
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Генерирует событие триггера, TIF устанавливается, и соответствующие прерывания и DMA генерируются, если они разрешены
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Без действия
|-
| rowspan="4" style="text-align: center;"| [5]
| rowspan="4" style="text-align: center;"| COMG
| rowspan="4" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| Бит генерации обновления управления сравнением и захватом. Генерирует событие обновления управления сравнением и захватом. Этот бит устанавливается программно и автоматически сбрасывается аппаратно
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| когда CCPC = 1, разрешить обновление битов CCxE, CCxNE, OCxM
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Без действия
|-
| colspan="2" style="text-align: left;"| ''Примечание: Этот бит актуален только для каналов с дополнительными выходами (каналы 1, 2, 3)''
|-
| style="text-align: center;"| [4]
| style="text-align: center;"| CC4G
| style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| Бит генерации события сравнения-захвата 4. Генерирует событие сравнения-захвата 4
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [3]
| style="text-align: center;"| CC3G
| style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| Бит генерации события сравнения-захвата 3. Генерирует событие сравнения-захвата 3
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [2]
| style="text-align: center;"| CC2G
| style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| Бит генерации события сравнения-захвата 2. Генерирует событие сравнения-захвата 2
| style="text-align: center;"| 0
|-
| rowspan="3" style="text-align: center;"| [1]
| rowspan="3" style="text-align: center;"| CC1G
| rowspan="3" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| Бит генерации события сравнения-захвата 1. Генерирует событие сравнения-захвата 1.<br />
Этот бит устанавливается программно и сбрасывается аппаратно. Он используется для генерации события сравнения-захвата.
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Генерирует событие сравнения-захвата на канале сравнения-захвата 1. Если канал сравнения-захвата 1 настроен как выходной: Устанавливает бит CC1IF. Генерирует соответствующие прерывания и DMA, если они включены. Если канал сравнения-захвата 1 настроен как входной: Текущее значение основного счетчика захватывается в регистр сравнения-захвата 1; устанавливает бит CC1IF для генерации соответствующих прерываний и DMA, если они включены; если CC1IF уже установлен, устанавливает бит CC1OF
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Без действия
|-
| rowspan="4" style="text-align: center;"| [0]
| rowspan="4" style="text-align: center;"| UG
| rowspan="4" style="text-align: center;"| WO
| colspan="2" style="text-align: left;"| Бит генерации события обновления для создания события обновления. Этот бит устанавливается программно и автоматически сбрасывается аппаратно
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Инициализировать счетчик и создать событие обновления
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Без действия
|-
| colspan="2" style="text-align: left;"| ''Примечание: Предделительный счетчик также обнуляется, но коэффициент предделителя остается неизменным. Основной счетчик сбрасывается, если он находится в центросимметричном режиме или инкрементном режиме подсчета; если в декрементном режиме подсчета, основной счетчик принимает значение регистра перезагрузки.''
|}

<span id="регистр-управления-сравнениемзахватом-1-tim1_chctlr1"></span>
=== 10.4.7 Регистр управления сравнением/захватом 1 (TIM1_CHCTLR1) ===

Смещение адреса: 0x00

{| class="wikitable"
|-
! style="text-align: center;"| 15
! style="text-align: center;"| 14
! style="text-align: center;"| 13
! style="text-align: center;"| 12
! style="text-align: center;"| 11
! style="text-align: center;"| 10
! style="text-align: center;"| 9
! style="text-align: center;"| 8
! style="text-align: center;"| 7
! style="text-align: center;"| 6
! style="text-align: center;"| 5
! style="text-align: center;"| 4
! style="text-align: center;"| 3
! style="text-align: center;"| 2
! style="text-align: center;"| 1
! style="text-align: center;"| 0
|-
| style="text-align: left;"| OC2CE
| colspan="3" style="text-align: center;"| OC2M[2:0]
| style="text-align: left;"| OC2PE
| style="text-align: left;"| OC2FE
| rowspan="2" colspan="2" style="text-align: center;"| CC2S[1:0]
| style="text-align: left;"| OC1CE
| colspan="3" style="text-align: center;"| OC1M[2:0]
| style="text-align: left;"| OC1PE
| style="text-align: left;"| OC1FE
| rowspan="2" colspan="2" style="text-align: center;"| CC1S[1:0]
|-
| colspan="4" style="text-align: center;"| IC2F[3:0]
| colspan="2" style="text-align: center;"| IC2PSC[1:0]
| colspan="4" style="text-align: center;"| IC1F[3:0]
| colspan="2" style="text-align: center;"| IC1PSC[1:0]
|}

Режим сравнения (пины используются как выходы)

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| rowspan="3" style="text-align: center;"| [15]
| rowspan="3" style="text-align: center;"| OC2CE
| rowspan="3" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит разрешения очистки канала сравнения-захвата 2
| rowspan="3" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Очищать бит OC2REF при обнаружении высокого уровня на входе ETRF
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Бит OC2REF не изменяется под воздействием входа ETRF
|-
| rowspan="10" style="text-align: center;"| [14:12]
| rowspan="10" style="text-align: center;"| OC2M[2:0]
| rowspan="10" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Поле настройки режима канала сравнения-захвата 2<br />
Эти 3 бита определяют действие сигнала опорного выхода OC2REF, который определяет значения сигналов OC2 и OC2N. Сигнал OC2REF активен высоким уровнем, а активные уровни сигналов OC2 и OC2N зависят от настроек битов CC2P и CC2NP
| rowspan="10" style="text-align: center;"| 0
|-
| style="text-align: right;"| 000:
| style="text-align: left;"| Заморозка. Сравнение значений регистра захвата с ядром счетчиков для OC2REF не работает.
|-
| style="text-align: right;"| 001:
| style="text-align: left;"| Принудительно установить на допустимом уровне. Принуждает OC2REF к высокому уровню, когда ядро счетчика имеет такое же значение, что и регистр сравнения-захвата 1.
|-
| style="text-align: right;"| 010:
| style="text-align: left;"| Принудительно установить на недопустимом уровне. Принуждает OC2REF к низкому уровню, когда значение ядра счетчика равно значению регистра сравнения-захвата 1.
|-
| style="text-align: right;"| 011:
| style="text-align: left;"| Переключение. Изменяет уровень OC2REF, когда значение ядра счетчика совпадает со значением регистра сравнения-захвата 1.
|-
| style="text-align: right;"| 100:
| style="text-align: left;"| Принудительно установить на недопустимом уровне. Принуждает OC2REF к низкому уровню.
|-
| style="text-align: right;"| 101:
| style="text-align: left;"| Принудительно установить на допустимом уровне. Принуждает OC2REF к высокому уровню.
|-
| style="text-align: right;"| 110:
| style="text-align: left;"| Режим ШИМ 1. При увеличении счетчика, канал 2 переходит на недопустимый уровень, когда значение ядра счетчика превышает значение регистра сравнения-захвата, иначе – на допустимый уровень; при уменьшении счетчика, канал 2 переходит на допустимый уровень, когда значение ядра счетчика превышает значение регистра сравнения-захвата, иначе – на недопустимый уровень.
|-
| style="text-align: right;"| 111:
| style="text-align: left;"| Режим ШИМ 2. При увеличении счетчика, канал 2 переходит на допустимый уровень, когда значение ядра счетчика превышает значение регистра сравнения-захвата, иначе – на недопустимый уровень; при уменьшении счетчика, канал 2 переходит на недопустимый уровень, когда значение ядра счетчика превышает значение регистра сравнения-захвата, иначе – на допустимый уровень (OC2REF=1).
|-
| colspan="2" style="text-align: left;"| ''Примечание: Эти биты нельзя изменить, если уровень блокировки (LOCK) установлен на 3, и CC2S=00b. В режиме ШИМ 1 или ШИМ 2 уровень OC2REF меняется только тогда, когда результат сравнения изменяется или при переключении из замороженного режима в режим ШИМ в режиме вывода сравнения.''
|-
| rowspan="4" style="text-align: center;"| [11]
| rowspan="4" style="text-align: center;"| OC2PE
| rowspan="4" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит разрешения предварительной загрузки регистра сравнения-захвата 2
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Разрешить функцию предварительной загрузки регистра сравнения-захвата 2. Операции чтения и записи работают только с регистрами предварительной загрузки. Предварительное значение регистра сравнения-захвата 2 загружается в текущий теневой регистр при наступлении события обновления
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Отключить функцию предварительной загрузки регистра сравнения-захвата 2. Регистр сравнения-захвата 2 можно записывать в любое время, и новое записанное значение вступает в силу немедленно
|-
| colspan="2" style="text-align: left;"| ''Примечание: После установки уровня блокировки (LOCK) на 3 и CC2S=00, этот бит невозможно изменить. Режим ШИМ может использоваться только в однократном импульсном режиме (OPM=1) без подтверждения регистра предварительной загрузки, в противном случае его поведение не определено.''
|-
| rowspan="4" style="text-align: center;"| [10]
| rowspan="4" style="text-align: center;"| OC2FE
| rowspan="4" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит быстрого включения канала сравнения-захвата 2, этот бит используется для ускорения реакции выхода канала сравнения-захвата на событие входного триггера.
| rowspan="4" style="text-align: center;"| 0
|-
| style="text-align: right;"| 1:
| style="text-align: left;"| Активный фронт на входе триггера действует так, как будто произошло сравнение. Таким образом, состояние выхода сравнивающего захвата устанавливается независимо от результата сравнения. Задержка между допустимым фронтом сигнала триггера выборки и выходом канала сравнения-захвата 2 сокращается до 3 тактовых циклов
|-
| style="text-align: right;"| 0:
| style="text-align: left;"| Канал сравнения-захвата 2 работает нормально на основе значений счетчика и регистра сравнения-захвата 1, даже если триггер открыт. Минимальная задержка активации выхода канала сравнения-захвата 2 составляет 5 тактовых циклов, когда на входе триггера появляется допустимый фронт
|-
| colspan="2" style="text-align: left;"| OC2FE работает только тогда, когда канал настроен на работу в режиме PWM1 или PWM2
|-
| rowspan="6" style="text-align: center;"| [9:8]
| rowspan="6" style="text-align: center;"| CC2S[1:0]
| rowspan="6" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Поля выбора входа канала сравнения-захвата 2.
| rowspan="6" style="text-align: center;"| 0
|-
| style="text-align: right;"| 00:
| style="text-align: left;"| Канал сравнения-захвата 2 настроен как выход.
|-
| style="text-align: right;"| 01:
| style="text-align: left;"| Канал сравнения-захвата 2 настроен как вход, и IC2 отображён на TI2.
|-
| style="text-align: right;"| 10:
| style="text-align: left;"| Канал сравнения-захвата 2 настроен как вход, и IC2 отображён на TI1.
|-
| style="text-align: right;"| 11:
| style="text-align: left;"| Канал сравнения-захвата 2 настроен как вход, и IC2 отображён на TRC. Этот режим работает только при выборе внутреннего входа триггера (по биту TS).
|-
| colspan="2" style="text-align: left;"| ''Примечание: Канал сравнения-захвата 2 доступен для записи только тогда, когда канал выключен (когда CC2E равен нулю)''
|-
| style="text-align: center;"| [7]
| style="text-align: center;"| OC1CE
| style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит разрешения очистки канала сравнения-захвата 1
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [6:4]
| style="text-align: center;"| OC1CE
| style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Поле настройки режима канала сравнения-захвата 1.
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [3]
| style="text-align: center;"| OC1CE
| style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит разрешения предварительной загрузки регистра сравнения-захвата 1.
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [2]
| style="text-align: center;"| OC1CE
| style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Бит быстрого включения канала сравнения-захвата 1.
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [1:0]
| style="text-align: center;"| OC1CE
| style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Compare capture channel 1 input selection fields.
| style="text-align: center;"| 0
|}

Режим захвата (пины используются как входа)

{| class="wikitable"
|-
! style="text-align: center;"| Бит
! style="text-align: center;"| Название
! style="text-align: center;"| Доступ
! colspan="2" style="text-align: center;"| Описание
! style="text-align: center;"| Значение сброса
|-
| rowspan="17" style="text-align: center;"| [15:12]
| rowspan="17" style="text-align: center;"| IC2F[3:0]
| rowspan="17" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Поле конфигурации фильтра захвата входов 2, эти биты задают частоту дискретизации входа TI1 и длину цифрового фильтра. Цифровой фильтр состоит из счётчика событий, который регистрирует N событий, а затем генерирует скачок на выходе.
| rowspan="17" style="text-align: center;"| 0
|-
| style="text-align: left;"| 0000:
| style="text-align: left;"| нет фильтра, частота дискретизации равна fDTS.
|-
| style="text-align: left;"| 1000:
| style="text-align: left;"| частота дискретизации Fsampling = Fdts/8, N = 6.
|-
| style="text-align: left;"| 0001:
| style="text-align: left;"| частота дискретизации Fsampling = Fck_int, N = 2.
|-
| style="text-align: left;"| 1001:
| style="text-align: left;"| частота дискретизации Fsampling = Fdts/8, N = 8.
|-
| style="text-align: left;"| 0010:
| style="text-align: left;"| частота дискретизации Fsampling = Fck_int, N = 4.
|-
| style="text-align: left;"| 1010:
| style="text-align: left;"| частота дискретизации Fsampling = Fdts/16, N = 5.
|-
| style="text-align: left;"| 0011:
| style="text-align: left;"| частота дискретизации Fsampling = Fck_int, N = 8.
|-
| style="text-align: left;"| 1011:
| style="text-align: left;"| частота дискретизации Fsampling = Fdts/16, N = 6.
|-
| style="text-align: left;"| 0100:
| style="text-align: left;"| частота дискретизации Fsampling = Fdts/2, N = 6.
|-
| style="text-align: left;"| 1100:
| style="text-align: left;"| частота дискретизации Fsampling = Fdts/16, N = 8.
|-
| style="text-align: left;"| 0101:
| style="text-align: left;"| частота дискретизации Fsampling = Fdts/2, N = 8.
|-
| style="text-align: left;"| 1101:
| style="text-align: left;"| частота дискретизации Fsampling = Fdts/32, N = 5.
|-
| style="text-align: left;"| 0110:
| style="text-align: left;"| частота дискретизации Fsampling = Fdts/4, N = 6.
|-
| style="text-align: left;"| 1110:
| style="text-align: left;"| частота дискретизации Fsampling = Fdts/32, N = 6.
|-
| style="text-align: left;"| 0111:
| style="text-align: left;"| частота дискретизации Fsampling = Fdts/4, N = 8.
|-
| style="text-align: left;"| 1111:
| style="text-align: left;"| частота дискретизации Fsampling = Fdts/32, N = 8.
|-
| rowspan="5" style="text-align: center;"| [11:10]
| rowspan="5" style="text-align: center;"| IC2PCS[1:0]
| rowspan="5" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Поле конфигурации предделителя канала сравнения-захвата 2, эти два бита определяют коэффициент предделителя для канала сравнения-захвата 2. Как только CC1E = 0, предделитель сбрасывается.
| rowspan="5" style="text-align: center;"| 0
|-
| style="text-align: right;"| 00:
| style="text-align: left;"| без предделителя, одно срабатывание захвата инициируется для каждого обнаруженного фронта на входе захвата.
|-
| style="text-align: right;"| 01:
| style="text-align: left;"| захват инициируется каждые 2 события.
|-
| style="text-align: right;"| 10:
| style="text-align: left;"| захват инициируется каждые 4 события.
|-
| style="text-align: right;"| 11:
| style="text-align: left;"| Захват инициируется каждые 8 событий.
|-
| rowspan="5" style="text-align: center;"| [9:8]
| rowspan="5" style="text-align: center;"| CC2S[1:0]
| rowspan="5" style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Поле выбора входа канала сравнения-захвата 2, эти два бита определяют направление канала (вход/выход) и выбор контакта ввода.
| rowspan="5" style="text-align: center;"| 0
|-
| style="text-align: right;"| 00:
| style="text-align: left;"| Канал сравнения-захвата 2 настроен как выход.
|-
| style="text-align: right;"| 01:
| style="text-align: left;"| Канал сравнения-захвата 2 настроен как вход, и IC2 отображён на TI1.
|-
| style="text-align: right;"| 10:
| style="text-align: left;"| Канал сравнения-захвата 2 настроен как вход, и IC2 отображён на TI2.
|-
| style="text-align: right;"| 11:
| style="text-align: left;"| Канал сравнения-захвата 2 настроен как вход, и IC2 отображён на TRC. Этот режим работает только при выборе внутреннего входа триггера (по биту TS).
|-
| style="text-align: center;"| [7:4]
| style="text-align: center;"| IC1F[3:0]
| style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Поле конфигурации фильтра захвата входов 1.
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [3:2]
| style="text-align: center;"| IC1PSC[1:0]
| style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Поле конфигурации предделителя канала сравнения-захвата 1.
| style="text-align: center;"| 0
|-
| style="text-align: center;"| [1:0]
| style="text-align: center;"| CC1S[1:0]
| style="text-align: center;"| RW
| colspan="2" style="text-align: left;"| Поля выбора входа канала сравнения-захвата 1.
| style="text-align: center;"| 0
|}

<span id="регистр-управления-сравнениемзахватом-2-tim1_chctlr2"></span>
=== 10.4.8 Регистр управления сравнением/захватом 2 (TIM1_CHCTLR2) ===

Смещение адреса: 0x00

<span id="регистр-разрешения-сравнениязахвата-2-tim1_ccer"></span>
=== 10.4.9 Регистр разрешения сравнения/захвата 2 (TIM1_CCER) ===

Смещение адреса: 0x00

<span id="счетчик-для-таймера-с-расширенным-управлением-tim1_cnt"></span>
=== 10.4.10 Счетчик для таймера с расширенным управлением (TIM1_CNT) ===

Смещение адреса: 0x00

<span id="пресейлдер-тактовой-частоты-счета-tim1_psc"></span>
=== 10.4.11 Пресейлдер тактовой частоты счета (TIM1_PSC) ===

Смещение адреса: 0x00

<span id="регистр-значения-автоперезагрузки-tim1_atrlr"></span>
=== 10.4.12 Регистр значения автоперезагрузки (TIM1_ATRLR))  ===

Смещение адреса: 0x00

<span id="регистр-значения-счетчика-повторений-tim1_rptcr"></span>
=== 10.4.13 Регистр значения счетчика повторений (TIM1_RPTCR) ===

Смещение адреса: 0x00

<span id="регистр-сравнениязахвата-1-tim1_ch1cvr"></span>
=== 10.4.14 Регистр сравнения/захвата 1 (TIM1_CH1CVR) ===

Смещение адреса: 0x00

<span id="регистр-сравнениязахвата-2-tim1_ch2cvr"></span>
=== 10.4.15 Регистр сравнения/захвата 2 (TIM1_CH2CVR) ===

Смещение адреса: 0x00

<span id="регистр-сравнениязахвата-3-tim1_ch3cvr"></span>
=== 10.4.16 Регистр сравнения/захвата 3 (TIM1_CH3CVR) ===

Смещение адреса: 0x00

<span id="регистр-сравнениязахвата-4-tim1_ch4cvr"></span>
=== 10.4.17 Регистр сравнения/захвата 4 (TIM1_CH4CVR) ===

Смещение адреса: 0x00

<span id="регистр-торможения-и-мертвого-времени-tim1_bdtr"></span>
=== 10.4.18 Регистр торможения и мертвого времени (TIM1_BDTR) ===

Смещение адреса: 0x00

<span id="регистр-управления-dma-tim1_dmacfgr"></span>
=== 10.4.19 Регистр управления DMA (TIM1_DMACFGR) ===

Смещение адреса: 0x00

<span id="регистр-адреса-dma-для-непрерывного-режима-tim1_dmaadr"></span>
=== 10.4.20 Регистр адреса DMA для непрерывного режима (TIM1_DMAADR) ===

Смещение адреса: 0x00

<span id="глава-11-универсальный-таймер-общего-назначения-gptm"></span>
= Глава 11: Универсальный таймер общего назначения (GPTM)  =

<blockquote>Модуль универсального таймера содержит 16-битный авто перезагружаемый таймер, TIM2, для измерения ширины импульса или генерации импульсов с определенной частотой, ШИМ-сигналов и т.д. Он может использоваться в системах автоматизации управления, источниках питания и других приложениях.
</blockquote>
<span id="основные-характеристики-4"></span>
== Основные характеристики  ==

<blockquote>Основные особенности универсального таймера включают:
</blockquote>
* '''16-битный авто перезагружаемый счетчик''', поддерживает режимы инкрементного счёта, декрементного счёта и комбинированного режима счёта (инкрементно-декрементный).
* '''16-битный прескейлер''' с динамически настраиваемым коэффициентом деления от 1 до 65536.
* '''Поддерживает четыре независимых канала сравнения захвата'''.
* Каждый канал сравнения захвата поддерживает несколько режимов работы, такие как: захват входных сигналов, сравнение выходов, генерацию ШИМ-сигнала и однократную генерацию импульса.
* Поддерживается управление таймером внешними сигналами.
* Поддержка DMA в нескольких режимах.
* Возможны инкрементация кодировки, каскадирование и синхронизация между несколькими таймерами.

<span id="принцип-работы-и-структура"></span>
== 11.2 Принцип работы и структура ==

Рисунок 11-1. Блок-схема структуры универсального таймера.

'''CK_TIM from RCC'''

'''Internal clock(CK_INT)'''

'''TRGO'''

'''To other timers'''

'''To ADC'''

'''Reset,'''

'''Enable,'''

'''Up, Count'''

'''AutoReload'''

'''Register'''

'''U'''

'''CK_PSC'''

'''PSC'''

'''('''

'''prescaler'''

''')'''

'''<u>CK_CNT</u>'''

'''CNT'''

''')'''

'''('''

'''counter'''

'''Stop, clear or up'''

'''U'''

'''U'''

'''Trigger'''

'''controller'''

<span id="обзор-4"></span>
=== 11.2.1 Обзор  ===

<blockquote>Как показано на рисунке 11-1, структуру универсального таймера можно условно разделить на три части: часть входного тактового сигнала, основную часть счетчика и часть каналов сравнения-захвата. Тактовый сигнал для универсального таймера может поступать от шины HB ('''CK_INT'''), от внешнего входа тактового сигнала ('''TIMx_ETR'''), от других таймеров с выходом тактового сигнала ('''ITRx''') и от входа канала сравнения-захвата ('''TIMx_CHx'''). Эти входные тактовые сигналы после различных операций фильтрации, деления и т.п. преобразуются в тактовые сигналы '''CK_PSC''' и выводятся в секцию основного счетчика. Кроме того, эти сложные источники тактовых сигналов также могут быть выведены как '''TRGO''' для других периферийных устройств, таких как таймеры и АЦП. Ядром универсального таймера является 16-битный счетчик ('''CNT'''). Сигнал '''CK_PSC''' делится с помощью преселектора ('''PSC'''), превращаясь в '''CK_CNT''', и затем подается на '''CNT'''. '''CNT''' поддерживает режимы инкрементного счета, декрементного счета и комбинированного инкрементно-декрементного режима, а также имеет регистр автоматической перезагрузки ('''ATRLR'''), который перезагружает начальное значение для '''CNT''' в конце каждого цикла счета. Универсальный таймер оснащен четырьмя наборами каналов сравнения-защиты, каждый из которых может принимать импульсы от эксклюзивных выводов или выводить волновые формы на выводы, то есть каналы сравнения-защиты поддерживают как входной, так и выходной режимы. Вход каждого канала регистра сравнения-зачата поддерживает фильтрацию, деление, обнаружение фронтов и другие операции, поддерживает взаимную активацию между каналами и может также обеспечивать тактовый сигнал для основного счетчика '''CNT'''. У каждого канала сравнения-зачета имеется набор регистров сравнения-зацета ('''CHxCVR'''), которые поддерживают сравнение с главным счетчиком ('''CNT''') для выдачи импульсов.
</blockquote>
<span id="различия-между-универсальным-таймером-общего-назначения-и-усовершенствованным-таймером-управления."></span>
=== 11.2.2 Различия между универсальным таймером общего назначения и усовершенствованным таймером управления. ===

<blockquote>По сравнению с усовершенствованными таймерами управления, универсальные таймеры общего назначения не обладают следующими функциями:
</blockquote>
# Универсальный таймер не имеет регистра повторного счета для подсчета циклов счета основного счетчика.
# Канал сравнения захвата универсального таймера не обладает функцией генерации мертвого времени и не имеет комплементарного выхода.
# Универсальный таймер не располагает механизмом тормозного сигнала.

<span id="вход-тактирования"></span>
=== 11.2.3 Вход тактирования  ===

<blockquote>В этом разделе обсуждается источник сигнала CK_PSC. Здесь представлена часть общей блок-схемы универсального таймера, относящаяся к источнику тактовых сигналов.

Рисунок 11-2. Блок-схема источника сигнала CK_PSC универсального таймера.
</blockquote>
'''Encoder'''

'''mode'''

'''External clock'''

'''mode 1'''

'''External clock'''

'''mode 2'''

'''Internal clock'''

'''mode'''

'''CK_PSC'''

'''TI2F'''

'''TI1F'''

'''or'''

'''or'''

'''TRGI'''

'''ETRF'''

'''CK_INT'''

'''or'''

''')'''

'''('''

'''internal clock'''

'''TS[2:0]'''

'''TIMx_SMCR'''

'''xx'''

'''0'''

'''100'''

'''101'''

'''110'''

'''111'''

'''ITRx'''

'''<u>TI1_ED</u>'''

'''<u>TI1FP1</u>'''

'''TI2FP2'''

'''<u>ETRF</u>'''

'''0'''

'''1'''

'''CC2P'''

'''TIMx_CCER'''

'''Edge'''

'''detector'''

'''<u>TI2F_Rising</u>'''

'''TI2F_Falling'''

'''Filter'''

'''ICF[3:0]'''

'''TIMx_CCMR1'''

'''TI2'''

'''ETR pin'''

'''ETP'''

'''TIMx_SMCR'''

'''0'''

'''1'''

'''ETR'''

'''Divider'''

'''/1,/2,/4,/8'''

'''ETPS[1:0]'''

'''TIMx_SMCR'''

'''ETF[3:0]'''

'''TIMx_SMCR'''

'''ETRP'''

'''f'''

'''DTS'''

'''Filter'''

'''downcounter'''

'''ECE'''

'''TIMx_SMCR'''

'''SMS[2:0]'''

<blockquote>Опциональные входные тактовые сигналы могут быть разделены на 4 категории.
</blockquote>
# Маршрут ввода внешнего тактового сигнала ('''ETR'''): '''ETR''' → '''ETRP''' → '''ETRF'''.
# Маршрут внутреннего тактового сигнала HB: '''CK_INT'''.
# Маршрут от контакта канала сравнения захвата ('''TIMx_CHx'''): '''TIMx_CHx''' → '''TIx''' → '''TIxFPx'''; этот маршрут также используется в режиме энкодера.
# Вход от других внутренних таймеров: '''ITRx'''. Фактическая операция может быть разделена на 3 категории путем определения выбора входного импульса для '''SMS''' источника '''CK_PSC'''.
# Выбор внутреннего источника тактового сигнала ('''CK_INT''').
# Режим внешнего тактового источника 1.
# Режим внешнего тактового источника 2.
# Режим энкодера.

<blockquote>Все 4 упомянутых выше источника тактовых сигналов могут быть выбраны этими 4 операциями.
</blockquote>
<span id="внутренний-источник-тактовых-сигналов-ck_int"></span>
==== 11.2.3.1 Внутренний источник тактовых сигналов (CK_INT)  ====

<blockquote>Если универсальный таймер запускается при удержании поля SMS в состоянии 000b, то выбирается внутренний источник тактовых сигналов (CK_INT) в качестве тактового сигнала. В этот момент CK_INT становится CK_PSC.
</blockquote>
<span id="режим-1-mode-1-внешнего-тактового-источника"></span>
==== 11.2.3.2 Режим 1 (Mode 1) внешнего тактового источника  ====

<blockquote>Когда область '''SMS''' установлена на 111b, включается первый режим внешнего тактового источника. При включении первого внешнего тактового источника в качестве источника для '''CK_PSC''' выбирается '''TRGI'''. Следует отметить, что пользователь также должен выбрать источник для '''TRGI''', настроив область '''TS'''. Область '''TS''' может выбирать следующие типы импульсов в качестве источников тактовых сигналов:
</blockquote>
# Внутренний триггер ('''ITRx''', где x равно 0,1,2,3).
# Сравнение сигнала после захвата канала 1 через детектор фронта ('''TI1F_ED''').
# Сравнение сигналов '''TI1FP1''', '''TI2FP2''' канала захвата.
# Сигнал '''ETRF''' от входа внешнего тактового сигнала.

<span id="режим-2-mode-2-внешнего-тактового-источника"></span>
==== 11.2.3.3 Режим 2 (Mode 2) внешнего тактового источника  ====

<blockquote>Используйте второй режим внешнего триггера для подсчета на каждом восходящем или нисходящем фронте входного сигнала внешнего тактового вывода. Когда позиция '''ECE''' установлена, используется второй режим внешнего тактового источника. При использовании второго режима внешнего тактового источника в качестве '''CK_PSC''' выбирается '''ETRF'''. Контакт '''ETR''' становится '''ETRP''' после прохождения через необязательный инвертор ('''ETP'''), делитель ('''ETPS'''), а затем '''ETRF''' после прохождения через фильтр ('''ETF'''). При установке бита позиции '''ECE''' и '''SMS''' на 111b это эквивалентно выбору '''ETRF''' в качестве ввода с помощью '''TS'''.
</blockquote>
<span id="режим-энкодера-1"></span>
==== 11.2.3.4 Режим энкодера  ====

<blockquote>Установка SMS на 001b, 010b или 011b включит режим энкодера. Включение режима энкодера позволяет выбрать определенный уровень в '''TI1FP1''' и '''TI2FP2''' для передачи сигнала с другим перепадом уровня в качестве сигнала. Этот режим используется при применении внешнего энкодера. За подробностями о конкретных функциях обратитесь к разделу 11.3.7.
</blockquote>
<span id="счетчики-и-переферия-1"></span>
=== 11.2.4 Счетчики и переферия  ===

<blockquote>'''CK_PSC''' поступает на предварительный делитель ('''PSC''') для деления. '''PSC''' является 16-битным, и реальный коэффициент деления равен значению '''R16_TIMx_PSC''' + 1. '''CK_PSC''' проходит через '''PSC''' и становится '''CK_INT'''. Изменение значения '''R16_TIM1_PSC''' не вступает в силу в реальном времени, но обновляется в '''PSC''' после события обновления. Событие обновления включает очистку и сброс бита '''UG'''.
</blockquote>
<span id="каналы-захвата-и-сравнения"></span>
=== 11.2.5 Каналы захвата и сравнения  ===

<blockquote>Ядром канала сравнения/захвата, который является основой таймера для реализации сложных функций, является регистр сравнения/захвата. Он дополняется цифровой фильтрацией, делением частоты и межканальным мультиплексированием в секции периферийного ввода, а также компаратором и управлением вывода в секции вывода. Блок-схема структуры канала сравнения/захвата показана на Рисунке 11-3.

Рисунок 11-3. Блок-схема структуры канала сравнения захвата.

[[File:media/image33.png|610x661px]]

Сигнал вводится с контакта канала x и опционально формируется как '''TIx''' (источником '''TI1''' может быть больше чем CH1, см. блок-схему 10-1 таймера), '''TI1''' проходит через фильтр ('''ICF'''[3:0]), чтобы сформировать '''TI1F''', а затем делится на '''TI1F_Rising''' и '''TI1F_Falling''' через детектор фронта, эти два сигнала выбираются ('''CC1P''') для генерации '''TI1FP1''', '''TI1FP1''' и '''TI2FP1''' из канала 2 отправляются вместе на '''CC1S''' для выбора и становятся '''IC1''', который отправляется в регистр сравнения захвата после деления '''ICPS'''. Регистр сравнения захвата состоит из регистра предварительной загрузки и теневого регистра, а процесс чтения/записи выполняется только на регистре предварительной загрузки. В режиме захвата захват происходит на теневом регистре, а затем копируется в регистр предварительной загрузки; в режиме сравнения содержимое регистра предварительной загрузки копируется в теневой регистр, а затем содержимое теневого регистра сравнивается с основным счетчиком ('''CNT''').
</blockquote>
<span id="функциональные-возможности-и-реализация"></span>
== 11.3 Функциональные возможности и реализация  ==

<blockquote>Сложные функции универсального таймера реализуются путем манипуляции каналом сравнения захвата таймера, схемой ввода тактового сигнала и компонентами счетчика и периферии. Тактовый сигнал, подаваемый на таймер, может быть получен из множества источников тактовых сигналов, включая вход канала сравнения захвата. Работа основного канала сравнения захвата и выбор источника тактовых сигналов непосредственно определяют его функцию. Канал сравнения захвата является двунаправленным и может работать как в режиме ввода, так и в режиме вывода.
</blockquote>
<span id="режим-захвата-входа-input-capture-1"></span>
=== 11.3.1 Режим захвата входа (Input Capture)  ===

<blockquote>Режим захвата входного сигнала является одной из базовых функций таймера. Принцип работы режима захвата входного сигнала заключается в том, что при обнаружении определенного фронта сигнала '''ICxPS''' генерируется событие захвата, и текущее значение счетчика фиксируется в регистре сравнения захвата ('''R16_TIMx_CHCTLRx'''). Бит '''CCxIF''' (в '''R16_TIMx_INTFR''') устанавливается при возникновении события захвата, и соответствующий прерывание или DMA генерируются, если они включены. Если бит '''CCxIF''' уже установлен при возникновении события захвата, то устанавливается бит '''CCxOF'''. Бит '''CCxIF''' может быть очищен программно или аппаратно путем чтения регистра сравнения захвата. Бит '''CCxOF''' очищается программно. Пример использования режима захвата на входе для канала 1 приведен ниже.
</blockquote>
# Настройте область '''CCxS''' для выбора источника сигнала '''ICx'''. Например, установите ее на 10b и выберите '''TI1FP1''' в качестве источника '''IC1''', не используя настройку по умолчанию. По умолчанию область '''CCxS''' настраивает модуль сравнения захвата как выходной канал.
# Настройте область '''ICxF''' для установки цифрового фильтра для сигнала '''TI'''. Цифровой фильтр будет выборочно считывать сигнал с определенной частотой определенное количество раз, а затем выдавать скачок. Эта частота выборки и количество раз определяются областью '''ICxF'''.
# Настройте бит '''CCxP''' для установки полярности сигнала '''TIxFPx'''. Например, оставьте бит '''CC1P''' низким и выберите переходы на восходящий фронт.
# Настройте область '''ICxPS''' для установки коэффициента перехода сигнала '''ICx''' между '''ICxPS'''. Например, оставляйте '''ICxPS''' на уровне 00b без перехода.
# Настройте бит '''CCxE''', чтобы разрешить захват значения основного счетчика ('''CNT''') в регистр сравнения захвата. Установите бит '''CC1E'''.
# Настройте биты '''CCxIE''' и '''CCxDE''' по мере необходимости, чтобы определить, следует ли разрешать использование прерываний или DMA. На этом завершается настройка канала сравнения захвата.

<blockquote>Когда захваченный импульс подается на '''TI1''', значение основного счетчика ('''CNT''') записывается в регистр сравнения захвата, устанавливается бит '''CC1IF''', а бит '''CCIOF''' устанавливается, когда бит '''CC1IF''' был установлен ранее. Если установлен бит '''CC1IE''', то генерируется прерывание; если установлен бит '''CC1DE''', генерируется запрос DMA. Событие захвата на входе может быть сгенерировано программным способом посредством записи в регистр генерации событий ('''R16_TIMx_SWEVGR''').
</blockquote>
<span id="режим-сравнения-compare-mode"></span>
=== 11.3.2 Режим сравнения (Compare Mode)  ===

<blockquote>Режим сравнения выходов является одной из базовых функций таймера. Принцип работы режима сравнения выходов заключается в том, чтобы выводить определенное изменение или форму волны, когда значение основного счетчика ('''CNT''') совпадает со значением регистра сравнения захвата. Поле '''OCxM''' (в '''R16_TIMx_CHCTLRx''') и бит '''CCxP''' (в '''R16_TIMx_CCER''') определяют, является ли выходной сигнал определенным высоким или низким уровнем или переключением уровня. Бит '''CCxIF''' также устанавливается, когда генерируется согласованное событие сравнения. Если предварительно установлен бит '''CCxIE''', будет сгенерировано прерывание; если предварительно установлен бит '''CCxDE''', будет сформирован запрос DMA. Чтобы настроить режим сравнения выходов, выполните следующие шаги:
</blockquote>
<ol start="4" style="list-style-type: decimal;">
<li><p>Настройка источника тактового сигнала и значения автоперезагрузки основного счетчика (CNT).</p></li>
<li><p>Установка значения для сравнения с регистром сравнения захвата (R16_TIMx_CHxCVR).</p></li>
<li><p>Установка бита CCxIE, если необходимо сгенерировать прерывание.</p></li>
<li><p>Оставьте OCxPE равным 0, чтобы отключить регистр предварительной загрузки для регистра сравнения захвата.</p></li>
<li><p>Установка режима вывода, установка поля OCxM и бита CCxP.</p></li>
<li><p>Включите вывод, установив бит CCxE.</p></li>
<li><p>Установка бита CEN для запуска таймера.</p></li></ol>

<span id="режим-принудительного-вывода-forced-output-mode"></span>
=== 11.3.3 Режим принудительного вывода (Forced Output Mode)  ===

<blockquote>Выходной шаблон канала сравнения захвата таймера может быть принудительно изменен программным обеспечением для вывода определенного уровня без необходимости сравнения теневого регистра регистра сравнения захвата с основным счетчиком. Это делается путем установки OCxM на 100b, что вынуждает OCxREF опускаться до низкого уровня, или путем установки OCxM на 101b, что заставляет OCxREF подниматься до высокого уровня. Обратите внимание, что принудительная установка OCxM в положение 100b или 101b все еще продолжается процесс сравнения между внутренним основным счетчиком и регистром сравнения захвата, соответствующие флаги все еще устанавливаются, и все еще генерируются прерывания и запросы DMA.
</blockquote>
<span id="режим-измерения-шим-pwm-input-mode"></span>
=== 11.3.4 Режим измерения ШИМ (PWM Input Mode)  ===

<blockquote>Режим ввода ШИМ используется для измерения коэффициента заполнения и частоты ШИМ и является особым случаем режима захвата на входе. Операции аналогичны режиму захвата на входе, за исключением следующих отличий: ШИМ занимает два канала сравнения захвата, и полярность ввода двух каналов установлена противоположная, один из сигналов установлен как вход триггера, а '''SMS''' установлен в режим сброса. Например, чтобы измерить период и частоту входящего сигнала ШИМ от '''TI1''', требуются следующие операции.
</blockquote>
# Установите TI1 (TI1FP1) в качестве входа сигнала IC1. Установите CC1S на 01b.
# Установите TI1FP1 на активный фронт нарастания. Держите CC1P на нуле.
# Установите TI1 (TI1FP2) в качестве входного сигнала IC2. Установите CC2S на 10b.
# Выберите TI1FP2 для активации спадающего фронта. Установите CC2P на 1.
# Выберите TI1FP1 в качестве источника тактового сигнала. Установите TS на 101b.
# Выберите режим сброса для SMS, то есть 100b.
# Включите захват на входе. Устанавливаются cc1e и cc2e.

<span id="режим-генерации-шим-pwm-output-mode"></span>
=== 11.3.5 Режим генерации ШИМ (PWM Output Mode)  ===

<blockquote>ежим вывода ШИМ является одной из основных функций таймера. Режим вывода ШИМ чаще всего используется для определения частоты ШИМ с использованием значения перезагрузки и коэффициента заполнения с использованием регистра сравнения захвата. Установите 110b или 111b в поле '''OCxM''' для использования режима ШИМ 1 или режима 2, установите бит '''OCxPE''' для включения регистра предварительной загрузки и, наконец, установите бит ARPE для разрешения автоматического перезагрузки регистра предварительной загрузки. Значение регистра предварительной загрузки может быть отправлено в теневой регистр только тогда, когда происходит событие обновления, поэтому бит '''UG''' необходимо установить для инициализации всех регистров перед началом счета основного счетчика. В режиме ШИМ основной счетчик и регистр сравнения захвата всегда находятся в сравнении, и в зависимости от бита '''CMS''' таймер способен выводить сигналы ШИМ, выровненные по краю или центру.
</blockquote>
* Выравнивание по краю

<blockquote>При выравнивании по краю основной счетчик увеличивается или уменьшается, и в сценарии режима ШИМ 1, когда значение основного счетчика превышает значение регистра сравнения захвата, '''OCxREF''' поднимается до высокого уровня; когда значение главного счетчика меньше значения регистра сравнения (например, когда главный счетчик растет до значения '''R16_TIMx_ATRLR''' и возвращается к полному нулю), '''OCxREF''' падает до низкого уровня. Выравнивание по центру При использовании режима центрированного выравнивания основной счетчик работает в чередовании режимов инкрементного и декрементального счета, и '''OCxREF''' выполняет подъемы и падения, когда значения основного счетчика и регистра сравнения совпадают. Тем не менее, флажки сравнения устанавливаются в разное время в трех режимах центрального выравнивания. При использовании режимов центрального выравнивания рекомендуется сгенерировать флаг программного обновления (установить бит '''UG''') перед запуском основного счетчика.
</blockquote>
<span id="режим-одного-импульса-single-pulse-mode"></span>
=== 11.3.6 Режим одного импульса (Single Pulse Mode)  ===

<blockquote>Режим одиночного импульса может реагировать на конкретное событие, генерируя импульс после задержки с программируемыми задержкой и шириной импульса. Установка бита '''OPM''' останавливает основной счетчик, когда генерируется следующее событие обновления '''UEV''' (счетчик переходит в ноль).

Рисунок 11-4. Генерация событий и реакция на импульс

[[File:media/image34.png|444x280px]]

Как показано на Рисунке 11-4, на выводе OC1 необходимо сгенерировать положительный импульс длиной Tpulse после задержки Tdelay в начале растущего фронта, обнаруженного на выводе '''TI2'''. Для этого требуется выполнить следующие шаги:
</blockquote>
# Настройки для генерации триггера. В поле '''CC2S''' установлено значение 01b, которое отображает '''TI2FP2''' как '''TI2'''; бит '''CC2P''' установлен на 0b, что устанавливает '''TI2FP2''' для обнаружения растущего края; поле '''TS''' установлено на 110b, устанавливающее '''TI2FP2''' в качестве триггерного источника; поле '''SMS''' установлено на значение 110b для установки '''TI2FP2''', используемого для запуска счетчика.
# Задержка Tdelay определяется значением регистра сравнения захвата, а ширина импульса Tpulse определяется значениями регистра автоперезагрузки и регистра сравнения захвата.

<span id="режим-энкодера-encoder-mode"></span>
=== 11.3.7 Режим энкодера (Encoder Mode)  ===

<blockquote>Режим энкодера является типичным применением таймера и может использоваться для получения фазового выхода энкодера. Направление счёта основного счётчика синхронизируется с направлением вращения оси энкодера, и каждое импульс, исходящий от энкодера, увеличит или уменьшит значение основного счётчика на единицу. Чтобы использовать энкодер, установите поле '''SMS''' на 001b (подсчёт только по краю '''TI2'''), 010b (счёт только на краю '''TI1''') или 011b (Счёт на краях '''TI1''' и '''TI2'''). Подключите энкодер к входам каналов сравнения захвата 1 и 2, и установите значение счётчика перегрузки, которое может быть установлено на большее значение. В режиме энкодера внутренние регистры сравнения захвата, пресет-счётчик, счётчик повторяющихся чисел и т.д. таймера работают нормально. В следующей таблице показаны отношения между направлением счёта и сигналом энкодера.

Таблица 11-1 Связь между направлением счёта и сигналом энкодера в режиме энкодера таймера
</blockquote>
<span id="режим-синхронизации-таймера-timer-synchronization-mode"></span>
=== 11.3.8 Режим синхронизации таймера (Timer Synchronization Mode) ===

<blockquote>Таймеры способны генерировать тактовые импульсы (TRGO) и получать входы от других таймеров (ITRx). Источник ITRx (TRGO от других таймеров) различается для разных таймеров. Соединения внутренней связи триггеров таймера показаны в Таблице 11-2.

Таблица 11-2 Подключение внутренних GTPM триггеров таймера
</blockquote>
{| class="wikitable"
|-
! style="text-align: left;"| От таймера
! style="text-align: left;"| ITR0(TS=000)
! style="text-align: left;"| ITR0(TS=001)
! style="text-align: left;"| ITR0(TS=010)
! style="text-align: left;"| ITR0(TS=011)
|-
| style="text-align: left;"| TIM2
| style="text-align: left;"| TIM1
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
|-
| style="text-align: left;"| TIM1
| style="text-align: left;"|  
| style="text-align: left;"| TIM2
| style="text-align: left;"|  
| style="text-align: left;"|  
|}

<span id="режим-наладки-3"></span>
=== 11.3.9 Режим наладки  ===

<blockquote>Когда система входит в режим отладки, таймер может продолжать выполнение команд или остановиться в зависимости от настроек модуля DBG.
</blockquote>
<span id="описание-регистров-9"></span>
== 11.4 Описание регистров  ==

<blockquote>Table 11-3 TIM2-related registers list
</blockquote>
<span id="control-register-1-tim2_ctlr1"></span>
=== 11.4.1 Control Register 1 (TIM2_CTLR1)  ===

<span id="control-register-2-tim2_ctlr2"></span>
=== 11.4.2 Control Register 2 (TIM2_CTLR2)  ===

<blockquote>Offset address: 0x04
</blockquote>
<span id="slave-mode-control-register-tim2_smcfgr"></span>
=== 11.4.3 Slave Mode Control Register (TIM2_SMCFGR)  ===

<blockquote>Offset address: 0x08
</blockquote>
'''11.4.4 TIM2 DMA/Interrupt Enable Register (TIM2_DMAINTENR)'''

<span id="interrupt-status-register-tim2_intfr"></span>
=== 11.4.5 Interrupt Status Register (TIM2_INTFR)  ===

<blockquote>Offset address: 0x10
</blockquote>
<span id="tim2-event-generation-register-tim2_swevgr"></span>
=== 11.4.6 TIM2 Event Generation Register (TIM2_SWEVGR)  ===

<blockquote>Offset address: 0x14
</blockquote>
<span id="comparecapture-control-register-1-tim2_chctlr1"></span>
=== 11.4.7 Compare/Capture Control Register 1 (TIM2_CHCTLR1)  ===

<blockquote>Offset address: 0x18

Канал может использоваться в режиме ввода (режим захвата) или вывода (режим сравнения), а направление канала задаётся соответствующим битом '''CCxS'''. Другие биты этого регистра выполняют разные функции в режимах ввода и вывода. Биты '''OCxx''' описывают функциональность канала в режиме вывода, а биты '''ICxx''' описывают функциональность канала в режиме ввода.
</blockquote>
<span id="comparecapture-control-register-2-tim2_chctlr2"></span>
=== 11.4.8 Compare/Capture Control Register 2 (TIM2_CHCTLR2)  ===

<blockquote>Offset address: 0x1C
</blockquote>
Канал может быть использован в режиме ввода (режим захвата) или вывода (режим сравнения), а направление канала определяется соответствующим битом '''CCxS'''. Остальные биты этого регистра служат различными целями в режимах ввода и вывода. Биты '''OCxx''' описывают функцию канала в режиме вывода, а биты '''ICxx''' описывают функцию канала в режиме ввода.

<span id="comparecapture-enable-register-tim2_ccer"></span>
=== 11.4.9 Compare/Capture Enable Register (TIM2_CCER)  ===

<blockquote>Offset address: 0x20
</blockquote>
<span id="counter-for-general-purpose-timer-tim2_cnt"></span>
=== 11.4.10 Counter for General-purpose Timer (TIM2_CNT)  ===

<span id="counting-clock-prescaler-tim2_psc"></span>
=== 11.4.11 Counting Clock Prescaler (TIM2_PSC)  ===

<span id="auto-reload-value-register-tim2_atrlr"></span>
=== 11.4.12 Auto-reload Value Register (TIM2_ATRLR)  ===

<span id="comparecapture-register-1-tim2_ch1cvr"></span>
=== 11.4.13 Compare/capture Register 1 (TIM2_CH1CVR)  ===

<blockquote>Offset address: 0x34
</blockquote>
<span id="comparecapture-register-2-tim2_ch2cvr"></span>
=== 11.4.14 Compare/capture Register 2 (TIM2_CH2CVR)  ===

<span id="comparecapture-register-3-tim2_ch3cvr"></span>
=== 11.4.15 Compare/capture Register 3 (TIM2_CH3CVR)  ===

<span id="comparecapture-register-4-tim2_ch4cvr"></span>
=== 11.4.16 Compare/capture Register 4 (TIM2_CH4CVR)  ===

<span id="dma-control-register-tim2_dmacfgr"></span>
=== 11.4.17 DMA Control Register (TIM2_DMACFGR)  ===

<blockquote>Offset address: 0x48
</blockquote>
<span id="dma-address-register-for-continuous-mode-tim2_dmaadr"></span>
=== 11.4.18 DMA Address Register for Continuous Mode (TIM2_DMAADR)  ===

<span id="глава-12-универсальный-синхронно-асинхронный-приёмопередатчик-usart"></span>
= Глава 12: Универсальный синхронно-асинхронный приёмопередатчик (USART)  =

<blockquote>Модуль включает в себя универсальный синхронно-асинхронный приемопередатчик USART1.
</blockquote>
<span id="основные-характеристики-5"></span>
== 12.1 Основные характеристики ==

* Полнодуплексная или полудуплексная синхронная или асинхронная связь
* Формат данных NRZ
* Генератор дробной скорости до 3 Mbps
* Программируемая длина данных
* Конфигурация стоповых битов
* Поддержка протоколов LIN, кодировщиков IrDA, смарт-карт
* Поддержка DMA
* Множество источников пререрываний

<span id="обзор-5"></span>
== 12.2 Обзор  ==

<blockquote>Рисунок 12-1. Блок-диаграмма универсального синхронно-асинхронного приемопередатчика

[[File:media/image35.png|508x536px]]

Когда бит '''TE''' (бит разрешения передачи) установлен, данные из регистра сдвига передачи выводятся на пин TX, а тактовый сигнал передается на пина CK. При передаче данных таймер выводит самый незначимый бит ('''LSB''') из сдвигового регистра на пину TX, и каждая передача данных начинается с низкоуровневого стартового бита. Передача данных осуществляется передачей 8-битового или 9-битового слова данных в зависимости от настройки бита '''M''' (длины слова). После завершения передачи данных и установки бита '''TE''', передатчик передает кадр начала, содержащий низкий стартовый бит, а затем 8 или 9 бит данных, в зависимости от установки битов '''M'''. В случае наличия бита проверки на четность, последний бит данных служит битами проверки. После отправки кадра, при установке бита '''TE''', посылается кадр «idle», состоящий из 10 или 11 высоких битов, за которыми следует бит остановки. Кадр отключения содержит 10 или 10 бит низких данных, за которым следует бит останова.
</blockquote>
<span id="тактирование-генератора-битрейта-передачи-baud-rate-generator"></span>
== 12.3 Тактирование генератора битрейта передачи (Baud Rate Generator) ==

<blockquote>Скорость передачи данных передатчика рассчитывается по формуле BaudRate = Fbaud, где Fbaud – это частота передачи данных, а '''HCLK''' – это тактовая частота шины HB. Значение '''USARTDIV''' определяется двумя полями, '''DIV_M''' и '''DIV_F''' в регистре '''USART_BRR'''. Формула расчета выглядит следующим образом:

<math display="block">BaudRate = \frac{HCLK}{16*USARTDIV\ }</math>

Где '''HCLK''' — это частота тактового генератора шины HB, а '''USARTDIV''' — это значение, определяемое полями '''DIV_M''' and '''DIV_F'''. Отсюда:

<math display="block">USARTDIV\  = \ {DIV}_{M} + \left( \frac{{DIV}_{F}}{16} \right)</math>

Важно отметить, что скорость передачи битов, генерируемая генератором скорости передачи символов (baud rate), может не всегда точно соответствовать требуемой пользователем скорости передачи данных, и возможны отклонения. Помимо выбора максимально близкого значения, одним из способов уменьшения отклонений является увеличение частоты тактового генератора HB. Например, если вы установите скорость передачи данных 115200 бит/с, значение '''USARTDIV''' будет установлено равным 39,0625, что даст вам точную скорость передачи 115200 бит/с при максимальной частоте, но если вам нужна скорость передачи данных 921600 бит/с, рассчитанное значение '''USARTDIV''' составляет 4,88, однако ближайшее значение, которое можно установить в '''USART_BRR''', фактически равно только 4,875. При значении 4,875 реальная скорость передачи составит 923076 бит/с с ошибкой 0,16%. Когда последовательный сигнал, отправленный передатчиком, передается приемнику, между скоростью передачи приемника и передатчика могут возникать некоторые ошибки. Ошибка возникает по трем основным причинам: действительная скорость передачи приемника отличается от таковой у передатчика; часы приемника и передатчика имеют погрешности; изменения, возникающие в сигнале линии. Приемник периферийного модуля имеет определенную допустимую погрешность приема, когда сумма всех трех вышеуказанных отклонений меньше предела допуска модуля, суммарное отклонение не влияет на передачу и прием. Предел допуска модуля зависит от использования дробной скорости передачи и длины слова данных (Mбит), использование дробной скорости передачи данных и длина поля данных в 9 бит уменьшают предел допуска, но он не должен быть менее 3%.Начало формы
</blockquote>
<span id="синхронный-режим-synchronous-mode"></span>
== 12.4 Синхронный режим (Synchronous Mode) ==

<span id="режим-синхронизации-позволяет-системе-выдавать-сигнал-синхронизации-при-использовании-модуля-usart.-когда-включается-синхронный-режим-для-передачи-данных-во-внешнюю-среду-контакт-ck-одновременно-начнет-выдавать-внешний-тактовый-сигнал."></span>
== Режим синхронизации позволяет системе выдавать сигнал синхронизации при использовании модуля USART. Когда включается синхронный режим для передачи данных во внешнюю среду, контакт CK одновременно начнет выдавать внешний тактовый сигнал. ==

<span id="чтобы-включить-синхронный-режим-необходимо-установить-бит-clken-в-контрольном-регистре-2-r16_usartx_ctlr2.-также-требуется-отключить-режимы-lin-смарт-карты-инфракрасный-и-полудуплексный-режимы-то-есть-убедиться-что-биты-scen-hdsel-и-iren-сброшены.-эти-три-бита-находятся-в-контрольном-регистре-3-r16_usartx_ctlr3.начало-формы"></span>
== Чтобы включить синхронный режим, необходимо установить бит CLKEN в контрольном регистре 2 (R16_USARTx_CTLR2). Также требуется отключить режимы LIN, смарт-карты, инфракрасный и полудуплексный режимы, то есть убедиться, что биты SCEN, HDSEL и IREN сброшены. Эти три бита находятся в контрольном регистре 3 (R16_USARTx_CTLR3).Начало формы ==

<span id="ключевой-момент-при-использовании-синхронного-режима-это-управление-выходом-тактового-сигнала.-следует-учесть-несколько-важных-аспектов"></span>
== Ключевой момент при использовании синхронного режима – это управление выходом тактового сигнала. Следует учесть несколько важных аспектов: ==

<span id="режим-синхронизации-модуля-usart-работает-только-в-основном-режиме-то-есть-контакт-ck-выдает-только-тактовый-сигнал-и-не-принимает-входных-данных."></span>
== Режим синхронизации модуля USART работает только в основном режиме, то есть контакт CK выдает только тактовый сигнал и не принимает входных данных.  ==

<span id="тактовый-сигнал-выдается-только-тогда-когда-данные-отправляются-через-контакт-tx."></span>
== Тактовый сигнал выдается только тогда, когда данные отправляются через контакт TX.  ==

<span id="бит-lbcl-определяет-будет-ли-выдаваться-тактовый-сигнал-после-отправки-последнего-бита-данных-бит-cpol-задает-полярность-тактового-сигнала-а-бит-cpha-его-фазу.-эти-три-бита-расположены-в-контрольном-регистре-2-r16_usartx_ctlr2-и-должны-быть-настроены-до-активации-режимов-te-и-re.-различия-между-этими-настройками-показаны-на-рисунке-12-2."></span>
== Бит LBCL определяет, будет ли выдаваться тактовый сигнал после отправки последнего бита данных, бит CPOL задает полярность тактового сигнала, а бит CPHA — его фазу. Эти три бита расположены в контрольном регистре 2 (R16_USARTx_CTLR2) и должны быть настроены до активации режимов TE и RE. Различия между этими настройками показаны на Рисунке 12-2.  ==

<span id="приемник-будет-производить-выборку-данных-только-по-выходному-тактовому-сигналу-в-синхронном-режиме-требуя-определенного-времени-нарастания-и-удержания-сигнала-от-устройства-как-показано-на-рисунке-12-3."></span>
== Приемник будет производить выборку данных только по выходному тактовому сигналу в синхронном режиме, требуя определенного времени нарастания и удержания сигнала от устройства, как показано на Рисунке 12-3.  ==

Рисунок 12-2 Пример временных характеристик тактового сигнала USART (M=0)

<blockquote>[[File:media/image36.png|610x398px]]

Рисунок 12-3 Время удержания выборки данных
</blockquote>
'''CK (capture strobe on CK'''

'''rising edge in this example)'''

'''Data on RX'''

'''from slave'''

''')'''

'''('''

'''valid DATA bit'''

'''t'''

'''SETUP'''

'''t'''

'''HOLD'''

'''t'''

'''SETUP'''

'''='''

'''t'''

'''HOLD'''

'''1'''

'''/16 bit time'''

<span id="однопроводный-полудуплексный-режим-1-wire-half-duplex-mode"></span>
== 12.5 Однопроводный полудуплексный режим (1-Wire Half-duplex Mode) ==

<blockquote>Полудуплексный режим поддерживает использование одного контакта (только TX) для приёма и передачи данных, при этом контакты TX и RX соединяются внутри чипа.

Для включения полудуплексного режима необходимо установить бит '''HDSEL''' в позиции регистра управления 3 ('''R16_USARTx_CTLR3'''), но также необходимо отключить режим LIN, режим смарт-карты, ИК-режим и синхронный режим, то есть обеспечить сброс битов '''SCEN''', '''CLKEN''' и '''IREN''', находящихся в регистрах управления 2 и 3 ('''R16_USARTx_CTLR2''' и '''R16_USARTx_CTLR3''').

После установки в полудуплексный режим необходимо настроить порт ввода-вывода TX на работу в режиме открытого стока с высоким уровнем выхода. При установке '''TE''' данные будут отправляться сразу же после записи их в регистр данных. Особое внимание следует уделить тому факту, что полудуплексный режим может привести к конфликтам шины при использовании нескольких устройств одной шины для отправки и получения данных, чего пользователь должен избегать программными средствами.
</blockquote>
<span id="режим-смарткарт-smart-card"></span>
== 12.6 Режим смарткарт (Smart Card) ==

<blockquote>Режим смарт-карты поддерживает доступ к контроллерам смарт-карт по протоколу ISO7816-3.

Для включения режима смарт-карта необходимо установить бит '''SCEN''' в позиции регистра управления 3 ('''R16_USARTx_CTLR3'''), но также необходимо отключить режим LIN, полудуплексный режим и ИК-режим, то есть обеспечить сброс битов '''LINEN''', '''HDSEL''' и '''IREN''', но '''CLKEN''' может быть включён для вывода тактового сигнала, эти биты находятся в регистрах управления 2 и 3 ('''R16_USARTx_CTLR2''' и '''R16_USARTx_CTLR3''').

Для поддержки режима смарт-карточек USART должен быть установлен на 8 бит данных плюс 1 бит чётности, а стоп-бит рекомендуется настраивать на 1,5 бита как для передачи, так и для приёма. Режим смарткарты представляет собой полудуплексный протокол с использованием одной линии связи, где используется линия TX для обмена данными и должна быть сконфигурирована как выходной каскад с открытым стоком плюс подтягивающий резистор. Когда приёмник получает кадр данных и обнаруживает ошибку чётности, он посылает сигнал NACK, то есть активно притягивает линию TX вниз на один цикл во время стоп-бита, а отправитель обнаруживает сигнал NACK и генерирует ошибку кадра, благодаря чему приложение может повторно передать данные. На рис. 17-4 показаны формы сигналов на контакте TX в нормальном случае и в случае ошибки чётности. Флаг '''TC''' (флаг завершения передачи) USART может задержать генерацию '''GT''' (время защиты) на один такт, и приёмник не распознаёт установленный им сигнал NACK как стартовый бит.

Рисунок 12-4 Диаграмма (не)возникновения ошибки чётности

[[File:media/image37.png|504x219px]]

В режиме смарт-карты форма сигнала, выводимого контактом CK при включении, никак не связана с коммуникацией; она просто подаёт тактовый сигнал на смарт-карту со значением тактового сигнала AHB, разделённого на пять бит (в два раза больше значения '''PSC''', вплоть до 62 делений).
</blockquote>
<span id="irda"></span>
== 12.7 IrDA  ==

<blockquote>Модуль USART поддерживает управление инфракрасными трансиверами IrDA для физической коммуникации. Для использования IrDA необходимо сбросить биты '''LINEN''', '''STOP''', '''CLKEN''', '''SCEN''' и '''HDSEL'''. Между модулем USART и физическим уровнем SIR (инфракрасный трансивер) используется кодирование '''NRZ''' (без возврата к нулю), поддерживаемое до скоростей 115200 бод.

IrDA является полудуплексным протоколом. Если USART передает данные физическому уровню '''SIR''', декодер IrDA игнорирует вновь поступающий инфракрасный сигнал. Если USART принимает данные от '''SIR''', то '''SIR''' не примет сигнал от USART. Логика уровней USART для '''SIR''' и '''SIR''' для USART различается. В логике приема '''SIR''' высокий уровень соответствует 1, а низкий — 0, но в логике передачи SIR высокий уровень равен 0, а низкий — 1.
</blockquote>
<span id="прямой-доступ-к-памяти-dma"></span>
== 12.8 Прямой доступ к памяти (DMA)  ==

<blockquote>Модуль USART поддерживает функцию DMA, которая может использоваться для достижения быстрой и непрерывной передачи и приема данных. Когда DMA активирован, DMA записывает данные из заданного пространства памяти в буфер передачи, когда установлен флаг '''TXE'''. При использовании DMA для приема данных, каждый раз, когда устанавливается флаг '''RXNE''', DMA переносит данные из буфера приема в определенное пространство памяти.
</blockquote>
<span id="прерывания"></span>
== 12.9 Прерывания  ==

<blockquote>Модуль USART поддерживает различные источники прерываний, включая пустоту регистра передачи данных ('''TXE'''), CTS, завершение передачи ('''TC'''), готовность принимаемых данных ('''RXNE'''), переполнение данных ('''ORE'''), неактивную линию (IDLE), ошибку четности ('''PE'''), флаг отключения ('''LBD'''), шум ('''NE'''), переполнение для многобуферной связи ('''ORT''') и ошибку кадра ('''FE'''), среди прочих.

Таблица 12-1 Соотношение между прерываниями и соответствующими битами разрешения
</blockquote>
<span id="описание-регистров-10"></span>
== 12.10 Описание регистров  ==

<blockquote>Таблица 12-2 Список регистров, связанных с USART

Начало формы
</blockquote>
<span id="usart-status-register-usart_statr"></span>
=== 12.10.1 USART Status Register (USART_STATR)  ===

<span id="section-1"></span>
===  ===

<span id="usart-data-register-usart_datar"></span>
=== 12.10.2 USART Data Register (USART_DATAR)  ===

<span id="usart-baud-rate-register-usart_brr"></span>
=== 12.10.3 USART Baud Rate Register (USART_BRR)  ===

<span id="usart-control-register-1-usart_ctlr1"></span>
=== 12.10.4 USART Control Register 1 (USART_CTLR1)  ===

<span id="section-2"></span>
===  ===

<span id="usart-control-register-2-usart_ctlr2"></span>
=== 12.10.5 USART Control Register 2 (USART_CTLR2)  ===

<span id="usart-control-register-3-usart_ctlr3"></span>
=== 12.10.6 USART Control Register 3 (USART_CTLR3)  ===

<span id="usart-guard-time-and-prescaler-register-usart_gpr"></span>
=== 12.10.7 USART Guard Time and Prescaler Register (USART_GPR)  ===

<span id="глава-13-интерфейс-межмикросхемной-связи-i2c"></span>
= Глава 13 Интерфейс межмикросхемной связи (I2C)  =

<blockquote>Шина внутренней микросхемы (I2C) широко применяется для связи микроконтроллеров с датчиками и другими внекристальными модулями. Она поддерживает режимы с несколькими ведущими и несколькими ведомыми устройствами и может обеспечивать связь на скоростях 100 КГц (стандартная) и 400 КГц (быстрая) всего лишь двумя линиями (SDA и SCL). Поддерживаются функции тайминга и DMA, а также функция проверки контрольной суммы CRC.
</blockquote>
<span id="основные-характеристики-6"></span>
== 13.1 Основные характеристики  ==

* Поддержка режимов мастера и слейва
* Поддержка 7-битных и 10-битных адресов
* Устройства-слейвы поддерживают двойные 7-битные адреса
* Поддержка двух скоростных режимов: 100 КГц и 400 КГц
* Множество состояний и множество флагов ошибок
* Поддержка расширенных функций часов
* Два вектора прерываний
* Поддержка DMA
* Поддержка PEC
* Совместимость с SMBus

<span id="обзор-6"></span>
== 13.2 Обзор ==

<blockquote>I2C представляет собой полудуплексную шину, которая может работать только в одном из следующих четырех режимов одновременно: режим передачи ведущего устройства, режим приема ведущего устройства, режим передачи ведомого устройства и режим приема ведомого устройства. Модуль I2C по умолчанию работает в режиме слейва и автоматически переключается в режим мастера при генерации условия старта и в режим слейва при потере арбитража или генерации сигнала остановки. Модуль I2C поддерживает функциональность с несколькими мастерами. Работая в режиме мастера, модуль I2C активно излучает данные и адреса. Как данные, так и адрес передаются блоками по 8 бит, причем старший бит идет первым, а младший — последним. После события старта следует однобайтовая (в режиме 7-битного адреса) или двухбайтовая (в режиме 10-битного адреса) информация об адресе, и для каждых 8-битных данных или адреса, отправленных хостом, слейву необходимо ответить подтверждением ACK, притянув шину SDA к низкому уровню, как показано на Рисунке 13-1.

Рисунок 13-1 Временная диаграмма I2C

Для корректной работы I2C необходимо подавать правильный тактовый сигнал, который должен быть минимум 2 МГц в стандартном режиме и 4 МГц в быстром режиме.

На рисунке 13-2 представлена функциональная блок-схема модуля I2C.
</blockquote>
'''Noise'''

'''filter'''

'''Data'''

'''control'''

'''Data shift register'''

'''Data register'''

'''Comparator'''

'''PEC calculation'''

'''Own address register'''

'''Dual address register'''

'''PEC register'''

'''Noise'''

'''filter'''

'''Clock'''

'''control'''

'''Clock control'''

'''Register (CKCFGR)'''

'''Control registers'''

'''CTLR1&amp;CTLR'''

'''2)'''

'''('''

'''Status registers'''

'''('''

'''2)'''

'''STAR1&amp;STAR'''

'''Control'''

'''logic'''

'''SDA'''

'''SCL'''

'''SMBA'''

'''Interrupts'''

'''DMA requests &amp; ACK'''

<span id="режим-мастера-master-mode"></span>
== 13.3 Режим мастера (Master Mode) ==

<blockquote>В режиме мастера модуль I2C управляет передачей данных и выдает сигнал синхронизации, а передача данных начинается с события начала и заканчивается событием окончания. Шаги для использования общения в режиме мастера следующие. Установка правильного тактового сигнала в регистре управления 2 (R16_I2Cx_CTLR2) и регистре контроля тактового сигнала (R16_I2Cx_CKCFGR). Установка соответствующего фронта в регистре фронтов (R16_I2Cx_RTR). Установка бита PE в регистре управления (R16_I2Cx_CTLR1) для запуска периферии. Установка бита START в регистре управления (R16_I2Cx_CTLR1) для генерации события начала.После установки бита START модуль I2C автоматически перейдет в основной режим, бит MSL будет установлен и событие начала будет сгенерировано. После генерации события начала будет установлен бит SB, и если установлен бит ITEVTEN (в R16_I2Cx_CTLR2), произойдет прерывание. В этот момент следует прочитать регистр статуса 1 (R16_I2Cx_STAR1), а бит SB будет автоматически очищен после записи адреса в регистр данных.

Если используется режим 10-битного адреса, то регистр записи данных отправляет заголовочную последовательность (заголовочная последовательность имеет вид 11110xx0b, где биты xx являются старшими двумя битами 10-битного адреса). После отправки заголовочной последовательности в регистре состояния будет установлен бит ADD10, и если был установлен бит ITEVTEN, будет сгенерировано прерывание. В этот момент следует прочитать регистр R16_I2Cx_STAR1 и очистить бит ADD10 после записи второго байта адреса в регистр данных.

Затем запишите второй байт адреса в регистр данных для его отправки. После отправки второго байта адреса в регистре состояния будет установлен бит ADDR. Если уже установлен бит ITEVTEN, будет сгенерировано прерывание. В этот момент следует прочитать регистр R16_I2Cx_STAR1, а затем однократно прочитать регистр R16_I2Cx_STAR2, чтобы очистить бит ADDR;

Если используется режим 7-битного адреса, то запишите байт адреса в регистр данных. После отправки байта адреса в регистре состояния установится бит ADDR. Если установлен бит ITEVTEN, то будет сгенерировано прерывание. В этом случае следует прочитать регистр R16_I2Cx_STAR1 и затем однократно прочитать регистр R16_I2Cx_STAR2 для очистки бита ADDR.

В режиме 7-битного адреса первый отправляемый байт — это байт адреса, первые 7 бит представляют адрес целевого ведомого устройства, 8-й бит определяет направление последующего сообщения: 0 означает, что ведущее устройство записывает данные в ведомое устройство, 1 означает, что ведущее устройство считывает информацию из ведомого устройства.

В режиме 10-битного адреса, как показано на Рисунке 13-3, на этапе отправки адреса первый байт имеет формат 11110xx0, где xx — это две старших цифры 10-битного адреса, а второй байт содержит младшие 8 бит 10-битного адреса. Если впоследствии предполагается перейти в режим передачи данных мастером, продолжайте отправлять данные; если планируется переход в режим приема данных мастером, необходимо повторно отправить условие начала, затем отправить байт в формате 11110xx1 и после этого перейти в режим приема данных мастером.

Рисунок 13-3 Диаграмма отправки и получения данных мастером при 10-битном адресе
</blockquote>
'''S'''

'''1'''

'''1 1 1 0 X X'''

'''0'''

'''A'''

'''Address 7- 0'''

'''A'''

'''DATA'''

'''A'''

'''DATA'''

'''A'''

'''P'''

'''('''

'''The upper 2 bits'''

'''of the address)'''

''')'''

'''('''

'''Write'''

'''The lower 8 bits of'''

'''the address'''

'''Transmitter'''

'''S'''

'''1'''

'''1 1 1 0 X X'''

'''0'''

'''A'''

'''Address 7- 0'''

'''A'''

'''DATA'''

'''A'''

'''DATA'''

'''A'''

'''P'''

'''The upper 2 bits'''

'''('''

'''of the address)'''

'''('''

'''Write'''

''')'''

'''The lower 8 bits of'''

'''the address'''

'''S'''

'''1'''

'''1 1 1 0 X X'''

'''1'''

'''A'''

'''('''

'''Read'''

''')'''

'''Receiver'''

<blockquote>Режим передачи данных мастером
</blockquote>
:

<blockquote>Внутренний сдвиговый регистр ведущего устройства отправляет данные из регистра данных на линию SDA. Когда ведущее устройство получает подтверждение (ACK), в регистре состояния 1 (R16_I2Cx_STAR1) устанавливается бит TxE, и также генерируется прерывание, если установлены биты ITEVTEN и ITBUFEN. Запись данных в регистр данных очистит бит TxE.

Если бит TxE установлен и новые данные не были записаны в регистр данных до отправки последних данных, то будет установлен бит BTF, и SCL останется низким до тех пор, пока он не будет очищен. Запись данных в регистр данных после чтения R16_I2Cx_STAR1 очистит бит BTF.
</blockquote>
Рисунок 13-4 Диаграмма последовательности передачи данных передатчиком мастера

{| class="wikitable"
|-
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: left;"|
| colspan="6" style="text-align: left;"| 7-бит посылка мастера
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: center;"| S
| style="text-align: center;"|
| style="text-align: center;"| Address
| style="text-align: center;"| A
| style="text-align: center;"|
| style="text-align: center;"|
| style="text-align: center;"| Data1
| style="text-align: center;"| A
| style="text-align: center;"| Data2
| style="text-align: center;"|  
| style="text-align: center;"| A
| style="text-align: center;"|
| style="text-align: center;"|  
| style="text-align: center;"| DataN
| style="text-align: center;"| A
| style="text-align: center;"|
| style="text-align: center;"| P
| style="text-align: center;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: left;"|
| style="text-align: center;"| EVT5
| style="text-align: center;"|
| style="text-align: center;"|
| style="text-align: center;"| EVT6
| style="text-align: center;"| EVT8_1
| style="text-align: center;"| EVT8
| style="text-align: center;"|
| style="text-align: center;"| EVT8
| style="text-align: center;"|
| style="text-align: center;"|
| style="text-align: center;"| EVT8
| style="text-align: center;"|
| style="text-align: center;"|
| style="text-align: center;"|
| style="text-align: center;"| EVT8_2
| style="text-align: center;"|
| style="text-align: center;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: left;"|
| colspan="6" style="text-align: left;"| 10-бит посылка мастера
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: center;"| S
| style="text-align: center;"|
| style="text-align: center;"| Frame header
| style="text-align: center;"| A
| style="text-align: center;"|
| style="text-align: center;"| Address
| style="text-align: center;"| A
| style="text-align: center;"|
| style="text-align: center;"|
| style="text-align: center;"| Data1
| style="text-align: center;"| A
| style="text-align: center;"| Data2
| style="text-align: center;"|  
| style="text-align: center;"| A
| style="text-align: center;"|
| style="text-align: center;"|  
| style="text-align: center;"| DataN
| style="text-align: center;"| A
| style="text-align: center;"|
| style="text-align: center;"| P
| style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: left;"|
| style="text-align: center;"| EVT5
| style="text-align: center;"|
| style="text-align: center;"|
| style="text-align: center;"| EVT9
| style="text-align: center;"|
| style="text-align: center;"|
| style="text-align: center;"| EVT6
| style="text-align: center;"| EVT8_1
| style="text-align: center;"| EVT8
| style="text-align: center;"|
| style="text-align: center;"| EVT8
| style="text-align: center;"|
| style="text-align: center;"|
| style="text-align: center;"| EVT8
| style="text-align: center;"|
| style="text-align: center;"|
| style="text-align: center;"|
| style="text-align: center;"| EVT8_2
| style="text-align: center;"|
| style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
|}

<blockquote>Описание:

S=Старт (условие старта), Sr=повторный старт, P=Стоп (условие остановки), A=ответ, NA=отсутствие ответа, '''EVTx'''=событие (прерывание генерируется, когда '''ITEVFEN'''=1)

EVT5: '''SB'''=1, чтение '''SR1''', а затем запись адреса в регистр '''DR''' очищает событие.

EVT6; '''ADDR'''=1, сначала читаем '''SR1''', затем читаем '''SR2''', чтобы очистить событие.

EVT81: '''TxE'''=1, сдвиговый регистр пуст, регистр данных пуст, запись в регистр '''DR'''.

EVT8: '''TxE'''=1, сдвиговый регистр не пустой, регистр данных пустой, запись в '''DR''' регистр очистит событие.

EVT82: '''TxE'''=1, '''BTF'''=1, запрос на установку бита остановки. Биты '''TxE''' и '''BTF''' аппаратно очищаются при генерации условия остановки.

EVT9: '''ADDR10'''=1, чтение '''SR1''' и последующая запись в '''DR''' очистят событие.

''Примечание:''

''1: События EVT5, EVT6, EVT9, EVT8_1 и EVT8_2 удлиняют низкий уровень SCL до конца соответствующей программной последовательности.''

''2: Программная последовательность EVT8 должна быть завершена до окончания текущей передачи байта.''

Режим приема мастером:

Модуль I2C будет принимать данные с линии SDA и записывать их в регистр данных через сдвиговый регистр. После каждого байта, если установлен бит '''ACK''', модуль I2C отправит ответ с низким уровнем, и будет установлен бит '''RxNE''', и, если установлены биты '''ITEVTEN''' и '''ITBUFEN''', будет сгенерировано прерывание. Если установлен бит '''RxNE''' и исходные данные не прочитаны до получения новых данных, будет установлен бит '''BTF''', и SCL останется низким до тех пор, пока '''BTF''' не будет очищен. Чтение '''R16_I2Cx_STAR1''', а затем чтение регистра данных очистит бит '''BTF'''.

Figure 13-5 Receiver transmission sequence diagram
</blockquote>
{| class="wikitable"
|-
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! colspan="2" style="text-align: left;"|  
! style="text-align: left;"|  
! colspan="2" style="text-align: left;"|  
! style="text-align: left;"|  
! colspan="2" style="text-align: left;"|  
! colspan="2" style="text-align: left;"|  
! colspan="2" style="text-align: left;"|  
! colspan="2" style="text-align: left;"|  
! colspan="2" style="text-align: left;"|  
! style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: left;"|
| colspan="6" style="text-align: left;"| 7-бит прием мастера
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: center;"| S
| style="text-align: center;"|
| style="text-align: center;"| Address
| style="text-align: center;"| A
| style="text-align: center;"|
| style="text-align: center;"| Data1
| style="text-align: center;"| A(1)
| colspan="2" style="text-align: center;"| Data2
| style="text-align: center;"| A
| style="text-align: center;"|
| colspan="2" style="text-align: center;"|  
| style="text-align: center;"| DataN
| colspan="2" style="text-align: center;"| NA
| style="text-align: center;"| P
| colspan="2" style="text-align: center;"|  
| colspan="2" style="text-align: center;"|
| colspan="2" style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: left;"|
| style="text-align: center;"| EVT5
| style="text-align: center;"|
| style="text-align: center;"|
| style="text-align: center;"| EVT6
| style="text-align: center;"| EVT6_1
| style="text-align: center;"|
| style="text-align: center;"| EVT7
| style="text-align: center;"|
| style="text-align: center;"|
| style="text-align: center;"| EVT7
| colspan="2" style="text-align: center;"|
| style="text-align: center;"| EVT8_2
| colspan="2" style="text-align: center;"|
| style="text-align: center;"| EVT7
| colspan="2" style="text-align: center;"|
| colspan="2" style="text-align: center;"|
| colspan="2" style="text-align: center;"|
| colspan="2" style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: left;"|
| colspan="6" style="text-align: left;"| 10-бит прием мастера
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: center;"| S
| style="text-align: center;"|
| style="text-align: center;"| Frame header
| style="text-align: center;"| A
| style="text-align: center;"|
| style="text-align: center;"| Address
| style="text-align: center;"| A
| style="text-align: center;"|
| style="text-align: center;"|
| style="text-align: left;"|
| style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: left;"|
| style="text-align: center;"| EVT5
| style="text-align: left;"| {| class="wikitable"
|-
! style="text-align: left;"|
|}

| style="text-align: left;"|
| style="text-align: center;"| EVT9
| style="text-align: center;"|
| style="text-align: center;"|
| style="text-align: center;"| EVT6
| style="text-align: center;"|
| style="text-align: left;"|
| style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| colspan="2" style="text-align: left;"|
| style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: center;"| Sr
| style="text-align: center;"|
| style="text-align: center;"| Frame header
| style="text-align: center;"| A
| style="text-align: center;"|
| style="text-align: center;"| Data1
| style="text-align: center;"| A(1)
| colspan="2" style="text-align: center;"| Data2
| colspan="2" style="text-align: center;"| A
| style="text-align: center;"|
| colspan="2" style="text-align: center;"|  
| style="text-align: center;"| DataN
| colspan="2" style="text-align: center;"|  
| colspan="2" style="text-align: center;"| NA
| colspan="2" style="text-align: center;"| P
| colspan="2" style="text-align: center;"|  
| colspan="2" style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: center;"| EVT5
| style="text-align: center;"|
| style="text-align: center;"|
| style="text-align: center;"| EVT6
| style="text-align: center;"| EVT6_1
| style="text-align: center;"|
| style="text-align: center;"| EVT7
| colspan="2" style="text-align: center;"|
| style="text-align: center;"|
| colspan="2" style="text-align: center;"| EVT2
| style="text-align: center;"|
| colspan="2" style="text-align: center;"| EVT7_1
| colspan="2" style="text-align: center;"|
| colspan="2" style="text-align: center;"|
| colspan="2" style="text-align: center;"| EVT2
| colspan="2" style="text-align: center;"|
| style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| colspan="2" style="text-align: left;"|  
| style="text-align: left;"|  
| colspan="2" style="text-align: left;"|  
| style="text-align: left;"|  
| colspan="2" style="text-align: left;"|  
| colspan="2" style="text-align: left;"|  
| colspan="2" style="text-align: left;"|  
| colspan="2" style="text-align: left;"|  
| colspan="2" style="text-align: left;"|  
| style="text-align: left;"|  
|}

<blockquote>Описание:

S=Старт (условие старта), Sr=повторный старт, P=Стоп (условие остановки), A=ответ, NA=отсутствие ответа, '''EVTx'''=событие (прерывание генерируется, когда '''ITEVFEN'''=1)

EVT5: '''SB'''=1, чтение '''SR1''', а затем запись адреса в регистр '''DR''' очистит событие.

EVT6: '''ADDR'''=1, сначала читаем '''SR1''', затем читаем '''SR2''', чтобы стереть это событие. В режиме приема мастером с 10-битным адресом после этого события следует установить START=1 в '''CR2'''.

EVT61: Нет соответствующего флага события, и оно подходит только для приема 1 байта. Сразу после EVT6 (то есть после очистки '''ADDR'''), биты генерации условий ответа и остановки должны быть очищены.

EVT7: '''RxNE'''=1, читайте регистр '''DR''', чтобы очистить событие.

EVT71: '''RxNE'''=1, прочтите регистр '''DR''' для очистки этого события. Установить '''ACK'''=0 и запрос на остановку.

EVT9: '''ADDR10'''=1, чтение '''SR1''' и последующая запись в регистр '''DR''' удаляют это событие.

Когда ведущее устройство заканчивает отправку данных, оно активно отправляет событие окончания, то есть устанавливает бит STOP, и I2C переключается в режим слейва. В режиме приема ведущему устройству необходимо отправить NAK на позицию ответа последнего бита данных, а после получения NACK ведомое устройство освобождает контроль над линиями SCL и SDA; ведущее устройство затем может отправить условие остановки/повторного старта. Обратите внимание, что модуль I2C автоматически переключается в режим ведомого устройства после генерации условия остановки.
</blockquote>
<span id="режим-слейва-slave-mode"></span>
== 13.4 Режим слейва (Slave Mode) ==

<blockquote>Когда модуль I2C находится в режиме слейва, он распознает свой собственный адрес и широковещательный вызов. Программное обеспечение может контролировать, включена или отключена функция распознавания широковещательного вызова. Как только обнаружено событие начала, модуль I2C сравнивает данные SDA через сдвиговый регистр со своим собственным адресом (количество битов зависит от ENDUAL и ADDMODE) или широковещательным адресом (при установленной ENGC). Если обнаружено несоответствие, оно будет проигнорировано до появления нового события начала. Если совпадает с заголовком, генерируется сигнал ACK, и ожидается адрес второго байта; если адрес второго байта также совпадает или совпадает полный сегментный адрес в случае 7-битного адреса, то: сначала генерируется ответ ACK; устанавливается бит ADDR, и если бит ITEVTEN уже установлен, генерируются соответствующие пререрывание; если используется режим двойного адреса (установлен бит ENDUAL), необходимо также прочитать бит DUALF, чтобы определить, какой адрес вызывает хоста. По умолчанию используется режим слейвом приеме. Если последний бит полученной заголовочной последовательности равен 1, или последний бит 7-битового адреса равен 1 (в зависимости от того, была получена заголовочная последовательность впервые или обычный 7-битный адрес), модуль I2C перейдёт в режим передачи, а бит TRA указывает, находится ли он сейчас в режиме приема или передачи.

Режим передачи слейвом:

После очистки бита ADDR модуль I2C отправляет байты из регистра данных на линию SDA через сдвиговый регистр. После получения подтверждения ACK, устанавливается бит TxE, и генерируется прерывание, если установлены биты ITEVTEN и ITBUFEN. Если установлен бит TxE и новые данные не были записаны в регистр данных до окончания отправки следующих данных, будет установлен бит BTF. SCL остаётся низким до тех пор, пока BTF не будет очищен. Чтение регистра состояния 1 (R16_I2Cx_STAR1) и последующая запись данных в регистр данных очистит бит BTF.

Рисунок 13-6 Диаграмма последовательности передачи данных передатчика слейва
</blockquote>
{| class="wikitable"
|-
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: left;"|
| colspan="6" style="text-align: left;"| 7-бит передача слейва
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: center;"| S
| style="text-align: center;"| Address
| style="text-align: center;"| A
| style="text-align: center;"|
| style="text-align: left;"|
| style="text-align: center;"| Data1
| style="text-align: center;"| A
| colspan="2" style="text-align: center;"| Data2
| style="text-align: center;"| A
| style="text-align: center;"|
| style="text-align: center;"|  
| style="text-align: center;"| DataN
| style="text-align: center;"| NA
| style="text-align: center;"| P
| style="text-align: center;"|
| style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: left;"|
| style="text-align: center;"|
| style="text-align: left;"|
| style="text-align: center;"| EVT1
| style="text-align: center;"| EVT3_1
| style="text-align: center;"| EVT3
| style="text-align: center;"|
| style="text-align: center;"| EVT3
| style="text-align: center;"|
| style="text-align: center;"|
| style="text-align: center;"| EVT3
| style="text-align: center;"|
| style="text-align: center;"|
| style="text-align: left;"|
| colspan="2" style="text-align: center;"| EVT3_2
| style="text-align: center;"|  
|-
| style="text-align: left;"|  
| style="text-align: left;"|
| colspan="6" style="text-align: left;"| 10-бит передача слейва
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: center;"| S
| style="text-align: center;"| Frame header
| style="text-align: center;"| A
| style="text-align: center;"| Address
| style="text-align: center;"| A
| style="text-align: center;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: center;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: left;"|
| style="text-align: center;"|
| style="text-align: left;"| {| class="wikitable"
|-
! style="text-align: left;"|
|}

| style="text-align: left;"|
| style="text-align: center;"|
| style="text-align: center;"| EVT9
| style="text-align: center;"|
| style="text-align: center;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: center;"| Sr
| style="text-align: center;"| Frame header
| style="text-align: center;"| A
| style="text-align: center;"|
| style="text-align: left;"|
| style="text-align: center;"| Data1
| style="text-align: center;"| A
| style="text-align: center;"|
| style="text-align: center;"|  
| style="text-align: center;"| DataN
| style="text-align: center;"| NA
| style="text-align: center;"| P
| style="text-align: center;"|
| style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: center;"|
| style="text-align: left;"|
| style="text-align: center;"| EVT1
| style="text-align: center;"| EVT3_1
| style="text-align: center;"| EVT3
| style="text-align: center;"|
| style="text-align: center;"| EVT3
| style="text-align: center;"|
| style="text-align: center;"|
| style="text-align: center;"|
| colspan="2" style="text-align: center;"| EVT7_1
| style="text-align: center;"|  
|-
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
|}

<blockquote>Описание:

S=Старт (условие старта), Sr=повторный старт, P=Остановка (условие остановки), A=Ответ, NA=Отказ, '''EVTx'''=Событие (прерывание генерируется, когда '''ITEVFEN'''=1)

EVT1; '''ADDR'''=1, чтение '''SR1''', а затем чтение '''SR2''' устранит событие.

EVT31: '''TxE'''=1, сдвиговый регистр пуст, регистр данных пуст, напишите '''DR'''.

EVT3: '''TxE'''=1, регистр сдвига не пуст, регистр данных пусто, запись '''DR''' очистит событие.

EVT32: '''AF'''=1, записать '0' в бит '''AF''' регистра '''SR1''' для очистки бита '''AF'''.

''Примечание:''

''1: События EVT1 и EVT3_1 продлевают состояние низкого уровня SCL до завершения соответствующей программной последовательности.''

''2: Программная последовательность EVT3 должна быть завершена до завершения текущего байта передачи.''

Режим приема слейвом:

После очистки бита '''ADDR''' модуль I2C сохраняет данные с SDA в регистр данных через сдвиговый регистр. После получения каждого байта модуль I2C устанавливает бит '''ACK''' и устанавливает бит '''RxNE''', и генерирует прерывание, если установлены биты '''ITEVTEN''' и '''ITBUFEN'''. Если установлен бит '''RxNE''' и старые данные не были прочитаны до получения новых данных, то устанавливается бит '''BTF'''. SCL остается на низком уровне до тех пор, пока бит '''BTF''' не очищен. Чтение регистра состояния 1 ('''R16_I2Cx_STAR1''') и чтение данных в регистре данных очистит бит '''BTF'''.

Рисунок 13-7 Диаграмма последовательности передачи данных приемника
</blockquote>
{| class="wikitable"
|-
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
! style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: left;"|
| colspan="6" style="text-align: left;"| 7-бит прием слейва
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: center;"| S
| style="text-align: center;"| Address
| style="text-align: center;"| A
| style="text-align: center;"|
| style="text-align: center;"| Data1
| style="text-align: center;"| A
| colspan="2" style="text-align: center;"| Data2
| style="text-align: center;"| A
| style="text-align: center;"|
| style="text-align: center;"|  
| style="text-align: center;"| DataN
| style="text-align: center;"| A
| colspan="2" style="text-align: center;"| P
| style="text-align: center;"|
| style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: left;"|
| style="text-align: center;"|
| style="text-align: left;"|
| style="text-align: center;"| EVT1
| style="text-align: center;"|
| style="text-align: left;"|
| style="text-align: center;"| EVT2
| style="text-align: center;"|
| style="text-align: left;"|
| style="text-align: center;"| EVT2
| style="text-align: center;"|
| style="text-align: left;"|
| style="text-align: center;"|
| style="text-align: center;"| EVT2
| style="text-align: center;"|
| style="text-align: center;"| EVT4
| style="text-align: center;"|  
|-
| style="text-align: left;"|  
| style="text-align: left;"|
| colspan="6" style="text-align: left;"| 10-бит приема слейва
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: center;"| S
| style="text-align: center;"| Frame header
| style="text-align: center;"| A
| style="text-align: center;"| Address
| style="text-align: center;"| A
| style="text-align: center;"|
| style="text-align: center;"| Data1
| style="text-align: center;"| A
| style="text-align: center;"|
| style="text-align: center;"|  
| style="text-align: center;"| DataN
| style="text-align: center;"| A
| colspan="2" style="text-align: center;"| P
| style="text-align: center;"|
| style="text-align: left;"|
| style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: left;"|
| style="text-align: center;"|
| style="text-align: left;"|
| style="text-align: center;"|
| style="text-align: center;"|
| style="text-align: center;"| EVT1
| style="text-align: center;"|
| style="text-align: center;"|
| style="text-align: center;"| EVT2
| style="text-align: center;"|
| style="text-align: left;"|
| style="text-align: left;"|
| style="text-align: center;"| EVT2
| style="text-align: center;"|
| style="text-align: center;"| EVT4
| style="text-align: center;"|
| style="text-align: left;"|  
|-
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
| style="text-align: left;"|  
|}

<blockquote>Описание:

S=Старт (условие старта), Sr=Повторный старт, P=Стоп (условие остановки), A=Ответ, NA=Отказ, EVTx=Событие (прерывание генерируется, когда ITEVFEN=1)

EVT1; ADDR=1, чтение SR1, а затем чтение SR2 удаляет событие.

EVT2: RxNE=1, чтении DR очищает событие.

EVT4: STOPF=1, чтению SR1 и последующей записи в регистр CR1 очистит событие.

''Примечание:''

''1: Событие EVT1 увеличивает длительность низкого уровня SCL до завершения соответствующей программной последовательности.''

''2: Программная последовательность EVT2 должна быть завершена до завершения текущего байта передачи.''

Ведущее устройство сгенерирует условие остановки после передачи последнего байта данных. Когда модуль I2C обнаружит событие остановки, он установит бит STOPF, и если бит ITEVFEN установлен, он также сгенерирует прерывание. Пользователю необходимо прочитать регистр состояния (например, R16_I2Cx_STAR1) и затем записать в регистр управления (например, сбросить слово управления SWRST) для его очистки. (См. EVT4 на приведенном выше рисунке).
</blockquote>
<span id="условия-возникновения-ошибок"></span>
== 13.5 Условия возникновения ошибок ==

<span id="ошибка-шины-berr"></span>
=== 13.5.1 Ошибка шины (BERR)  ===

<blockquote>Ошибка шины возникает, когда модуль I2C обнаруживает внешние события начала или остановки во время передачи адреса или данных. Когда возникает ошибка шины, устанавливается бит '''BERR''', и генерируется прерывание, если установлен бит '''ITERREN'''. В режиме слейва данные отбрасываются, и оборудование освобождает шину. Если это сигнал старта, оборудование считает его сигналом перезапуска и ожидает сигнала адреса или остановки. Если сигнал остановки, оборудование продолжает функционировать как обычно, ожидая нормального сигнала остановки. В мастерском режиме, оборудование не отпускает шину, и пользовательский код решает, продолжить передачу или прервать её.
</blockquote>
<span id="ошибка-подтверждения-af"></span>
=== 13.5.2 Ошибка подтверждения (AF)  ===

<blockquote>Ошибка ответа возникает, когда модуль I2C обнаруживает байт данных, но не получает подтверждения. Когда возникает ошибка ответа:
</blockquote>
* Устанавливается бит AF.
* Генерируется прерывание, если установлен бит ITERREN.
* При возникновении ошибки AF, оборудование должно освободить шину, если модуль I2C работает в режиме слейва, и программное обеспечение должно сгенерировать событие остановки, если оно работает в мастер-режиме.

<span id="потеря-арбитража-arlo"></span>
=== 13.5.3 Потеря арбитража (ARLO)  ===

<blockquote>Ошибка потери арбитража возникает, когда модуль I2C обнаруживает потерю арбитража. Когда возникает ошибка потери арбитража:
</blockquote>
* Устанавливается бит ARLO.
* Генерируется прерывание, если установлен бит ITERREN.
* Модуль I2C переходит в режим слейва и перестает отвечать на запросы, направленные на его адрес, если хозяин не инициировал новое событие старта.

<span id="ошибка-переполнениянедостаточного-заполнения-ovr"></span>
=== 13.5.4 Ошибка переполнения/недостаточного заполнения (OVR)  ===

<span id="ошибка-переполнения"></span>
=== Ошибка переполнения ===

<blockquote>В режиме слейва, если расширение тактовой частоты отключено и модуль I2C получает данные, возникает ошибка переполнения, если байт данных был принят, но последние полученные данные еще не были прочитаны. При возникновении ошибки переполнения последнее принятый байт отбрасывается, и отправляющий должен повторить передачу последнего байта.
</blockquote>
<span id="ошибка-недонаполнения"></span>
=== Ошибка недонаполнения ===

<blockquote>В режиме слейва, если запрещено удлинение тактовой частоты и модуль I2C отправляет данные, возникает ошибка недонаполнения, если новые данные не были записаны в регистр данных до наступления следующего байтa clock edge. В случае ошибки недонаполненности, данные из предыдущего регистра данных отправляются дважды, и если возникает ошибка недоучёта, получатель должен отбрасывать повторные данные. Чтобы избежать ошибки недонаполнения, модуль I2C должен записать данные в регистр данных перед появлением первого растянутого края следующего байта.
</blockquote>
<span id="расширение-тактовых-импульсов"></span>
== 13.6 Расширение тактовых импульсов ==

<blockquote>Если расширение тактовых импульсов отключено, возникают риски ошибок переполнения/недостаточного заполнения. Однако, если расширение тактовой частоты включено:
</blockquote>
* В режиме передачи, если установлен бит '''TxE''' и бит '''BTF''', сигнал SCL будет оставаться на низким уровне, ожидаемый пользователем для чтения регистра статуса и записи данных в регистр данных.
* В режиме приема, если установлены биты '''RxNE''' и '''BTF''', SCL останется на низким уровне после получения данных, ожидающегося чтения регистра статусов и данных пользователем. Активация расширения тактовых импульсов помогает предотвратить ошибки переполнения/недостаточно заполненного состояния.

<blockquote>Видно, что включение расширения тактовых импульсов помогает избежать ошибок переполнения/недостаточного заполнения.
</blockquote>
<span id="шина-smbus"></span>
== 13.7 Шина SMBus  ==

<span id="smbus-также-является-двухпроводным-интерфейсом-который-обычно-используется-между-системой-и-управлением-питанием.-у-smbus-и-i2c-много-общего-например-smbus-использует-тот-же-режим-адресации-с-7-битами-что-и-i2c-а-следующие-функции-являются-общими-для-smbus-и-i2c"></span>
== SMBus также является двухпроводным интерфейсом, который обычно используется между системой и управлением питанием. У SMBus и I2C много общего, например, SMBus использует тот же режим адресации с 7 битами, что и I2C, а следующие функции являются общими для SMBus и I2C: ==

<span id="режим-связи-ведущий-ведомый-при-котором-хост-предоставляет-тактовый-сигнал-и-поддерживает-несколько-ведущих-устройств-и-подчиненных."></span>
== Режим связи &quot;ведущий-ведомый&quot;, при котором хост предоставляет тактовый сигнал и поддерживает несколько ведущих устройств и подчиненных. ==

<span id="двухпроводная-архитектура-связи-с-опциональной-линией-предупреждения-для-smbus."></span>
== Двухпроводная архитектура связи, с опциональной линией предупреждения для SMBus. ==

<span id="оба-поддерживают-формат-адреса-длиной-7-битов."></span>
== Оба поддерживают формат адреса длиной 7 битов. ==

<blockquote>Начало формы

Также существуют различия между SMBus и I2C:
</blockquote>
# I2C поддерживает скорости до 400 кГц, тогда как SMBus поддерживает до 100 кГц; кроме того, у SMBus есть ограничение минимальной скорости в 10 кГц.
# При низком уровне тактового сигнала SMBus более чем на 35 мс будет сообщаться о тайм-ауте, однако такого ограничения нет у I2C.
# U SMBus фиксированный логический уровень, тогда как у I2C он зависит от напряжения питания (VDD).
# U SMBus имеется протокол шины, которого нет у I2C.

<blockquote>Кроме того, SMBus включает идентификацию устройств, протоколы разрешения адресов, уникальные идентификаторы устройств, напоминания SMBus и различные шинные протоколы, описанные в спецификации версии 2.0 SMBus. При использовании SMBus необходимо установить только бит SMBus в регистре управления, а биты '''SMBTYPE''' и '''ENAARP''' должны быть настроены по мере необходимости.
</blockquote>
<span id="прерывания-1"></span>
== 13.8 Прерывания  ==

<blockquote>Каждый модуль I2C имеет два вектора прерываний: прерывания событий и прерывания ошибок. Оба типа прерываний поддерживают источники прерываний, указанные на Рисунке 13-4.

Рисунок 13-4 Запрос прерывания I2C
</blockquote>
<span id="прямой-доступ-к-памяти-dma-1"></span>
== 13.9 Прямой доступ к памяти (DMA) ==

DMA может использоваться для отправки и получения больших объемов данных. Бит '''ITBUFEN''' в регистре управления не должен быть установлен при использовании DMA.

Начало формы

* Передача с использованием DMA

РНачало формы

<blockquote>ежим DMA активируется путем установки бита '''DMAEN''' в регистре '''CTLR2'''. Как только бит '''TxE''' установлен, данные будут загружены через DMA из заданной памяти в регистр данных I2C. Для выделения каналов для I2C требуются следующие настройки:
</blockquote>
# Установите адрес регистра '''I2Cx_DATAR''' в регистр '''DMA_PADDRx''', а адрес памяти – в регистр '''DMA_MADDRx''' таким образом, чтобы после каждого события TxE данные отправлялись из памяти в регистр '''I2Cx_DATAR'''.
# Задайте необходимое количество байтов для передачи в регистре '''DMA_CNTRx'''. Это значение будет уменьшаться после каждого события TxE.
# Настройте приоритет канала с помощью битов '''PL'''[0:1] в регистре '''DMA_CFGRx'''.
# Установите бит '''DIR''' в регистре '''DMA_CFGRx''' и, в зависимости от требований приложения, настройте его для выдачи запроса на прерывание, когда вся передача будет выполнена наполовину или полностью.
# Активируйте канал, установив бит '''EN''' в регистре '''DMA_CFGRx'''.

<blockquote>Начало формы

Когда количество байтов передачи данных, установленных в контроллере DMA, завершено, контроллер DMA отправляет сигнал окончания передачи (EOT/EOT_1) на интерфейс I2C. Если разрешено прерывание, будет сгенерировано прерывание DMA.
</blockquote>
* Прием с использованием DMA

Режим приема DMA может быть выполнен после установки '''DMAEN''' в регистре '''CTLR2'''. При использовании режима приема DMA, DMA передает данные из регистра данных в предварительно заданную область памяти. Для выделения каналов для I2C необходимы следующие шаги:

# Установите адрес регистра '''I2Cx_DATAR''' в регистр '''DMA_PADDRx''', а адрес памяти – в регистр '''DMA_MADDRx''' таким образом, чтобы после каждого события '''RxNE''' данные записывались в память из регистра '''I2Cx_DATAR'''.
# Задайте необходимое количество байтов для передачи в регистре '''DMA_CNTRx'''. Это значение будет уменьшаться после каждого события '''RxNE'''.
# Настройте приоритет канала с помощью битов '''PL'''[0:1] в регистре '''DMA_CFGRx'''.
# Сбросьте бит '''DIR''' в регистре '''DMA_CFGRx''', и в зависимости от требований приложения можно настроить выдачу запроса на прерывание, когда передача данных будет выполнена наполовину или полностью.
# Установите бит '''EN''' в регистре '''DMA_CFGRx''' для активации канала.

Начало формы

Когда количество передач данных, установленное в контроллере DMA, завершено, контроллер DMA отправляет сигнал окончания передачи (EOT/EOT_1) на интерфейс I2C. Если прерывание разрешено, будет сгенерировано прерывание DMA.

<span id="проверка-ошибок-пакета"></span>
== 13.10 Проверка ошибок пакета  ==

<blockquote>Контрольная сумма пакета (PEC) — это дополнительный шаг проверки с использованием CRC8 для повышения надежности передачи, рассчитываемый для каждого бита последовательных данных с использованием следующего полинома.

<math display="block">C = X8\  + X2\  + X + 1</math>

Расчёт PEC активируется битом ENPEC в регистре управления и выполняется для всех информационных байтов, включая адрес и биты чтения/записи. При передаче включение PEC добавляет байт результата расчёта CRC8 после последнего байта данных; в режиме приёма последний байт рассматривается как результат проверки CRC8, и если он не совпадает с результатом внутреннего расчёта, будет отправлен ответ NAK, а в случае основного приёмника, независимо от правильности результата проверки.
</blockquote>
<span id="описание-регистров-11"></span>
== 13.11 Описание регистров  ==

Таблица 13-1 Список регистров, связанных с I2C

<span id="i2c-control-register-1i2c1_ctlr1"></span>
=== 13.11.1 I2C Control Register 1(I2C1_CTLR1)  ===

<span id="i2c-control-register-2i2c1_ctlr2"></span>
=== 13.11.2 I2C Control Register 2(I2C1_CTLR2)  ===

<span id="section-3"></span>
===  ===

<span id="i2c-own-address-register-1i2c1_oar1"></span>
=== 13.11.3 I2C Own Address Register 1(I2C1_OAR1)  ===

<span id="i2c-own-address-register-2i2c1_oar2"></span>
=== 13.11.4 I2C Own Address Register 2(I2C1_OAR2)  ===

<span id="i2c-data-register-i2c_datar"></span>
=== 13.11.5 I2C Data Register (I2C_DATAR)  ===

<span id="i2c-status-register-1i2c_star1"></span>
=== 13.11.6 I2C Status Register 1(I2C_STAR1)  ===

<span id="i2c-status-register-2i2c_star2"></span>
=== 13.11.7 I2C Status Register 2(I2C_STAR2)  ===

<span id="i2c-clock-register-i2c1_ckcfgr"></span>
=== 13.11.8 I2C Clock Register (I2C1_CKCFGR)  ===

<span id="глава-14-последовательный-периферийный-интерфейс-spi"></span>
= Глава 14 Последовательный периферийный интерфейс (SPI)  =

<blockquote>SPI поддерживает взаимодействие данных в синхронном последовательном режиме по трём проводам, а также имеет линию выбора чипа для поддержки аппаратного переключения между режимами Master и Slave и поддерживает связь по одной линии данных.
</blockquote>
<span id="основные-характеристики-7"></span>
== 14.1 Основные характеристики ==

* Поддержка полнодуплексного синхронного последовательного режима
* Поддержка полу-дуплексного режима с использованием одной линии
* Поддержка режимов Master и Slave, многорежимного Slave
* Поддерживаются структуры данных длиной 8 или 16 бит
* Максимальная частота тактового сигнала может достигать половины от частоты FHCLK
* Порядок передачи данных поддерживает передачу старшего (MSB) или младшего (LSB) бита первым
* Поддерживается управление выводом NSS как аппаратное, так и программное
* Аппаратная поддержка контрольной суммы CRC при передаче и приеме данных
* Буфер передатчика поддерживает передачу данных через DMA
* Возможность изменения фазы и полярности тактовых сигналов

<blockquote>Начало формы
</blockquote>
<span id="описание-функций-3"></span>
== 14.2 Описание функций ==

<span id="обзор-7"></span>
=== 14.2.1 Обзор ===

<blockquote>Рисунок 14-1 Блок-схема структуры SPIНачало формы

[[File:media/image104.png|522x397px]]

Как видно из Рисунка 14-1, четыре основных вывода, связанных с SPI, это MISO, MOSI, SCK и NSS. Вывод MISO является входным выводом данных, когда модуль SPI работает в режиме Master, и выходным выводом данных, когда он работает в режиме Slave. Вывод MOSI является выходным выводом данных при работе в режиме Master и входным выводом данных при работе в режиме Slave. Выводом SCK является тактовый вывод; тактовый сигнал всегда генерируется ведущим устройством, а ведомое устройство принимает тактовый сигнал и синхронизирует отправку и прием данных. Вывод NSS является выводом выбора чипа, который используется следующим образом.
</blockquote>
# '''Управление NSS программно''': Когда установлен бит '''SSM''', внутренний сигнал '''NSS''' будет иметь высокий или низкий уровень, определяемый состоянием '''SSI'''. Этот случай обычно используется в режиме Master модуля SPI.
# '''Управление NSS аппаратно''': При включении выхода '''NSS''', то есть когда установлен бит '''SSOE''', вывод '''NSS''' будет активно подтягиваться к низкому уровню, когда ведущий SPI начинает передавать данные наружу. Если не удается подтянуть вывод '''NSS''' к низкому уровню (что указывает на наличие другого ведущего устройства на шине, которое уже ведет коммуникацию), будет сгенерирована ошибка оборудования. Если бит '''SSOE''' не установлен, можно использовать режим с несколькими ведущими устройствами, и если этот вывод будет подтянут к низкому уровню извне, устройство принудительно перейдет в режим Slave, и бит '''MSTR''' автоматически сбросится.

<blockquote>Начало формы

Установка бита '''CPHA''' означает, что модуль выбирает данные по второму фронту тактового сигнала и фиксирует их, тогда как сброс бита '''CPHA''' указывает, что SPI-модуль выбирает данные по первому фронту тактового сигнала и также фиксирует их. Бит '''CPOL''' определяет, удерживается ли тактовый сигнал на высоком или низком уровне, когда нет передаваемых данных. Подробности представлены на рисунке 14-2 ниже.
</blockquote>
Рисунок 14-2 Режим SPIНачало формы

[[File:media/image105.png|591x578px]]

<blockquote>Ведущее устройство и ведомое должны быть настроены на одинаковый режим работы SPI, а бит '''SPE''' необходимо сбросить перед настройкой режима SPI. Бит '''DEF''' определяет, составляет ли длина отдельных данных '''SP''' 8 или 16 бит. Бит '''LSBFIRST''' управляет тем, начинается ли одно слово данных со старшего или младшего бита.
</blockquote>
<span id="режим-мастера"></span>
=== 14.2.2 Режим мастера  ===

<blockquote>При работе модуля SPI в режиме Master, последовательный тактовый сигнал генерируется на выводе SCK. Для настройки режима Master выполняются следующие шаги:
</blockquote>
# '''Настройка поля BR[2:0] регистра управления''' для определения частоты тактового сигнала.
# '''Конфигурация битов CPOL и CPHA''' для выбора режима работы SPI.
# '''Конфигурирование бита DEF''' для задания длины слова данных (8 или 16 бит).
# '''Установить бит LSBFIRST''' для указания формата кадра (передача сначала старшего или младшего бита).
# '''Настроить вывод NSS''', например, установив бит '''SSOE''', чтобы позволить аппаратуре управлять выводом '''NSS'''. Также возможно установить бит '''SSM''' и задать высокий уровень на выводе '''NSS''' путем установки бита '''SSI'''.
# '''Убедиться, что вывод NSS находится в высоком состоянии''', прежде чем устанавливать бит '''MSTR''' и бит '''SPE'''.

<blockquote>Когда требуется передать данные, достаточно записать данные в регистр данных. SPI параллельно перенесет данные из буфера передачи в сдвиговый регистр, после чего начнет передачу данных согласно установке бита '''LSBFIRST'''. Как только данные окажутся в сдвиговом регистре, флаг '''TXE''' установится. Если был предварительно установлен бит '''TXEIE''', произойдет генерация прерывания. Чтобы поддерживать непрерывность потока данных, необходимо заполнить позицию флага '''TXE''' новыми данными в регистр данных.

Когда приемник получает данные, по приходу последнего фронта выборки тактового импульса для данного слова данных, они будут переданы из сдвигового регистра в буфер приема параллельно, устанавливается флаг '''RXNE''' и, если ранее был установлен бит '''RXNEIE''', происходит генерация прерывания. В этом случае следует как можно скорее считать данные из регистра данных, чтобы забрать их.Начало формы
</blockquote>
<span id="режим-слейва"></span>
=== 14.2.3 Режим слейва  ===

<blockquote>Когда модуль SPI работает в режиме Slave, вывод SCK используется для получения тактового сигнала от ведущего устройства, и его собственная настройка скорости передачи данных становится недействительной. Для конфигурации в режим Slave выполните следующие действия:
</blockquote>
# '''Настройте бит DEF''' для установки длины бита данных.
# '''Биты CPOL и CPHA''' должны соответствовать режиму работы ведущего устройства.
# '''Бит LSBFIRST''' должен соответствовать формату кадра данных ведущего устройства;
# '''Вывод NSS''' должен находиться в низком состоянии при управлении аппаратурой. Если '''NSS''' управляется программно (установлен бит '''SSM'''), тогда убедитесь, что бит SSI сброшен.
# '''Сбросьте бит MSTR''' и установите бит SPE для включения режима SPI.

<blockquote>Во время передачи данных, когда появляется первый фронт выборки у ведомого устройства на выводе '''SCK''', оно начинает передачу. Процесс отправки заключается в перемещении данных из буфера передачи в регистр сдвига передачи. Когда данные из буфера передачи перемещаются в регистр сдвига, устанавливается флаг '''TXE''', и если до этого был установлен бит '''TXEIE''', генерируется прерывание.

Во время приёма данных, после последнего фронта выборки тактового импульса, устанавливается бит '''RXNE''', байты, принятые регистром сдвига, переносятся в буфер приёма, и операция чтения регистра данных позволяет получить данные из приёмного буфера. Если до установки '''RXNE''' был установлен '''RXNEIE''', то генерируется прерывание.

Начало формы
</blockquote>
<span id="полудуплексный-режим-simplex-mode"></span>
=== 14.2.4 Полудуплексный режим (Simplex Mode) ===

<blockquote>Интерфейс SPI может работать в полудуплексном режиме, где ведущее устройство использует вывод MOSI, а ведомое устройство — вывод MISO для связи. При использовании полудуплексной связи нужно настроить бит '''BIDIMODE''' и использовать '''BIDIOE''' для управления направлением передачи.

Установка бита '''RXONLY''' в обычном полнодуплексном режиме переводит модуль SPI в простой симплексный режим только для приема, освобождая вывод данных после установки '''RXONLY'''. SPI также может быть переведен в режим только передачи, игнорируя принимаемые данные.
</blockquote>
<span id="контрольная-сумма-crc"></span>
=== 14.2.5 Контрольная сумма CRC  ===

<blockquote>Модуль SPI использует контрольную сумму CRC для обеспечения надежности полнодуплексной связи, причем для отправки и приема данных используются отдельные калькуляторы CRC. Полином для вычисления CRC определяется регистром полинома, и для ширины данных 8 бит и 16 бит соответственно применяются различные расчеты. Установка бита '''CRCEN''' активирует проверку контрольной суммы CRC и одновременно сбрасывает калькулятор CRC. После отправки последнего байта данных установка бита '''CRCNEXT''' приведет к отправке результата расчета '''TXCRCR''' после отправки текущего байта, в то время как бит '''CRCERR''' будет установлен, если последнее полученное значение регистра сдвига приема не совпадает с локально рассчитанным значением '''RXCRCR'''. Использование проверки контрольной суммы CRC требует настройки калькулятора полинома и установки бита '''CRCEN''' при конфигурировании режима работы SPI, а также установки бита '''CRCNEXT''' на последнем слове или полуслове для отправки CRC и выполнения проверки CRC для приема. Обратите внимание, что полином для расчета CRC должен быть единым как для отправки, так и для приема.Начало формы
</blockquote>
<span id="прямой-доступ-к-памяти-dma-2"></span>
=== 14.2.6 Прямой доступ к памяти (DMA)  ===

<blockquote>Модуль SPI поддерживает использование DMA для ускорения обмена данными, будь то заполнение буфера передачи с помощью DMA или своевременное получение данных из буфера приема посредством DMA. DMA будет своевременно забирать или отправлять данные, используя сигналы '''RXNE''' и '''TXE'''. DMA также может работать в симплексном режиме или режиме с проверкой CRC.

Начало формы

'''14.2.7 Ошибки'''
</blockquote>
* '''Ошибка режима Master (MODF)'''Когда SPI работает в режиме управления аппаратным обеспечением вывода NSS, происходит внешнее снижение уровня на выводе NSS; либо в режиме программного управления выводом NSS очищается бит SSI; либо очищается бит SPE, что приводит к отключению SPI; либо очищен бит MSTR, и SPI переходит в режим Slave. Если бит ERRIE уже установлен, также генерируется прерывание. Шаги для очистки бита MODF: Сначала выполните операцию чтения или записи в регистр R16_SPI1_STATR, затем запишите в регистр R16_SPI1_CTLR1.
* '''Переполнение'''Если хост передает данные, а в буфере приема ведомого устройства остаются непрочитанные данные, возникает ошибка переполнения, устанавливается бит OVR, и если установлен бит ERRIE, генерируется прерывание. Ошибка переполнения должна перезапустить текущую передачу. Чтение регистра данных, а затем чтение регистра состояния позволит устранить эту ошибку.
* '''Ошибки CRC'''При несоответствии принятого слова CRC и значения RXCRCR возникает ошибка CRC, и устанавливается бит CRCERR.Начало формы

<span id="прерывания-2"></span>
=== 14.2.8 Прерывания ===

<blockquote>Модуль SPI поддерживает пять источников прерываний, среди которых события '''TXE''' и '''RXNE''' устанавливаются, когда установлены соответствующие биты '''TXEIE''' и '''RXNEIE'''. Помимо этих событий, три упомянутые выше ошибки ('''MODF''', '''OVR''' и '''CRCERR''') также могут генерировать прерывания, если включен бит '''ERRIE'''. В таком случае эти три ошибки вызовут генерацию ошибок прерывания.
</blockquote>
<span id="описание-регистров-12"></span>
== 14.3 Описание регистров ==

Таблица 14-1 Список регистров, связанных с SPI

<span id="spi-control-register-1-spi_ctlr1"></span>
=== 14.3.1 SPI Control Register 1 (SPI_CTLR1)  ===

<span id="spi-control-register-2-spi_ctlr2"></span>
=== 14.3.2 SPI Control Register 2 (SPI_CTLR2)  ===

<span id="spi-status-register-spi_statr"></span>
=== 14.3.3 SPI Status Register (SPI_STATR)  ===

<span id="spi-data-register-spi_datar"></span>
=== 14.3.4 SPI Data Register (SPI_DATAR)  ===

<span id="spi1-polynomial-register-spi_crcr"></span>
=== 14.3.5 SPI1 Polynomial Register (SPI_CRCR)  ===

<span id="spi1-receive-crc-register-spi_rcrcr"></span>
=== 14.3.6 SPI1 Receive CRC Register (SPI_RCRCR)  ===

<span id="spi1-transmit-crc-register-spi_tcrcr"></span>
=== 14.3.7 SPI1 Transmit CRC Register (SPI_TCRCR)  ===

<span id="spi-high-speed-control-register-spi_hscr"></span>
=== 14.3.8 SPI High-speed Control Register (SPI_HSCR)  ===

<span id="глава-15-электронная-подпись-esig"></span>
= Глава 15 Электронная подпись (ESIG) =

<blockquote>Электронная подпись содержит информацию об идентификации микросхемы: емкость области флеш-памяти и уникальный идентификатор. Она записывается производителем в системную область хранения памяти модуля на заводе и может быть прочитана с помощью SWD (SDI) или прикладного кода.
</blockquote>
<span id="описание-функциональных-возможностей"></span>
== 15.1 Описание функциональных возможностей ==

<blockquote>Емкость Flash-памяти: Указывает текущий размер кристалла, доступный для использования пользовательскими приложениями. Уникальная идентификация: 96-битный двоичный код, уникален для любого микроконтроллера. Пользователь может только читать доступ, но не изменять его. Эта уникальная информация идентификации может использоваться в качестве пароля безопасности микроконтроллеров (продуктов), ключей шифрования и дешифровки, серийных номеров продуктов и т.д., для улучшения механизмов безопасности системы или для обозначения информации о личности. Все вышеперечисленное может быть доступно для чтения пользователем с использованием 8-, 16- или 32-битного доступа.
</blockquote>
<span id="описание-регистров-13"></span>
== 15.2 Описание регистров ==

Таблица 15-1 Список регистров, связанных с ESIG

<span id="flash-capacity-register-esig_flacap"></span>
=== 15.2.1 Flash capacity register (ESIG_FLACAP)  ===

<span id="uid-register-esig_uniid1"></span>
=== 15.2.2 UID Register (ESIG_UNIID1)  ===

<span id="uid-register-esig_uniid2"></span>
=== 15.2.3 UID Register (ESIG_UNIID2)  ===

<span id="uid-register-esig_uniid3"></span>
=== 15.2.4 UID Register (ESIG_UNIID3)  ===

<span id="глава-16-флеш-память-и-байты-опций-пользователя"></span>
= Глава 16 Флеш-память и байты опций пользователя =

<span id="организация-флеш-памяти"></span>
== 16.1 Организация флеш-памяти ==

<blockquote>Внутренняя флеш-память чипа организована следующим образом.

Начало формы

Таблица 16-1 Организация флеш-памяти

''Примечания: Основная область памяти, указанная выше, используется для хранения приложений пользователя и защищена от записи блоками по 1 Кбайт (16 страниц); за исключением области «слова конфигурационных настроек производителя», которая заблокирована заводским способом и недоступна пользователю, другие области доступны для операций пользователя при определенных условиях.''
</blockquote>
<span id="программирование-и-безопасность-флеш-памяти"></span>
== 16.2 Программирование и безопасность флеш-памяти ==

<span id="два-метода-программированиястирания"></span>
=== 16.2.1 Два метода программирования/стирания ===

* Стандартное программирование: Это режим программирования по умолчанию (совместимый режим). В этом режиме ЦПУ выполняет программирование отдельными двумя байтами и операции стирания и полного стирания отдельными блоками по 1 Кбайт.
* Быстрое программирование: Этот метод использует операции со страницей (рекомендуется). После определенной последовательности разблокировки выполняется программирование и стирание блоков по 64 байта, а также стирание блока размером 1Кбайт (стандартное полное стирание всего чипа также применимо для быстрого программирования).

<span id="безопасность-предотвращение-несанкционированного-доступа-чтение-запись-стирание"></span>
=== 16.2.2 Безопасность – Предотвращение несанкционированного доступа (чтение, запись, стирание) ===

* Защита страницы от записи
* Защита от чтения

<blockquote>Когда чип находится в состоянии защиты от чтения.
</blockquote>
# Страницы основной памяти с 0 по 32 (2 Кбайт) автоматически находятся в состоянии защиты от записи, не контролируемой регистром '''FLASH_WPR'''; состояние без защиты от чтения, все страницы основной памяти контролируются регистром FLASH_WPR.
# Область загрузочного кода системы, режим SDI и область RAM не подлежат стиранию или программированию для основной памяти, за исключением полного стирания всего чипа. Области байтов опций пользователя могут быть стерты или запрограммированы. Если предпринята попытка снять защиту от чтения (запрограммировать слово пользователя), чип автоматически сотрет всю область пользователя.

<blockquote>''Начало формы''

''Примечание: Внутренний RC-генератор (HSI) должен быть включен во время выполнения операции программирования/стирания флеш-памяти.''
</blockquote>
<span id="описание-регистров-14"></span>
== 16.3 Описание регистров  ==

<blockquote>Таблица 16-2 Список регистров, связанных с FLASH
</blockquote>
<span id="control-register-flash_actlr"></span>
=== 16.3.1 Control Register (FLASH_ACTLR)  ===

<span id="fpec-key-register-flash_keyr"></span>
=== 16.3.2 FPEC Key Register (FLASH_KEYR)  ===

<span id="obkey-register-flash_obkeyr"></span>
=== 16.3.3 OBKEY Register (FLASH_OBKEYR)  ===

<span id="status-register-flash_statr"></span>
=== 16.3.4 Status Register (FLASH_STATR)  ===

''Примечание: При выполнении операции программирования необходимо убедиться, что бит '''STRT''' регистра '''FLASH_CTLR''' равен нулю.''

<span id="configuration-register-flash_-ctlr"></span>
=== 16.3.5 Configuration Register (FLASH_ CTLR)  ===

<span id="address-register-flash_-addr"></span>
=== 16.3.6 Address Register (FLASH_ ADDR)  ===

<span id="option-byte-register-flash_obr"></span>
=== 16.3.7 Option Byte Register (FLASH_OBR)  ===

''Примечание: '''USER''' и '''RDPRT''' загружаются из области байтов опций пользователя после сброса системы.''

<span id="write-protect-register-flash_wpr"></span>
=== 16.3.8 Write Protect Register (FLASH_WPR)  ===

<blockquote>''Note: '''WPR''' is loaded from the user-option bytes area after a system reset.''
</blockquote>
<span id="extended-key-register-flash_modekeyr"></span>
=== 16.3.9 Extended Key Register (FLASH_MODEKEYR)  ===

<span id="boot-key-register-flash_boot_modekeyp"></span>
=== 16.3.10 BOOT Key Register (FLASH_BOOT_MODEKEYP)  ===

<span id="последовательность-операций-с-флеш-памятью"></span>
== 16.4 Последовательность операций с флеш-памятью ==

<span id="начало-формы-4"></span>
== Начало формы ==

<span id="операции-чтения"></span>
=== 16.4.1 Операции чтения  ===

Используя прямое обращение в общем адресном пространстве, любая операция чтения данных размером 8/16/32 бита может получить доступ к содержимому модуля флеш-памяти и получить соответствующие данные.

<span id="деблокировка-флешпамяти"></span>
=== 16.4.2 Деблокировка флешпамяти  ===

<blockquote>После сброса системы, контроллер флеш-памяти ('''FPEC''') и регистр '''FLASH_CTLR''' заблокированы и недоступны. Разблокировка модуля контроллера флеш-памяти возможна путём записи определённой последовательности в регистр '''FLASH_KEYR'''.
</blockquote>
Последовательность разблокировки.

# Записать значение KEY1 = 0x45670123 в регистр '''FLASH_KEYR''' (шаг 1 обязательно должен быть KEY1).
# Записать значение KEY2 = 0xCDEF89AB в регистр '''FLASH_KEYR''' (шаг 2 обязательно должен быть KEY2).

Вышеуказанные операции должны выполняться последовательно и непрерывно, иначе они будут считаться ошибочными операциями, которые заблокируют модуль '''FPEC''' и регистры '''FLASH_CTLR''' и вызовут ошибки шины до следующего сброса системы. Контроллер флеш-памяти ('''FPEC''') и регистры '''FLASH_CTLR''' могут быть снова заблокированы путем установки бита &quot;'''LOCK'''&quot; регистра '''FLASH_CTLR''' в 1.

<span id="стандартное-программирование-основной-памяти"></span>
=== 16.4.3 Стандартное программирование основной памяти  ===

<blockquote>Стандартное программирование может осуществляться двумя байтами за раз. Когда бит PG регистра '''FLASH_CTLR''' установлен в '1', каждая половина слова (два байта), записываемая по адресу флеш-памяти, инициирует однократное программирование, а запись любых данных, отличных от половины слова, вызовет генерацию контроллером '''FPEC''' ошибки шины. Во время программирования бит '''BSY''' установлен в '1', а по завершении программирования бит '''BSY''' сбрасывается в '0', а бит '''EOP''' устанавливается в '1'.
</blockquote>
''Примечание: Когда бит '''BSY''' установлен в '1', выполнение операции записи в любой регистр будет запрещено.''

<blockquote>''Начало формы''
</blockquote>
''<br />
''<br />
Рисунок 16-1 Программирование FLASH

Прочитайте бит LOCK регистра FLASH_CTRL

Начало формы

BSY Бит = 1 ?

Выполнить операцию &quot;Разблокировка флеш-памяти&quot;

Установить FLASH_CTLR PG бит = 1

Запись полуслова (2 байта) по указанному адресу

Начало формы

Чтение EOP/WRPRTERR для оценки результата программирования Чтение адреса для проверки записанных запрограммированных данных

Продолжить программирование

Конец, бит PG = 0

Бит LOCK = 1 ?

Да

Нет

Нет

Да

Да

Нет

# Проверьте бит '''LOCK''' регистра '''FLASH_CTLR'''; если он равен 1, вам потребуется выполнить операцию &quot;Разблокировка флеш-памяти&quot;.
# Установите бит '''PG''' регистра '''FLASH_CTLR''' в '1', чтобы включить стандартный режим программирования.
# Запишите половину слова, которую вы хотите запрограммировать, по заданному адресу флеш-памяти (четный адрес).
# Подождите, пока бит '''BSY''' станет равным '0' или бит '''EOP''' регистра '''FLASH_STATR''' станет равным '1', что указывает на окончание программирования, и очистите бит '''EOP''' до нуля.
# Просмотрите регистр '''FLASH_STATR''', чтобы узнать, была ли допущена ошибка, или прочтите контрольную сумму данных запрограммированного адреса.
# Продолжите программирование, повторив шаги 3-5, и завершите программирование, очистив бит '''PG''' до нуля.

Начало формы

<span id="стандартное-стирание-основной-памяти"></span>
=== 16.4.4 Стандартное стирание основной памяти ===

<blockquote>Флеш-память может быть стерта стандартными страницами (по 1 Кбайт) или целиком.

Рисунок 16-2 Стирание страницы FLASH
</blockquote>
Read the LOCK bit of

FLASH_CTRL

BSY bit=1

？

Perform &quot;Unlock Flash

Memory&quot; operation

Set FLASH_CTLR

的

PER bit=1

Set FLASH_CTLR STRT bit=1

Read out erase page data

verification

Continue

erasing?

Over

，

PEG bit=0

LOCK bit=1?

YES

NO

NO

YES

YES

NO

Write the erased page header

address in FLASH_ADDR register

(

)

erase 8 pages at a time

# Проверьте бит '''LOCK''' регистра '''FLASH_CTLR'''; если он равен 1, вам потребуется выполнить операцию &quot;Разблокировка флеш-памяти&quot;.
# Установите бит '''PER''' регистра '''FLASH_CTLR''' в '1', чтобы включить стандартный режим стирания страницы.
# Запишите адрес заголовка страницы выбранного стирания в регистр FLASH_ADDR.
# Установите бит '''STRT''' регистра '''FLASH_CTLR''' в '1', чтобы инициировать действие стирания.
# Дождитесь, пока бит '''BSY''' станет равным '0' или бит '''EOP''' регистра '''FLASH_STATR''' станет равным '1', что указывает на завершение стирания, и очистите бит '''EOP''' до нуля.
# Прочтите данные стертых страниц для проверки.
# Продолжите стандартное стирание страницы, повторяя шаги 3-5, и закончите стирание, очистив бит '''PEG''' до нуля.

<blockquote>Начало формы

Рисунок 16-3 Полное стирание всего чипа FLASH
</blockquote>
Read the LOCK bit of

FLASH_CTRL

BSY bit=1

？

Perform &quot;Unlock Flash

Memory&quot; operation

Set FLASH_CTLR MER bit=1

Set FLASH_CTLR STRT bit=1

Read out all pages of data to

verify

Over

，

MEG

bit=0

LOCK bit=1?

YES

NO

YES

NO

<ol start="8" style="list-style-type: decimal;">
<li><p>Проверьте бит '''LOCK''' регистра '''FLASH_CTLR'''; если он равен 1, вам потребуется выполнить операцию &quot;Разблокировка флеш-памяти&quot;.</p></li>
<li><p>Установите бит '''MER''' регистра '''FLASH_CTLR''' в '1', чтобы включить режим полного стирания чипа.</p></li>
<li><p>Установите бит '''STRT''' регистра '''FLASH_CTLR''' в '1', чтобы начать процесс стирания.</p></li>
<li><p>Дождитесь, пока бит '''BSY''' станет равным '0' или бит '''EOP''' регистра '''FLASH_STATR''' станет равным '1', что указывает на завершение стирания, и очистите бит '''EOP''' до нуля.</p></li>
<li><p>Прочтите данные стертых страниц для проверки.</p></li>
<li><p>Очистите бит '''MER''' до нуля.</p></li></ol>

Начало формы

<span id="разблокировка-режима-быстрого-программирования"></span>
=== 16.4.5 Разблокировка режима быстрого программирования ===

<blockquote>Операция в режиме быстрого программирования может быть разблокирована путем записи последовательности в регистр '''FLASH_MODEKEYR'''. После разблокировки бит '''FLOCK''' регистра '''FLASH_CTLR''' будет очищен до 0, что указывает на возможность выполнения операций быстрого стирания и программирования. Регистр '''FLASH_CTLR''' снова блокируется программным обеспечением путем установки бита &quot;'''FLOCK'''&quot; в 1.

Последовательность разблокировки.
</blockquote>
# Запишите значение KEY1 = 0x45670123 в регистр FLASH_MODEKEYR.
# Запишите значение KEY2 = 0xCDEF89AB в регистр FLASH_MODEKEYR.

<blockquote>Начало формы

Эти операции должны выполняться последовательно и непрерывно, иначе они будут рассматриваться как неправильные операции, которые приведут к блокировке, и их нельзя будет разблокировать повторно до следующего сброса системы.

''Примечание: Операции быстрого программирования требуют снятия блокировки уровней &quot;LOCK&quot; и &quot;FLOCK&quot;.''
</blockquote>
<span id="быстрое-программирование-основной-памяти"></span>
=== 16.4.6 Быстрое программирование основной памяти ===

<span id="начало-формы-5"></span>
=== Начало формы ===

Быстрое программирование по странице (64 байта).

# Проверьте бит '''LOCK''' регистра '''FLASH_CTLR'''; если он равен 1, вам потребуется выполнить операцию &quot;Разблокировка флеш-памяти&quot;.
# Проверьте бит '''BSY''' регистра '''FLASH_STATR''', чтобы подтвердить отсутствие других выполняемых операций программирования.
# Проверьте бит '''FLOCK''' регистра '''FLASH_CTLR'''; если он равен 1, вам понадобится выполнить операцию &quot;разблокировки режима быстрого программирования&quot;.
# Установите бит '''FTPG''' регистра '''FLASH_CTLR''', чтобы включить функцию быстрого программирования.
# Установите бит '''BUFRST''' регистра '''FLASH_CTLR''', чтобы выполнить операцию очистки внутреннего буфера объемом 64 байта.
# Дождитесь, пока бит '''BSY''' станет равным '0' или бит '''EOP''' регистра '''FLASH_STATR''' станет равным '1', что указывает на завершение очистки, и очистите бит '''EOP''' до нуля.
# Начните запись четырех байтов данных по указанному адресу (4 байта/операция), затем установите бит '''BUFLOAD''' регистра '''FLASH_CTLR''' и выполните загрузку в буфер.
# Дождитесь, пока бит '''BYS''' станет равным '0' или бит '''EOP''' регистра '''FLASH_STATR''' станет равным '1', что укажет на завершение загрузки, и очистите бит '''EOP''' до нуля.
# Повторяйте шаги 7-8 в общей сложности 16 раз, чтобы загрузить все 64 байта данных в буфер (адреса операций в 16 циклах должны идти подряд).
# Запишите первый адрес быстрой программируемой страницы в регистр FLASH_ADDR.
# Установите бит '''STRT''' регистра '''FLASH_CTLR''' в '1', чтобы запустить быструю страницу программирования.
# Дождитесь, пока бит '''BSY''' станет равным '0' или бит '''EOP''' регистра '''FLASH_STATR''' станет равным '1', что свидетельствует о завершении программирования, и сбросьте бит '''EOP''' в ноль.
# Запросите регистр '''FLASH_STATR''', чтобы проверить наличие ошибок, или прочитайте контрольную сумму данных по запрограммированному адресу.
# Вы можете продолжить быстрое программирование страницы, повторив шаги 5-13, и завершить программирование, сбросив бит '''FTPG''' до нуля.

Начало формы

Конец формы

<span id="section-4"></span>
===  ===

<span id="быстрое-стирание-основной-памяти"></span>
=== 16.4.7 Быстрое стирание основной памяти ===

Быстрое стирание удаляет данные постранично (64 байта).

# Проверьте бит '''LOCK''' регистра '''FLASH_CTLR'''; если он равен 1, вам потребуется выполнить операцию &quot;Разблокировка флеш-памяти&quot;.
# Проверьте бит '''FLOCK''' регистра '''FLASH_CTLR'''; если он равен 1, вам придется выполнить операцию разблокировки режима быстрого программирования.
# Проверьте бит '''BSY''' регистра '''FLASH_STATR''', чтобы убедиться, что никаких других операций программирования не проводится.
# Установите бит '''FTER''' регистра '''FLASH_CTLR''' в '1', чтобы включить функцию быстрого стирания страницы (64 байта).
# Запишите первый адрес быстро стираемой страницы в регистр '''FLASH_ADDR'''.
# Установите бит '''STRT''' регистра '''FLASH_CTLR''' в '1' для запуска быстрого стирания страницы (64 байта).
# Дождитесь, пока бит '''BSY''' станет равным '0' или бит '''EOP''' регистра '''FLASH_STATR''' станет равным '1', что укажет на завершение стирания, и очистите бит '''EOP''' до нуля.
# Запросите регистр '''FLASH_STATR''', чтобы проверить наличие ошибок, или прочитайте контрольную сумму данных по адресу стертых страниц.
# Вы можете продолжить быстрое стирание страницы, повторив шаги 5-8, и завершить стирание, сбросив бит '''FTER''' до нуля.

<span id="байты-опций-пользователя"></span>
== 16.5 Байты опций пользователя ==

<span id="начало-формы-6"></span>
== Начало формы ==

<blockquote>Байт опций пользователя фиксируется в FLASH и будет перезагружен в соответствующий регистр после сброса системы и может быть произвольно стерт и запрограммирован пользователем. Блок информации байтов опций пользователя состоит из восьми байтов (четыре байта для защиты от записи, один байт для защиты от чтения, один байт для параметров конфигурации и два байта для хранения пользовательских данных), и каждый бит имеет свой инверсный бит кода для проверки при загрузке. Далее описываются структура и смысл байтов опции.

Таблица 16-3 Разделение формата байтов опций на 32 бита
</blockquote>
[

<blockquote>Таблица 16-4 Структура информации байтов опций пользователя

Начало формы
</blockquote>
<span id="разблокировка-байтов-опций-пользователя"></span>
=== 16.5.1 Разблокировка байтов опций пользователя ===

<span id="начало-формы-7"></span>
=== Начало формы ===

<blockquote>Операцию с байтами опций пользователя можно разблокировать, записав последовательность в регистр '''FLASH_OBKEYR'''. После разблокировки бит '''OBWRE''' регистра '''FLASH_CTLR''' будет установлен в 1, что указывает на то, что байты опций пользователя могут быть стерты и запрограммированы. Его можно снова заблокировать, сбросив бит &quot;'''OBWRE'''&quot; регистра '''FLASH_CTLR''' до 0 с помощью программного обеспечения.

Последовательность разблокировки.
</blockquote>
# Запишите значение KEY1 = 0x45670123 в регистр FLASH_OBKEYR.
# Запишите значение KEY2 = 0xCDEF89AB в регистр FLASH_OBKEYR.

<blockquote>Начало формы

''Примечание: Операции с байтами опций пользователя требуют снятия блокировки слоев &quot;'''LOCK'''&quot; и &quot;'''OBWRE'''&quot;.''
</blockquote>
<span id="программирование-байтов-опций-пользователя"></span>
=== 16.5.2 Программирование байтов опций пользователя ===

<blockquote>Поддерживается только стандартный метод программирования, при котором запись осуществляется половинами слов (по 2 байта) за раз. На практике, при программировании байтов опций пользователя '''FPEC''' использует только младший байт в половине слова и автоматически рассчитывает старший байт (старший байт является обратным младшему байту), а затем запускает операцию программирования, что гарантирует, что байт в байтах опций пользователя и его обратный код всегда верны.
</blockquote>
<ol start="10" style="list-style-type: decimal;">
<li><p>Проверьте бит '''LOCK''' регистра '''FLASH_CTLR'''; если он равен 1, вам потребуется выполнить операцию &quot;Разблокировка флеш-памяти&quot;.</p></li>
<li><p>Проверьте бит '''BSY''' регистра '''FLASH_STATR''', чтобы убедиться, что никакие другие операции программирования не проводятся.</p></li>
<li><p>Установите бит '''OBPG''' регистра '''FLASH_CTLR''' в '1', затем установите бит '''STAT''' регистра '''FLASH_CTLR''' в '1' для включения программирования байтов опций пользователя.</p></li>
<li><p>Установите бит '''OBPG''' в регистре '''FLASH_CTLR''' на '1'.</p></li>
<li><p>Запишите половину слова (2 байта), которую вы хотите запрограммировать, по указанному адресу.</p></li>
<li><p>Дождитесь, пока бит '''BSY''' станет равным '0' или бит '''EOP''' регистра '''FLASH_STATR''' станет равным '1', что указывает на завершение программирования, и очистите бит '''EOP''' до нуля.</p></li>
<li><p>Прочтите контрольную сумму данных по запрограммированному адресу.</p></li>
<li><p>Если вы продолжаете программирование, вы можете повторить шаги 5-7 и завершить программирование, сбросив бит '''OBPG''' до нуля.</p></li></ol>

<blockquote>''Примечание: Когда параметр &quot;Защищено от чтения&quot; в выбранном слове изменяется на &quot;Не защищено&quot;, автоматически выполняется полная очистка основной памяти. Если изменён другой параметр, отличный от &quot;защищенного от чтения&quot;, операция полной очистки не произойдёт.''
</blockquote>
<span id="стирание-байтов-опций-пользователя"></span>
=== 16.5.3 Стирание байтов опций пользователя ===

<span id="начало-формы-8"></span>
=== Начало формы ===

Полностью стирать область байтов опций пользователя размером 64 байта.

# Проверьте бит '''LOCK''' регистра '''FLASH_CTLR'''; если он равен 1, вам потребуется выполнить операцию &quot;Разблокировка флеш-памяти&quot;.
# Проверьте бит '''BSY''' регистра '''FLASH_STATR''', чтобы убедиться, что нет активных операций программирования.
# Проверьте бит '''OBWRE''' регистра '''FLASH_CTLR'''; если он равен 0, вам необходимо выполнить операцию разблокировки байтов опций пользователя.
# Установите бит '''OBER''' регистра '''FLASH_CTLR''' в '1', затем установите бит '''STAT''' регистра '''FLASH_CTLR''' в '1' для включения функции стирания байтов опций пользователя.
# Дождитесь, пока бит BSY станет равным '0' или бит '''EOP''' регистра '''FLASH_STATR''' станет равным '1', что указывает на завершение стирания, и очистите бит '''EOP''' до нуля.
# Прочтите и проверьте контрольную сумму данных по адресу стирания.
# Завершение операции стирания путем сброса бита '''OBER''' до нуля.

<span id="снятие-защиты-от-чтения"></span>
=== 16.5.4 Снятие защиты от чтения ===

<span id="начало-формы-9"></span>
=== Начало формы ===

Защищены ли данные флэш-памяти от чтения или нет, определяется байтом опций пользователя. Прочитайте регистр '''FLASH_OBR''', когда бит '''RDPRT''' равен '1', это означает, что в данный момент флэш-память находится в состоянии защиты от чтения, и работа флэш-памяти защищена рядом защитных мер для защиты от считывания. Процедура снятия защиты от чтении выглядит следующим образом.

# Стереть всю область байтов опций пользователя, в этот момент поле '''RDPR''' остается в силе, и защита от чтения сохраняется.
# Выполните программирование байтов опций пользователя и запишите правильный код '''RDPR''' 0xA5 для снятия защиты чтения с флэш-памяти. (Этот шаг сначала заставит систему автоматически выполнить полную операцию стирания флэш-памяти.)
# Выполняйте сброс питания для перезагрузки байта выбора (включая новый код '''RDPR'''), после чего снимается защита от чтения.

Начало формы

<span id="глава-17-расширенная-конфигурация"></span>
= Глава 17 Расширенная конфигурация =

<span id="начало-формы-10"></span>
= Начало формы =

<span id="расширенная-конфигурация"></span>
== 17.1 Расширенная конфигурация ==

Система предоставляет расширенную конфигурационную единицу EXTEND (регистр '''EXTEND_CTR'''). Эта единица использует тактовый сигнал HB и выполняет сброс только при системном сбросе. Он включает следующие основные функции управляющих битов:

# '''Регулировка встроенного напряжения''': Поле '''LDOTRIM''' выбирает значение по умолчанию, которое можно изменить при настройке производительности и энергопотребления.
# '''Мониторинг функции блокировки''': Включается поле '''LKUPEN''', что открывает мониторинг ситуации блокировки системы. Как только произойдет ситуация блокировки, система выполнит программный сброс и установит флаг '''LKUPRESET''' в 1. После чтения можно записать 1, чтобы сбросить этот флажок.
# '''Конфигурация усилителя''': Установите '''OPA_EN''' для включения OPA, настройте '''OPA_PSEL''' для выбора положительного входного контакта OPA и настройте '''OPA_NSEL''' для выбора отрицательного входного контакта OPA.

Начало формы

<span id="описание-регистров-15"></span>
== 17.2 Описание регистров ==

<span id="начало-формы-11"></span>
== Начало формы ==

<blockquote>Таблица 17-1 Список регистров, связанных с EXTEND
</blockquote>
<span id="section-5"></span>
===  ===

<span id="configure-extended-control-register-extend_ctr"></span>
=== 17.2.1 Configure Extended Control Register (EXTEND_CTR)  ===

<span id="глава-18-поддержка-отладки-dbg"></span>
= Глава 18 Поддержка отладки (DBG) =

<span id="основные-возможности-4"></span>
== 18.1 Основные возможности ==

<span id="начало-формы-12"></span>
== Начало формы ==

Этот регистр позволяет настроить микроконтроллер в режиме отладки. Он включает в себя:

* Включенные счетчики независимого сторожевого таймера (IWDG)
* Включенные счетчики оконного сторожевого таймера (WWDG)
* Включенные счетчики таймера 1
* Включенные счетчики таймера 2

Начало формы

<span id="section-6"></span>
==  ==

<span id="описание-регистра"></span>
== 18.2 Описание регистра ==

<span id="debug-mcu-configuration-register-dbgmcu_cr"></span>
=== 18.2.1 Debug MCU Configuration Register (DBGMCU_CR)  ===
